var Ba=Object.defineProperty,Fa=Object.defineProperties;var Da=Object.getOwnPropertyDescriptors;var bn=Object.getOwnPropertySymbols;var xa=Object.prototype.hasOwnProperty,va=Object.prototype.propertyIsEnumerable;var ya=(xt,Rt,K)=>Rt in xt?Ba(xt,Rt,{enumerable:!0,configurable:!0,writable:!0,value:K}):xt[Rt]=K,fe=(xt,Rt)=>{for(var K in Rt||(Rt={}))xa.call(Rt,K)&&ya(xt,K,Rt[K]);if(bn)for(var K of bn(Rt))va.call(Rt,K)&&ya(xt,K,Rt[K]);return xt},fi=(xt,Rt)=>Fa(xt,Da(Rt));var ta=(xt,Rt)=>{var K={};for(var f in xt)xa.call(xt,f)&&Rt.indexOf(f)<0&&(K[f]=xt[f]);if(xt!=null&&bn)for(var f of bn(xt))Rt.indexOf(f)<0&&va.call(xt,f)&&(K[f]=xt[f]);return K};var Pt=(xt,Rt,K)=>new Promise((f,ut)=>{var at=dt=>{try{Y(K.next(dt))}catch(O){ut(O)}},vt=dt=>{try{Y(K.throw(dt))}catch(O){ut(O)}},Y=dt=>dt.done?f(dt.value):Promise.resolve(dt.value).then(at,vt);Y((K=K.apply(xt,Rt)).next())});(self.webpackChunkstellar_odyssey=self.webpackChunkstellar_odyssey||[]).push([[465],{924:function(xt,Rt,K){"use strict";var f=K(210),ut=K(559),at=ut(f("String.prototype.indexOf"));xt.exports=function(Y,dt){var O=f(Y,!!dt);return typeof O=="function"&&at(Y,".prototype.")>-1?ut(O):O}},559:function(xt,Rt,K){"use strict";var f=K(612),ut=K(210),at=K(771),vt=ut("%TypeError%"),Y=ut("%Function.prototype.apply%"),dt=ut("%Function.prototype.call%"),O=ut("%Reflect.apply%",!0)||f.call(dt,Y),J=ut("%Object.defineProperty%",!0),V=ut("%Math.max%");if(J)try{J({},"a",{value:1})}catch(q){J=null}xt.exports=function(ft){if(typeof ft!="function")throw new vt("a function is required");var pt=O(f,dt,arguments);return at(pt,1+V(0,ft.length-(arguments.length-1)),!0)};var F=function(){return O(f,Y,arguments)};J?J(xt.exports,"apply",{value:F}):xt.exports.apply=F},296:function(xt,Rt,K){"use strict";var f=K(44)(),ut=K(210),at=f&&ut("%Object.defineProperty%",!0);if(at)try{at({},"a",{value:1})}catch(O){at=!1}var vt=ut("%SyntaxError%"),Y=ut("%TypeError%"),dt=K(275);xt.exports=function(J,V,F){if(!J||typeof J!="object"&&typeof J!="function")throw new Y("`obj` must be an object or a function`");if(typeof V!="string"&&typeof V!="symbol")throw new Y("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!="boolean"&&arguments[3]!==null)throw new Y("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!="boolean"&&arguments[4]!==null)throw new Y("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!="boolean"&&arguments[5]!==null)throw new Y("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!="boolean")throw new Y("`loose`, if provided, must be a boolean");var q=arguments.length>3?arguments[3]:null,ft=arguments.length>4?arguments[4]:null,pt=arguments.length>5?arguments[5]:null,H=arguments.length>6?arguments[6]:!1,mt=!!dt&&dt(J,V);if(at)at(J,V,{configurable:pt===null&&mt?mt.configurable:!pt,enumerable:q===null&&mt?mt.enumerable:!q,value:F,writable:ft===null&&mt?mt.writable:!ft});else if(H||!q&&!ft&&!pt)J[V]=F;else throw new vt("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.")}},187:function(xt){"use strict";xt.exports=Rt,xt.exports.default=Rt;function Rt(A,I,S){S=S||2;var z=I&&I.length,X=z?I[0]*S:A.length,M=K(A,0,X,S,!0),N=[];if(!M||M.next===M.prev)return N;var Q,ht,gt,lt,Tt,wt,Mt;if(z&&(M=O(A,I,M,S)),A.length>80*S){Q=gt=A[0],ht=lt=A[1];for(var Ft=S;Ft<X;Ft+=S)Tt=A[Ft],wt=A[Ft+1],Tt<Q&&(Q=Tt),wt<ht&&(ht=wt),Tt>gt&&(gt=Tt),wt>lt&&(lt=wt);Mt=Math.max(gt-Q,lt-ht),Mt=Mt!==0?32767/Mt:0}return ut(M,N,S,Q,ht,Mt,0),N}function K(A,I,S,z,X){var M,N;if(X===ot(A,I,S,z)>0)for(M=I;M<S;M+=z)N=Ut(M,A[M],A[M+1],N);else for(M=S-z;M>=I;M-=z)N=Ut(M,A[M],A[M+1],N);return N&&j(N,N.next)&&(Ht(N),N=N.next),N}function f(A,I){if(!A)return A;I||(I=A);var S=A,z;do if(z=!1,!S.steiner&&(j(S,S.next)||G(S.prev,S,S.next)===0)){if(Ht(S),S=I=S.prev,S===S.next)break;z=!0}else S=S.next;while(z||S!==I);return I}function ut(A,I,S,z,X,M,N){if(A){!N&&M&&ft(A,z,X,M);for(var Q=A,ht,gt;A.prev!==A.next;){if(ht=A.prev,gt=A.next,M?vt(A,z,X,M):at(A)){I.push(ht.i/S|0),I.push(A.i/S|0),I.push(gt.i/S|0),Ht(A),A=gt.next,Q=gt.next;continue}if(A=gt,A===Q){N?N===1?(A=Y(f(A),I,S),ut(A,I,S,z,X,M,2)):N===2&&dt(A,I,S,z,X,M):ut(f(A),I,S,z,X,M,1);break}}}}function at(A){var I=A.prev,S=A,z=A.next;if(G(I,S,z)>=0)return!1;for(var X=I.x,M=S.x,N=z.x,Q=I.y,ht=S.y,gt=z.y,lt=X<M?X<N?X:N:M<N?M:N,Tt=Q<ht?Q<gt?Q:gt:ht<gt?ht:gt,wt=X>M?X>N?X:N:M>N?M:N,Mt=Q>ht?Q>gt?Q:gt:ht>gt?ht:gt,Ft=z.next;Ft!==I;){if(Ft.x>=lt&&Ft.x<=wt&&Ft.y>=Tt&&Ft.y<=Mt&&it(X,Q,M,ht,N,gt,Ft.x,Ft.y)&&G(Ft.prev,Ft,Ft.next)>=0)return!1;Ft=Ft.next}return!0}function vt(A,I,S,z){var X=A.prev,M=A,N=A.next;if(G(X,M,N)>=0)return!1;for(var Q=X.x,ht=M.x,gt=N.x,lt=X.y,Tt=M.y,wt=N.y,Mt=Q<ht?Q<gt?Q:gt:ht<gt?ht:gt,Ft=lt<Tt?lt<wt?lt:wt:Tt<wt?Tt:wt,ae=Q>ht?Q>gt?Q:gt:ht>gt?ht:gt,qt=lt>Tt?lt>wt?lt:wt:Tt>wt?Tt:wt,Et=H(Mt,Ft,I,S,z),ue=H(ae,qt,I,S,z),Ot=A.prevZ,Lt=A.nextZ;Ot&&Ot.z>=Et&&Lt&&Lt.z<=ue;){if(Ot.x>=Mt&&Ot.x<=ae&&Ot.y>=Ft&&Ot.y<=qt&&Ot!==X&&Ot!==N&&it(Q,lt,ht,Tt,gt,wt,Ot.x,Ot.y)&&G(Ot.prev,Ot,Ot.next)>=0||(Ot=Ot.prevZ,Lt.x>=Mt&&Lt.x<=ae&&Lt.y>=Ft&&Lt.y<=qt&&Lt!==X&&Lt!==N&&it(Q,lt,ht,Tt,gt,wt,Lt.x,Lt.y)&&G(Lt.prev,Lt,Lt.next)>=0))return!1;Lt=Lt.nextZ}for(;Ot&&Ot.z>=Et;){if(Ot.x>=Mt&&Ot.x<=ae&&Ot.y>=Ft&&Ot.y<=qt&&Ot!==X&&Ot!==N&&it(Q,lt,ht,Tt,gt,wt,Ot.x,Ot.y)&&G(Ot.prev,Ot,Ot.next)>=0)return!1;Ot=Ot.prevZ}for(;Lt&&Lt.z<=ue;){if(Lt.x>=Mt&&Lt.x<=ae&&Lt.y>=Ft&&Lt.y<=qt&&Lt!==X&&Lt!==N&&it(Q,lt,ht,Tt,gt,wt,Lt.x,Lt.y)&&G(Lt.prev,Lt,Lt.next)>=0)return!1;Lt=Lt.nextZ}return!0}function Y(A,I,S){var z=A;do{var X=z.prev,M=z.next.next;!j(X,M)&&rt(X,z,z.next,M)&&bt(X,M)&&bt(M,X)&&(I.push(X.i/S|0),I.push(z.i/S|0),I.push(M.i/S|0),Ht(z),Ht(z.next),z=A=M),z=z.next}while(z!==A);return f(z)}function dt(A,I,S,z,X,M){var N=A;do{for(var Q=N.next.next;Q!==N.prev;){if(N.i!==Q.i&&C(N,Q)){var ht=Gt(N,Q);N=f(N,N.next),ht=f(ht,ht.next),ut(N,I,S,z,X,M,0),ut(ht,I,S,z,X,M,0);return}Q=Q.next}N=N.next}while(N!==A)}function O(A,I,S,z){var X=[],M,N,Q,ht,gt;for(M=0,N=I.length;M<N;M++)Q=I[M]*z,ht=M<N-1?I[M+1]*z:A.length,gt=K(A,Q,ht,z,!1),gt===gt.next&&(gt.steiner=!0),X.push(mt(gt));for(X.sort(J),M=0;M<X.length;M++)S=V(X[M],S);return S}function J(A,I){return A.x-I.x}function V(A,I){var S=F(A,I);if(!S)return I;var z=Gt(S,A);return f(z,z.next),f(S,S.next)}function F(A,I){var S=I,z=A.x,X=A.y,M=-1/0,N;do{if(X<=S.y&&X>=S.next.y&&S.next.y!==S.y){var Q=S.x+(X-S.y)*(S.next.x-S.x)/(S.next.y-S.y);if(Q<=z&&Q>M&&(M=Q,N=S.x<S.next.x?S:S.next,Q===z))return N}S=S.next}while(S!==I);if(!N)return null;var ht=N,gt=N.x,lt=N.y,Tt=1/0,wt;S=N;do z>=S.x&&S.x>=gt&&z!==S.x&&it(X<lt?z:M,X,gt,lt,X<lt?M:z,X,S.x,S.y)&&(wt=Math.abs(X-S.y)/(z-S.x),bt(S,A)&&(wt<Tt||wt===Tt&&(S.x>N.x||S.x===N.x&&q(N,S)))&&(N=S,Tt=wt)),S=S.next;while(S!==ht);return N}function q(A,I){return G(A.prev,A,I.prev)<0&&G(I.next,A,A.next)<0}function ft(A,I,S,z){var X=A;do X.z===0&&(X.z=H(X.x,X.y,I,S,z)),X.prevZ=X.prev,X.nextZ=X.next,X=X.next;while(X!==A);X.prevZ.nextZ=null,X.prevZ=null,pt(X)}function pt(A){var I,S,z,X,M,N,Q,ht,gt=1;do{for(S=A,A=null,M=null,N=0;S;){for(N++,z=S,Q=0,I=0;I<gt&&(Q++,z=z.nextZ,!!z);I++);for(ht=gt;Q>0||ht>0&&z;)Q!==0&&(ht===0||!z||S.z<=z.z)?(X=S,S=S.nextZ,Q--):(X=z,z=z.nextZ,ht--),M?M.nextZ=X:A=X,X.prevZ=M,M=X;S=z}M.nextZ=null,gt*=2}while(N>1);return A}function H(A,I,S,z,X){return A=(A-S)*X|0,I=(I-z)*X|0,A=(A|A<<8)&16711935,A=(A|A<<4)&252645135,A=(A|A<<2)&858993459,A=(A|A<<1)&1431655765,I=(I|I<<8)&16711935,I=(I|I<<4)&252645135,I=(I|I<<2)&858993459,I=(I|I<<1)&1431655765,A|I<<1}function mt(A){var I=A,S=A;do(I.x<S.x||I.x===S.x&&I.y<S.y)&&(S=I),I=I.next;while(I!==A);return S}function it(A,I,S,z,X,M,N,Q){return(X-N)*(I-Q)>=(A-N)*(M-Q)&&(A-N)*(z-Q)>=(S-N)*(I-Q)&&(S-N)*(M-Q)>=(X-N)*(z-Q)}function C(A,I){return A.next.i!==I.i&&A.prev.i!==I.i&&!P(A,I)&&(bt(A,I)&&bt(I,A)&&B(A,I)&&(G(A.prev,A,I.prev)||G(A,I.prev,I))||j(A,I)&&G(A.prev,A,A.next)>0&&G(I.prev,I,I.next)>0)}function G(A,I,S){return(I.y-A.y)*(S.x-I.x)-(I.x-A.x)*(S.y-I.y)}function j(A,I){return A.x===I.x&&A.y===I.y}function rt(A,I,S,z){var X=_t(G(A,I,S)),M=_t(G(A,I,z)),N=_t(G(S,z,A)),Q=_t(G(S,z,I));return!!(X!==M&&N!==Q||X===0&&ct(A,S,I)||M===0&&ct(A,z,I)||N===0&&ct(S,A,z)||Q===0&&ct(S,I,z))}function ct(A,I,S){return I.x<=Math.max(A.x,S.x)&&I.x>=Math.min(A.x,S.x)&&I.y<=Math.max(A.y,S.y)&&I.y>=Math.min(A.y,S.y)}function _t(A){return A>0?1:A<0?-1:0}function P(A,I){var S=A;do{if(S.i!==A.i&&S.next.i!==A.i&&S.i!==I.i&&S.next.i!==I.i&&rt(S,S.next,A,I))return!0;S=S.next}while(S!==A);return!1}function bt(A,I){return G(A.prev,A,A.next)<0?G(A,I,A.next)>=0&&G(A,A.prev,I)>=0:G(A,I,A.prev)<0||G(A,A.next,I)<0}function B(A,I){var S=A,z=!1,X=(A.x+I.x)/2,M=(A.y+I.y)/2;do S.y>M!=S.next.y>M&&S.next.y!==S.y&&X<(S.next.x-S.x)*(M-S.y)/(S.next.y-S.y)+S.x&&(z=!z),S=S.next;while(S!==A);return z}function Gt(A,I){var S=new Nt(A.i,A.x,A.y),z=new Nt(I.i,I.x,I.y),X=A.next,M=I.prev;return A.next=I,I.prev=A,S.next=X,X.prev=S,z.next=S,S.prev=z,M.next=z,z.prev=M,z}function Ut(A,I,S,z){var X=new Nt(A,I,S);return z?(X.next=z.next,X.prev=z,z.next.prev=X,z.next=X):(X.prev=X,X.next=X),X}function Ht(A){A.next.prev=A.prev,A.prev.next=A.next,A.prevZ&&(A.prevZ.nextZ=A.nextZ),A.nextZ&&(A.nextZ.prevZ=A.prevZ)}function Nt(A,I,S){this.i=A,this.x=I,this.y=S,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}Rt.deviation=function(A,I,S,z){var X=I&&I.length,M=X?I[0]*S:A.length,N=Math.abs(ot(A,0,M,S));if(X)for(var Q=0,ht=I.length;Q<ht;Q++){var gt=I[Q]*S,lt=Q<ht-1?I[Q+1]*S:A.length;N-=Math.abs(ot(A,gt,lt,S))}var Tt=0;for(Q=0;Q<z.length;Q+=3){var wt=z[Q]*S,Mt=z[Q+1]*S,Ft=z[Q+2]*S;Tt+=Math.abs((A[wt]-A[Ft])*(A[Mt+1]-A[wt+1])-(A[wt]-A[Mt])*(A[Ft+1]-A[wt+1]))}return N===0&&Tt===0?0:Math.abs((Tt-N)/N)};function ot(A,I,S,z){for(var X=0,M=I,N=S-z;M<S;M+=z)X+=(A[N]-A[M])*(A[M+1]+A[N+1]),N=M;return X}Rt.flatten=function(A){for(var I=A[0][0].length,S={vertices:[],holes:[],dimensions:I},z=0,X=0;X<A.length;X++){for(var M=0;M<A[X].length;M++)for(var N=0;N<I;N++)S.vertices.push(A[X][M][N]);X>0&&(z+=A[X-1].length,S.holes.push(z))}return S}},729:function(xt){"use strict";var Rt=Object.prototype.hasOwnProperty,K="~";function f(){}Object.create&&(f.prototype=Object.create(null),new f().__proto__||(K=!1));function ut(dt,O,J){this.fn=dt,this.context=O,this.once=J||!1}function at(dt,O,J,V,F){if(typeof J!="function")throw new TypeError("The listener must be a function");var q=new ut(J,V||dt,F),ft=K?K+O:O;return dt._events[ft]?dt._events[ft].fn?dt._events[ft]=[dt._events[ft],q]:dt._events[ft].push(q):(dt._events[ft]=q,dt._eventsCount++),dt}function vt(dt,O){--dt._eventsCount===0?dt._events=new f:delete dt._events[O]}function Y(){this._events=new f,this._eventsCount=0}Y.prototype.eventNames=function(){var O=[],J,V;if(this._eventsCount===0)return O;for(V in J=this._events)Rt.call(J,V)&&O.push(K?V.slice(1):V);return Object.getOwnPropertySymbols?O.concat(Object.getOwnPropertySymbols(J)):O},Y.prototype.listeners=function(O){var J=K?K+O:O,V=this._events[J];if(!V)return[];if(V.fn)return[V.fn];for(var F=0,q=V.length,ft=new Array(q);F<q;F++)ft[F]=V[F].fn;return ft},Y.prototype.listenerCount=function(O){var J=K?K+O:O,V=this._events[J];return V?V.fn?1:V.length:0},Y.prototype.emit=function(O,J,V,F,q,ft){var pt=K?K+O:O;if(!this._events[pt])return!1;var H=this._events[pt],mt=arguments.length,it,C;if(H.fn){switch(H.once&&this.removeListener(O,H.fn,void 0,!0),mt){case 1:return H.fn.call(H.context),!0;case 2:return H.fn.call(H.context,J),!0;case 3:return H.fn.call(H.context,J,V),!0;case 4:return H.fn.call(H.context,J,V,F),!0;case 5:return H.fn.call(H.context,J,V,F,q),!0;case 6:return H.fn.call(H.context,J,V,F,q,ft),!0}for(C=1,it=new Array(mt-1);C<mt;C++)it[C-1]=arguments[C];H.fn.apply(H.context,it)}else{var G=H.length,j;for(C=0;C<G;C++)switch(H[C].once&&this.removeListener(O,H[C].fn,void 0,!0),mt){case 1:H[C].fn.call(H[C].context);break;case 2:H[C].fn.call(H[C].context,J);break;case 3:H[C].fn.call(H[C].context,J,V);break;case 4:H[C].fn.call(H[C].context,J,V,F);break;default:if(!it)for(j=1,it=new Array(mt-1);j<mt;j++)it[j-1]=arguments[j];H[C].fn.apply(H[C].context,it)}}return!0},Y.prototype.on=function(O,J,V){return at(this,O,J,V,!1)},Y.prototype.once=function(O,J,V){return at(this,O,J,V,!0)},Y.prototype.removeListener=function(O,J,V,F){var q=K?K+O:O;if(!this._events[q])return this;if(!J)return vt(this,q),this;var ft=this._events[q];if(ft.fn)ft.fn===J&&(!F||ft.once)&&(!V||ft.context===V)&&vt(this,q);else{for(var pt=0,H=[],mt=ft.length;pt<mt;pt++)(ft[pt].fn!==J||F&&!ft[pt].once||V&&ft[pt].context!==V)&&H.push(ft[pt]);H.length?this._events[q]=H.length===1?H[0]:H:vt(this,q)}return this},Y.prototype.removeAllListeners=function(O){var J;return O?(J=K?K+O:O,this._events[J]&&vt(this,J)):(this._events=new f,this._eventsCount=0),this},Y.prototype.off=Y.prototype.removeListener,Y.prototype.addListener=Y.prototype.on,Y.prefixed=K,Y.EventEmitter=Y,xt.exports=Y},648:function(xt){"use strict";var Rt="Function.prototype.bind called on incompatible ",K=Object.prototype.toString,f=Math.max,ut="[object Function]",at=function(O,J){for(var V=[],F=0;F<O.length;F+=1)V[F]=O[F];for(var q=0;q<J.length;q+=1)V[q+O.length]=J[q];return V},vt=function(O,J){for(var V=[],F=J||0,q=0;F<O.length;F+=1,q+=1)V[q]=O[F];return V},Y=function(dt,O){for(var J="",V=0;V<dt.length;V+=1)J+=dt[V],V+1<dt.length&&(J+=O);return J};xt.exports=function(O){var J=this;if(typeof J!="function"||K.apply(J)!==ut)throw new TypeError(Rt+J);for(var V=vt(arguments,1),F,q=function(){if(this instanceof F){var it=J.apply(this,at(V,arguments));return Object(it)===it?it:this}return J.apply(O,at(V,arguments))},ft=f(0,J.length-V.length),pt=[],H=0;H<ft;H++)pt[H]="$"+H;if(F=Function("binder","return function ("+Y(pt,",")+"){ return binder.apply(this,arguments); }")(q),J.prototype){var mt=function(){};mt.prototype=J.prototype,F.prototype=new mt,mt.prototype=null}return F}},612:function(xt,Rt,K){"use strict";var f=K(648);xt.exports=Function.prototype.bind||f},210:function(xt,Rt,K){"use strict";var f,ut=SyntaxError,at=Function,vt=TypeError,Y=function(Nt){try{return at('"use strict"; return ('+Nt+").constructor;")()}catch(ot){}},dt=Object.getOwnPropertyDescriptor;if(dt)try{dt({},"")}catch(Nt){dt=null}var O=function(){throw new vt},J=dt?function(){try{return arguments.callee,O}catch(Nt){try{return dt(arguments,"callee").get}catch(ot){return O}}}():O,V=K(405)(),F=K(185)(),q=Object.getPrototypeOf||(F?function(Nt){return Nt.__proto__}:null),ft={},pt=typeof Uint8Array=="undefined"||!q?f:q(Uint8Array),H={"%AggregateError%":typeof AggregateError=="undefined"?f:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer=="undefined"?f:ArrayBuffer,"%ArrayIteratorPrototype%":V&&q?q([][Symbol.iterator]()):f,"%AsyncFromSyncIteratorPrototype%":f,"%AsyncFunction%":ft,"%AsyncGenerator%":ft,"%AsyncGeneratorFunction%":ft,"%AsyncIteratorPrototype%":ft,"%Atomics%":typeof Atomics=="undefined"?f:Atomics,"%BigInt%":typeof BigInt=="undefined"?f:BigInt,"%BigInt64Array%":typeof BigInt64Array=="undefined"?f:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array=="undefined"?f:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView=="undefined"?f:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":typeof Float32Array=="undefined"?f:Float32Array,"%Float64Array%":typeof Float64Array=="undefined"?f:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry=="undefined"?f:FinalizationRegistry,"%Function%":at,"%GeneratorFunction%":ft,"%Int8Array%":typeof Int8Array=="undefined"?f:Int8Array,"%Int16Array%":typeof Int16Array=="undefined"?f:Int16Array,"%Int32Array%":typeof Int32Array=="undefined"?f:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":V&&q?q(q([][Symbol.iterator]())):f,"%JSON%":typeof JSON=="object"?JSON:f,"%Map%":typeof Map=="undefined"?f:Map,"%MapIteratorPrototype%":typeof Map=="undefined"||!V||!q?f:q(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise=="undefined"?f:Promise,"%Proxy%":typeof Proxy=="undefined"?f:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":typeof Reflect=="undefined"?f:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set=="undefined"?f:Set,"%SetIteratorPrototype%":typeof Set=="undefined"||!V||!q?f:q(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer=="undefined"?f:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":V&&q?q(""[Symbol.iterator]()):f,"%Symbol%":V?Symbol:f,"%SyntaxError%":ut,"%ThrowTypeError%":J,"%TypedArray%":pt,"%TypeError%":vt,"%Uint8Array%":typeof Uint8Array=="undefined"?f:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray=="undefined"?f:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array=="undefined"?f:Uint16Array,"%Uint32Array%":typeof Uint32Array=="undefined"?f:Uint32Array,"%URIError%":URIError,"%WeakMap%":typeof WeakMap=="undefined"?f:WeakMap,"%WeakRef%":typeof WeakRef=="undefined"?f:WeakRef,"%WeakSet%":typeof WeakSet=="undefined"?f:WeakSet};if(q)try{null.error}catch(Nt){var mt=q(q(Nt));H["%Error.prototype%"]=mt}var it=function Nt(ot){var A;if(ot==="%AsyncFunction%")A=Y("async function () {}");else if(ot==="%GeneratorFunction%")A=Y("function* () {}");else if(ot==="%AsyncGeneratorFunction%")A=Y("async function* () {}");else if(ot==="%AsyncGenerator%"){var I=Nt("%AsyncGeneratorFunction%");I&&(A=I.prototype)}else if(ot==="%AsyncIteratorPrototype%"){var S=Nt("%AsyncGenerator%");S&&q&&(A=q(S.prototype))}return H[ot]=A,A},C={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},G=K(612),j=K(824),rt=G.call(Function.call,Array.prototype.concat),ct=G.call(Function.apply,Array.prototype.splice),_t=G.call(Function.call,String.prototype.replace),P=G.call(Function.call,String.prototype.slice),bt=G.call(Function.call,RegExp.prototype.exec),B=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,Gt=/\\(\\)?/g,Ut=function(ot){var A=P(ot,0,1),I=P(ot,-1);if(A==="%"&&I!=="%")throw new ut("invalid intrinsic syntax, expected closing `%`");if(I==="%"&&A!=="%")throw new ut("invalid intrinsic syntax, expected opening `%`");var S=[];return _t(ot,B,function(z,X,M,N){S[S.length]=M?_t(N,Gt,"$1"):X||z}),S},Ht=function(ot,A){var I=ot,S;if(j(C,I)&&(S=C[I],I="%"+S[0]+"%"),j(H,I)){var z=H[I];if(z===ft&&(z=it(I)),typeof z=="undefined"&&!A)throw new vt("intrinsic "+ot+" exists, but is not available. Please file an issue!");return{alias:S,name:I,value:z}}throw new ut("intrinsic "+ot+" does not exist!")};xt.exports=function(ot,A){if(typeof ot!="string"||ot.length===0)throw new vt("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof A!="boolean")throw new vt('"allowMissing" argument must be a boolean');if(bt(/^%?[^%]*%?$/,ot)===null)throw new ut("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var I=Ut(ot),S=I.length>0?I[0]:"",z=Ht("%"+S+"%",A),X=z.name,M=z.value,N=!1,Q=z.alias;Q&&(S=Q[0],ct(I,rt([0,1],Q)));for(var ht=1,gt=!0;ht<I.length;ht+=1){var lt=I[ht],Tt=P(lt,0,1),wt=P(lt,-1);if((Tt==='"'||Tt==="'"||Tt==="`"||wt==='"'||wt==="'"||wt==="`")&&Tt!==wt)throw new ut("property names with quotes must have matching quotes");if((lt==="constructor"||!gt)&&(N=!0),S+="."+lt,X="%"+S+"%",j(H,X))M=H[X];else if(M!=null){if(!(lt in M)){if(!A)throw new vt("base intrinsic for "+ot+" exists, but the property is not available.");return}if(dt&&ht+1>=I.length){var Mt=dt(M,lt);gt=!!Mt,gt&&"get"in Mt&&!("originalValue"in Mt.get)?M=Mt.get:M=M[lt]}else gt=j(M,lt),M=M[lt];gt&&!N&&(H[X]=M)}}return M}},275:function(xt,Rt,K){"use strict";var f=K(210),ut=f("%Object.getOwnPropertyDescriptor%",!0);if(ut)try{ut([],"length")}catch(at){ut=null}xt.exports=ut},44:function(xt,Rt,K){"use strict";var f=K(210),ut=f("%Object.defineProperty%",!0),at=function(){if(ut)try{return ut({},"a",{value:1}),!0}catch(Y){return!1}return!1};at.hasArrayLengthDefineBug=function(){if(!at())return null;try{return ut([],"length",{value:1}).length!==1}catch(Y){return!0}},xt.exports=at},185:function(xt){"use strict";var Rt={foo:{}},K=Object;xt.exports=function(){return{__proto__:Rt}.foo===Rt.foo&&!({__proto__:null}instanceof K)}},405:function(xt,Rt,K){"use strict";var f=typeof Symbol!="undefined"&&Symbol,ut=K(419);xt.exports=function(){return typeof f!="function"||typeof Symbol!="function"||typeof f("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:ut()}},419:function(xt){"use strict";xt.exports=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var K={},f=Symbol("test"),ut=Object(f);if(typeof f=="string"||Object.prototype.toString.call(f)!=="[object Symbol]"||Object.prototype.toString.call(ut)!=="[object Symbol]")return!1;var at=42;K[f]=at;for(f in K)return!1;if(typeof Object.keys=="function"&&Object.keys(K).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(K).length!==0)return!1;var vt=Object.getOwnPropertySymbols(K);if(vt.length!==1||vt[0]!==f||!Object.prototype.propertyIsEnumerable.call(K,f))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var Y=Object.getOwnPropertyDescriptor(K,f);if(Y.value!==at||Y.enumerable!==!0)return!1}return!0}},824:function(xt,Rt,K){"use strict";var f=Function.prototype.call,ut=Object.prototype.hasOwnProperty,at=K(612);xt.exports=at.call(f,ut)},631:function(xt,Rt,K){var f=typeof Map=="function"&&Map.prototype,ut=Object.getOwnPropertyDescriptor&&f?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,at=f&&ut&&typeof ut.get=="function"?ut.get:null,vt=f&&Map.prototype.forEach,Y=typeof Set=="function"&&Set.prototype,dt=Object.getOwnPropertyDescriptor&&Y?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,O=Y&&dt&&typeof dt.get=="function"?dt.get:null,J=Y&&Set.prototype.forEach,V=typeof WeakMap=="function"&&WeakMap.prototype,F=V?WeakMap.prototype.has:null,q=typeof WeakSet=="function"&&WeakSet.prototype,ft=q?WeakSet.prototype.has:null,pt=typeof WeakRef=="function"&&WeakRef.prototype,H=pt?WeakRef.prototype.deref:null,mt=Boolean.prototype.valueOf,it=Object.prototype.toString,C=Function.prototype.toString,G=String.prototype.match,j=String.prototype.slice,rt=String.prototype.replace,ct=String.prototype.toUpperCase,_t=String.prototype.toLowerCase,P=RegExp.prototype.test,bt=Array.prototype.concat,B=Array.prototype.join,Gt=Array.prototype.slice,Ut=Math.floor,Ht=typeof BigInt=="function"?BigInt.prototype.valueOf:null,Nt=Object.getOwnPropertySymbols,ot=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,A=typeof Symbol=="function"&&typeof Symbol.iterator=="object",I=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===A||"symbol")?Symbol.toStringTag:null,S=Object.prototype.propertyIsEnumerable,z=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(U){return U.__proto__}:null);function X(U,W){if(U===1/0||U===-1/0||U!==U||U&&U>-1e3&&U<1e3||P.call(/e/,W))return W;var Qt=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof U=="number"){var ee=U<0?-Ut(-U):Ut(U);if(ee!==U){var pe=String(ee),Yt=j.call(W,pe.length+1);return rt.call(pe,Qt,"$&_")+"."+rt.call(rt.call(Yt,/([0-9]{3})/g,"$&_"),/_$/,"")}}return rt.call(W,Qt,"$&_")}var M=K(654),N=M.custom,Q=Et(N)?N:null;xt.exports=function U(W,Qt,ee,pe){var Yt=Qt||{};if(Lt(Yt,"quoteStyle")&&Yt.quoteStyle!=="single"&&Yt.quoteStyle!=="double")throw new TypeError('option "quoteStyle" must be "single" or "double"');if(Lt(Yt,"maxStringLength")&&(typeof Yt.maxStringLength=="number"?Yt.maxStringLength<0&&Yt.maxStringLength!==1/0:Yt.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var Me=Lt(Yt,"customInspect")?Yt.customInspect:!0;if(typeof Me!="boolean"&&Me!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(Lt(Yt,"indent")&&Yt.indent!==null&&Yt.indent!=="	"&&!(parseInt(Yt.indent,10)===Yt.indent&&Yt.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(Lt(Yt,"numericSeparator")&&typeof Yt.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var Je=Yt.numericSeparator;if(typeof W=="undefined")return"undefined";if(W===null)return"null";if(typeof W=="boolean")return W?"true":"false";if(typeof W=="string")return Kr(W,Yt);if(typeof W=="number"){if(W===0)return 1/0/W>0?"0":"-0";var Re=String(W);return Je?X(W,Re):Re}if(typeof W=="bigint"){var We=String(W)+"n";return Je?X(W,We):We}var qr=typeof Yt.depth=="undefined"?5:Yt.depth;if(typeof ee=="undefined"&&(ee=0),ee>=qr&&qr>0&&typeof W=="object")return lt(W)?"[Array]":"[Object]";var Le=mi(Yt,ee);if(typeof pe=="undefined")pe=[];else if(qe(pe,W)>=0)return"[Circular]";function we(ar,xr,Jr){if(xr&&(pe=Gt.call(pe),pe.push(xr)),Jr){var yi={depth:Yt.depth};return Lt(Yt,"quoteStyle")&&(yi.quoteStyle=Yt.quoteStyle),U(ar,yi,ee+1,pe)}return U(ar,Yt,ee+1,pe)}if(typeof W=="function"&&!wt(W)){var Zr=sr(W),$i=Or(W,we);return"[Function"+(Zr?": "+Zr:" (anonymous)")+"]"+($i.length>0?" { "+B.call($i,", ")+" }":"")}if(Et(W)){var Lr=A?rt.call(String(W),/^(Symbol\(.*\))_[^)]*$/,"$1"):ot.call(W);return typeof W=="object"&&!A?Ee(Lr):Lr}if(Ce(W)){for(var Ne="<"+_t.call(String(W.nodeName)),Nr=W.attributes||[],ze=0;ze<Nr.length;ze++)Ne+=" "+Nr[ze].name+"="+ht(gt(Nr[ze].value),"double",Yt);return Ne+=">",W.childNodes&&W.childNodes.length&&(Ne+="..."),Ne+="</"+_t.call(String(W.nodeName))+">",Ne}if(lt(W)){if(W.length===0)return"[]";var Ae=Or(W,we);return Le&&!Qe(Ae)?"["+yr(Ae,Le)+"]":"[ "+B.call(Ae,", ")+" ]"}if(Mt(W)){var Ur=Or(W,we);return!("cause"in Error.prototype)&&"cause"in W&&!S.call(W,"cause")?"{ ["+String(W)+"] "+B.call(bt.call("[cause]: "+we(W.cause),Ur),", ")+" }":Ur.length===0?"["+String(W)+"]":"{ ["+String(W)+"] "+B.call(Ur,", ")+" }"}if(typeof W=="object"&&Me){if(Q&&typeof W[Q]=="function"&&M)return M(W,{depth:qr-ee});if(Me!=="symbol"&&typeof W.inspect=="function")return W.inspect()}if(He(W)){var gi=[];return vt&&vt.call(W,function(ar,xr){gi.push(we(xr,W,!0)+" => "+we(ar,W))}),ce("Map",at.call(W),gi,Le)}if(zi(W)){var ji=[];return J&&J.call(W,function(ar){ji.push(we(ar,W))}),ce("Set",O.call(W),ji,Le)}if(Xe(W))return ge("WeakMap");if(Ve(W))return ge("WeakSet");if(pi(W))return ge("WeakRef");if(ae(W))return Ee(we(Number(W)));if(ue(W))return Ee(we(Ht.call(W)));if(qt(W))return Ee(mt.call(W));if(Ft(W))return Ee(we(String(W)));if(typeof window!="undefined"&&W===window)return"{ [object Window] }";if(W===K.g)return"{ [object globalThis] }";if(!Tt(W)&&!wt(W)){var nr=Or(W,we),tr=z?z(W)===Object.prototype:W instanceof Object||W.constructor===Object,Se=W instanceof Object?"":"null prototype",_i=!tr&&I&&Object(W)===W&&I in W?j.call(xe(W),8,-1):Se?"Object":"",Yi=tr||typeof W.constructor!="function"?"":W.constructor.name?W.constructor.name+" ":"",Qr=Yi+(_i||Se?"["+B.call(bt.call([],_i||[],Se||[]),": ")+"] ":"");return nr.length===0?Qr+"{}":Le?Qr+"{"+yr(nr,Le)+"}":Qr+"{ "+B.call(nr,", ")+" }"}return String(W)};function ht(U,W,Qt){var ee=(Qt.quoteStyle||W)==="double"?'"':"'";return ee+U+ee}function gt(U){return rt.call(String(U),/"/g,"&quot;")}function lt(U){return xe(U)==="[object Array]"&&(!I||!(typeof U=="object"&&I in U))}function Tt(U){return xe(U)==="[object Date]"&&(!I||!(typeof U=="object"&&I in U))}function wt(U){return xe(U)==="[object RegExp]"&&(!I||!(typeof U=="object"&&I in U))}function Mt(U){return xe(U)==="[object Error]"&&(!I||!(typeof U=="object"&&I in U))}function Ft(U){return xe(U)==="[object String]"&&(!I||!(typeof U=="object"&&I in U))}function ae(U){return xe(U)==="[object Number]"&&(!I||!(typeof U=="object"&&I in U))}function qt(U){return xe(U)==="[object Boolean]"&&(!I||!(typeof U=="object"&&I in U))}function Et(U){if(A)return U&&typeof U=="object"&&U instanceof Symbol;if(typeof U=="symbol")return!0;if(!U||typeof U!="object"||!ot)return!1;try{return ot.call(U),!0}catch(W){}return!1}function ue(U){if(!U||typeof U!="object"||!Ht)return!1;try{return Ht.call(U),!0}catch(W){}return!1}var Ot=Object.prototype.hasOwnProperty||function(U){return U in this};function Lt(U,W){return Ot.call(U,W)}function xe(U){return it.call(U)}function sr(U){if(U.name)return U.name;var W=G.call(C.call(U),/^function\s*([\w$]+)/);return W?W[1]:null}function qe(U,W){if(U.indexOf)return U.indexOf(W);for(var Qt=0,ee=U.length;Qt<ee;Qt++)if(U[Qt]===W)return Qt;return-1}function He(U){if(!at||!U||typeof U!="object")return!1;try{at.call(U);try{O.call(U)}catch(W){return!0}return U instanceof Map}catch(W){}return!1}function Xe(U){if(!F||!U||typeof U!="object")return!1;try{F.call(U,F);try{ft.call(U,ft)}catch(W){return!0}return U instanceof WeakMap}catch(W){}return!1}function pi(U){if(!H||!U||typeof U!="object")return!1;try{return H.call(U),!0}catch(W){}return!1}function zi(U){if(!O||!U||typeof U!="object")return!1;try{O.call(U);try{at.call(U)}catch(W){return!0}return U instanceof Set}catch(W){}return!1}function Ve(U){if(!ft||!U||typeof U!="object")return!1;try{ft.call(U,ft);try{F.call(U,F)}catch(W){return!0}return U instanceof WeakSet}catch(W){}return!1}function Ce(U){return!U||typeof U!="object"?!1:typeof HTMLElement!="undefined"&&U instanceof HTMLElement?!0:typeof U.nodeName=="string"&&typeof U.getAttribute=="function"}function Kr(U,W){if(U.length>W.maxStringLength){var Qt=U.length-W.maxStringLength,ee="... "+Qt+" more character"+(Qt>1?"s":"");return Kr(j.call(U,0,W.maxStringLength),W)+ee}var pe=rt.call(rt.call(U,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,Ze);return ht(pe,"single",W)}function Ze(U){var W=U.charCodeAt(0),Qt={8:"b",9:"t",10:"n",12:"f",13:"r"}[W];return Qt?"\\"+Qt:"\\x"+(W<16?"0":"")+ct.call(W.toString(16))}function Ee(U){return"Object("+U+")"}function ge(U){return U+" { ? }"}function ce(U,W,Qt,ee){var pe=ee?yr(Qt,ee):B.call(Qt,", ");return U+" ("+W+") {"+pe+"}"}function Qe(U){for(var W=0;W<U.length;W++)if(qe(U[W],`
`)>=0)return!1;return!0}function mi(U,W){var Qt;if(U.indent==="	")Qt="	";else if(typeof U.indent=="number"&&U.indent>0)Qt=B.call(Array(U.indent+1)," ");else return null;return{base:Qt,prev:B.call(Array(W+1),Qt)}}function yr(U,W){if(U.length===0)return"";var Qt=`
`+W.prev+W.base;return Qt+B.call(U,","+Qt)+`
`+W.prev}function Or(U,W){var Qt=lt(U),ee=[];if(Qt){ee.length=U.length;for(var pe=0;pe<U.length;pe++)ee[pe]=Lt(U,pe)?W(U[pe],U):""}var Yt=typeof Nt=="function"?Nt(U):[],Me;if(A){Me={};for(var Je=0;Je<Yt.length;Je++)Me["$"+Yt[Je]]=Yt[Je]}for(var Re in U)Lt(U,Re)&&(Qt&&String(Number(Re))===Re&&Re<U.length||A&&Me["$"+Re]instanceof Symbol||(P.call(/[^\w$]/,Re)?ee.push(W(Re,U)+": "+W(U[Re],U)):ee.push(Re+": "+W(U[Re],U))));if(typeof Nt=="function")for(var We=0;We<Yt.length;We++)S.call(U,Yt[We])&&ee.push("["+W(Yt[We])+"]: "+W(U[Yt[We]],U));return ee}},798:function(xt){"use strict";var Rt=String.prototype.replace,K=/%20/g,f={RFC1738:"RFC1738",RFC3986:"RFC3986"};xt.exports={default:f.RFC3986,formatters:{RFC1738:function(ut){return Rt.call(ut,K,"+")},RFC3986:function(ut){return String(ut)}},RFC1738:f.RFC1738,RFC3986:f.RFC3986}},129:function(xt,Rt,K){"use strict";var f=K(261),ut=K(235),at=K(798);xt.exports={formats:at,parse:ut,stringify:f}},235:function(xt,Rt,K){"use strict";var f=K(769),ut=Object.prototype.hasOwnProperty,at=Array.isArray,vt={allowDots:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decoder:f.decode,delimiter:"&",depth:5,ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictNullHandling:!1},Y=function(pt){return pt.replace(/&#(\d+);/g,function(H,mt){return String.fromCharCode(parseInt(mt,10))})},dt=function(pt,H){return pt&&typeof pt=="string"&&H.comma&&pt.indexOf(",")>-1?pt.split(","):pt},O="utf8=%26%2310003%3B",J="utf8=%E2%9C%93",V=function(H,mt){var it={__proto__:null},C=mt.ignoreQueryPrefix?H.replace(/^\?/,""):H,G=mt.parameterLimit===1/0?void 0:mt.parameterLimit,j=C.split(mt.delimiter,G),rt=-1,ct,_t=mt.charset;if(mt.charsetSentinel)for(ct=0;ct<j.length;++ct)j[ct].indexOf("utf8=")===0&&(j[ct]===J?_t="utf-8":j[ct]===O&&(_t="iso-8859-1"),rt=ct,ct=j.length);for(ct=0;ct<j.length;++ct)if(ct!==rt){var P=j[ct],bt=P.indexOf("]="),B=bt===-1?P.indexOf("="):bt+1,Gt,Ut;B===-1?(Gt=mt.decoder(P,vt.decoder,_t,"key"),Ut=mt.strictNullHandling?null:""):(Gt=mt.decoder(P.slice(0,B),vt.decoder,_t,"key"),Ut=f.maybeMap(dt(P.slice(B+1),mt),function(Ht){return mt.decoder(Ht,vt.decoder,_t,"value")})),Ut&&mt.interpretNumericEntities&&_t==="iso-8859-1"&&(Ut=Y(Ut)),P.indexOf("[]=")>-1&&(Ut=at(Ut)?[Ut]:Ut),ut.call(it,Gt)?it[Gt]=f.combine(it[Gt],Ut):it[Gt]=Ut}return it},F=function(pt,H,mt,it){for(var C=it?H:dt(H,mt),G=pt.length-1;G>=0;--G){var j,rt=pt[G];if(rt==="[]"&&mt.parseArrays)j=[].concat(C);else{j=mt.plainObjects?Object.create(null):{};var ct=rt.charAt(0)==="["&&rt.charAt(rt.length-1)==="]"?rt.slice(1,-1):rt,_t=parseInt(ct,10);!mt.parseArrays&&ct===""?j={0:C}:!isNaN(_t)&&rt!==ct&&String(_t)===ct&&_t>=0&&mt.parseArrays&&_t<=mt.arrayLimit?(j=[],j[_t]=C):ct!=="__proto__"&&(j[ct]=C)}C=j}return C},q=function(H,mt,it,C){if(H){var G=it.allowDots?H.replace(/\.([^.[]+)/g,"[$1]"):H,j=/(\[[^[\]]*])/,rt=/(\[[^[\]]*])/g,ct=it.depth>0&&j.exec(G),_t=ct?G.slice(0,ct.index):G,P=[];if(_t){if(!it.plainObjects&&ut.call(Object.prototype,_t)&&!it.allowPrototypes)return;P.push(_t)}for(var bt=0;it.depth>0&&(ct=rt.exec(G))!==null&&bt<it.depth;){if(bt+=1,!it.plainObjects&&ut.call(Object.prototype,ct[1].slice(1,-1))&&!it.allowPrototypes)return;P.push(ct[1])}return ct&&P.push("["+G.slice(ct.index)+"]"),F(P,mt,it,C)}},ft=function(H){if(!H)return vt;if(H.decoder!==null&&H.decoder!==void 0&&typeof H.decoder!="function")throw new TypeError("Decoder has to be a function.");if(typeof H.charset!="undefined"&&H.charset!=="utf-8"&&H.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var mt=typeof H.charset=="undefined"?vt.charset:H.charset;return{allowDots:typeof H.allowDots=="undefined"?vt.allowDots:!!H.allowDots,allowPrototypes:typeof H.allowPrototypes=="boolean"?H.allowPrototypes:vt.allowPrototypes,allowSparse:typeof H.allowSparse=="boolean"?H.allowSparse:vt.allowSparse,arrayLimit:typeof H.arrayLimit=="number"?H.arrayLimit:vt.arrayLimit,charset:mt,charsetSentinel:typeof H.charsetSentinel=="boolean"?H.charsetSentinel:vt.charsetSentinel,comma:typeof H.comma=="boolean"?H.comma:vt.comma,decoder:typeof H.decoder=="function"?H.decoder:vt.decoder,delimiter:typeof H.delimiter=="string"||f.isRegExp(H.delimiter)?H.delimiter:vt.delimiter,depth:typeof H.depth=="number"||H.depth===!1?+H.depth:vt.depth,ignoreQueryPrefix:H.ignoreQueryPrefix===!0,interpretNumericEntities:typeof H.interpretNumericEntities=="boolean"?H.interpretNumericEntities:vt.interpretNumericEntities,parameterLimit:typeof H.parameterLimit=="number"?H.parameterLimit:vt.parameterLimit,parseArrays:H.parseArrays!==!1,plainObjects:typeof H.plainObjects=="boolean"?H.plainObjects:vt.plainObjects,strictNullHandling:typeof H.strictNullHandling=="boolean"?H.strictNullHandling:vt.strictNullHandling}};xt.exports=function(pt,H){var mt=ft(H);if(pt===""||pt===null||typeof pt=="undefined")return mt.plainObjects?Object.create(null):{};for(var it=typeof pt=="string"?V(pt,mt):pt,C=mt.plainObjects?Object.create(null):{},G=Object.keys(it),j=0;j<G.length;++j){var rt=G[j],ct=q(rt,it[rt],mt,typeof pt=="string");C=f.merge(C,ct,mt)}return mt.allowSparse===!0?C:f.compact(C)}},261:function(xt,Rt,K){"use strict";var f=K(478),ut=K(769),at=K(798),vt=Object.prototype.hasOwnProperty,Y={brackets:function(C){return C+"[]"},comma:"comma",indices:function(C,G){return C+"["+G+"]"},repeat:function(C){return C}},dt=Array.isArray,O=Array.prototype.push,J=function(it,C){O.apply(it,dt(C)?C:[C])},V=Date.prototype.toISOString,F=at.default,q={addQueryPrefix:!1,allowDots:!1,charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encoder:ut.encode,encodeValuesOnly:!1,format:F,formatter:at.formatters[F],indices:!1,serializeDate:function(C){return V.call(C)},skipNulls:!1,strictNullHandling:!1},ft=function(C){return typeof C=="string"||typeof C=="number"||typeof C=="boolean"||typeof C=="symbol"||typeof C=="bigint"},pt={},H=function it(C,G,j,rt,ct,_t,P,bt,B,Gt,Ut,Ht,Nt,ot,A,I){for(var S=C,z=I,X=0,M=!1;(z=z.get(pt))!==void 0&&!M;){var N=z.get(C);if(X+=1,typeof N!="undefined"){if(N===X)throw new RangeError("Cyclic object value");M=!0}typeof z.get(pt)=="undefined"&&(X=0)}if(typeof bt=="function"?S=bt(G,S):S instanceof Date?S=Ut(S):j==="comma"&&dt(S)&&(S=ut.maybeMap(S,function(Et){return Et instanceof Date?Ut(Et):Et})),S===null){if(ct)return P&&!ot?P(G,q.encoder,A,"key",Ht):G;S=""}if(ft(S)||ut.isBuffer(S)){if(P){var Q=ot?G:P(G,q.encoder,A,"key",Ht);return[Nt(Q)+"="+Nt(P(S,q.encoder,A,"value",Ht))]}return[Nt(G)+"="+Nt(String(S))]}var ht=[];if(typeof S=="undefined")return ht;var gt;if(j==="comma"&&dt(S))ot&&P&&(S=ut.maybeMap(S,P)),gt=[{value:S.length>0?S.join(",")||null:void 0}];else if(dt(bt))gt=bt;else{var lt=Object.keys(S);gt=B?lt.sort(B):lt}for(var Tt=rt&&dt(S)&&S.length===1?G+"[]":G,wt=0;wt<gt.length;++wt){var Mt=gt[wt],Ft=typeof Mt=="object"&&typeof Mt.value!="undefined"?Mt.value:S[Mt];if(!(_t&&Ft===null)){var ae=dt(S)?typeof j=="function"?j(Tt,Mt):Tt:Tt+(Gt?"."+Mt:"["+Mt+"]");I.set(C,X);var qt=f();qt.set(pt,I),J(ht,it(Ft,ae,j,rt,ct,_t,j==="comma"&&ot&&dt(S)?null:P,bt,B,Gt,Ut,Ht,Nt,ot,A,qt))}}return ht},mt=function(C){if(!C)return q;if(C.encoder!==null&&typeof C.encoder!="undefined"&&typeof C.encoder!="function")throw new TypeError("Encoder has to be a function.");var G=C.charset||q.charset;if(typeof C.charset!="undefined"&&C.charset!=="utf-8"&&C.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var j=at.default;if(typeof C.format!="undefined"){if(!vt.call(at.formatters,C.format))throw new TypeError("Unknown format option provided.");j=C.format}var rt=at.formatters[j],ct=q.filter;return(typeof C.filter=="function"||dt(C.filter))&&(ct=C.filter),{addQueryPrefix:typeof C.addQueryPrefix=="boolean"?C.addQueryPrefix:q.addQueryPrefix,allowDots:typeof C.allowDots=="undefined"?q.allowDots:!!C.allowDots,charset:G,charsetSentinel:typeof C.charsetSentinel=="boolean"?C.charsetSentinel:q.charsetSentinel,delimiter:typeof C.delimiter=="undefined"?q.delimiter:C.delimiter,encode:typeof C.encode=="boolean"?C.encode:q.encode,encoder:typeof C.encoder=="function"?C.encoder:q.encoder,encodeValuesOnly:typeof C.encodeValuesOnly=="boolean"?C.encodeValuesOnly:q.encodeValuesOnly,filter:ct,format:j,formatter:rt,serializeDate:typeof C.serializeDate=="function"?C.serializeDate:q.serializeDate,skipNulls:typeof C.skipNulls=="boolean"?C.skipNulls:q.skipNulls,sort:typeof C.sort=="function"?C.sort:null,strictNullHandling:typeof C.strictNullHandling=="boolean"?C.strictNullHandling:q.strictNullHandling}};xt.exports=function(it,C){var G=it,j=mt(C),rt,ct;typeof j.filter=="function"?(ct=j.filter,G=ct("",G)):dt(j.filter)&&(ct=j.filter,rt=ct);var _t=[];if(typeof G!="object"||G===null)return"";var P;C&&C.arrayFormat in Y?P=C.arrayFormat:C&&"indices"in C?P=C.indices?"indices":"repeat":P="indices";var bt=Y[P];if(C&&"commaRoundTrip"in C&&typeof C.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var B=bt==="comma"&&C&&C.commaRoundTrip;rt||(rt=Object.keys(G)),j.sort&&rt.sort(j.sort);for(var Gt=f(),Ut=0;Ut<rt.length;++Ut){var Ht=rt[Ut];j.skipNulls&&G[Ht]===null||J(_t,H(G[Ht],Ht,bt,B,j.strictNullHandling,j.skipNulls,j.encode?j.encoder:null,j.filter,j.sort,j.allowDots,j.serializeDate,j.format,j.formatter,j.encodeValuesOnly,j.charset,Gt))}var Nt=_t.join(j.delimiter),ot=j.addQueryPrefix===!0?"?":"";return j.charsetSentinel&&(j.charset==="iso-8859-1"?ot+="utf8=%26%2310003%3B&":ot+="utf8=%E2%9C%93&"),Nt.length>0?ot+Nt:""}},769:function(xt,Rt,K){"use strict";var f=K(798),ut=Object.prototype.hasOwnProperty,at=Array.isArray,vt=function(){for(var it=[],C=0;C<256;++C)it.push("%"+((C<16?"0":"")+C.toString(16)).toUpperCase());return it}(),Y=function(C){for(;C.length>1;){var G=C.pop(),j=G.obj[G.prop];if(at(j)){for(var rt=[],ct=0;ct<j.length;++ct)typeof j[ct]!="undefined"&&rt.push(j[ct]);G.obj[G.prop]=rt}}},dt=function(C,G){for(var j=G&&G.plainObjects?Object.create(null):{},rt=0;rt<C.length;++rt)typeof C[rt]!="undefined"&&(j[rt]=C[rt]);return j},O=function it(C,G,j){if(!G)return C;if(typeof G!="object"){if(at(C))C.push(G);else if(C&&typeof C=="object")(j&&(j.plainObjects||j.allowPrototypes)||!ut.call(Object.prototype,G))&&(C[G]=!0);else return[C,G];return C}if(!C||typeof C!="object")return[C].concat(G);var rt=C;return at(C)&&!at(G)&&(rt=dt(C,j)),at(C)&&at(G)?(G.forEach(function(ct,_t){if(ut.call(C,_t)){var P=C[_t];P&&typeof P=="object"&&ct&&typeof ct=="object"?C[_t]=it(P,ct,j):C.push(ct)}else C[_t]=ct}),C):Object.keys(G).reduce(function(ct,_t){var P=G[_t];return ut.call(ct,_t)?ct[_t]=it(ct[_t],P,j):ct[_t]=P,ct},rt)},J=function(C,G){return Object.keys(G).reduce(function(j,rt){return j[rt]=G[rt],j},C)},V=function(it,C,G){var j=it.replace(/\+/g," ");if(G==="iso-8859-1")return j.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(j)}catch(rt){return j}},F=function(C,G,j,rt,ct){if(C.length===0)return C;var _t=C;if(typeof C=="symbol"?_t=Symbol.prototype.toString.call(C):typeof C!="string"&&(_t=String(C)),j==="iso-8859-1")return escape(_t).replace(/%u[0-9a-f]{4}/gi,function(Gt){return"%26%23"+parseInt(Gt.slice(2),16)+"%3B"});for(var P="",bt=0;bt<_t.length;++bt){var B=_t.charCodeAt(bt);if(B===45||B===46||B===95||B===126||B>=48&&B<=57||B>=65&&B<=90||B>=97&&B<=122||ct===f.RFC1738&&(B===40||B===41)){P+=_t.charAt(bt);continue}if(B<128){P=P+vt[B];continue}if(B<2048){P=P+(vt[192|B>>6]+vt[128|B&63]);continue}if(B<55296||B>=57344){P=P+(vt[224|B>>12]+vt[128|B>>6&63]+vt[128|B&63]);continue}bt+=1,B=65536+((B&1023)<<10|_t.charCodeAt(bt)&1023),P+=vt[240|B>>18]+vt[128|B>>12&63]+vt[128|B>>6&63]+vt[128|B&63]}return P},q=function(C){for(var G=[{obj:{o:C},prop:"o"}],j=[],rt=0;rt<G.length;++rt)for(var ct=G[rt],_t=ct.obj[ct.prop],P=Object.keys(_t),bt=0;bt<P.length;++bt){var B=P[bt],Gt=_t[B];typeof Gt=="object"&&Gt!==null&&j.indexOf(Gt)===-1&&(G.push({obj:_t,prop:B}),j.push(Gt))}return Y(G),C},ft=function(C){return Object.prototype.toString.call(C)==="[object RegExp]"},pt=function(C){return!C||typeof C!="object"?!1:!!(C.constructor&&C.constructor.isBuffer&&C.constructor.isBuffer(C))},H=function(C,G){return[].concat(C,G)},mt=function(C,G){if(at(C)){for(var j=[],rt=0;rt<C.length;rt+=1)j.push(G(C[rt]));return j}return G(C)};xt.exports={arrayToObject:dt,assign:J,combine:H,compact:q,decode:V,encode:F,isBuffer:pt,isRegExp:ft,maybeMap:mt,merge:O}},771:function(xt,Rt,K){"use strict";var f=K(210),ut=K(296),at=K(44)(),vt=K(275),Y=f("%TypeError%"),dt=f("%Math.floor%");xt.exports=function(J,V){if(typeof J!="function")throw new Y("`fn` is not a function");if(typeof V!="number"||V<0||V>4294967295||dt(V)!==V)throw new Y("`length` must be a positive 32-bit integer");var F=arguments.length>2&&!!arguments[2],q=!0,ft=!0;if("length"in J&&vt){var pt=vt(J,"length");pt&&!pt.configurable&&(q=!1),pt&&!pt.writable&&(ft=!1)}return(q||ft||!F)&&(at?ut(J,"length",V,!0,!0):ut(J,"length",V)),J}},478:function(xt,Rt,K){"use strict";var f=K(210),ut=K(924),at=K(631),vt=f("%TypeError%"),Y=f("%WeakMap%",!0),dt=f("%Map%",!0),O=ut("WeakMap.prototype.get",!0),J=ut("WeakMap.prototype.set",!0),V=ut("WeakMap.prototype.has",!0),F=ut("Map.prototype.get",!0),q=ut("Map.prototype.set",!0),ft=ut("Map.prototype.has",!0),pt=function(C,G){for(var j=C,rt;(rt=j.next)!==null;j=rt)if(rt.key===G)return j.next=rt.next,rt.next=C.next,C.next=rt,rt},H=function(C,G){var j=pt(C,G);return j&&j.value},mt=function(C,G,j){var rt=pt(C,G);rt?rt.value=j:C.next={key:G,next:C.next,value:j}},it=function(C,G){return!!pt(C,G)};xt.exports=function(){var G,j,rt,ct={assert:function(_t){if(!ct.has(_t))throw new vt("Side channel does not contain "+at(_t))},get:function(_t){if(Y&&_t&&(typeof _t=="object"||typeof _t=="function")){if(G)return O(G,_t)}else if(dt){if(j)return F(j,_t)}else if(rt)return H(rt,_t)},has:function(_t){if(Y&&_t&&(typeof _t=="object"||typeof _t=="function")){if(G)return V(G,_t)}else if(dt){if(j)return ft(j,_t)}else if(rt)return it(rt,_t);return!1},set:function(_t,P){Y&&_t&&(typeof _t=="object"||typeof _t=="function")?(G||(G=new Y),J(G,_t,P)):dt?(j||(j=new dt),q(j,_t,P)):(rt||(rt={key:{},next:null}),mt(rt,_t,P))}};return ct}},511:function(xt,Rt,K){xt=K.nmd(xt);var f;/*! https://mths.be/punycode v1.4.1 by @mathias */(function(ut){var at=Rt&&!Rt.nodeType&&Rt,vt=xt&&!xt.nodeType&&xt,Y=typeof K.g=="object"&&K.g;(Y.global===Y||Y.window===Y||Y.self===Y)&&(ut=Y);var dt,O=2147483647,J=36,V=1,F=26,q=38,ft=700,pt=72,H=128,mt="-",it=/^xn--/,C=/[^\x20-\x7E]/,G=/[\x2E\u3002\uFF0E\uFF61]/g,j={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},rt=J-V,ct=Math.floor,_t=String.fromCharCode,P;function bt(M){throw new RangeError(j[M])}function B(M,N){for(var Q=M.length,ht=[];Q--;)ht[Q]=N(M[Q]);return ht}function Gt(M,N){var Q=M.split("@"),ht="";Q.length>1&&(ht=Q[0]+"@",M=Q[1]),M=M.replace(G,".");var gt=M.split("."),lt=B(gt,N).join(".");return ht+lt}function Ut(M){for(var N=[],Q=0,ht=M.length,gt,lt;Q<ht;)gt=M.charCodeAt(Q++),gt>=55296&&gt<=56319&&Q<ht?(lt=M.charCodeAt(Q++),(lt&64512)==56320?N.push(((gt&1023)<<10)+(lt&1023)+65536):(N.push(gt),Q--)):N.push(gt);return N}function Ht(M){return B(M,function(N){var Q="";return N>65535&&(N-=65536,Q+=_t(N>>>10&1023|55296),N=56320|N&1023),Q+=_t(N),Q}).join("")}function Nt(M){return M-48<10?M-22:M-65<26?M-65:M-97<26?M-97:J}function ot(M,N){return M+22+75*(M<26)-((N!=0)<<5)}function A(M,N,Q){var ht=0;for(M=Q?ct(M/ft):M>>1,M+=ct(M/N);M>rt*F>>1;ht+=J)M=ct(M/rt);return ct(ht+(rt+1)*M/(M+q))}function I(M){var N=[],Q=M.length,ht,gt=0,lt=H,Tt=pt,wt,Mt,Ft,ae,qt,Et,ue,Ot,Lt;for(wt=M.lastIndexOf(mt),wt<0&&(wt=0),Mt=0;Mt<wt;++Mt)M.charCodeAt(Mt)>=128&&bt("not-basic"),N.push(M.charCodeAt(Mt));for(Ft=wt>0?wt+1:0;Ft<Q;){for(ae=gt,qt=1,Et=J;Ft>=Q&&bt("invalid-input"),ue=Nt(M.charCodeAt(Ft++)),(ue>=J||ue>ct((O-gt)/qt))&&bt("overflow"),gt+=ue*qt,Ot=Et<=Tt?V:Et>=Tt+F?F:Et-Tt,!(ue<Ot);Et+=J)Lt=J-Ot,qt>ct(O/Lt)&&bt("overflow"),qt*=Lt;ht=N.length+1,Tt=A(gt-ae,ht,ae==0),ct(gt/ht)>O-lt&&bt("overflow"),lt+=ct(gt/ht),gt%=ht,N.splice(gt++,0,lt)}return Ht(N)}function S(M){var N,Q,ht,gt,lt,Tt,wt,Mt,Ft,ae,qt,Et=[],ue,Ot,Lt,xe;for(M=Ut(M),ue=M.length,N=H,Q=0,lt=pt,Tt=0;Tt<ue;++Tt)qt=M[Tt],qt<128&&Et.push(_t(qt));for(ht=gt=Et.length,gt&&Et.push(mt);ht<ue;){for(wt=O,Tt=0;Tt<ue;++Tt)qt=M[Tt],qt>=N&&qt<wt&&(wt=qt);for(Ot=ht+1,wt-N>ct((O-Q)/Ot)&&bt("overflow"),Q+=(wt-N)*Ot,N=wt,Tt=0;Tt<ue;++Tt)if(qt=M[Tt],qt<N&&++Q>O&&bt("overflow"),qt==N){for(Mt=Q,Ft=J;ae=Ft<=lt?V:Ft>=lt+F?F:Ft-lt,!(Mt<ae);Ft+=J)xe=Mt-ae,Lt=J-ae,Et.push(_t(ot(ae+xe%Lt,0))),Mt=ct(xe/Lt);Et.push(_t(ot(Mt,0))),lt=A(Q,Ot,ht==gt),Q=0,++ht}++Q,++N}return Et.join("")}function z(M){return Gt(M,function(N){return it.test(N)?I(N.slice(4).toLowerCase()):N})}function X(M){return Gt(M,function(N){return C.test(N)?"xn--"+S(N):N})}dt={version:"1.4.1",ucs2:{decode:Ut,encode:Ht},decode:I,encode:S,toASCII:X,toUnicode:z},f=function(){return dt}.call(Rt,K,Rt,xt),f!==void 0&&(xt.exports=f)})(this)},575:function(xt,Rt,K){"use strict";var f,ut=K(511);function at(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var vt=/^([a-z0-9.+-]+:)/i,Y=/:[0-9]*$/,dt=/^(\/\/?(?!\/)[^?\s]*)(\?[^\s]*)?$/,O=["<",">",'"',"`"," ","\r",`
`,"	"],J=["{","}","|","\\","^","`"].concat(O),V=["'"].concat(J),F=["%","/","?",";","#"].concat(V),q=["/","?","#"],ft=255,pt=/^[+a-z0-9A-Z_-]{0,63}$/,H=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,mt={javascript:!0,"javascript:":!0},it={javascript:!0,"javascript:":!0},C={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},G=K(129);function j(P,bt,B){if(P&&typeof P=="object"&&P instanceof at)return P;var Gt=new at;return Gt.parse(P,bt,B),Gt}at.prototype.parse=function(P,bt,B){if(typeof P!="string")throw new TypeError("Parameter 'url' must be a string, not "+typeof P);var Gt=P.indexOf("?"),Ut=Gt!==-1&&Gt<P.indexOf("#")?"?":"#",Ht=P.split(Ut),Nt=/\\/g;Ht[0]=Ht[0].replace(Nt,"/"),P=Ht.join(Ut);var ot=P;if(ot=ot.trim(),!B&&P.split("#").length===1){var A=dt.exec(ot);if(A)return this.path=ot,this.href=ot,this.pathname=A[1],A[2]?(this.search=A[2],bt?this.query=G.parse(this.search.substr(1)):this.query=this.search.substr(1)):bt&&(this.search="",this.query={}),this}var I=vt.exec(ot);if(I){I=I[0];var S=I.toLowerCase();this.protocol=S,ot=ot.substr(I.length)}if(B||I||ot.match(/^\/\/[^@/]+@[^@/]+/)){var z=ot.substr(0,2)==="//";z&&!(I&&it[I])&&(ot=ot.substr(2),this.slashes=!0)}if(!it[I]&&(z||I&&!C[I])){for(var X=-1,M=0;M<q.length;M++){var N=ot.indexOf(q[M]);N!==-1&&(X===-1||N<X)&&(X=N)}var Q,ht;X===-1?ht=ot.lastIndexOf("@"):ht=ot.lastIndexOf("@",X),ht!==-1&&(Q=ot.slice(0,ht),ot=ot.slice(ht+1),this.auth=decodeURIComponent(Q)),X=-1;for(var M=0;M<F.length;M++){var N=ot.indexOf(F[M]);N!==-1&&(X===-1||N<X)&&(X=N)}X===-1&&(X=ot.length),this.host=ot.slice(0,X),ot=ot.slice(X),this.parseHost(),this.hostname=this.hostname||"";var gt=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!gt)for(var lt=this.hostname.split(/\./),M=0,Tt=lt.length;M<Tt;M++){var wt=lt[M];if(wt&&!wt.match(pt)){for(var Mt="",Ft=0,ae=wt.length;Ft<ae;Ft++)wt.charCodeAt(Ft)>127?Mt+="x":Mt+=wt[Ft];if(!Mt.match(pt)){var qt=lt.slice(0,M),Et=lt.slice(M+1),ue=wt.match(H);ue&&(qt.push(ue[1]),Et.unshift(ue[2])),Et.length&&(ot="/"+Et.join(".")+ot),this.hostname=qt.join(".");break}}}this.hostname.length>ft?this.hostname="":this.hostname=this.hostname.toLowerCase(),gt||(this.hostname=ut.toASCII(this.hostname));var Ot=this.port?":"+this.port:"",Lt=this.hostname||"";this.host=Lt+Ot,this.href+=this.host,gt&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),ot[0]!=="/"&&(ot="/"+ot))}if(!mt[S])for(var M=0,Tt=V.length;M<Tt;M++){var xe=V[M];if(ot.indexOf(xe)!==-1){var sr=encodeURIComponent(xe);sr===xe&&(sr=escape(xe)),ot=ot.split(xe).join(sr)}}var qe=ot.indexOf("#");qe!==-1&&(this.hash=ot.substr(qe),ot=ot.slice(0,qe));var He=ot.indexOf("?");if(He!==-1?(this.search=ot.substr(He),this.query=ot.substr(He+1),bt&&(this.query=G.parse(this.query)),ot=ot.slice(0,He)):bt&&(this.search="",this.query={}),ot&&(this.pathname=ot),C[S]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var Ot=this.pathname||"",Xe=this.search||"";this.path=Ot+Xe}return this.href=this.format(),this};function rt(P){return typeof P=="string"&&(P=j(P)),P instanceof at?P.format():at.prototype.format.call(P)}at.prototype.format=function(){var P=this.auth||"";P&&(P=encodeURIComponent(P),P=P.replace(/%3A/i,":"),P+="@");var bt=this.protocol||"",B=this.pathname||"",Gt=this.hash||"",Ut=!1,Ht="";this.host?Ut=P+this.host:this.hostname&&(Ut=P+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(Ut+=":"+this.port)),this.query&&typeof this.query=="object"&&Object.keys(this.query).length&&(Ht=G.stringify(this.query,{arrayFormat:"repeat",addQueryPrefix:!1}));var Nt=this.search||Ht&&"?"+Ht||"";return bt&&bt.substr(-1)!==":"&&(bt+=":"),this.slashes||(!bt||C[bt])&&Ut!==!1?(Ut="//"+(Ut||""),B&&B.charAt(0)!=="/"&&(B="/"+B)):Ut||(Ut=""),Gt&&Gt.charAt(0)!=="#"&&(Gt="#"+Gt),Nt&&Nt.charAt(0)!=="?"&&(Nt="?"+Nt),B=B.replace(/[?#]/g,function(ot){return encodeURIComponent(ot)}),Nt=Nt.replace("#","%23"),bt+Ut+B+Nt+Gt};function ct(P,bt){return j(P,!1,!0).resolve(bt)}at.prototype.resolve=function(P){return this.resolveObject(j(P,!1,!0)).format()};function _t(P,bt){return P?j(P,!1,!0).resolveObject(bt):bt}at.prototype.resolveObject=function(P){if(typeof P=="string"){var bt=new at;bt.parse(P,!1,!0),P=bt}for(var B=new at,Gt=Object.keys(this),Ut=0;Ut<Gt.length;Ut++){var Ht=Gt[Ut];B[Ht]=this[Ht]}if(B.hash=P.hash,P.href==="")return B.href=B.format(),B;if(P.slashes&&!P.protocol){for(var Nt=Object.keys(P),ot=0;ot<Nt.length;ot++){var A=Nt[ot];A!=="protocol"&&(B[A]=P[A])}return C[B.protocol]&&B.hostname&&!B.pathname&&(B.pathname="/",B.path=B.pathname),B.href=B.format(),B}if(P.protocol&&P.protocol!==B.protocol){if(!C[P.protocol]){for(var I=Object.keys(P),S=0;S<I.length;S++){var z=I[S];B[z]=P[z]}return B.href=B.format(),B}if(B.protocol=P.protocol,!P.host&&!it[P.protocol]){for(var Tt=(P.pathname||"").split("/");Tt.length&&!(P.host=Tt.shift()););P.host||(P.host=""),P.hostname||(P.hostname=""),Tt[0]!==""&&Tt.unshift(""),Tt.length<2&&Tt.unshift(""),B.pathname=Tt.join("/")}else B.pathname=P.pathname;if(B.search=P.search,B.query=P.query,B.host=P.host||"",B.auth=P.auth,B.hostname=P.hostname||P.host,B.port=P.port,B.pathname||B.search){var X=B.pathname||"",M=B.search||"";B.path=X+M}return B.slashes=B.slashes||P.slashes,B.href=B.format(),B}var N=B.pathname&&B.pathname.charAt(0)==="/",Q=P.host||P.pathname&&P.pathname.charAt(0)==="/",ht=Q||N||B.host&&P.pathname,gt=ht,lt=B.pathname&&B.pathname.split("/")||[],Tt=P.pathname&&P.pathname.split("/")||[],wt=B.protocol&&!C[B.protocol];if(wt&&(B.hostname="",B.port=null,B.host&&(lt[0]===""?lt[0]=B.host:lt.unshift(B.host)),B.host="",P.protocol&&(P.hostname=null,P.port=null,P.host&&(Tt[0]===""?Tt[0]=P.host:Tt.unshift(P.host)),P.host=null),ht=ht&&(Tt[0]===""||lt[0]==="")),Q)B.host=P.host||P.host===""?P.host:B.host,B.hostname=P.hostname||P.hostname===""?P.hostname:B.hostname,B.search=P.search,B.query=P.query,lt=Tt;else if(Tt.length)lt||(lt=[]),lt.pop(),lt=lt.concat(Tt),B.search=P.search,B.query=P.query;else if(P.search!=null){if(wt){B.host=lt.shift(),B.hostname=B.host;var Mt=B.host&&B.host.indexOf("@")>0?B.host.split("@"):!1;Mt&&(B.auth=Mt.shift(),B.hostname=Mt.shift(),B.host=B.hostname)}return B.search=P.search,B.query=P.query,(B.pathname!==null||B.search!==null)&&(B.path=(B.pathname?B.pathname:"")+(B.search?B.search:"")),B.href=B.format(),B}if(!lt.length)return B.pathname=null,B.search?B.path="/"+B.search:B.path=null,B.href=B.format(),B;for(var Ft=lt.slice(-1)[0],ae=(B.host||P.host||lt.length>1)&&(Ft==="."||Ft==="..")||Ft==="",qt=0,Et=lt.length;Et>=0;Et--)Ft=lt[Et],Ft==="."?lt.splice(Et,1):Ft===".."?(lt.splice(Et,1),qt++):qt&&(lt.splice(Et,1),qt--);if(!ht&&!gt)for(;qt--;qt)lt.unshift("..");ht&&lt[0]!==""&&(!lt[0]||lt[0].charAt(0)!=="/")&&lt.unshift(""),ae&&lt.join("/").substr(-1)!=="/"&&lt.push("");var ue=lt[0]===""||lt[0]&&lt[0].charAt(0)==="/";if(wt){B.hostname=ue?"":lt.length?lt.shift():"",B.host=B.hostname;var Mt=B.host&&B.host.indexOf("@")>0?B.host.split("@"):!1;Mt&&(B.auth=Mt.shift(),B.hostname=Mt.shift(),B.host=B.hostname)}return ht=ht||B.host&&lt.length,ht&&!ue&&lt.unshift(""),lt.length>0?B.pathname=lt.join("/"):(B.pathname=null,B.path=null),(B.pathname!==null||B.search!==null)&&(B.path=(B.pathname?B.pathname:"")+(B.search?B.search:"")),B.auth=P.auth||B.auth,B.slashes=B.slashes||P.slashes,B.href=B.format(),B},at.prototype.parseHost=function(){var P=this.host,bt=Y.exec(P);bt&&(bt=bt[0],bt!==":"&&(this.port=bt.substr(1)),P=P.substr(0,P.length-bt.length)),P&&(this.hostname=P)},Rt.Qc=j,Rt.DB=ct,f=_t,Rt.WU=rt,f=at},774:function(xt,Rt,K){"use strict";var gr;K.d(Rt,{iw:function(){return H},T$:function(){return Y},VL:function(){return se},a$:function(){return Xs},JZ:function(){return Gr},Ie:function(){return qs},lW:function(){return Ie},qm:function(){return Ei},yl:function(){return mt},Cd:function(){return hs},Il:function(){return Se},ZX:function(){return Ws},lg:function(){return dt},Pj:function(){return Hr},nw:function(){return Zt},I2:function(){return O},wn:function(){return rr},wG:function(){return Er},A7:function(){return G},KI:function(){return pt},y3:function(){return de},bO:function(){return Wr},AB:function(){return De},_b:function(){return as},E9:function(){return oe},mg:function(){return Ar},$r:function(){return Cr},ud:function(){return en},jl:function(){return os},Ae:function(){return ie},TI:function(){return Rr},c9:function(){return ni},aH:function(){return q},HS:function(){return hr},pX:function(){return Rs},ex:function(){return Vr},ZM:function(){return br},vK:function(){return V},xE:function(){return ne},UX:function(){return Ts},vB:function(){return St},wx:function(){return ls},uF:function(){return nt},oo:function(){return je},eH:function(){return di},Rv:function(){return Gs},Nt:function(){return ft},e6:function(){return It},Y9:function(){return Bt},kP:function(){return he},Rw:function(){return re},Xd:function(){return P},P6:function(){return f}});var f={};K.r(f),K.d(f,{BaseTextureCache:function(){return Be},BoundingBox:function(){return kr},CanvasRenderTarget:function(){return vr},DATA_URI:function(){return Ki},EventEmitter:function(){return Mt},ProgramCache:function(){return Ue},TextureCache:function(){return ve},clearTextureCache:function(){return Dn},correctBlendMode:function(){return yi},createIndicesForQuads:function(){return Rn},decomposeDataUri:function(){return On},deprecation:function(){return Et},destroyTextureCache:function(){return Fn},detectVideoAlphaMode:function(){return pi},determineCrossOrigin:function(){return ii},earcut:function(){return Ft},getBufferType:function(){return vi},getCanvasBoundingBox:function(){return Ns},getResolutionOfUrl:function(){return Zi},hex2rgb:function(){return _i},hex2string:function(){return Yi},interleaveTypedArrays:function(){return Pn},isMobile:function(){return wt},isPow2:function(){return ei},isWebGLSupported:function(){return Kr},log2:function(){return qi},nextPow2:function(){return ti},path:function(){return He},premultiplyBlendMode:function(){return Jr},premultiplyRgba:function(){return In},premultiplyTint:function(){return xi},premultiplyTintToRgba:function(){return Cn},removeItems:function(){return Ls},rgb2hex:function(){return ar},sayHello:function(){return Ve},sign:function(){return Mn},skipHello:function(){return zi},string2hex:function(){return Qr},trimCanvas:function(){return Us},uid:function(){return or},url:function(){return ue}});var ut=(s=>(s[s.WEBGL_LEGACY=0]="WEBGL_LEGACY",s[s.WEBGL=1]="WEBGL",s[s.WEBGL2=2]="WEBGL2",s))(ut||{}),at=(s=>(s[s.UNKNOWN=0]="UNKNOWN",s[s.WEBGL=1]="WEBGL",s[s.CANVAS=2]="CANVAS",s))(at||{}),vt=(s=>(s[s.COLOR=16384]="COLOR",s[s.DEPTH=256]="DEPTH",s[s.STENCIL=1024]="STENCIL",s))(vt||{}),Y=(s=>(s[s.NORMAL=0]="NORMAL",s[s.ADD=1]="ADD",s[s.MULTIPLY=2]="MULTIPLY",s[s.SCREEN=3]="SCREEN",s[s.OVERLAY=4]="OVERLAY",s[s.DARKEN=5]="DARKEN",s[s.LIGHTEN=6]="LIGHTEN",s[s.COLOR_DODGE=7]="COLOR_DODGE",s[s.COLOR_BURN=8]="COLOR_BURN",s[s.HARD_LIGHT=9]="HARD_LIGHT",s[s.SOFT_LIGHT=10]="SOFT_LIGHT",s[s.DIFFERENCE=11]="DIFFERENCE",s[s.EXCLUSION=12]="EXCLUSION",s[s.HUE=13]="HUE",s[s.SATURATION=14]="SATURATION",s[s.COLOR=15]="COLOR",s[s.LUMINOSITY=16]="LUMINOSITY",s[s.NORMAL_NPM=17]="NORMAL_NPM",s[s.ADD_NPM=18]="ADD_NPM",s[s.SCREEN_NPM=19]="SCREEN_NPM",s[s.NONE=20]="NONE",s[s.SRC_OVER=0]="SRC_OVER",s[s.SRC_IN=21]="SRC_IN",s[s.SRC_OUT=22]="SRC_OUT",s[s.SRC_ATOP=23]="SRC_ATOP",s[s.DST_OVER=24]="DST_OVER",s[s.DST_IN=25]="DST_IN",s[s.DST_OUT=26]="DST_OUT",s[s.DST_ATOP=27]="DST_ATOP",s[s.ERASE=26]="ERASE",s[s.SUBTRACT=28]="SUBTRACT",s[s.XOR=29]="XOR",s))(Y||{}),dt=(s=>(s[s.POINTS=0]="POINTS",s[s.LINES=1]="LINES",s[s.LINE_LOOP=2]="LINE_LOOP",s[s.LINE_STRIP=3]="LINE_STRIP",s[s.TRIANGLES=4]="TRIANGLES",s[s.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",s[s.TRIANGLE_FAN=6]="TRIANGLE_FAN",s))(dt||{}),O=(s=>(s[s.RGBA=6408]="RGBA",s[s.RGB=6407]="RGB",s[s.RG=33319]="RG",s[s.RED=6403]="RED",s[s.RGBA_INTEGER=36249]="RGBA_INTEGER",s[s.RGB_INTEGER=36248]="RGB_INTEGER",s[s.RG_INTEGER=33320]="RG_INTEGER",s[s.RED_INTEGER=36244]="RED_INTEGER",s[s.ALPHA=6406]="ALPHA",s[s.LUMINANCE=6409]="LUMINANCE",s[s.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",s[s.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",s[s.DEPTH_STENCIL=34041]="DEPTH_STENCIL",s))(O||{}),J=(s=>(s[s.TEXTURE_2D=3553]="TEXTURE_2D",s[s.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",s[s.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",s[s.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",s[s.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",s[s.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",s[s.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",s[s.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",s[s.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",s))(J||{}),V=(s=>(s[s.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",s[s.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",s[s.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",s[s.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",s[s.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",s[s.UNSIGNED_INT=5125]="UNSIGNED_INT",s[s.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",s[s.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",s[s.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",s[s.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",s[s.BYTE=5120]="BYTE",s[s.SHORT=5122]="SHORT",s[s.INT=5124]="INT",s[s.FLOAT=5126]="FLOAT",s[s.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",s[s.HALF_FLOAT=36193]="HALF_FLOAT",s))(V||{}),F=(s=>(s[s.FLOAT=0]="FLOAT",s[s.INT=1]="INT",s[s.UINT=2]="UINT",s))(F||{}),q=(s=>(s[s.NEAREST=0]="NEAREST",s[s.LINEAR=1]="LINEAR",s))(q||{}),ft=(s=>(s[s.CLAMP=33071]="CLAMP",s[s.REPEAT=10497]="REPEAT",s[s.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",s))(ft||{}),pt=(s=>(s[s.OFF=0]="OFF",s[s.POW2=1]="POW2",s[s.ON=2]="ON",s[s.ON_MANUAL=3]="ON_MANUAL",s))(pt||{}),H=(s=>(s[s.NPM=0]="NPM",s[s.UNPACK=1]="UNPACK",s[s.PMA=2]="PMA",s[s.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",s[s.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",s[s.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA",s))(H||{}),mt=(s=>(s[s.NO=0]="NO",s[s.YES=1]="YES",s[s.AUTO=2]="AUTO",s[s.BLEND=0]="BLEND",s[s.CLEAR=1]="CLEAR",s[s.BLIT=2]="BLIT",s))(mt||{}),it=(s=>(s[s.AUTO=0]="AUTO",s[s.MANUAL=1]="MANUAL",s))(it||{}),C=(s=>(s.LOW="lowp",s.MEDIUM="mediump",s.HIGH="highp",s))(C||{}),G=(s=>(s[s.NONE=0]="NONE",s[s.SCISSOR=1]="SCISSOR",s[s.STENCIL=2]="STENCIL",s[s.SPRITE=3]="SPRITE",s[s.COLOR=4]="COLOR",s))(G||{}),j=(s=>(s[s.RED=1]="RED",s[s.GREEN=2]="GREEN",s[s.BLUE=4]="BLUE",s[s.ALPHA=8]="ALPHA",s))(j||{}),rt=(s=>(s[s.NONE=0]="NONE",s[s.LOW=2]="LOW",s[s.MEDIUM=4]="MEDIUM",s[s.HIGH=8]="HIGH",s))(rt||{}),ct=(s=>(s[s.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",s[s.ARRAY_BUFFER=34962]="ARRAY_BUFFER",s[s.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",s))(ct||{});const P={ADAPTER:{createCanvas:(s,e)=>{const i=document.createElement("canvas");return i.width=s,i.height=e,i},getCanvasRenderingContext2D:()=>CanvasRenderingContext2D,getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>{var s;return(s=document.baseURI)!=null?s:window.location.href},getFontFaceSet:()=>document.fonts,fetch:(s,e)=>fetch(s,e),parseXML:s=>new DOMParser().parseFromString(s,"text/xml")},RESOLUTION:1,CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1};var bt=/iPhone/i,B=/iPod/i,Gt=/iPad/i,Ut=/\biOS-universal(?:.+)Mac\b/i,Ht=/\bAndroid(?:.+)Mobile\b/i,Nt=/Android/i,ot=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,A=/Silk/i,I=/Windows Phone/i,S=/\bWindows(?:.+)ARM\b/i,z=/BlackBerry/i,X=/BB10/i,M=/Opera Mini/i,N=/\b(CriOS|Chrome)(?:.+)Mobile/i,Q=/Mobile(?:.+)Firefox\b/i,ht=function(s){return typeof s!="undefined"&&s.platform==="MacIntel"&&typeof s.maxTouchPoints=="number"&&s.maxTouchPoints>1&&typeof MSStream=="undefined"};function gt(s){return function(e){return e.test(s)}}function lt(s){var e={userAgent:"",platform:"",maxTouchPoints:0};!s&&typeof navigator!="undefined"?e={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0}:typeof s=="string"?e.userAgent=s:s&&s.userAgent&&(e={userAgent:s.userAgent,platform:s.platform,maxTouchPoints:s.maxTouchPoints||0});var i=e.userAgent,a=i.split("[FBAN");typeof a[1]!="undefined"&&(i=a[0]),a=i.split("Twitter"),typeof a[1]!="undefined"&&(i=a[0]);var h=gt(i),u={apple:{phone:h(bt)&&!h(I),ipod:h(B),tablet:!h(bt)&&(h(Gt)||ht(e))&&!h(I),universal:h(Ut),device:(h(bt)||h(B)||h(Gt)||h(Ut)||ht(e))&&!h(I)},amazon:{phone:h(ot),tablet:!h(ot)&&h(A),device:h(ot)||h(A)},android:{phone:!h(I)&&h(ot)||!h(I)&&h(Ht),tablet:!h(I)&&!h(ot)&&!h(Ht)&&(h(A)||h(Nt)),device:!h(I)&&(h(ot)||h(A)||h(Ht)||h(Nt))||h(/\bokhttp\b/i)},windows:{phone:h(I),tablet:h(S),device:h(I)||h(S)},other:{blackberry:h(z),blackberry10:h(X),opera:h(M),firefox:h(Q),chrome:h(N),device:h(z)||h(X)||h(M)||h(Q)||h(N)},any:!1,phone:!1,tablet:!1};return u.any=u.apple.device||u.android.device||u.windows.device||u.other.device,u.phone=u.apple.phone||u.android.phone||u.windows.phone,u.tablet=u.apple.tablet||u.android.tablet||u.windows.tablet,u}const Tt=(gr=lt.default)!=null?gr:lt,wt=Tt(globalThis.navigator);P.RETINA_PREFIX=/@([0-9\.]+)x/,P.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1;var Mt=K(729),Ft=K(187),ae=K(575);const qt={};function Et(s,e,i=3){if(qt[e])return;let a=new Error().stack;typeof a>"u"?console.warn("PixiJS Deprecation Warning: ",`${e}
Deprecated since v${s}`):(a=a.split(`
`).splice(i).join(`
`),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",`${e}
Deprecated since v${s}`),console.warn(a),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",`${e}
Deprecated since v${s}`),console.warn(a))),qt[e]=!0}const ue={get parse(){return Et("7.3.0","utils.url.parse is deprecated, use native URL API instead."),ae.Qc},get format(){return Et("7.3.0","utils.url.format is deprecated, use native URL API instead."),ae.WU},get resolve(){return Et("7.3.0","utils.url.resolve is deprecated, use native URL API instead."),ae.DB}};function Ot(s){if(typeof s!="string")throw new TypeError(`Path must be a string. Received ${JSON.stringify(s)}`)}function Lt(s){return s.split("?")[0].split("#")[0]}function xe(s){return s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function sr(s,e,i){return s.replace(new RegExp(xe(e),"g"),i)}function qe(s,e){let i="",a=0,h=-1,u=0,m=-1;for(let y=0;y<=s.length;++y){if(y<s.length)m=s.charCodeAt(y);else{if(m===47)break;m=47}if(m===47){if(!(h===y-1||u===1))if(h!==y-1&&u===2){if(i.length<2||a!==2||i.charCodeAt(i.length-1)!==46||i.charCodeAt(i.length-2)!==46){if(i.length>2){const E=i.lastIndexOf("/");if(E!==i.length-1){E===-1?(i="",a=0):(i=i.slice(0,E),a=i.length-1-i.lastIndexOf("/")),h=y,u=0;continue}}else if(i.length===2||i.length===1){i="",a=0,h=y,u=0;continue}}e&&(i.length>0?i+="/..":i="..",a=2)}else i.length>0?i+=`/${s.slice(h+1,y)}`:i=s.slice(h+1,y),a=y-h-1;h=y,u=0}else m===46&&u!==-1?++u:u=-1}return i}const He={toPosix(s){return sr(s,"\\","/")},isUrl(s){return/^https?:/.test(this.toPosix(s))},isDataUrl(s){return/^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test(s)},isBlobUrl(s){return s.startsWith("blob:")},hasProtocol(s){return/^[^/:]+:/.test(this.toPosix(s))},getProtocol(s){Ot(s),s=this.toPosix(s);const e=/^file:\/\/\//.exec(s);if(e)return e[0];const i=/^[^/:]+:\/{0,2}/.exec(s);return i?i[0]:""},toAbsolute(s,e,i){if(Ot(s),this.isDataUrl(s)||this.isBlobUrl(s))return s;const a=Lt(this.toPosix(e!=null?e:P.ADAPTER.getBaseUrl())),h=Lt(this.toPosix(i!=null?i:this.rootname(a)));return s=this.toPosix(s),s.startsWith("/")?He.join(h,s.slice(1)):this.isAbsolute(s)?s:this.join(a,s)},normalize(s){if(Ot(s),s.length===0)return".";if(this.isDataUrl(s)||this.isBlobUrl(s))return s;s=this.toPosix(s);let e="";const i=s.startsWith("/");this.hasProtocol(s)&&(e=this.rootname(s),s=s.slice(e.length));const a=s.endsWith("/");return s=qe(s,!1),s.length>0&&a&&(s+="/"),i?`/${s}`:e+s},isAbsolute(s){return Ot(s),s=this.toPosix(s),this.hasProtocol(s)?!0:s.startsWith("/")},join(...s){var i;if(s.length===0)return".";let e;for(let a=0;a<s.length;++a){const h=s[a];if(Ot(h),h.length>0)if(e===void 0)e=h;else{const u=(i=s[a-1])!=null?i:"";this.extname(u)?e+=`/../${h}`:e+=`/${h}`}}return e===void 0?".":this.normalize(e)},dirname(s){if(Ot(s),s.length===0)return".";s=this.toPosix(s);let e=s.charCodeAt(0);const i=e===47;let a=-1,h=!0;const u=this.getProtocol(s),m=s;s=s.slice(u.length);for(let y=s.length-1;y>=1;--y)if(e=s.charCodeAt(y),e===47){if(!h){a=y;break}}else h=!1;return a===-1?i?"/":this.isUrl(m)?u+s:u:i&&a===1?"//":u+s.slice(0,a)},rootname(s){Ot(s),s=this.toPosix(s);let e="";if(s.startsWith("/")?e="/":e=this.getProtocol(s),this.isUrl(s)){const i=s.indexOf("/",e.length);i!==-1?e=s.slice(0,i):e=s,e.endsWith("/")||(e+="/")}return e},basename(s,e){Ot(s),e&&Ot(e),s=Lt(this.toPosix(s));let i=0,a=-1,h=!0,u;if(e!==void 0&&e.length>0&&e.length<=s.length){if(e.length===s.length&&e===s)return"";let m=e.length-1,y=-1;for(u=s.length-1;u>=0;--u){const E=s.charCodeAt(u);if(E===47){if(!h){i=u+1;break}}else y===-1&&(h=!1,y=u+1),m>=0&&(E===e.charCodeAt(m)?--m===-1&&(a=u):(m=-1,a=y))}return i===a?a=y:a===-1&&(a=s.length),s.slice(i,a)}for(u=s.length-1;u>=0;--u)if(s.charCodeAt(u)===47){if(!h){i=u+1;break}}else a===-1&&(h=!1,a=u+1);return a===-1?"":s.slice(i,a)},extname(s){Ot(s),s=Lt(this.toPosix(s));let e=-1,i=0,a=-1,h=!0,u=0;for(let m=s.length-1;m>=0;--m){const y=s.charCodeAt(m);if(y===47){if(!h){i=m+1;break}continue}a===-1&&(h=!1,a=m+1),y===46?e===-1?e=m:u!==1&&(u=1):e!==-1&&(u=-1)}return e===-1||a===-1||u===0||u===1&&e===a-1&&e===i+1?"":s.slice(e,a)},parse(s){Ot(s);const e={root:"",dir:"",base:"",ext:"",name:""};if(s.length===0)return e;s=Lt(this.toPosix(s));let i=s.charCodeAt(0);const a=this.isAbsolute(s);let h;const u="";e.root=this.rootname(s),a||this.hasProtocol(s)?h=1:h=0;let m=-1,y=0,E=-1,D=!0,Z=s.length-1,st=0;for(;Z>=h;--Z){if(i=s.charCodeAt(Z),i===47){if(!D){y=Z+1;break}continue}E===-1&&(D=!1,E=Z+1),i===46?m===-1?m=Z:st!==1&&(st=1):m!==-1&&(st=-1)}return m===-1||E===-1||st===0||st===1&&m===E-1&&m===y+1?E!==-1&&(y===0&&a?e.base=e.name=s.slice(1,E):e.base=e.name=s.slice(y,E)):(y===0&&a?(e.name=s.slice(1,m),e.base=s.slice(1,E)):(e.name=s.slice(y,m),e.base=s.slice(y,E)),e.ext=s.slice(m,E)),e.dir=this.dirname(s),u&&(e.dir=u+e.dir),e},sep:"/",delimiter:":"};let Xe;function pi(){return Pt(this,null,function*(){return Xe!=null||(Xe=(()=>Pt(this,null,function*(){var u;const s=document.createElement("canvas").getContext("webgl");if(!s)return H.UNPACK;const e=yield new Promise(m=>{const y=document.createElement("video");y.onloadeddata=()=>m(y),y.onerror=()=>m(null),y.autoplay=!1,y.crossOrigin="anonymous",y.preload="auto",y.src="data:video/webm;base64,GkXfo59ChoEBQveBAULygQRC84EIQoKEd2VibUKHgQJChYECGFOAZwEAAAAAAAHTEU2bdLpNu4tTq4QVSalmU6yBoU27i1OrhBZUrmtTrIHGTbuMU6uEElTDZ1OsggEXTbuMU6uEHFO7a1OsggG97AEAAAAAAABZAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVSalmoCrXsYMPQkBNgIRMYXZmV0GETGF2ZkSJiEBEAAAAAAAAFlSua8yuAQAAAAAAAEPXgQFzxYgAAAAAAAAAAZyBACK1nIN1bmSIgQCGhVZfVlA5g4EBI+ODhAJiWgDglLCBArqBApqBAlPAgQFVsIRVuYEBElTDZ9Vzc9JjwItjxYgAAAAAAAAAAWfInEWjh0VOQ09ERVJEh49MYXZjIGxpYnZweC12cDlnyKJFo4hEVVJBVElPTkSHlDAwOjAwOjAwLjA0MDAwMDAwMAAAH0O2dcfngQCgwqGggQAAAIJJg0IAABAAFgA4JBwYSgAAICAAEb///4r+AAB1oZ2mm+6BAaWWgkmDQgAAEAAWADgkHBhKAAAgIABIQBxTu2uRu4+zgQC3iveBAfGCAXHwgQM=",y.load()});if(!e)return H.UNPACK;const i=s.createTexture();s.bindTexture(s.TEXTURE_2D,i);const a=s.createFramebuffer();s.bindFramebuffer(s.FRAMEBUFFER,a),s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,i,0),s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),s.pixelStorei(s.UNPACK_COLORSPACE_CONVERSION_WEBGL,s.NONE),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,e);const h=new Uint8Array(4);return s.readPixels(0,0,1,1,s.RGBA,s.UNSIGNED_BYTE,h),s.deleteFramebuffer(a),s.deleteTexture(i),(u=s.getExtension("WEBGL_lose_context"))==null||u.loseContext(),h[0]<=h[3]?H.PMA:H.UNPACK}))()),Xe})}function zi(){Et("7.0.0","skipHello is deprecated, please use settings.RENDER_OPTIONS.hello")}function Ve(){Et("7.0.0",`sayHello is deprecated, please use Renderer's "hello" option`)}let Ce;function Kr(){return typeof Ce>"u"&&(Ce=function(){var e;const s={stencil:!0,failIfMajorPerformanceCaveat:P.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!P.ADAPTER.getWebGLRenderingContext())return!1;const i=P.ADAPTER.createCanvas();let a=i.getContext("webgl",s)||i.getContext("experimental-webgl",s);const h=!!((e=a==null?void 0:a.getContextAttributes())!=null&&e.stencil);if(a){const u=a.getExtension("WEBGL_lose_context");u&&u.loseContext()}return a=null,h}catch(i){return!1}}()),Ce}var Ze={grad:.9,turn:360,rad:360/(2*Math.PI)},Ee=function(s){return typeof s=="string"?s.length>0:typeof s=="number"},ge=function(s,e,i){return e===void 0&&(e=0),i===void 0&&(i=Math.pow(10,e)),Math.round(i*s)/i+0},ce=function(s,e,i){return e===void 0&&(e=0),i===void 0&&(i=1),s>i?i:s>e?s:e},Qe=function(s){return(s=isFinite(s)?s%360:0)>0?s:s+360},mi=function(s){return{r:ce(s.r,0,255),g:ce(s.g,0,255),b:ce(s.b,0,255),a:ce(s.a)}},yr=function(s){return{r:ge(s.r),g:ge(s.g),b:ge(s.b),a:ge(s.a,3)}},Or=/^#([0-9a-f]{3,8})$/i,U=function(s){var e=s.toString(16);return e.length<2?"0"+e:e},W=function(s){var e=s.r,i=s.g,a=s.b,h=s.a,u=Math.max(e,i,a),m=u-Math.min(e,i,a),y=m?u===e?(i-a)/m:u===i?2+(a-e)/m:4+(e-i)/m:0;return{h:60*(y<0?y+6:y),s:u?m/u*100:0,v:u/255*100,a:h}},Qt=function(s){var e=s.h,i=s.s,a=s.v,h=s.a;e=e/360*6,i/=100,a/=100;var u=Math.floor(e),m=a*(1-i),y=a*(1-(e-u)*i),E=a*(1-(1-e+u)*i),D=u%6;return{r:255*[a,y,m,m,E,a][D],g:255*[E,a,a,y,m,m][D],b:255*[m,m,E,a,a,y][D],a:h}},ee=function(s){return{h:Qe(s.h),s:ce(s.s,0,100),l:ce(s.l,0,100),a:ce(s.a)}},pe=function(s){return{h:ge(s.h),s:ge(s.s),l:ge(s.l),a:ge(s.a,3)}},Yt=function(s){return Qt((i=(e=s).s,{h:e.h,s:(i*=((a=e.l)<50?a:100-a)/100)>0?2*i/(a+i)*100:0,v:a+i,a:e.a}));var e,i,a},Me=function(s){return{h:(e=W(s)).h,s:(h=(200-(i=e.s))*(a=e.v)/100)>0&&h<200?i*a/100/(h<=100?h:200-h)*100:0,l:h/2,a:e.a};var e,i,a,h},Je=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Re=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,We=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,qr=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Le={string:[[function(s){var e=Or.exec(s);return e?(s=e[1]).length<=4?{r:parseInt(s[0]+s[0],16),g:parseInt(s[1]+s[1],16),b:parseInt(s[2]+s[2],16),a:s.length===4?ge(parseInt(s[3]+s[3],16)/255,2):1}:s.length===6||s.length===8?{r:parseInt(s.substr(0,2),16),g:parseInt(s.substr(2,2),16),b:parseInt(s.substr(4,2),16),a:s.length===8?ge(parseInt(s.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(s){var e=We.exec(s)||qr.exec(s);return e?e[2]!==e[4]||e[4]!==e[6]?null:mi({r:Number(e[1])/(e[2]?100/255:1),g:Number(e[3])/(e[4]?100/255:1),b:Number(e[5])/(e[6]?100/255:1),a:e[7]===void 0?1:Number(e[7])/(e[8]?100:1)}):null},"rgb"],[function(s){var e=Je.exec(s)||Re.exec(s);if(!e)return null;var i,a,h=ee({h:(i=e[1],a=e[2],a===void 0&&(a="deg"),Number(i)*(Ze[a]||1)),s:Number(e[3]),l:Number(e[4]),a:e[5]===void 0?1:Number(e[5])/(e[6]?100:1)});return Yt(h)},"hsl"]],object:[[function(s){var e=s.r,i=s.g,a=s.b,h=s.a,u=h===void 0?1:h;return Ee(e)&&Ee(i)&&Ee(a)?mi({r:Number(e),g:Number(i),b:Number(a),a:Number(u)}):null},"rgb"],[function(s){var e=s.h,i=s.s,a=s.l,h=s.a,u=h===void 0?1:h;if(!Ee(e)||!Ee(i)||!Ee(a))return null;var m=ee({h:Number(e),s:Number(i),l:Number(a),a:Number(u)});return Yt(m)},"hsl"],[function(s){var e=s.h,i=s.s,a=s.v,h=s.a,u=h===void 0?1:h;if(!Ee(e)||!Ee(i)||!Ee(a))return null;var m=function(y){return{h:Qe(y.h),s:ce(y.s,0,100),v:ce(y.v,0,100),a:ce(y.a)}}({h:Number(e),s:Number(i),v:Number(a),a:Number(u)});return Qt(m)},"hsv"]]},we=function(s,e){for(var i=0;i<e.length;i++){var a=e[i][0](s);if(a)return[a,e[i][1]]}return[null,void 0]},Zr=function(s){return typeof s=="string"?we(s.trim(),Le.string):typeof s=="object"&&s!==null?we(s,Le.object):[null,void 0]},$i=function(s){return Zr(s)[1]},Lr=function(s,e){var i=Me(s);return{h:i.h,s:ce(i.s+100*e,0,100),l:i.l,a:i.a}},Ne=function(s){return(299*s.r+587*s.g+114*s.b)/1e3/255},Nr=function(s,e){var i=Me(s);return{h:i.h,s:i.s,l:ce(i.l+100*e,0,100),a:i.a}},ze=function(){function s(e){this.parsed=Zr(e)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return s.prototype.isValid=function(){return this.parsed!==null},s.prototype.brightness=function(){return ge(Ne(this.rgba),2)},s.prototype.isDark=function(){return Ne(this.rgba)<.5},s.prototype.isLight=function(){return Ne(this.rgba)>=.5},s.prototype.toHex=function(){return e=yr(this.rgba),i=e.r,a=e.g,h=e.b,m=(u=e.a)<1?U(ge(255*u)):"","#"+U(i)+U(a)+U(h)+m;var e,i,a,h,u,m},s.prototype.toRgb=function(){return yr(this.rgba)},s.prototype.toRgbString=function(){return e=yr(this.rgba),i=e.r,a=e.g,h=e.b,(u=e.a)<1?"rgba("+i+", "+a+", "+h+", "+u+")":"rgb("+i+", "+a+", "+h+")";var e,i,a,h,u},s.prototype.toHsl=function(){return pe(Me(this.rgba))},s.prototype.toHslString=function(){return e=pe(Me(this.rgba)),i=e.h,a=e.s,h=e.l,(u=e.a)<1?"hsla("+i+", "+a+"%, "+h+"%, "+u+")":"hsl("+i+", "+a+"%, "+h+"%)";var e,i,a,h,u},s.prototype.toHsv=function(){return e=W(this.rgba),{h:ge(e.h),s:ge(e.s),v:ge(e.v),a:ge(e.a,3)};var e},s.prototype.invert=function(){return Ae({r:255-(e=this.rgba).r,g:255-e.g,b:255-e.b,a:e.a});var e},s.prototype.saturate=function(e){return e===void 0&&(e=.1),Ae(Lr(this.rgba,e))},s.prototype.desaturate=function(e){return e===void 0&&(e=.1),Ae(Lr(this.rgba,-e))},s.prototype.grayscale=function(){return Ae(Lr(this.rgba,-1))},s.prototype.lighten=function(e){return e===void 0&&(e=.1),Ae(Nr(this.rgba,e))},s.prototype.darken=function(e){return e===void 0&&(e=.1),Ae(Nr(this.rgba,-e))},s.prototype.rotate=function(e){return e===void 0&&(e=15),this.hue(this.hue()+e)},s.prototype.alpha=function(e){return typeof e=="number"?Ae({r:(i=this.rgba).r,g:i.g,b:i.b,a:e}):ge(this.rgba.a,3);var i},s.prototype.hue=function(e){var i=Me(this.rgba);return typeof e=="number"?Ae({h:e,s:i.s,l:i.l,a:i.a}):ge(i.h)},s.prototype.isEqual=function(e){return this.toHex()===Ae(e).toHex()},s}(),Ae=function(s){return s instanceof ze?s:new ze(s)},Ur=[],gi=function(s){s.forEach(function(e){Ur.indexOf(e)<0&&(e(ze,Le),Ur.push(e))})},ji=function(){return new ze({r:255*Math.random(),g:255*Math.random(),b:255*Math.random()})};function nr(s,e){var i={white:"#ffffff",bisque:"#ffe4c4",blue:"#0000ff",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",antiquewhite:"#faebd7",aqua:"#00ffff",azure:"#f0ffff",whitesmoke:"#f5f5f5",papayawhip:"#ffefd5",plum:"#dda0dd",blanchedalmond:"#ffebcd",black:"#000000",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",cornsilk:"#fff8dc",cornflowerblue:"#6495ed",burlywood:"#deb887",aquamarine:"#7fffd4",beige:"#f5f5dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkkhaki:"#bdb76b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",peachpuff:"#ffdab9",darkmagenta:"#8b008b",darkred:"#8b0000",darkorchid:"#9932cc",darkorange:"#ff8c00",darkslateblue:"#483d8b",gray:"#808080",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",deeppink:"#ff1493",deepskyblue:"#00bfff",wheat:"#f5deb3",firebrick:"#b22222",floralwhite:"#fffaf0",ghostwhite:"#f8f8ff",darkviolet:"#9400d3",magenta:"#ff00ff",green:"#008000",dodgerblue:"#1e90ff",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",blueviolet:"#8a2be2",forestgreen:"#228b22",lawngreen:"#7cfc00",indianred:"#cd5c5c",indigo:"#4b0082",fuchsia:"#ff00ff",brown:"#a52a2a",maroon:"#800000",mediumblue:"#0000cd",lightcoral:"#f08080",darkturquoise:"#00ced1",lightcyan:"#e0ffff",ivory:"#fffff0",lightyellow:"#ffffe0",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",linen:"#faf0e6",mediumaquamarine:"#66cdaa",lemonchiffon:"#fffacd",lime:"#00ff00",khaki:"#f0e68c",mediumseagreen:"#3cb371",limegreen:"#32cd32",mediumspringgreen:"#00fa9a",lightskyblue:"#87cefa",lightblue:"#add8e6",midnightblue:"#191970",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",mintcream:"#f5fffa",lightslategray:"#778899",lightslategrey:"#778899",navajowhite:"#ffdead",navy:"#000080",mediumvioletred:"#c71585",powderblue:"#b0e0e6",palegoldenrod:"#eee8aa",oldlace:"#fdf5e6",paleturquoise:"#afeeee",mediumturquoise:"#48d1cc",mediumorchid:"#ba55d3",rebeccapurple:"#663399",lightsteelblue:"#b0c4de",mediumslateblue:"#7b68ee",thistle:"#d8bfd8",tan:"#d2b48c",orchid:"#da70d6",mediumpurple:"#9370db",purple:"#800080",pink:"#ffc0cb",skyblue:"#87ceeb",springgreen:"#00ff7f",palegreen:"#98fb98",red:"#ff0000",yellow:"#ffff00",slateblue:"#6a5acd",lavenderblush:"#fff0f5",peru:"#cd853f",palevioletred:"#db7093",violet:"#ee82ee",teal:"#008080",slategray:"#708090",slategrey:"#708090",aliceblue:"#f0f8ff",darkseagreen:"#8fbc8f",darkolivegreen:"#556b2f",greenyellow:"#adff2f",seagreen:"#2e8b57",seashell:"#fff5ee",tomato:"#ff6347",silver:"#c0c0c0",sienna:"#a0522d",lavender:"#e6e6fa",lightgreen:"#90ee90",orange:"#ffa500",orangered:"#ff4500",steelblue:"#4682b4",royalblue:"#4169e1",turquoise:"#40e0d0",yellowgreen:"#9acd32",salmon:"#fa8072",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",darksalmon:"#e9967a",lightgoldenrodyellow:"#fafad2",snow:"#fffafa",lightgrey:"#d3d3d3",lightgray:"#d3d3d3",dimgray:"#696969",dimgrey:"#696969",olivedrab:"#6b8e23",olive:"#808000"},a={};for(var h in i)a[i[h]]=h;var u={};s.prototype.toName=function(m){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return"transparent";var y,E,D=a[this.toHex()];if(D)return D;if(m!=null&&m.closest){var Z=this.toRgb(),st=1/0,yt="black";if(!u.length)for(var jt in i)u[jt]=new s(i[jt]).toRgb();for(var le in i){var Kt=(y=Z,E=u[le],Math.pow(y.r-E.r,2)+Math.pow(y.g-E.g,2)+Math.pow(y.b-E.b,2));Kt<st&&(st=Kt,yt=le)}return yt}},e.string.push([function(m){var y=m.toLowerCase(),E=y==="transparent"?"#0000":i[y];return E?new s(E).toRgb():null},"name"])}gi([nr]);const tr=class Tn{constructor(e=16777215){this._value=null,this._components=new Float32Array(4),this._components.fill(1),this._int=16777215,this.value=e}get red(){return this._components[0]}get green(){return this._components[1]}get blue(){return this._components[2]}get alpha(){return this._components[3]}setValue(e){return this.value=e,this}set value(e){if(e instanceof Tn)this._value=this.cloneSource(e._value),this._int=e._int,this._components.set(e._components);else{if(e===null)throw new Error("Cannot set PIXI.Color#value to null");(this._value===null||!this.isSourceEqual(this._value,e))&&(this.normalize(e),this._value=this.cloneSource(e))}}get value(){return this._value}cloneSource(e){return typeof e=="string"||typeof e=="number"||e instanceof Number||e===null?e:Array.isArray(e)||ArrayBuffer.isView(e)?e.slice(0):typeof e=="object"&&e!==null?fe({},e):e}isSourceEqual(e,i){const a=typeof e;if(a!==typeof i)return!1;if(a==="number"||a==="string"||e instanceof Number)return e===i;if(Array.isArray(e)&&Array.isArray(i)||ArrayBuffer.isView(e)&&ArrayBuffer.isView(i))return e.length!==i.length?!1:e.every((h,u)=>h===i[u]);if(e!==null&&i!==null){const h=Object.keys(e),u=Object.keys(i);return h.length!==u.length?!1:h.every(m=>e[m]===i[m])}return e===i}toRgba(){const[e,i,a,h]=this._components;return{r:e,g:i,b:a,a:h}}toRgb(){const[e,i,a]=this._components;return{r:e,g:i,b:a}}toRgbaString(){const[e,i,a]=this.toUint8RgbArray();return`rgba(${e},${i},${a},${this.alpha})`}toUint8RgbArray(e){const[i,a,h]=this._components;return e=e!=null?e:[],e[0]=Math.round(i*255),e[1]=Math.round(a*255),e[2]=Math.round(h*255),e}toRgbArray(e){e=e!=null?e:[];const[i,a,h]=this._components;return e[0]=i,e[1]=a,e[2]=h,e}toNumber(){return this._int}toLittleEndianNumber(){const e=this._int;return(e>>16)+(e&65280)+((e&255)<<16)}multiply(e){const[i,a,h,u]=Tn.temp.setValue(e)._components;return this._components[0]*=i,this._components[1]*=a,this._components[2]*=h,this._components[3]*=u,this.refreshInt(),this._value=null,this}premultiply(e,i=!0){return i&&(this._components[0]*=e,this._components[1]*=e,this._components[2]*=e),this._components[3]=e,this.refreshInt(),this._value=null,this}toPremultiplied(e,i=!0){if(e===1)return(255<<24)+this._int;if(e===0)return i?0:this._int;let a=this._int>>16&255,h=this._int>>8&255,u=this._int&255;return i&&(a=a*e+.5|0,h=h*e+.5|0,u=u*e+.5|0),(e*255<<24)+(a<<16)+(h<<8)+u}toHex(){const e=this._int.toString(16);return`#${"000000".substring(0,6-e.length)+e}`}toHexa(){const e=Math.round(this._components[3]*255).toString(16);return this.toHex()+"00".substring(0,2-e.length)+e}setAlpha(e){return this._components[3]=this._clamp(e),this}round(e){const[i,a,h]=this._components;return this._components[0]=Math.round(i*e)/e,this._components[1]=Math.round(a*e)/e,this._components[2]=Math.round(h*e)/e,this.refreshInt(),this._value=null,this}toArray(e){e=e!=null?e:[];const[i,a,h,u]=this._components;return e[0]=i,e[1]=a,e[2]=h,e[3]=u,e}normalize(e){let i,a,h,u;if((typeof e=="number"||e instanceof Number)&&e>=0&&e<=16777215){const m=e;i=(m>>16&255)/255,a=(m>>8&255)/255,h=(m&255)/255,u=1}else if((Array.isArray(e)||e instanceof Float32Array)&&e.length>=3&&e.length<=4)e=this._clamp(e),[i,a,h,u=1]=e;else if((e instanceof Uint8Array||e instanceof Uint8ClampedArray)&&e.length>=3&&e.length<=4)e=this._clamp(e,0,255),[i,a,h,u=255]=e,i/=255,a/=255,h/=255,u/=255;else if(typeof e=="string"||typeof e=="object"){if(typeof e=="string"){const y=Tn.HEX_PATTERN.exec(e);y&&(e=`#${y[2]}`)}const m=Ae(e);m.isValid()&&({r:i,g:a,b:h,a:u}=m.rgba,i/=255,a/=255,h/=255)}if(i!==void 0)this._components[0]=i,this._components[1]=a,this._components[2]=h,this._components[3]=u,this.refreshInt();else throw new Error(`Unable to convert color ${e}`)}refreshInt(){this._clamp(this._components);const[e,i,a]=this._components;this._int=(e*255<<16)+(i*255<<8)+(a*255|0)}_clamp(e,i=0,a=1){return typeof e=="number"?Math.min(Math.max(e,i),a):(e.forEach((h,u)=>{e[u]=Math.min(Math.max(h,i),a)}),e)}};tr.shared=new tr,tr.temp=new tr,tr.HEX_PATTERN=/^(#|0x)?(([a-f0-9]{3}){1,2}([a-f0-9]{2})?)$/i;let Se=tr;function _i(s,e=[]){return Et("7.2.0","utils.hex2rgb is deprecated, use Color#toRgbArray instead"),Se.shared.setValue(s).toRgbArray(e)}function Yi(s){return Et("7.2.0","utils.hex2string is deprecated, use Color#toHex instead"),Se.shared.setValue(s).toHex()}function Qr(s){return Et("7.2.0","utils.string2hex is deprecated, use Color#toNumber instead"),Se.shared.setValue(s).toNumber()}function ar(s){return Et("7.2.0","utils.rgb2hex is deprecated, use Color#toNumber instead"),Se.shared.setValue(s).toNumber()}function xr(){const s=[],e=[];for(let a=0;a<32;a++)s[a]=a,e[a]=a;s[Y.NORMAL_NPM]=Y.NORMAL,s[Y.ADD_NPM]=Y.ADD,s[Y.SCREEN_NPM]=Y.SCREEN,e[Y.NORMAL]=Y.NORMAL_NPM,e[Y.ADD]=Y.ADD_NPM,e[Y.SCREEN]=Y.SCREEN_NPM;const i=[];return i.push(e),i.push(s),i}const Jr=xr();function yi(s,e){return Jr[e?1:0][s]}function In(s,e,i,a=!0){return Et("7.2.0","utils.premultiplyRgba has moved to Color.premultiply"),Se.shared.setValue(s).premultiply(e,a).toArray(i!=null?i:new Float32Array(4))}function xi(s,e){return Et("7.2.0","utils.premultiplyTint has moved to Color.toPremultiplied"),Se.shared.setValue(s).toPremultiplied(e)}function Cn(s,e,i,a=!0){return Et("7.2.0","utils.premultiplyTintToRgba has moved to Color.premultiply"),Se.shared.setValue(s).premultiply(e,a).toArray(i!=null?i:new Float32Array(4))}const Ki=/^\s*data:(?:([\w-]+)\/([\w+.-]+))?(?:;charset=([\w-]+))?(?:;(base64))?,(.*)/i;function Rn(s,e=null){const i=s*6;if(e=e||new Uint16Array(i),e.length!==i)throw new Error(`Out buffer length is incorrect, got ${e.length} and expected ${i}`);for(let a=0,h=0;a<i;a+=6,h+=4)e[a+0]=h+0,e[a+1]=h+1,e[a+2]=h+2,e[a+3]=h+0,e[a+4]=h+2,e[a+5]=h+3;return e}function vi(s){if(s.BYTES_PER_ELEMENT===4)return s instanceof Float32Array?"Float32Array":s instanceof Uint32Array?"Uint32Array":"Int32Array";if(s.BYTES_PER_ELEMENT===2){if(s instanceof Uint16Array)return"Uint16Array"}else if(s.BYTES_PER_ELEMENT===1&&s instanceof Uint8Array)return"Uint8Array";return null}const Os={Float32Array,Uint32Array,Int32Array,Uint8Array};function Pn(s,e){let i=0,a=0;const h={};for(let E=0;E<s.length;E++)a+=e[E],i+=s[E].length;const u=new ArrayBuffer(i*4);let m=null,y=0;for(let E=0;E<s.length;E++){const D=e[E],Z=s[E],st=vi(Z);h[st]||(h[st]=new Os[st](u)),m=h[st];for(let yt=0;yt<Z.length;yt++){const jt=(yt/D|0)*a+y,le=yt%D;m[jt+le]=Z[yt]}y+=D}return new Float32Array(u)}function ti(s){return s+=s===0?1:0,--s,s|=s>>>1,s|=s>>>2,s|=s>>>4,s|=s>>>8,s|=s>>>16,s+1}function ei(s){return!(s&s-1)&&!!s}function qi(s){let e=(s>65535?1:0)<<4;s>>>=e;let i=(s>255?1:0)<<3;return s>>>=i,e|=i,i=(s>15?1:0)<<2,s>>>=i,e|=i,i=(s>3?1:0)<<1,s>>>=i,e|=i,e|s>>1}function Ls(s,e,i){const a=s.length;let h;if(e>=a||i===0)return;i=e+i>a?a-e:i;const u=a-i;for(h=e;h<u;++h)s[h]=s[h+i];s.length=u}function Mn(s){return s===0?0:s<0?-1:1}let Bn=0;function or(){return++Bn}const Pe=class{constructor(s,e,i,a){this.left=s,this.top=e,this.right=i,this.bottom=a}get width(){return this.right-this.left}get height(){return this.bottom-this.top}isEmpty(){return this.left===this.right||this.top===this.bottom}};Pe.EMPTY=new Pe(0,0,0,0);let kr=Pe;const Ue={},ve=Object.create(null),Be=Object.create(null);function Fn(){let s;for(s in ve)ve[s].destroy();for(s in Be)Be[s].destroy()}function Dn(){let s;for(s in ve)delete ve[s];for(s in Be)delete Be[s]}class vr{constructor(e,i,a){this._canvas=P.ADAPTER.createCanvas(),this._context=this._canvas.getContext("2d"),this.resolution=a||P.RESOLUTION,this.resize(e,i)}clear(){this._checkDestroyed(),this._context.setTransform(1,0,0,1,0,0),this._context.clearRect(0,0,this._canvas.width,this._canvas.height)}resize(e,i){this._checkDestroyed(),this._canvas.width=Math.round(e*this.resolution),this._canvas.height=Math.round(i*this.resolution)}destroy(){this._context=null,this._canvas=null}get width(){return this._checkDestroyed(),this._canvas.width}set width(e){this._checkDestroyed(),this._canvas.width=Math.round(e)}get height(){return this._checkDestroyed(),this._canvas.height}set height(e){this._checkDestroyed(),this._canvas.height=Math.round(e)}get canvas(){return this._checkDestroyed(),this._canvas}get context(){return this._checkDestroyed(),this._context}_checkDestroyed(){if(this._canvas===null)throw new TypeError("The CanvasRenderTarget has already been destroyed")}}function bi(s,e,i){for(let a=0,h=4*i*e;a<e;++a,h+=4)if(s[h+3]!==0)return!1;return!0}function ri(s,e,i,a,h){const u=4*e;for(let m=a,y=a*u+4*i;m<=h;++m,y+=u)if(s[y+3]!==0)return!1;return!0}function Ns(s){const{width:e,height:i}=s,a=s.getContext("2d",{willReadFrequently:!0});if(a===null)throw new TypeError("Failed to get canvas 2D context");const h=a.getImageData(0,0,e,i).data;let u=0,m=0,y=e-1,E=i-1;for(;m<i&&bi(h,e,m);)++m;if(m===i)return kr.EMPTY;for(;bi(h,e,E);)--E;for(;ri(h,e,u,m,E);)++u;for(;ri(h,e,y,m,E);)--y;return++y,++E,new kr(u,m,y,E)}function Us(s){const e=Ns(s),{width:i,height:a}=e;let h=null;if(!e.isEmpty()){const u=s.getContext("2d");if(u===null)throw new TypeError("Failed to get canvas 2D context");h=u.getImageData(e.left,e.top,i,a)}return{width:i,height:a,data:h}}function On(s){const e=Ki.exec(s);if(e)return{mediaType:e[1]?e[1].toLowerCase():void 0,subType:e[2]?e[2].toLowerCase():void 0,charset:e[3]?e[3].toLowerCase():void 0,encoding:e[4]?e[4].toLowerCase():void 0,data:e[5]}}function ii(s,e=globalThis.location){if(s.startsWith("data:"))return"";e=e||globalThis.location;const i=new URL(s,document.baseURI);return i.hostname!==e.hostname||i.port!==e.port||i.protocol!==e.protocol?"anonymous":""}function Zi(s,e=1){var a;const i=(a=P.RETINA_PREFIX)==null?void 0:a.exec(s);return i?parseFloat(i[1]):e}var Zt=(s=>(s.Renderer="renderer",s.Application="application",s.RendererSystem="renderer-webgl-system",s.RendererPlugin="renderer-webgl-plugin",s.CanvasRendererSystem="renderer-canvas-system",s.CanvasRendererPlugin="renderer-canvas-plugin",s.Asset="asset",s.LoadParser="load-parser",s.ResolveParser="resolve-parser",s.CacheParser="cache-parser",s.DetectionParser="detection-parser",s))(Zt||{});const Qi=s=>{if(typeof s=="function"||typeof s=="object"&&s.extension){if(!s.extension)throw new Error("Extension class must have an extension object");s=fi(fe({},typeof s.extension!="object"?{type:s.extension}:s.extension),{ref:s})}if(typeof s=="object")s=fe({},s);else throw new Error("Invalid extension type");return typeof s.type=="string"&&(s.type=[s.type]),s},ks=(s,e)=>{var i;return(i=Qi(s).priority)!=null?i:e},re={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...s){return s.map(Qi).forEach(e=>{e.type.forEach(i=>{var a,h;return(h=(a=this._removeHandlers)[i])==null?void 0:h.call(a,e)})}),this},add(...s){return s.map(Qi).forEach(e=>{e.type.forEach(i=>{const a=this._addHandlers,h=this._queue;a[i]?a[i](e):(h[i]=h[i]||[],h[i].push(e))})}),this},handle(s,e,i){const a=this._addHandlers,h=this._removeHandlers;if(a[s]||h[s])throw new Error(`Extension type ${s} already has a handler`);a[s]=e,h[s]=i;const u=this._queue;return u[s]&&(u[s].forEach(m=>e(m)),delete u[s]),this},handleByMap(s,e){return this.handle(s,i=>{e[i.name]=i.ref},i=>{delete e[i.name]})},handleByList(s,e,i=-1){return this.handle(s,a=>{e.includes(a.ref)||(e.push(a.ref),e.sort((h,u)=>ks(u,i)-ks(h,i)))},a=>{const h=e.indexOf(a.ref);h!==-1&&e.splice(h,1)})}};class Gs{constructor(e){typeof e=="number"?this.rawBinaryData=new ArrayBuffer(e):e instanceof Uint8Array?this.rawBinaryData=e.buffer:this.rawBinaryData=e,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get uint16View(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}view(e){return this[`${e}View`]}destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null}static sizeOf(e){switch(e){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${e} isn't a valid view type`)}}}const Ln=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function Nn(s){let e="";for(let i=0;i<s;++i)i>0&&(e+=`
else `),i<s-1&&(e+=`if(test == ${i}.0){}`);return e}function Un(s,e){if(s===0)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");const i=e.createShader(e.FRAGMENT_SHADER);for(;;){const a=Ln.replace(/%forloop%/gi,Nn(s));if(e.shaderSource(i,a),e.compileShader(i),!e.getShaderParameter(i,e.COMPILE_STATUS))s=s/2|0;else break}return s}const Ji=0,ts=1,es=2,rs=3,is=4,ss=5;class br{constructor(){this.data=0,this.blendMode=Y.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(this.data&1<<Ji)}set blend(e){!!(this.data&1<<Ji)!==e&&(this.data^=1<<Ji)}get offsets(){return!!(this.data&1<<ts)}set offsets(e){!!(this.data&1<<ts)!==e&&(this.data^=1<<ts)}get culling(){return!!(this.data&1<<es)}set culling(e){!!(this.data&1<<es)!==e&&(this.data^=1<<es)}get depthTest(){return!!(this.data&1<<rs)}set depthTest(e){!!(this.data&1<<rs)!==e&&(this.data^=1<<rs)}get depthMask(){return!!(this.data&1<<ss)}set depthMask(e){!!(this.data&1<<ss)!==e&&(this.data^=1<<ss)}get clockwiseFrontFace(){return!!(this.data&1<<is)}set clockwiseFrontFace(e){!!(this.data&1<<is)!==e&&(this.data^=1<<is)}get blendMode(){return this._blendMode}set blendMode(e){this.blend=e!==Y.NONE,this._blendMode=e}get polygonOffset(){return this._polygonOffset}set polygonOffset(e){this.offsets=!!e,this._polygonOffset=e}static for2d(){const e=new br;return e.depthTest=!1,e.blend=!0,e}}br.prototype.toString=function(){return`[@pixi/core:State blendMode=${this.blendMode} clockwiseFrontFace=${this.clockwiseFrontFace} culling=${this.culling} depthMask=${this.depthMask} polygonOffset=${this.polygonOffset}]`};const Ti=[];function Hs(s,e){if(!s)return null;let i="";if(typeof s=="string"){const a=/\.(\w{3,4})(?:$|\?|#)/i.exec(s);a&&(i=a[1].toLowerCase())}for(let a=Ti.length-1;a>=0;--a){const h=Ti[a];if(h.test&&h.test(s,i))return new h(s,e)}throw new Error("Unrecognized source type to auto-detect Resource")}class ye{constructor(e){this.items=[],this._name=e,this._aliasCount=0}emit(e,i,a,h,u,m,y,E){if(arguments.length>8)throw new Error("max arguments reached");const{name:D,items:Z}=this;this._aliasCount++;for(let st=0,yt=Z.length;st<yt;st++)Z[st][D](e,i,a,h,u,m,y,E);return Z===this.items&&this._aliasCount--,this}ensureNonAliasedItems(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))}add(e){return e[this._name]&&(this.ensureNonAliasedItems(),this.remove(e),this.items.push(e)),this}remove(e){const i=this.items.indexOf(e);return i!==-1&&(this.ensureNonAliasedItems(),this.items.splice(i,1)),this}contains(e){return this.items.includes(e)}removeAll(){return this.ensureNonAliasedItems(),this.items.length=0,this}destroy(){this.removeAll(),this.items=null,this._name=null}get empty(){return this.items.length===0}get name(){return this._name}}Object.defineProperties(ye.prototype,{dispatch:{value:ye.prototype.emit},run:{value:ye.prototype.emit}});class Tr{constructor(e=0,i=0){this._width=e,this._height=i,this.destroyed=!1,this.internal=!1,this.onResize=new ye("setRealSize"),this.onUpdate=new ye("update"),this.onError=new ye("onError")}bind(e){this.onResize.add(e),this.onUpdate.add(e),this.onError.add(e),(this._width||this._height)&&this.onResize.emit(this._width,this._height)}unbind(e){this.onResize.remove(e),this.onUpdate.remove(e),this.onError.remove(e)}resize(e,i){(e!==this._width||i!==this._height)&&(this._width=e,this._height=i,this.onResize.emit(e,i))}get valid(){return!!this._width&&!!this._height}update(){this.destroyed||this.onUpdate.emit()}load(){return Promise.resolve(this)}get width(){return this._width}get height(){return this._height}style(e,i,a){return!1}dispose(){}destroy(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)}static test(e,i){return!1}}class Ei extends Tr{constructor(e,i){var u;const{width:a,height:h}=i||{};if(!a||!h)throw new Error("BufferResource width or height invalid");super(a,h),this.data=e,this.unpackAlignment=(u=i.unpackAlignment)!=null?u:4}upload(e,i,a){const h=e.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,this.unpackAlignment),h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i.alphaMode===H.UNPACK);const u=i.realWidth,m=i.realHeight;return a.width===u&&a.height===m?h.texSubImage2D(i.target,0,0,0,u,m,i.format,a.type,this.data):(a.width=u,a.height=m,h.texImage2D(i.target,0,a.internalFormat,u,m,0,i.format,a.type,this.data)),!0}dispose(){this.data=null}static test(e){return e===null||e instanceof Int8Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array}}const kn={scaleMode:q.NEAREST,alphaMode:H.NPM},ns=class Hi extends Mt{constructor(e=null,i=null){super(),i=Object.assign({},Hi.defaultOptions,i);const{alphaMode:a,mipmap:h,anisotropicLevel:u,scaleMode:m,width:y,height:E,wrapMode:D,format:Z,type:st,target:yt,resolution:jt,resourceOptions:le}=i;e&&!(e instanceof Tr)&&(e=Hs(e,le),e.internal=!0),this.resolution=jt||P.RESOLUTION,this.width=Math.round((y||0)*this.resolution)/this.resolution,this.height=Math.round((E||0)*this.resolution)/this.resolution,this._mipmap=h,this.anisotropicLevel=u,this._wrapMode=D,this._scaleMode=m,this.format=Z,this.type=st,this.target=yt,this.alphaMode=a,this.uid=or(),this.touched=0,this.isPowerOfTwo=!1,this._refreshPOT(),this._glTextures={},this.dirtyId=0,this.dirtyStyleId=0,this.cacheId=null,this.valid=y>0&&E>0,this.textureCacheIds=[],this.destroyed=!1,this.resource=null,this._batchEnabled=0,this._batchLocation=0,this.parentTextureArray=null,this.setResource(e)}get realWidth(){return Math.round(this.width*this.resolution)}get realHeight(){return Math.round(this.height*this.resolution)}get mipmap(){return this._mipmap}set mipmap(e){this._mipmap!==e&&(this._mipmap=e,this.dirtyStyleId++)}get scaleMode(){return this._scaleMode}set scaleMode(e){this._scaleMode!==e&&(this._scaleMode=e,this.dirtyStyleId++)}get wrapMode(){return this._wrapMode}set wrapMode(e){this._wrapMode!==e&&(this._wrapMode=e,this.dirtyStyleId++)}setStyle(e,i){let a;return e!==void 0&&e!==this.scaleMode&&(this.scaleMode=e,a=!0),i!==void 0&&i!==this.mipmap&&(this.mipmap=i,a=!0),a&&this.dirtyStyleId++,this}setSize(e,i,a){return a=a||this.resolution,this.setRealSize(e*a,i*a,a)}setRealSize(e,i,a){return this.resolution=a||this.resolution,this.width=Math.round(e)/this.resolution,this.height=Math.round(i)/this.resolution,this._refreshPOT(),this.update(),this}_refreshPOT(){this.isPowerOfTwo=ei(this.realWidth)&&ei(this.realHeight)}setResolution(e){const i=this.resolution;return i===e?this:(this.resolution=e,this.valid&&(this.width=Math.round(this.width*i)/e,this.height=Math.round(this.height*i)/e,this.emit("update",this)),this._refreshPOT(),this)}setResource(e){if(this.resource===e)return this;if(this.resource)throw new Error("Resource can be set only once");return e.bind(this),this.resource=e,this}update(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))}onError(e){this.emit("error",this,e)}destroy(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete Be[this.cacheId],delete ve[this.cacheId],this.cacheId=null),this.valid=!1,this.dispose(),Hi.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0,this.emit("destroyed",this),this.removeAllListeners()}dispose(){this.emit("dispose",this)}castToBaseTexture(){return this}static from(e,i,a=P.STRICT_TEXTURE_CACHE){const h=typeof e=="string";let u=null;if(h)u=e;else{if(!e._pixiId){const y=(i==null?void 0:i.pixiIdPrefix)||"pixiid";e._pixiId=`${y}_${or()}`}u=e._pixiId}let m=Be[u];if(h&&a&&!m)throw new Error(`The cacheId "${u}" does not exist in BaseTextureCache.`);return m||(m=new Hi(e,i),m.cacheId=u,Hi.addToCache(m,u)),m}static fromBuffer(e,i,a,h){e=e||new Float32Array(i*a*4);const u=new Ei(e,fe({width:i,height:a},h==null?void 0:h.resourceOptions));let m,y;return e instanceof Float32Array?(m=O.RGBA,y=V.FLOAT):e instanceof Int32Array?(m=O.RGBA_INTEGER,y=V.INT):e instanceof Uint32Array?(m=O.RGBA_INTEGER,y=V.UNSIGNED_INT):e instanceof Int16Array?(m=O.RGBA_INTEGER,y=V.SHORT):e instanceof Uint16Array?(m=O.RGBA_INTEGER,y=V.UNSIGNED_SHORT):e instanceof Int8Array?(m=O.RGBA,y=V.BYTE):(m=O.RGBA,y=V.UNSIGNED_BYTE),u.internal=!0,new Hi(u,Object.assign({},kn,{type:y,format:m},h))}static addToCache(e,i){i&&(e.textureCacheIds.includes(i)||e.textureCacheIds.push(i),Be[i]&&Be[i]!==e&&console.warn(`BaseTexture added to the cache with an id [${i}] that already had an entry`),Be[i]=e)}static removeFromCache(e){if(typeof e=="string"){const i=Be[e];if(i){const a=i.textureCacheIds.indexOf(e);return a>-1&&i.textureCacheIds.splice(a,1),delete Be[e],i}}else if(e!=null&&e.textureCacheIds){for(let i=0;i<e.textureCacheIds.length;++i)delete Be[e.textureCacheIds[i]];return e.textureCacheIds.length=0,e}return null}};ns.defaultOptions={mipmap:pt.POW2,anisotropicLevel:0,scaleMode:q.LINEAR,wrapMode:ft.CLAMP,alphaMode:H.UNPACK,target:J.TEXTURE_2D,format:O.RGBA,type:V.UNSIGNED_BYTE},ns._globalBatch=0;let se=ns;class Xs{constructor(){this.texArray=null,this.blend=0,this.type=dt.TRIANGLES,this.start=0,this.size=0,this.data=null}}let Gn=0;class Ie{constructor(e,i=!0,a=!1){this.data=e||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=a,this.static=i,this.id=Gn++,this.disposeRunner=new ye("disposeBuffer")}update(e){e instanceof Array&&(e=new Float32Array(e)),this.data=e||this.data,this._updateID++}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.data=null}set index(e){this.type=e?ct.ELEMENT_ARRAY_BUFFER:ct.ARRAY_BUFFER}get index(){return this.type===ct.ELEMENT_ARRAY_BUFFER}static from(e){return e instanceof Array&&(e=new Float32Array(e)),new Ie(e)}}class Ai{constructor(e,i=0,a=!1,h=V.FLOAT,u,m,y,E=1){this.buffer=e,this.size=i,this.normalized=a,this.type=h,this.stride=u,this.start=m,this.instance=y,this.divisor=E}destroy(){this.buffer=null}static from(e,i,a,h,u){return new Ai(e,i,a,h,u)}}const Hn={Float32Array,Uint32Array,Int32Array,Uint8Array};function Xn(s,e){let i=0,a=0;const h={};for(let E=0;E<s.length;E++)a+=e[E],i+=s[E].length;const u=new ArrayBuffer(i*4);let m=null,y=0;for(let E=0;E<s.length;E++){const D=e[E],Z=s[E],st=vi(Z);h[st]||(h[st]=new Hn[st](u)),m=h[st];for(let yt=0;yt<Z.length;yt++){const jt=(yt/D|0)*a+y,le=yt%D;m[jt+le]=Z[yt]}y+=D}return new Float32Array(u)}const si={5126:4,5123:2,5121:1};let Vn=0;const Vs={Float32Array,Uint32Array,Int32Array,Uint8Array,Uint16Array};class Er{constructor(e=[],i={}){this.buffers=e,this.indexBuffer=null,this.attributes=i,this.glVertexArrayObjects={},this.id=Vn++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new ye("disposeGeometry"),this.refCount=0}addAttribute(e,i,a=0,h=!1,u,m,y,E=!1){if(!i)throw new Error("You must pass a buffer when creating an attribute");i instanceof Ie||(i instanceof Array&&(i=new Float32Array(i)),i=new Ie(i));const D=e.split("|");if(D.length>1){for(let st=0;st<D.length;st++)this.addAttribute(D[st],i,a,h,u);return this}let Z=this.buffers.indexOf(i);return Z===-1&&(this.buffers.push(i),Z=this.buffers.length-1),this.attributes[e]=new Ai(Z,a,h,u,m,y,E),this.instanced=this.instanced||E,this}getAttribute(e){return this.attributes[e]}getBuffer(e){return this.buffers[this.getAttribute(e).buffer]}addIndex(e){return e instanceof Ie||(e instanceof Array&&(e=new Uint16Array(e)),e=new Ie(e)),e.type=ct.ELEMENT_ARRAY_BUFFER,this.indexBuffer=e,this.buffers.includes(e)||this.buffers.push(e),this}getIndex(){return this.indexBuffer}interleave(){if(this.buffers.length===1||this.buffers.length===2&&this.indexBuffer)return this;const e=[],i=[],a=new Ie;let h;for(h in this.attributes){const u=this.attributes[h],m=this.buffers[u.buffer];e.push(m.data),i.push(u.size*si[u.type]/4),u.buffer=0}for(a.data=Xn(e,i),h=0;h<this.buffers.length;h++)this.buffers[h]!==this.indexBuffer&&this.buffers[h].destroy();return this.buffers=[a],this.indexBuffer&&this.buffers.push(this.indexBuffer),this}getSize(){for(const e in this.attributes){const i=this.attributes[e];return this.buffers[i.buffer].data.length/(i.stride/4||i.size)}return 0}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null}clone(){const e=new Er;for(let i=0;i<this.buffers.length;i++)e.buffers[i]=new Ie(this.buffers[i].data.slice(0));for(const i in this.attributes){const a=this.attributes[i];e.attributes[i]=new Ai(a.buffer,a.size,a.normalized,a.type,a.stride,a.start,a.instance)}return this.indexBuffer&&(e.indexBuffer=e.buffers[this.buffers.indexOf(this.indexBuffer)],e.indexBuffer.type=ct.ELEMENT_ARRAY_BUFFER),e}static merge(e){const i=new Er,a=[],h=[],u=[];let m;for(let y=0;y<e.length;y++){m=e[y];for(let E=0;E<m.buffers.length;E++)h[E]=h[E]||0,h[E]+=m.buffers[E].data.length,u[E]=0}for(let y=0;y<m.buffers.length;y++)a[y]=new Vs[vi(m.buffers[y].data)](h[y]),i.buffers[y]=new Ie(a[y]);for(let y=0;y<e.length;y++){m=e[y];for(let E=0;E<m.buffers.length;E++)a[E].set(m.buffers[E].data,u[E]),u[E]+=m.buffers[E].data.length}if(i.attributes=m.attributes,m.indexBuffer){i.indexBuffer=i.buffers[m.buffers.indexOf(m.indexBuffer)],i.indexBuffer.type=ct.ELEMENT_ARRAY_BUFFER;let y=0,E=0,D=0,Z=0;for(let st=0;st<m.buffers.length;st++)if(m.buffers[st]!==m.indexBuffer){Z=st;break}for(const st in m.attributes){const yt=m.attributes[st];(yt.buffer|0)===Z&&(E+=yt.size*si[yt.type]/4)}for(let st=0;st<e.length;st++){const yt=e[st].indexBuffer.data;for(let jt=0;jt<yt.length;jt++)i.indexBuffer.data[jt+D]+=y;y+=e[st].buffers[Z].data.length/E,D+=yt.length}}return i}}class Gr extends Er{constructor(e=!1){super(),this._buffer=new Ie(null,e,!1),this._indexBuffer=new Ie(null,e,!0),this.addAttribute("aVertexPosition",this._buffer,2,!1,V.FLOAT).addAttribute("aTextureCoord",this._buffer,2,!1,V.FLOAT).addAttribute("aColor",this._buffer,4,!0,V.UNSIGNED_BYTE).addAttribute("aTextureId",this._buffer,1,!0,V.FLOAT).addIndex(this._indexBuffer)}}const as=Math.PI*2,os=180/Math.PI,Ws=Math.PI/180;var hr=(s=>(s[s.POLY=0]="POLY",s[s.RECT=1]="RECT",s[s.CIRC=2]="CIRC",s[s.ELIP=3]="ELIP",s[s.RREC=4]="RREC",s))(hr||{});class oe{constructor(e=0,i=0){this.x=0,this.y=0,this.x=e,this.y=i}clone(){return new oe(this.x,this.y)}copyFrom(e){return this.set(e.x,e.y),this}copyTo(e){return e.set(this.x,this.y),e}equals(e){return e.x===this.x&&e.y===this.y}set(e=0,i=e){return this.x=e,this.y=i,this}}oe.prototype.toString=function(){return`[@pixi/math:Point x=${this.x} y=${this.y}]`};const ke=[new oe,new oe,new oe,new oe];class ie{constructor(e=0,i=0,a=0,h=0){this.x=Number(e),this.y=Number(i),this.width=Number(a),this.height=Number(h),this.type=hr.RECT}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}static get EMPTY(){return new ie(0,0,0,0)}clone(){return new ie(this.x,this.y,this.width,this.height)}copyFrom(e){return this.x=e.x,this.y=e.y,this.width=e.width,this.height=e.height,this}copyTo(e){return e.x=this.x,e.y=this.y,e.width=this.width,e.height=this.height,e}contains(e,i){return this.width<=0||this.height<=0?!1:e>=this.x&&e<this.x+this.width&&i>=this.y&&i<this.y+this.height}intersects(e,i){if(!i){const Pa=this.x<e.x?e.x:this.x;if((this.right>e.right?e.right:this.right)<=Pa)return!1;const Ma=this.y<e.y?e.y:this.y;return(this.bottom>e.bottom?e.bottom:this.bottom)>Ma}const a=this.left,h=this.right,u=this.top,m=this.bottom;if(h<=a||m<=u)return!1;const y=ke[0].set(e.left,e.top),E=ke[1].set(e.left,e.bottom),D=ke[2].set(e.right,e.top),Z=ke[3].set(e.right,e.bottom);if(D.x<=y.x||E.y<=y.y)return!1;const st=Math.sign(i.a*i.d-i.b*i.c);if(st===0||(i.apply(y,y),i.apply(E,E),i.apply(D,D),i.apply(Z,Z),Math.max(y.x,E.x,D.x,Z.x)<=a||Math.min(y.x,E.x,D.x,Z.x)>=h||Math.max(y.y,E.y,D.y,Z.y)<=u||Math.min(y.y,E.y,D.y,Z.y)>=m))return!1;const yt=st*(E.y-y.y),jt=st*(y.x-E.x),le=yt*a+jt*u,Kt=yt*h+jt*u,_e=yt*a+jt*m,Yr=yt*h+jt*m;if(Math.max(le,Kt,_e,Yr)<=yt*y.x+jt*y.y||Math.min(le,Kt,_e,Yr)>=yt*Z.x+jt*Z.y)return!1;const Mr=st*(y.y-D.y),Br=st*(D.x-y.x),Fr=Mr*a+Br*u,Dr=Mr*h+Br*u,ga=Mr*a+Br*m,_a=Mr*h+Br*m;return!(Math.max(Fr,Dr,ga,_a)<=Mr*y.x+Br*y.y||Math.min(Fr,Dr,ga,_a)>=Mr*Z.x+Br*Z.y)}pad(e=0,i=e){return this.x-=e,this.y-=i,this.width+=e*2,this.height+=i*2,this}fit(e){const i=Math.max(this.x,e.x),a=Math.min(this.x+this.width,e.x+e.width),h=Math.max(this.y,e.y),u=Math.min(this.y+this.height,e.y+e.height);return this.x=i,this.width=Math.max(a-i,0),this.y=h,this.height=Math.max(u-h,0),this}ceil(e=1,i=.001){const a=Math.ceil((this.x+this.width-i)*e)/e,h=Math.ceil((this.y+this.height-i)*e)/e;return this.x=Math.floor((this.x+i)*e)/e,this.y=Math.floor((this.y+i)*e)/e,this.width=a-this.x,this.height=h-this.y,this}enlarge(e){const i=Math.min(this.x,e.x),a=Math.max(this.x+this.width,e.x+e.width),h=Math.min(this.y,e.y),u=Math.max(this.y+this.height,e.y+e.height);return this.x=i,this.width=a-i,this.y=h,this.height=u-h,this}}ie.prototype.toString=function(){return`[@pixi/math:Rectangle x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`};class hs{constructor(e=0,i=0,a=0){this.x=e,this.y=i,this.radius=a,this.type=hr.CIRC}clone(){return new hs(this.x,this.y,this.radius)}contains(e,i){if(this.radius<=0)return!1;const a=this.radius*this.radius;let h=this.x-e,u=this.y-i;return h*=h,u*=u,h+u<=a}getBounds(){return new ie(this.x-this.radius,this.y-this.radius,this.radius*2,this.radius*2)}}hs.prototype.toString=function(){return`[@pixi/math:Circle x=${this.x} y=${this.y} radius=${this.radius}]`};class Hr{constructor(e=0,i=0,a=0,h=0){this.x=e,this.y=i,this.width=a,this.height=h,this.type=hr.ELIP}clone(){return new Hr(this.x,this.y,this.width,this.height)}contains(e,i){if(this.width<=0||this.height<=0)return!1;let a=(e-this.x)/this.width,h=(i-this.y)/this.height;return a*=a,h*=h,a+h<=1}getBounds(){return new ie(this.x-this.width,this.y-this.height,this.width,this.height)}}Hr.prototype.toString=function(){return`[@pixi/math:Ellipse x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`};class Ar{constructor(...e){let i=Array.isArray(e[0])?e[0]:e;if(typeof i[0]!="number"){const a=[];for(let h=0,u=i.length;h<u;h++)a.push(i[h].x,i[h].y);i=a}this.points=i,this.type=hr.POLY,this.closeStroke=!0}clone(){const e=this.points.slice(),i=new Ar(e);return i.closeStroke=this.closeStroke,i}contains(e,i){let a=!1;const h=this.points.length/2;for(let u=0,m=h-1;u<h;m=u++){const y=this.points[u*2],E=this.points[u*2+1],D=this.points[m*2],Z=this.points[m*2+1];E>i!=Z>i&&e<(D-y)*((i-E)/(Z-E))+y&&(a=!a)}return a}}Ar.prototype.toString=function(){return`[@pixi/math:PolygoncloseStroke=${this.closeStroke}points=${this.points.reduce((s,e)=>`${s}, ${e}`,"")}]`};class ni{constructor(e=0,i=0,a=0,h=0,u=20){this.x=e,this.y=i,this.width=a,this.height=h,this.radius=u,this.type=hr.RREC}clone(){return new ni(this.x,this.y,this.width,this.height,this.radius)}contains(e,i){if(this.width<=0||this.height<=0)return!1;if(e>=this.x&&e<=this.x+this.width&&i>=this.y&&i<=this.y+this.height){const a=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(i>=this.y+a&&i<=this.y+this.height-a||e>=this.x+a&&e<=this.x+this.width-a)return!0;let h=e-(this.x+a),u=i-(this.y+a);const m=a*a;if(h*h+u*u<=m||(h=e-(this.x+this.width-a),h*h+u*u<=m)||(u=i-(this.y+this.height-a),h*h+u*u<=m)||(h=e-(this.x+a),h*h+u*u<=m))return!0}return!1}}ni.prototype.toString=function(){return`[@pixi/math:RoundedRectangle x=${this.x} y=${this.y}width=${this.width} height=${this.height} radius=${this.radius}]`};class de{constructor(e=1,i=0,a=0,h=1,u=0,m=0){this.array=null,this.a=e,this.b=i,this.c=a,this.d=h,this.tx=u,this.ty=m}fromArray(e){this.a=e[0],this.b=e[1],this.c=e[3],this.d=e[4],this.tx=e[2],this.ty=e[5]}set(e,i,a,h,u,m){return this.a=e,this.b=i,this.c=a,this.d=h,this.tx=u,this.ty=m,this}toArray(e,i){this.array||(this.array=new Float32Array(9));const a=i||this.array;return e?(a[0]=this.a,a[1]=this.b,a[2]=0,a[3]=this.c,a[4]=this.d,a[5]=0,a[6]=this.tx,a[7]=this.ty,a[8]=1):(a[0]=this.a,a[1]=this.c,a[2]=this.tx,a[3]=this.b,a[4]=this.d,a[5]=this.ty,a[6]=0,a[7]=0,a[8]=1),a}apply(e,i){i=i||new oe;const a=e.x,h=e.y;return i.x=this.a*a+this.c*h+this.tx,i.y=this.b*a+this.d*h+this.ty,i}applyInverse(e,i){i=i||new oe;const a=1/(this.a*this.d+this.c*-this.b),h=e.x,u=e.y;return i.x=this.d*a*h+-this.c*a*u+(this.ty*this.c-this.tx*this.d)*a,i.y=this.a*a*u+-this.b*a*h+(-this.ty*this.a+this.tx*this.b)*a,i}translate(e,i){return this.tx+=e,this.ty+=i,this}scale(e,i){return this.a*=e,this.d*=i,this.c*=e,this.b*=i,this.tx*=e,this.ty*=i,this}rotate(e){const i=Math.cos(e),a=Math.sin(e),h=this.a,u=this.c,m=this.tx;return this.a=h*i-this.b*a,this.b=h*a+this.b*i,this.c=u*i-this.d*a,this.d=u*a+this.d*i,this.tx=m*i-this.ty*a,this.ty=m*a+this.ty*i,this}append(e){const i=this.a,a=this.b,h=this.c,u=this.d;return this.a=e.a*i+e.b*h,this.b=e.a*a+e.b*u,this.c=e.c*i+e.d*h,this.d=e.c*a+e.d*u,this.tx=e.tx*i+e.ty*h+this.tx,this.ty=e.tx*a+e.ty*u+this.ty,this}setTransform(e,i,a,h,u,m,y,E,D){return this.a=Math.cos(y+D)*u,this.b=Math.sin(y+D)*u,this.c=-Math.sin(y-E)*m,this.d=Math.cos(y-E)*m,this.tx=e-(a*this.a+h*this.c),this.ty=i-(a*this.b+h*this.d),this}prepend(e){const i=this.tx;if(e.a!==1||e.b!==0||e.c!==0||e.d!==1){const a=this.a,h=this.c;this.a=a*e.a+this.b*e.c,this.b=a*e.b+this.b*e.d,this.c=h*e.a+this.d*e.c,this.d=h*e.b+this.d*e.d}return this.tx=i*e.a+this.ty*e.c+e.tx,this.ty=i*e.b+this.ty*e.d+e.ty,this}decompose(e){const i=this.a,a=this.b,h=this.c,u=this.d,m=e.pivot,y=-Math.atan2(-h,u),E=Math.atan2(a,i),D=Math.abs(y+E);return D<1e-5||Math.abs(as-D)<1e-5?(e.rotation=E,e.skew.x=e.skew.y=0):(e.rotation=0,e.skew.x=y,e.skew.y=E),e.scale.x=Math.sqrt(i*i+a*a),e.scale.y=Math.sqrt(h*h+u*u),e.position.x=this.tx+(m.x*i+m.y*h),e.position.y=this.ty+(m.x*a+m.y*u),e}invert(){const e=this.a,i=this.b,a=this.c,h=this.d,u=this.tx,m=e*h-i*a;return this.a=h/m,this.b=-i/m,this.c=-a/m,this.d=e/m,this.tx=(a*this.ty-h*u)/m,this.ty=-(e*this.ty-i*u)/m,this}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){const e=new de;return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e}copyTo(e){return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e}copyFrom(e){return this.a=e.a,this.b=e.b,this.c=e.c,this.d=e.d,this.tx=e.tx,this.ty=e.ty,this}static get IDENTITY(){return new de}static get TEMP_MATRIX(){return new de}}de.prototype.toString=function(){return`[@pixi/math:Matrix a=${this.a} b=${this.b} c=${this.c} d=${this.d} tx=${this.tx} ty=${this.ty}]`};const wr=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],Sr=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],er=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],$e=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],Xr=[],wi=[],lr=Math.sign;function Si(){for(let s=0;s<16;s++){const e=[];Xr.push(e);for(let i=0;i<16;i++){const a=lr(wr[s]*wr[i]+er[s]*Sr[i]),h=lr(Sr[s]*wr[i]+$e[s]*Sr[i]),u=lr(wr[s]*er[i]+er[s]*$e[i]),m=lr(Sr[s]*er[i]+$e[s]*$e[i]);for(let y=0;y<16;y++)if(wr[y]===a&&Sr[y]===h&&er[y]===u&&$e[y]===m){e.push(y);break}}}for(let s=0;s<16;s++){const e=new de;e.set(wr[s],Sr[s],er[s],$e[s],0,0),wi.push(e)}}Si();const me={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:s=>wr[s],uY:s=>Sr[s],vX:s=>er[s],vY:s=>$e[s],inv:s=>s&8?s&15:-s&7,add:(s,e)=>Xr[s][e],sub:(s,e)=>Xr[s][me.inv(e)],rotate180:s=>s^4,isVertical:s=>(s&3)===2,byDirection:(s,e)=>Math.abs(s)*2<=Math.abs(e)?e>=0?me.S:me.N:Math.abs(e)*2<=Math.abs(s)?s>0?me.E:me.W:e>0?s>0?me.SE:me.SW:s>0?me.NE:me.NW,matrixAppendRotationInv:(s,e,i=0,a=0)=>{const h=wi[me.inv(e)];h.tx=i,h.ty=a,s.append(h)}};class De{constructor(e,i,a=0,h=0){this._x=a,this._y=h,this.cb=e,this.scope=i}clone(e=this.cb,i=this.scope){return new De(e,i,this._x,this._y)}set(e=0,i=e){return(this._x!==e||this._y!==i)&&(this._x=e,this._y=i,this.cb.call(this.scope)),this}copyFrom(e){return(this._x!==e.x||this._y!==e.y)&&(this._x=e.x,this._y=e.y,this.cb.call(this.scope)),this}copyTo(e){return e.set(this._x,this._y),e}equals(e){return e.x===this._x&&e.y===this._y}get x(){return this._x}set x(e){this._x!==e&&(this._x=e,this.cb.call(this.scope))}get y(){return this._y}set y(e){this._y!==e&&(this._y=e,this.cb.call(this.scope))}}De.prototype.toString=function(){return`[@pixi/math:ObservablePoint x=${this.x} y=${this.y} scope=${this.scope}]`};const Ii=class{constructor(){this.worldTransform=new de,this.localTransform=new de,this.position=new De(this.onChange,this,0,0),this.scale=new De(this.onChange,this,1,1),this.pivot=new De(this.onChange,this,0,0),this.skew=new De(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}onChange(){this._localID++}updateSkew(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++}updateLocalTransform(){const s=this.localTransform;this._localID!==this._currentLocalID&&(s.a=this._cx*this.scale.x,s.b=this._sx*this.scale.x,s.c=this._cy*this.scale.y,s.d=this._sy*this.scale.y,s.tx=this.position.x-(this.pivot.x*s.a+this.pivot.y*s.c),s.ty=this.position.y-(this.pivot.x*s.b+this.pivot.y*s.d),this._currentLocalID=this._localID,this._parentID=-1)}updateTransform(s){const e=this.localTransform;if(this._localID!==this._currentLocalID&&(e.a=this._cx*this.scale.x,e.b=this._sx*this.scale.x,e.c=this._cy*this.scale.y,e.d=this._sy*this.scale.y,e.tx=this.position.x-(this.pivot.x*e.a+this.pivot.y*e.c),e.ty=this.position.y-(this.pivot.x*e.b+this.pivot.y*e.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==s._worldID){const i=s.worldTransform,a=this.worldTransform;a.a=e.a*i.a+e.b*i.c,a.b=e.a*i.b+e.b*i.d,a.c=e.c*i.a+e.d*i.c,a.d=e.c*i.b+e.d*i.d,a.tx=e.tx*i.a+e.ty*i.c+i.tx,a.ty=e.tx*i.b+e.ty*i.d+i.ty,this._parentID=s._worldID,this._worldID++}}setFromMatrix(s){s.decompose(this),this._localID++}get rotation(){return this._rotation}set rotation(s){this._rotation!==s&&(this._rotation=s,this.updateSkew())}};Ii.IDENTITY=new Ii;let ls=Ii;ls.prototype.toString=function(){return`[@pixi/math:Transform position=(${this.position.x}, ${this.position.y}) rotation=${this.rotation} scale=(${this.scale.x}, ${this.scale.y}) skew=(${this.skew.x}, ${this.skew.y}) ]`};var Ci=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor *= texture2D(uSampler, vTextureCoord);
}`,us=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void){
   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
   vTextureCoord = aTextureCoord;
}
`;const ur=[{test:s=>s.type==="float"&&s.size===1&&!s.isArray,code:s=>`
            if(uv["${s}"] !== ud["${s}"].value)
            {
                ud["${s}"].value = uv["${s}"]
                gl.uniform1f(ud["${s}"].location, uv["${s}"])
            }
            `},{test:(s,e)=>(s.type==="sampler2D"||s.type==="samplerCube"||s.type==="sampler2DArray")&&s.size===1&&!s.isArray&&(e==null||e.castToBaseTexture!==void 0),code:s=>`t = syncData.textureCount++;

            renderer.texture.bind(uv["${s}"], t);

            if(ud["${s}"].value !== t)
            {
                ud["${s}"].value = t;
                gl.uniform1i(ud["${s}"].location, t);
; // eslint-disable-line max-len
            }`},{test:(s,e)=>s.type==="mat3"&&s.size===1&&!s.isArray&&e.a!==void 0,code:s=>`
            gl.uniformMatrix3fv(ud["${s}"].location, false, uv["${s}"].toArray(true));
            `,codeUbo:s=>`
                var ${s}_matrix = uv.${s}.toArray(true);

                data[offset] = ${s}_matrix[0];
                data[offset+1] = ${s}_matrix[1];
                data[offset+2] = ${s}_matrix[2];
        
                data[offset + 4] = ${s}_matrix[3];
                data[offset + 5] = ${s}_matrix[4];
                data[offset + 6] = ${s}_matrix[5];
        
                data[offset + 8] = ${s}_matrix[6];
                data[offset + 9] = ${s}_matrix[7];
                data[offset + 10] = ${s}_matrix[8];
            `},{test:(s,e)=>s.type==="vec2"&&s.size===1&&!s.isArray&&e.x!==void 0,code:s=>`
                cv = ud["${s}"].value;
                v = uv["${s}"];

                if(cv[0] !== v.x || cv[1] !== v.y)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    gl.uniform2f(ud["${s}"].location, v.x, v.y);
                }`,codeUbo:s=>`
                v = uv.${s};

                data[offset] = v.x;
                data[offset+1] = v.y;
            `},{test:s=>s.type==="vec2"&&s.size===1&&!s.isArray,code:s=>`
                cv = ud["${s}"].value;
                v = uv["${s}"];

                if(cv[0] !== v[0] || cv[1] !== v[1])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    gl.uniform2f(ud["${s}"].location, v[0], v[1]);
                }
            `},{test:(s,e)=>s.type==="vec4"&&s.size===1&&!s.isArray&&e.width!==void 0,code:s=>`
                cv = ud["${s}"].value;
                v = uv["${s}"];

                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    cv[2] = v.width;
                    cv[3] = v.height;
                    gl.uniform4f(ud["${s}"].location, v.x, v.y, v.width, v.height)
                }`,codeUbo:s=>`
                    v = uv.${s};

                    data[offset] = v.x;
                    data[offset+1] = v.y;
                    data[offset+2] = v.width;
                    data[offset+3] = v.height;
                `},{test:(s,e)=>s.type==="vec4"&&s.size===1&&!s.isArray&&e.red!==void 0,code:s=>`
                cv = ud["${s}"].value;
                v = uv["${s}"];

                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.alpha)
                {
                    cv[0] = v.red;
                    cv[1] = v.green;
                    cv[2] = v.blue;
                    cv[3] = v.alpha;
                    gl.uniform4f(ud["${s}"].location, v.red, v.green, v.blue, v.alpha)
                }`,codeUbo:s=>`
                    v = uv.${s};

                    data[offset] = v.red;
                    data[offset+1] = v.green;
                    data[offset+2] = v.blue;
                    data[offset+3] = v.alpha;
                `},{test:(s,e)=>s.type==="vec3"&&s.size===1&&!s.isArray&&e.red!==void 0,code:s=>`
                cv = ud["${s}"].value;
                v = uv["${s}"];

                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.a)
                {
                    cv[0] = v.red;
                    cv[1] = v.green;
                    cv[2] = v.blue;
    
                    gl.uniform3f(ud["${s}"].location, v.red, v.green, v.blue)
                }`,codeUbo:s=>`
                    v = uv.${s};

                    data[offset] = v.red;
                    data[offset+1] = v.green;
                    data[offset+2] = v.blue;
                `},{test:s=>s.type==="vec4"&&s.size===1&&!s.isArray,code:s=>`
                cv = ud["${s}"].value;
                v = uv["${s}"];

                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    cv[2] = v[2];
                    cv[3] = v[3];

                    gl.uniform4f(ud["${s}"].location, v[0], v[1], v[2], v[3])
                }`}],cs={float:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1f(location, v);
    }`,vec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2f(location, v[0], v[1])
    }`,vec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3f(location, v[0], v[1], v[2])
    }`,vec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4f(location, v[0], v[1], v[2], v[3]);
    }`,int:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,ivec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,ivec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,ivec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,uint:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1ui(location, v);
    }`,uvec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2ui(location, v[0], v[1]);
    }`,uvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3ui(location, v[0], v[1], v[2]);
    }`,uvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4ui(location, v[0], v[1], v[2], v[3]);
    }`,bool:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1i(location, v);
    }`,bvec2:`
    if (cv[0] != v[0] || cv[1] != v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,bvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,bvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,samplerCube:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,sampler2DArray:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`},ds={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"};function ha(s,e){var a;const i=[`
        var v = null;
        var cv = null;
        var cu = null;
        var t = 0;
        var gl = renderer.gl;
    `];for(const h in s.uniforms){const u=e[h];if(!u){((a=s.uniforms[h])==null?void 0:a.group)===!0&&(s.uniforms[h].ubo?i.push(`
                        renderer.shader.syncUniformBufferGroup(uv.${h}, '${h}');
                    `):i.push(`
                        renderer.shader.syncUniformGroup(uv.${h}, syncData);
                    `));continue}const m=s.uniforms[h];let y=!1;for(let E=0;E<ur.length;E++)if(ur[E].test(u,m)){i.push(ur[E].code(h,m)),y=!0;break}if(!y){const E=(u.size===1&&!u.isArray?cs:ds)[u.type].replace("location",`ud["${h}"].location`);i.push(`
            cu = ud["${h}"];
            cv = cu.value;
            v = uv["${h}"];
            ${E};`)}}return new Function("ud","uv","renderer","syncData",i.join(`
`))}const zs={};let cr=zs;function $s(){if(cr===zs||cr!=null&&cr.isContextLost()){const s=P.ADAPTER.createCanvas();let e;P.PREFER_ENV>=ut.WEBGL2&&(e=s.getContext("webgl2",{})),e||(e=s.getContext("webgl",{})||s.getContext("experimental-webgl",{}),e?e.getExtension("WEBGL_draw_buffers"):e=null),cr=e}return cr}let ai;function js(){if(!ai){ai=C.MEDIUM;const s=$s();if(s&&s.getShaderPrecisionFormat){const e=s.getShaderPrecisionFormat(s.FRAGMENT_SHADER,s.HIGH_FLOAT);e&&(ai=e.precision?C.HIGH:C.MEDIUM)}}return ai}const Wn={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function Ys(s){return Wn[s]}let Ri=null;const fs={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function zn(s,e){if(!Ri){const i=Object.keys(fs);Ri={};for(let a=0;a<i.length;++a){const h=i[a];Ri[s[h]]=fs[h]}}return Ri[e]}function $n(s,e,i){if(s.substring(0,9)!=="precision"){let a=e;return e===C.HIGH&&i!==C.HIGH&&(a=C.MEDIUM),`precision ${a} float;
${s}`}else if(i!==C.HIGH&&s.substring(0,15)==="precision highp")return s.replace("precision highp","precision mediump");return s}let la=0;const Ir={},Ks=class Xi{constructor(e,i,a="pixi-shader",h={}){this.extra={},this.id=la++,this.vertexSrc=e||Xi.defaultVertexSrc,this.fragmentSrc=i||Xi.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),this.extra=h,this.vertexSrc.substring(0,8)!=="#version"&&(a=a.replace(/\s+/g,"-"),Ir[a]?(Ir[a]++,a+=`-${Ir[a]}`):Ir[a]=1,this.vertexSrc=`#define SHADER_NAME ${a}
${this.vertexSrc}`,this.fragmentSrc=`#define SHADER_NAME ${a}
${this.fragmentSrc}`,this.vertexSrc=$n(this.vertexSrc,Xi.defaultVertexPrecision,C.HIGH),this.fragmentSrc=$n(this.fragmentSrc,Xi.defaultFragmentPrecision,js())),this.glPrograms={},this.syncUniforms=null}static get defaultVertexSrc(){return us}static get defaultFragmentSrc(){return Ci}static from(e,i,a){const h=e+i;let u=Ue[h];return u||(Ue[h]=u=new Xi(e,i,a)),u}};Ks.defaultVertexPrecision=C.HIGH,Ks.defaultFragmentPrecision=wt.apple.device?C.HIGH:C.MEDIUM;let Cr=Ks,ua=0;class je{constructor(e,i,a){this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=ua++,this.static=!!i,this.ubo=!!a,e instanceof Ie?(this.buffer=e,this.buffer.type=ct.UNIFORM_BUFFER,this.autoManage=!1,this.ubo=!0):(this.uniforms=e,this.ubo&&(this.buffer=new Ie(new Float32Array(1)),this.buffer.type=ct.UNIFORM_BUFFER,this.autoManage=!0))}update(){this.dirtyId++,!this.autoManage&&this.buffer&&this.buffer.update()}add(e,i,a){if(!this.ubo)this.uniforms[e]=new je(i,a);else throw new Error("[UniformGroup] uniform groups in ubo mode cannot be modified, or have uniform groups nested in them")}static from(e,i,a){return new je(e,i,a)}static uboFrom(e,i){return new je(e,i!=null?i:!0,!0)}}class Vr{constructor(e,i){this.uniformBindCount=0,this.program=e,i?i instanceof je?this.uniformGroup=i:this.uniformGroup=new je(i):this.uniformGroup=new je({}),this.disposeRunner=new ye("disposeShader")}checkUniformExists(e,i){if(i.uniforms[e])return!0;for(const a in i.uniforms){const h=i.uniforms[a];if(h.group===!0&&this.checkUniformExists(e,h))return!0}return!1}destroy(){this.uniformGroup=null,this.disposeRunner.emit(this),this.disposeRunner.destroy()}get uniforms(){return this.uniformGroup.uniforms}static from(e,i,a){const h=Cr.from(e,i);return new Vr(h,a)}}class jn{constructor(e,i){if(this.vertexSrc=e,this.fragTemplate=i,this.programCache={},this.defaultGroupCache={},!i.includes("%count%"))throw new Error('Fragment template must contain "%count%".');if(!i.includes("%forloop%"))throw new Error('Fragment template must contain "%forloop%".')}generateShader(e){if(!this.programCache[e]){const a=new Int32Array(e);for(let u=0;u<e;u++)a[u]=u;this.defaultGroupCache[e]=je.from({uSamplers:a},!0);let h=this.fragTemplate;h=h.replace(/%count%/gi,`${e}`),h=h.replace(/%forloop%/gi,this.generateSampleSrc(e)),this.programCache[e]=new Cr(this.vertexSrc,h)}const i={tint:new Float32Array([1,1,1,1]),translationMatrix:new de,default:this.defaultGroupCache[e]};return new Vr(this.programCache[e],i)}generateSampleSrc(e){let i="";i+=`
`,i+=`
`;for(let a=0;a<e;a++)a>0&&(i+=`
else `),a<e-1&&(i+=`if(vTextureId < ${a}.5)`),i+=`
{`,i+=`
	color = texture2D(uSamplers[${a}], vTextureCoord);`,i+=`
}`;return i+=`
`,i+=`
`,i}}class qs{constructor(){this.elements=[],this.ids=[],this.count=0}clear(){for(let e=0;e<this.count;e++)this.elements[e]=null;this.count=0}}function Zs(){return!wt.apple.device}function Pi(s){let e=!0;const i=P.ADAPTER.getNavigator();if(wt.tablet||wt.phone){if(wt.apple.device){const a=i.userAgent.match(/OS (\d+)_(\d+)?/);a&&parseInt(a[1],10)<11&&(e=!1)}if(wt.android.device){const a=i.userAgent.match(/Android\s([0-9.]*)/);a&&parseInt(a[1],10)<7&&(e=!1)}}return e?s:4}class Wr{constructor(e){this.renderer=e}flush(){}destroy(){this.renderer=null}start(){}stop(){this.flush()}render(e){}}var Ye=`varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;
uniform sampler2D uSamplers[%count%];

void main(void){
    vec4 color;
    %forloop%
    gl_FragColor = color * vColor;
}
`,dr=`precision highp float;
attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;
attribute float aTextureId;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform vec4 tint;

varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;

void main(void){
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vTextureId = aTextureId;
    vColor = aColor * tint;
}
`;const oi=class ir extends Wr{constructor(e){super(e),this.setShaderGenerator(),this.geometryClass=Gr,this.vertexSize=6,this.state=br.for2d(),this.size=ir.defaultBatchSize*4,this._vertexCount=0,this._indexCount=0,this._bufferedElements=[],this._bufferedTextures=[],this._bufferSize=0,this._shader=null,this._packedGeometries=[],this._packedGeometryPoolSize=2,this._flushId=0,this._aBuffers={},this._iBuffers={},this.maxTextures=1,this.renderer.on("prerender",this.onPrerender,this),e.runners.contextChange.add(this),this._dcIndex=0,this._aIndex=0,this._iIndex=0,this._attributeBuffer=null,this._indexBuffer=null,this._tempBoundTextures=[]}static get defaultMaxTextures(){var e;return this._defaultMaxTextures=(e=this._defaultMaxTextures)!=null?e:Pi(32),this._defaultMaxTextures}static set defaultMaxTextures(e){this._defaultMaxTextures=e}static get canUploadSameBuffer(){var e;return this._canUploadSameBuffer=(e=this._canUploadSameBuffer)!=null?e:Zs(),this._canUploadSameBuffer}static set canUploadSameBuffer(e){this._canUploadSameBuffer=e}get MAX_TEXTURES(){return Et("7.1.0","BatchRenderer#MAX_TEXTURES renamed to BatchRenderer#maxTextures"),this.maxTextures}static get defaultVertexSrc(){return dr}static get defaultFragmentTemplate(){return Ye}setShaderGenerator({vertex:e=ir.defaultVertexSrc,fragment:i=ir.defaultFragmentTemplate}={}){this.shaderGenerator=new jn(e,i)}contextChange(){const e=this.renderer.gl;P.PREFER_ENV===ut.WEBGL_LEGACY?this.maxTextures=1:(this.maxTextures=Math.min(e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),ir.defaultMaxTextures),this.maxTextures=Un(this.maxTextures,e)),this._shader=this.shaderGenerator.generateShader(this.maxTextures);for(let i=0;i<this._packedGeometryPoolSize;i++)this._packedGeometries[i]=new this.geometryClass;this.initFlushBuffers()}initFlushBuffers(){const{_drawCallPool:e,_textureArrayPool:i}=ir,a=this.size/4,h=Math.floor(a/this.maxTextures)+1;for(;e.length<a;)e.push(new Xs);for(;i.length<h;)i.push(new qs);for(let u=0;u<this.maxTextures;u++)this._tempBoundTextures[u]=null}onPrerender(){this._flushId=0}render(e){e._texture.valid&&(this._vertexCount+e.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=e.vertexData.length/2,this._indexCount+=e.indices.length,this._bufferedTextures[this._bufferSize]=e._texture.baseTexture,this._bufferedElements[this._bufferSize++]=e)}buildTexturesAndDrawCalls(){const{_bufferedTextures:e,maxTextures:i}=this,a=ir._textureArrayPool,h=this.renderer.batch,u=this._tempBoundTextures,m=this.renderer.textureGC.count;let y=++se._globalBatch,E=0,D=a[0],Z=0;h.copyBoundTextures(u,i);for(let st=0;st<this._bufferSize;++st){const yt=e[st];e[st]=null,yt._batchEnabled!==y&&(D.count>=i&&(h.boundArray(D,u,y,i),this.buildDrawCalls(D,Z,st),Z=st,D=a[++E],++y),yt._batchEnabled=y,yt.touched=m,D.elements[D.count++]=yt)}D.count>0&&(h.boundArray(D,u,y,i),this.buildDrawCalls(D,Z,this._bufferSize),++E,++y);for(let st=0;st<u.length;st++)u[st]=null;se._globalBatch=y}buildDrawCalls(e,i,a){const{_bufferedElements:h,_attributeBuffer:u,_indexBuffer:m,vertexSize:y}=this,E=ir._drawCallPool;let D=this._dcIndex,Z=this._aIndex,st=this._iIndex,yt=E[D];yt.start=this._iIndex,yt.texArray=e;for(let jt=i;jt<a;++jt){const le=h[jt],Kt=le._texture.baseTexture,_e=Jr[Kt.alphaMode?1:0][le.blendMode];h[jt]=null,i<jt&&yt.blend!==_e&&(yt.size=st-yt.start,i=jt,yt=E[++D],yt.texArray=e,yt.start=st),this.packInterleavedGeometry(le,u,m,Z,st),Z+=le.vertexData.length/2*y,st+=le.indices.length,yt.blend=_e}i<a&&(yt.size=st-yt.start,++D),this._dcIndex=D,this._aIndex=Z,this._iIndex=st}bindAndClearTexArray(e){const i=this.renderer.texture;for(let a=0;a<e.count;a++)i.bind(e.elements[a],e.ids[a]),e.elements[a]=null;e.count=0}updateGeometry(){const{_packedGeometries:e,_attributeBuffer:i,_indexBuffer:a}=this;ir.canUploadSameBuffer?(e[this._flushId]._buffer.update(i.rawBinaryData),e[this._flushId]._indexBuffer.update(a),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,e[this._flushId]=new this.geometryClass),e[this._flushId]._buffer.update(i.rawBinaryData),e[this._flushId]._indexBuffer.update(a),this.renderer.geometry.bind(e[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)}drawBatches(){const e=this._dcIndex,{gl:i,state:a}=this.renderer,h=ir._drawCallPool;let u=null;for(let m=0;m<e;m++){const{texArray:y,type:E,size:D,start:Z,blend:st}=h[m];u!==y&&(u=y,this.bindAndClearTexArray(y)),this.state.blendMode=st,a.set(this.state),i.drawElements(E,D,i.UNSIGNED_SHORT,Z*2)}}flush(){this._vertexCount!==0&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)}start(){this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.maxTextures),this.renderer.shader.bind(this._shader),ir.canUploadSameBuffer&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])}stop(){this.flush()}destroy(){for(let e=0;e<this._packedGeometryPoolSize;e++)this._packedGeometries[e]&&this._packedGeometries[e].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),super.destroy()}getAttributeBuffer(e){const i=ti(Math.ceil(e/8)),a=qi(i),h=i*8;this._aBuffers.length<=a&&(this._iBuffers.length=a+1);let u=this._aBuffers[h];return u||(this._aBuffers[h]=u=new Gs(h*this.vertexSize*4)),u}getIndexBuffer(e){const i=ti(Math.ceil(e/12)),a=qi(i),h=i*12;this._iBuffers.length<=a&&(this._iBuffers.length=a+1);let u=this._iBuffers[a];return u||(this._iBuffers[a]=u=new Uint16Array(h)),u}packInterleavedGeometry(e,i,a,h,u){const{uint32View:m,float32View:y}=i,E=h/this.vertexSize,D=e.uvs,Z=e.indices,st=e.vertexData,yt=e._texture.baseTexture._batchLocation,jt=Math.min(e.worldAlpha,1),le=Se.shared.setValue(e._tintRGB).toPremultiplied(jt,e._texture.baseTexture.alphaMode>0);for(let Kt=0;Kt<st.length;Kt+=2)y[h++]=st[Kt],y[h++]=st[Kt+1],y[h++]=D[Kt],y[h++]=D[Kt+1],m[h++]=le,y[h++]=yt;for(let Kt=0;Kt<Z.length;Kt++)a[u++]=E+Z[Kt]}};oi.defaultBatchSize=4096,oi.extension={name:"batch",type:Zt.RendererPlugin},oi._drawCallPool=[],oi._textureArrayPool=[];let fr=oi;re.add(fr);var pr=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor = texture2D(uSampler, vTextureCoord);
}
`,ps=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;const ms=class Ps extends Vr{constructor(e,i,a){const h=Cr.from(e||Ps.defaultVertexSrc,i||Ps.defaultFragmentSrc);super(h,a),this.padding=0,this.resolution=Ps.defaultResolution,this.multisample=Ps.defaultMultisample,this.enabled=!0,this.autoFit=!0,this.state=new br}apply(e,i,a,h,u){e.applyFilter(this,i,a,h)}get blendMode(){return this.state.blendMode}set blendMode(e){this.state.blendMode=e}get resolution(){return this._resolution}set resolution(e){this._resolution=e}static get defaultVertexSrc(){return ps}static get defaultFragmentSrc(){return pr}};ms.defaultResolution=1,ms.defaultMultisample=rt.NONE;let rr=ms;class Mi{constructor(){this.clearBeforeRender=!0,this._backgroundColor=new Se(0),this.alpha=1}init(e){this.clearBeforeRender=e.clearBeforeRender;const{backgroundColor:i,background:a,backgroundAlpha:h}=e,u=a!=null?a:i;u!==void 0&&(this.color=u),this.alpha=h}get color(){return this._backgroundColor.value}set color(e){this._backgroundColor.setValue(e)}get alpha(){return this._backgroundColor.alpha}set alpha(e){this._backgroundColor.setAlpha(e)}get backgroundColor(){return this._backgroundColor}destroy(){}}Mi.defaultOptions={backgroundAlpha:1,backgroundColor:0,clearBeforeRender:!0},Mi.extension={type:[Zt.RendererSystem,Zt.CanvasRendererSystem],name:"background"},re.add(Mi);class gs{constructor(e){this.renderer=e,this.emptyRenderer=new Wr(e),this.currentRenderer=this.emptyRenderer}setObjectRenderer(e){this.currentRenderer!==e&&(this.currentRenderer.stop(),this.currentRenderer=e,this.currentRenderer.start())}flush(){this.setObjectRenderer(this.emptyRenderer)}reset(){this.setObjectRenderer(this.emptyRenderer)}copyBoundTextures(e,i){const{boundTextures:a}=this.renderer.texture;for(let h=i-1;h>=0;--h)e[h]=a[h]||null,e[h]&&(e[h]._batchLocation=h)}boundArray(e,i,a,h){const{elements:u,ids:m,count:y}=e;let E=0;for(let D=0;D<y;D++){const Z=u[D],st=Z._batchLocation;if(st>=0&&st<h&&i[st]===Z){m[D]=st;continue}for(;E<h;){const yt=i[E];if(yt&&yt._batchEnabled===a&&yt._batchLocation===E){E++;continue}m[D]=E,Z._batchLocation=E,i[E]=Z;break}}}destroy(){this.renderer=null}}gs.extension={type:Zt.RendererSystem,name:"batch"},re.add(gs);let _s=0;class Bi{constructor(e){this.renderer=e,this.webGLVersion=1,this.extensions={},this.supports={uint32Indices:!1},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this)}get isLost(){return!this.gl||this.gl.isContextLost()}contextChange(e){this.gl=e,this.renderer.gl=e,this.renderer.CONTEXT_UID=_s++}init(e){if(e.context)this.initFromContext(e.context);else{const i=this.renderer.background.alpha<1,a=e.premultipliedAlpha;this.preserveDrawingBuffer=e.preserveDrawingBuffer,this.useContextAlpha=e.useContextAlpha,this.powerPreference=e.powerPreference,this.initFromOptions({alpha:i,premultipliedAlpha:a,antialias:e.antialias,stencil:!0,preserveDrawingBuffer:e.preserveDrawingBuffer,powerPreference:e.powerPreference})}}initFromContext(e){this.gl=e,this.validateContext(e),this.renderer.gl=e,this.renderer.CONTEXT_UID=_s++,this.renderer.runners.contextChange.emit(e);const i=this.renderer.view;i.addEventListener!==void 0&&(i.addEventListener("webglcontextlost",this.handleContextLost,!1),i.addEventListener("webglcontextrestored",this.handleContextRestored,!1))}initFromOptions(e){const i=this.createContext(this.renderer.view,e);this.initFromContext(i)}createContext(e,i){let a;if(P.PREFER_ENV>=ut.WEBGL2&&(a=e.getContext("webgl2",i)),a)this.webGLVersion=2;else if(this.webGLVersion=1,a=e.getContext("webgl",i)||e.getContext("experimental-webgl",i),!a)throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=a,this.getExtensions(),this.gl}getExtensions(){const{gl:e}=this,i={loseContext:e.getExtension("WEBGL_lose_context"),anisotropicFiltering:e.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:e.getExtension("OES_texture_float_linear"),s3tc:e.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:e.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:e.getExtension("WEBGL_compressed_texture_etc"),etc1:e.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:e.getExtension("WEBGL_compressed_texture_atc"),astc:e.getExtension("WEBGL_compressed_texture_astc")};this.webGLVersion===1?Object.assign(this.extensions,i,{drawBuffers:e.getExtension("WEBGL_draw_buffers"),depthTexture:e.getExtension("WEBGL_depth_texture"),vertexArrayObject:e.getExtension("OES_vertex_array_object")||e.getExtension("MOZ_OES_vertex_array_object")||e.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:e.getExtension("OES_element_index_uint"),floatTexture:e.getExtension("OES_texture_float"),floatTextureLinear:e.getExtension("OES_texture_float_linear"),textureHalfFloat:e.getExtension("OES_texture_half_float"),textureHalfFloatLinear:e.getExtension("OES_texture_half_float_linear")}):this.webGLVersion===2&&Object.assign(this.extensions,i,{colorBufferFloat:e.getExtension("EXT_color_buffer_float")})}handleContextLost(e){e.preventDefault(),setTimeout(()=>{this.gl.isContextLost()&&this.extensions.loseContext&&this.extensions.loseContext.restoreContext()},0)}handleContextRestored(){this.renderer.runners.contextChange.emit(this.gl)}destroy(){const e=this.renderer.view;this.renderer=null,e.removeEventListener!==void 0&&(e.removeEventListener("webglcontextlost",this.handleContextLost),e.removeEventListener("webglcontextrestored",this.handleContextRestored)),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()}postrender(){this.renderer.objectRenderer.renderingToScreen&&this.gl.flush()}validateContext(e){const i=e.getContextAttributes(),a="WebGL2RenderingContext"in globalThis&&e instanceof globalThis.WebGL2RenderingContext;a&&(this.webGLVersion=2),i&&!i.stencil&&console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");const h=a||!!e.getExtension("OES_element_index_uint");this.supports.uint32Indices=h,h||console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")}}Bi.defaultOptions={context:null,antialias:!1,premultipliedAlpha:!0,preserveDrawingBuffer:!1,powerPreference:"default"},Bi.extension={type:Zt.RendererSystem,name:"context"},re.add(Bi);class ys{constructor(e,i){if(this.width=Math.round(e),this.height=Math.round(i),!this.width||!this.height)throw new Error("Framebuffer width or height is zero");this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new ye("disposeFramebuffer"),this.multisample=rt.NONE}get colorTexture(){return this.colorTextures[0]}addColorTexture(e=0,i){return this.colorTextures[e]=i||new se(null,{scaleMode:q.NEAREST,resolution:1,mipmap:pt.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this}addDepthTexture(e){return this.depthTexture=e||new se(null,{scaleMode:q.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:pt.OFF,format:O.DEPTH_COMPONENT,type:V.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this}enableDepth(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this}enableStencil(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this}resize(e,i){if(e=Math.round(e),i=Math.round(i),!e||!i)throw new Error("Framebuffer width and height must not be zero");if(!(e===this.width&&i===this.height)){this.width=e,this.height=i,this.dirtyId++,this.dirtySize++;for(let a=0;a<this.colorTextures.length;a++){const h=this.colorTextures[a],u=h.resolution;h.setSize(e/u,i/u)}if(this.depthTexture){const a=this.depthTexture.resolution;this.depthTexture.setSize(e/a,i/a)}}}dispose(){this.disposeRunner.emit(this,!1)}destroyDepthTexture(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)}}class Qs extends se{constructor(e={}){var i,a,h;if(typeof e=="number"){const u=arguments[0],m=arguments[1],y=arguments[2],E=arguments[3];e={width:u,height:m,scaleMode:y,resolution:E}}e.width=(i=e.width)!=null?i:100,e.height=(a=e.height)!=null?a:100,(h=e.multisample)!=null||(e.multisample=rt.NONE),super(null,e),this.mipmap=pt.OFF,this.valid=!0,this._clear=new Se([0,0,0,0]),this.framebuffer=new ys(this.realWidth,this.realHeight).addColorTexture(0,this),this.framebuffer.multisample=e.multisample,this.maskStack=[],this.filterStack=[{}]}set clearColor(e){this._clear.setValue(e)}get clearColor(){return this._clear.value}get clear(){return this._clear}get multisample(){return this.framebuffer.multisample}set multisample(e){this.framebuffer.multisample=e}resize(e,i){this.framebuffer.resize(e*this.resolution,i*this.resolution),this.setRealSize(this.framebuffer.width,this.framebuffer.height)}dispose(){this.framebuffer.dispose(),super.dispose()}destroy(){super.destroy(),this.framebuffer.destroyDepthTexture(),this.framebuffer=null}}class mr extends Tr{constructor(e){const i=e,a=i.naturalWidth||i.videoWidth||i.width,h=i.naturalHeight||i.videoHeight||i.height;super(a,h),this.source=e,this.noSubImage=!1}static crossOrigin(e,i,a){a===void 0&&!i.startsWith("data:")?e.crossOrigin=ii(i):a!==!1&&(e.crossOrigin=typeof a=="string"?a:"anonymous")}upload(e,i,a,h){const u=e.gl,m=i.realWidth,y=i.realHeight;if(h=h||this.source,typeof HTMLImageElement<"u"&&h instanceof HTMLImageElement){if(!h.complete||h.naturalWidth===0)return!1}else if(typeof HTMLVideoElement<"u"&&h instanceof HTMLVideoElement&&h.readyState<=1)return!1;return u.pixelStorei(u.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i.alphaMode===H.UNPACK),!this.noSubImage&&i.target===u.TEXTURE_2D&&a.width===m&&a.height===y?u.texSubImage2D(u.TEXTURE_2D,0,0,0,i.format,a.type,h):(a.width=m,a.height=y,u.texImage2D(i.target,0,a.internalFormat,i.format,a.type,h)),!0}update(){if(this.destroyed)return;const e=this.source,i=e.naturalWidth||e.videoWidth||e.width,a=e.naturalHeight||e.videoHeight||e.height;this.resize(i,a),super.update()}dispose(){this.source=null}}class Js extends mr{constructor(e,i){var a;if(i=i||{},typeof e=="string"){const h=new Image;mr.crossOrigin(h,e,i.crossorigin),h.src=e,e=h}super(e),!e.complete&&this._width&&this._height&&(this._width=0,this._height=0),this.url=e.src,this._process=null,this.preserveBitmap=!1,this.createBitmap=((a=i.createBitmap)!=null?a:P.CREATE_IMAGE_BITMAP)&&!!globalThis.createImageBitmap,this.alphaMode=typeof i.alphaMode=="number"?i.alphaMode:null,this.bitmap=null,this._load=null,i.autoLoad!==!1&&this.load()}load(e){return this._load?this._load:(e!==void 0&&(this.createBitmap=e),this._load=new Promise((i,a)=>{const h=this.source;this.url=h.src;const u=()=>{this.destroyed||(h.onload=null,h.onerror=null,this.update(),this._load=null,this.createBitmap?i(this.process()):i(this))};h.complete&&h.src?u():(h.onload=u,h.onerror=m=>{a(m),this.onError.emit(m)})}),this._load)}process(){const e=this.source;if(this._process!==null)return this._process;if(this.bitmap!==null||!globalThis.createImageBitmap)return Promise.resolve(this);const i=globalThis.createImageBitmap,a=!e.crossOrigin||e.crossOrigin==="anonymous";return this._process=fetch(e.src,{mode:a?"cors":"no-cors"}).then(h=>h.blob()).then(h=>i(h,0,0,e.width,e.height,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===H.UNPACK?"premultiply":"none"})).then(h=>this.destroyed?Promise.reject():(this.bitmap=h,this.update(),this._process=null,Promise.resolve(this))),this._process}upload(e,i,a){if(typeof this.alphaMode=="number"&&(i.alphaMode=this.alphaMode),!this.createBitmap)return super.upload(e,i,a);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(super.upload(e,i,a,this.bitmap),!this.preserveBitmap){let h=!0;const u=i._glTextures;for(const m in u){const y=u[m];if(y!==a&&y.dirtyId!==i.dirtyId){h=!1;break}}h&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0}dispose(){this.source.onload=null,this.source.onerror=null,super.dispose(),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null}static test(e){return typeof HTMLImageElement<"u"&&(typeof e=="string"||e instanceof HTMLImageElement)}}class xs{constructor(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}set(e,i,a){const h=i.width,u=i.height;if(a){const m=e.width/2/h,y=e.height/2/u,E=e.x/h+m,D=e.y/u+y;a=me.add(a,me.NW),this.x0=E+m*me.uX(a),this.y0=D+y*me.uY(a),a=me.add(a,2),this.x1=E+m*me.uX(a),this.y1=D+y*me.uY(a),a=me.add(a,2),this.x2=E+m*me.uX(a),this.y2=D+y*me.uY(a),a=me.add(a,2),this.x3=E+m*me.uX(a),this.y3=D+y*me.uY(a)}else this.x0=e.x/h,this.y0=e.y/u,this.x1=(e.x+e.width)/h,this.y1=e.y/u,this.x2=(e.x+e.width)/h,this.y2=(e.y+e.height)/u,this.x3=e.x/h,this.y3=(e.y+e.height)/u;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3}}xs.prototype.toString=function(){return`[@pixi/core:TextureUvs x0=${this.x0} y0=${this.y0} x1=${this.x1} y1=${this.y1} x2=${this.x2} y2=${this.y2} x3=${this.x3} y3=${this.y3}]`};const tn=new xs;function Fi(s){s.destroy=function(){},s.on=function(){},s.once=function(){},s.emit=function(){}}class ne extends Mt{constructor(e,i,a,h,u,m,y){if(super(),this.noFrame=!1,i||(this.noFrame=!0,i=new ie(0,0,1,1)),e instanceof ne&&(e=e.baseTexture),this.baseTexture=e,this._frame=i,this.trim=h,this.valid=!1,this.destroyed=!1,this._uvs=tn,this.uvMatrix=null,this.orig=a||i,this._rotate=Number(u||0),u===!0)this._rotate=2;else if(this._rotate%2!==0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");this.defaultAnchor=m?new oe(m.x,m.y):new oe(0,0),this.defaultBorders=y,this._updateID=0,this.textureCacheIds=[],e.valid?this.noFrame?e.valid&&this.onBaseTextureUpdated(e):this.frame=i:e.once("loaded",this.onBaseTextureUpdated,this),this.noFrame&&e.on("update",this.onBaseTextureUpdated,this)}update(){this.baseTexture.resource&&this.baseTexture.resource.update()}onBaseTextureUpdated(e){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=e.width,this._frame.height=e.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)}destroy(e){if(this.baseTexture){if(e){const{resource:i}=this.baseTexture;i!=null&&i.url&&ve[i.url]&&ne.removeFromCache(i.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,ne.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0,this.emit("destroyed",this),this.removeAllListeners()}clone(){var h;const e=this._frame.clone(),i=this._frame===this.orig?e:this.orig.clone(),a=new ne(this.baseTexture,!this.noFrame&&e,i,(h=this.trim)==null?void 0:h.clone(),this.rotate,this.defaultAnchor,this.defaultBorders);return this.noFrame&&(a._frame=e),a}updateUvs(){this._uvs===tn&&(this._uvs=new xs),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++}static from(e,i={},a=P.STRICT_TEXTURE_CACHE){const h=typeof e=="string";let u=null;if(h)u=e;else if(e instanceof se){if(!e.cacheId){const y=(i==null?void 0:i.pixiIdPrefix)||"pixiid";e.cacheId=`${y}-${or()}`,se.addToCache(e,e.cacheId)}u=e.cacheId}else{if(!e._pixiId){const y=(i==null?void 0:i.pixiIdPrefix)||"pixiid";e._pixiId=`${y}_${or()}`}u=e._pixiId}let m=ve[u];if(h&&a&&!m)throw new Error(`The cacheId "${u}" does not exist in TextureCache.`);return!m&&!(e instanceof se)?(i.resolution||(i.resolution=Zi(e)),m=new ne(new se(e,i)),m.baseTexture.cacheId=u,se.addToCache(m.baseTexture,u),ne.addToCache(m,u)):!m&&e instanceof se&&(m=new ne(e),ne.addToCache(m,u)),m}static fromURL(e,i){const a=Object.assign({autoLoad:!1},i==null?void 0:i.resourceOptions),h=ne.from(e,Object.assign({resourceOptions:a},i),!1),u=h.baseTexture.resource;return h.baseTexture.valid?Promise.resolve(h):u.load().then(()=>Promise.resolve(h))}static fromBuffer(e,i,a,h){return new ne(se.fromBuffer(e,i,a,h))}static fromLoader(e,i,a,h){const u=new se(e,Object.assign({scaleMode:se.defaultOptions.scaleMode,resolution:Zi(i)},h)),{resource:m}=u;m instanceof Js&&(m.url=i);const y=new ne(u);return a||(a=i),se.addToCache(y.baseTexture,a),ne.addToCache(y,a),a!==i&&(se.addToCache(y.baseTexture,i),ne.addToCache(y,i)),y.baseTexture.valid?Promise.resolve(y):new Promise(E=>{y.baseTexture.once("loaded",()=>E(y))})}static addToCache(e,i){i&&(e.textureCacheIds.includes(i)||e.textureCacheIds.push(i),ve[i]&&ve[i]!==e&&console.warn(`Texture added to the cache with an id [${i}] that already had an entry`),ve[i]=e)}static removeFromCache(e){if(typeof e=="string"){const i=ve[e];if(i){const a=i.textureCacheIds.indexOf(e);return a>-1&&i.textureCacheIds.splice(a,1),delete ve[e],i}}else if(e!=null&&e.textureCacheIds){for(let i=0;i<e.textureCacheIds.length;++i)ve[e.textureCacheIds[i]]===e&&delete ve[e.textureCacheIds[i]];return e.textureCacheIds.length=0,e}return null}get resolution(){return this.baseTexture.resolution}get frame(){return this._frame}set frame(e){this._frame=e,this.noFrame=!1;const{x:i,y:a,width:h,height:u}=e,m=i+h>this.baseTexture.width,y=a+u>this.baseTexture.height;if(m||y){const E=m&&y?"and":"or",D=`X: ${i} + ${h} = ${i+h} > ${this.baseTexture.width}`,Z=`Y: ${a} + ${u} = ${a+u} > ${this.baseTexture.height}`;throw new Error(`Texture Error: frame does not fit inside the base Texture dimensions: ${D} ${E} ${Z}`)}this.valid=h&&u&&this.baseTexture.valid,!this.trim&&!this.rotate&&(this.orig=e),this.valid&&this.updateUvs()}get rotate(){return this._rotate}set rotate(e){this._rotate=e,this.valid&&this.updateUvs()}get width(){return this.orig.width}get height(){return this.orig.height}castToBaseTexture(){return this.baseTexture}static get EMPTY(){return ne._EMPTY||(ne._EMPTY=new ne(new se),Fi(ne._EMPTY),Fi(ne._EMPTY.baseTexture)),ne._EMPTY}static get WHITE(){if(!ne._WHITE){const e=P.ADAPTER.createCanvas(16,16),i=e.getContext("2d");e.width=16,e.height=16,i.fillStyle="white",i.fillRect(0,0,16,16),ne._WHITE=new ne(se.from(e)),Fi(ne._WHITE),Fi(ne._WHITE.baseTexture)}return ne._WHITE}}class Rr extends ne{constructor(e,i){super(e,i),this.valid=!0,this.filterFrame=null,this.filterPoolKey=null,this.updateUvs()}get framebuffer(){return this.baseTexture.framebuffer}get multisample(){return this.framebuffer.multisample}set multisample(e){this.framebuffer.multisample=e}resize(e,i,a=!0){const h=this.baseTexture.resolution,u=Math.round(e*h)/h,m=Math.round(i*h)/h;this.valid=u>0&&m>0,this._frame.width=this.orig.width=u,this._frame.height=this.orig.height=m,a&&this.baseTexture.resize(u,m),this.updateUvs()}setResolution(e){const{baseTexture:i}=this;i.resolution!==e&&(i.setResolution(e),this.resize(i.width,i.height,!1))}static create(e){return new Rr(new Qs(e))}}class vs{constructor(e){this.texturePool={},this.textureOptions=e||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}createTexture(e,i,a=rt.NONE){const h=new Qs(Object.assign({width:e,height:i,resolution:1,multisample:a},this.textureOptions));return new Rr(h)}getOptimalTexture(e,i,a=1,h=rt.NONE){let u;e=Math.max(Math.ceil(e*a-1e-6),1),i=Math.max(Math.ceil(i*a-1e-6),1),!this.enableFullScreen||e!==this._pixelsWidth||i!==this._pixelsHeight?(e=ti(e),i=ti(i),u=((e&65535)<<16|i&65535)>>>0,h>1&&(u+=h*4294967296)):u=h>1?-h:-1,this.texturePool[u]||(this.texturePool[u]=[]);let m=this.texturePool[u].pop();return m||(m=this.createTexture(e,i,h)),m.filterPoolKey=u,m.setResolution(a),m}getFilterTexture(e,i,a){const h=this.getOptimalTexture(e.width,e.height,i||e.resolution,a||rt.NONE);return h.filterFrame=e.filterFrame,h}returnTexture(e){const i=e.filterPoolKey;e.filterFrame=null,this.texturePool[i].push(e)}returnFilterTexture(e){this.returnTexture(e)}clear(e){if(e=e!==!1,e)for(const i in this.texturePool){const a=this.texturePool[i];if(a)for(let h=0;h<a.length;h++)a[h].destroy(!0)}this.texturePool={}}setScreenSize(e){if(!(e.width===this._pixelsWidth&&e.height===this._pixelsHeight)){this.enableFullScreen=e.width>0&&e.height>0;for(const i in this.texturePool){if(!(Number(i)<0))continue;const a=this.texturePool[i];if(a)for(let h=0;h<a.length;h++)a[h].destroy(!0);this.texturePool[i]=[]}this._pixelsWidth=e.width,this._pixelsHeight=e.height}}}vs.SCREEN_KEY=-1;class Yn extends Er{constructor(){super(),this.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2])}}class en extends Er{constructor(){super(),this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),this.vertexBuffer=new Ie(this.vertices),this.uvBuffer=new Ie(this.uvs),this.addAttribute("aVertexPosition",this.vertexBuffer).addAttribute("aTextureCoord",this.uvBuffer).addIndex([0,1,2,0,2,3])}map(e,i){let a=0,h=0;return this.uvs[0]=a,this.uvs[1]=h,this.uvs[2]=a+i.width/e.width,this.uvs[3]=h,this.uvs[4]=a+i.width/e.width,this.uvs[5]=h+i.height/e.height,this.uvs[6]=a,this.uvs[7]=h+i.height/e.height,a=i.x,h=i.y,this.vertices[0]=a,this.vertices[1]=h,this.vertices[2]=a+i.width,this.vertices[3]=h,this.vertices[4]=a+i.width,this.vertices[5]=h+i.height,this.vertices[6]=a,this.vertices[7]=h+i.height,this.invalidate(),this}invalidate(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this}}class rn{constructor(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.multisample=rt.NONE,this.sourceFrame=new ie,this.destinationFrame=new ie,this.bindingSourceFrame=new ie,this.bindingDestinationFrame=new ie,this.filters=[],this.transform=null}clear(){this.target=null,this.filters=null,this.renderTexture=null}}const zr=[new oe,new oe,new oe,new oe],Pr=new de;class bs{constructor(e){this.renderer=e,this.defaultFilterStack=[{}],this.texturePool=new vs,this.statePool=[],this.quad=new Yn,this.quadUv=new en,this.tempRect=new ie,this.activeState={},this.globalUniforms=new je({outputFrame:new ie,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this.forceClear=!1,this.useMaxPadding=!1}init(){this.texturePool.setScreenSize(this.renderer.view)}push(e,i){var _e,Yr,Mr,Br;const a=this.renderer,h=this.defaultFilterStack,u=this.statePool.pop()||new rn,m=a.renderTexture;let y,E;if(m.current){const Fr=m.current;y=Fr.resolution,E=Fr.multisample}else y=a.resolution,E=a.multisample;let D=i[0].resolution||y,Z=(_e=i[0].multisample)!=null?_e:E,st=i[0].padding,yt=i[0].autoFit,jt=(Yr=i[0].legacy)!=null?Yr:!0;for(let Fr=1;Fr<i.length;Fr++){const Dr=i[Fr];D=Math.min(D,Dr.resolution||y),Z=Math.min(Z,(Mr=Dr.multisample)!=null?Mr:E),st=this.useMaxPadding?Math.max(st,Dr.padding):st+Dr.padding,yt=yt&&Dr.autoFit,jt=jt||((Br=Dr.legacy)!=null?Br:!0)}h.length===1&&(this.defaultFilterStack[0].renderTexture=m.current),h.push(u),u.resolution=D,u.multisample=Z,u.legacy=jt,u.target=e,u.sourceFrame.copyFrom(e.filterArea||e.getBounds(!0)),u.sourceFrame.pad(st);const le=this.tempRect.copyFrom(m.sourceFrame);a.projection.transform&&this.transformAABB(Pr.copyFrom(a.projection.transform).invert(),le),yt?(u.sourceFrame.fit(le),(u.sourceFrame.width<=0||u.sourceFrame.height<=0)&&(u.sourceFrame.width=0,u.sourceFrame.height=0)):u.sourceFrame.intersects(le)||(u.sourceFrame.width=0,u.sourceFrame.height=0),this.roundFrame(u.sourceFrame,m.current?m.current.resolution:a.resolution,m.sourceFrame,m.destinationFrame,a.projection.transform),u.renderTexture=this.getOptimalFilterTexture(u.sourceFrame.width,u.sourceFrame.height,D,Z),u.filters=i,u.destinationFrame.width=u.renderTexture.width,u.destinationFrame.height=u.renderTexture.height;const Kt=this.tempRect;Kt.x=0,Kt.y=0,Kt.width=u.sourceFrame.width,Kt.height=u.sourceFrame.height,u.renderTexture.filterFrame=u.sourceFrame,u.bindingSourceFrame.copyFrom(m.sourceFrame),u.bindingDestinationFrame.copyFrom(m.destinationFrame),u.transform=a.projection.transform,a.projection.transform=null,m.bind(u.renderTexture,u.sourceFrame,Kt),a.framebuffer.clear(0,0,0,0)}pop(){const e=this.defaultFilterStack,i=e.pop(),a=i.filters;this.activeState=i;const h=this.globalUniforms.uniforms;h.outputFrame=i.sourceFrame,h.resolution=i.resolution;const u=h.inputSize,m=h.inputPixel,y=h.inputClamp;if(u[0]=i.destinationFrame.width,u[1]=i.destinationFrame.height,u[2]=1/u[0],u[3]=1/u[1],m[0]=Math.round(u[0]*i.resolution),m[1]=Math.round(u[1]*i.resolution),m[2]=1/m[0],m[3]=1/m[1],y[0]=.5*m[2],y[1]=.5*m[3],y[2]=i.sourceFrame.width*u[2]-.5*m[2],y[3]=i.sourceFrame.height*u[3]-.5*m[3],i.legacy){const D=h.filterArea;D[0]=i.destinationFrame.width,D[1]=i.destinationFrame.height,D[2]=i.sourceFrame.x,D[3]=i.sourceFrame.y,h.filterClamp=h.inputClamp}this.globalUniforms.update();const E=e[e.length-1];if(this.renderer.framebuffer.blit(),a.length===1)a[0].apply(this,i.renderTexture,E.renderTexture,mt.BLEND,i),this.returnFilterTexture(i.renderTexture);else{let D=i.renderTexture,Z=this.getOptimalFilterTexture(D.width,D.height,i.resolution);Z.filterFrame=D.filterFrame;let st=0;for(st=0;st<a.length-1;++st){st===1&&i.multisample>1&&(Z=this.getOptimalFilterTexture(D.width,D.height,i.resolution),Z.filterFrame=D.filterFrame),a[st].apply(this,D,Z,mt.CLEAR,i);const yt=D;D=Z,Z=yt}a[st].apply(this,D,E.renderTexture,mt.BLEND,i),st>1&&i.multisample>1&&this.returnFilterTexture(i.renderTexture),this.returnFilterTexture(D),this.returnFilterTexture(Z)}i.clear(),this.statePool.push(i)}bindAndClear(e,i=mt.CLEAR){const{renderTexture:a,state:h}=this.renderer;if(e===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.renderer.projection.transform=this.activeState.transform:this.renderer.projection.transform=null,e==null?void 0:e.filterFrame){const m=this.tempRect;m.x=0,m.y=0,m.width=e.filterFrame.width,m.height=e.filterFrame.height,a.bind(e,e.filterFrame,m)}else e!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?a.bind(e):this.renderer.renderTexture.bind(e,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);const u=h.stateId&1||this.forceClear;(i===mt.CLEAR||i===mt.BLIT&&u)&&this.renderer.framebuffer.clear(0,0,0,0)}applyFilter(e,i,a,h){const u=this.renderer;u.state.set(e.state),this.bindAndClear(a,h),e.uniforms.uSampler=i,e.uniforms.filterGlobals=this.globalUniforms,u.shader.bind(e),e.legacy=!!e.program.attributeData.aTextureCoord,e.legacy?(this.quadUv.map(i._frame,i.filterFrame),u.geometry.bind(this.quadUv),u.geometry.draw(dt.TRIANGLES)):(u.geometry.bind(this.quad),u.geometry.draw(dt.TRIANGLE_STRIP))}calculateSpriteMatrix(e,i){const{sourceFrame:a,destinationFrame:h}=this.activeState,{orig:u}=i._texture,m=e.set(h.width,0,0,h.height,a.x,a.y),y=i.worldTransform.copyTo(de.TEMP_MATRIX);return y.invert(),m.prepend(y),m.scale(1/u.width,1/u.height),m.translate(i.anchor.x,i.anchor.y),m}destroy(){this.renderer=null,this.texturePool.clear(!1)}getOptimalFilterTexture(e,i,a=1,h=rt.NONE){return this.texturePool.getOptimalTexture(e,i,a,h)}getFilterTexture(e,i,a){if(typeof e=="number"){const u=e;e=i,i=u}e=e||this.activeState.renderTexture;const h=this.texturePool.getOptimalTexture(e.width,e.height,i||e.resolution,a||rt.NONE);return h.filterFrame=e.filterFrame,h}returnFilterTexture(e){this.texturePool.returnTexture(e)}emptyPool(){this.texturePool.clear(!0)}resize(){this.texturePool.setScreenSize(this.renderer.view)}transformAABB(e,i){const a=zr[0],h=zr[1],u=zr[2],m=zr[3];a.set(i.left,i.top),h.set(i.left,i.bottom),u.set(i.right,i.top),m.set(i.right,i.bottom),e.apply(a,a),e.apply(h,h),e.apply(u,u),e.apply(m,m);const y=Math.min(a.x,h.x,u.x,m.x),E=Math.min(a.y,h.y,u.y,m.y),D=Math.max(a.x,h.x,u.x,m.x),Z=Math.max(a.y,h.y,u.y,m.y);i.x=y,i.y=E,i.width=D-y,i.height=Z-E}roundFrame(e,i,a,h,u){if(!(e.width<=0||e.height<=0||a.width<=0||a.height<=0)){if(u){const{a:m,b:y,c:E,d:D}=u;if((Math.abs(y)>1e-4||Math.abs(E)>1e-4)&&(Math.abs(m)>1e-4||Math.abs(D)>1e-4))return}u=u?Pr.copyFrom(u):Pr.identity(),u.translate(-a.x,-a.y).scale(h.width/a.width,h.height/a.height).translate(h.x,h.y),this.transformAABB(u,e),e.ceil(i),this.transformAABB(u.invert(),e)}}}bs.extension={type:Zt.RendererSystem,name:"filter"},re.add(bs);class Kn{constructor(e){this.framebuffer=e,this.stencil=null,this.dirtyId=-1,this.dirtyFormat=-1,this.dirtySize=-1,this.multisample=rt.NONE,this.msaaBuffer=null,this.blitFramebuffer=null,this.mipLevel=0}}const qn=new ie;class sn{constructor(e){this.renderer=e,this.managedFramebuffers=[],this.unknownFramebuffer=new ys(10,10),this.msaaSamples=null}contextChange(){this.disposeAll(!0);const e=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new ie,this.hasMRT=!0,this.writeDepthTexture=!0,this.renderer.context.webGLVersion===1){let i=this.renderer.context.extensions.drawBuffers,a=this.renderer.context.extensions.depthTexture;P.PREFER_ENV===ut.WEBGL_LEGACY&&(i=null,a=null),i?e.drawBuffers=h=>i.drawBuffersWEBGL(h):(this.hasMRT=!1,e.drawBuffers=()=>{}),a||(this.writeDepthTexture=!1)}else this.msaaSamples=e.getInternalformatParameter(e.RENDERBUFFER,e.RGBA8,e.SAMPLES)}bind(e,i,a=0){const{gl:h}=this;if(e){const u=e.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(e);this.current!==e&&(this.current=e,h.bindFramebuffer(h.FRAMEBUFFER,u.framebuffer)),u.mipLevel!==a&&(e.dirtyId++,e.dirtyFormat++,u.mipLevel=a),u.dirtyId!==e.dirtyId&&(u.dirtyId=e.dirtyId,u.dirtyFormat!==e.dirtyFormat?(u.dirtyFormat=e.dirtyFormat,u.dirtySize=e.dirtySize,this.updateFramebuffer(e,a)):u.dirtySize!==e.dirtySize&&(u.dirtySize=e.dirtySize,this.resizeFramebuffer(e)));for(let m=0;m<e.colorTextures.length;m++){const y=e.colorTextures[m];this.renderer.texture.unbind(y.parentTextureArray||y)}if(e.depthTexture&&this.renderer.texture.unbind(e.depthTexture),i){const m=i.width>>a,y=i.height>>a,E=m/i.width;this.setViewport(i.x*E,i.y*E,m,y)}else{const m=e.width>>a,y=e.height>>a;this.setViewport(0,0,m,y)}}else this.current&&(this.current=null,h.bindFramebuffer(h.FRAMEBUFFER,null)),i?this.setViewport(i.x,i.y,i.width,i.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)}setViewport(e,i,a,h){const u=this.viewport;e=Math.round(e),i=Math.round(i),a=Math.round(a),h=Math.round(h),(u.width!==a||u.height!==h||u.x!==e||u.y!==i)&&(u.x=e,u.y=i,u.width=a,u.height=h,this.gl.viewport(e,i,a,h))}get size(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}}clear(e,i,a,h,u=vt.COLOR|vt.DEPTH){const{gl:m}=this;m.clearColor(e,i,a,h),m.clear(u)}initFramebuffer(e){const{gl:i}=this,a=new Kn(i.createFramebuffer());return a.multisample=this.detectSamples(e.multisample),e.glFramebuffers[this.CONTEXT_UID]=a,this.managedFramebuffers.push(e),e.disposeRunner.add(this),a}resizeFramebuffer(e){const{gl:i}=this,a=e.glFramebuffers[this.CONTEXT_UID];if(a.stencil){i.bindRenderbuffer(i.RENDERBUFFER,a.stencil);let m;this.renderer.context.webGLVersion===1?m=i.DEPTH_STENCIL:e.depth&&e.stencil?m=i.DEPTH24_STENCIL8:e.depth?m=i.DEPTH_COMPONENT24:m=i.STENCIL_INDEX8,a.msaaBuffer?i.renderbufferStorageMultisample(i.RENDERBUFFER,a.multisample,m,e.width,e.height):i.renderbufferStorage(i.RENDERBUFFER,m,e.width,e.height)}const h=e.colorTextures;let u=h.length;i.drawBuffers||(u=Math.min(u,1));for(let m=0;m<u;m++){const y=h[m],E=y.parentTextureArray||y;this.renderer.texture.bind(E,0),m===0&&a.msaaBuffer&&(i.bindRenderbuffer(i.RENDERBUFFER,a.msaaBuffer),i.renderbufferStorageMultisample(i.RENDERBUFFER,a.multisample,E._glTextures[this.CONTEXT_UID].internalFormat,e.width,e.height))}e.depthTexture&&this.writeDepthTexture&&this.renderer.texture.bind(e.depthTexture,0)}updateFramebuffer(e,i){const{gl:a}=this,h=e.glFramebuffers[this.CONTEXT_UID],u=e.colorTextures;let m=u.length;a.drawBuffers||(m=Math.min(m,1)),h.multisample>1&&this.canMultisampleFramebuffer(e)?h.msaaBuffer=h.msaaBuffer||a.createRenderbuffer():h.msaaBuffer&&(a.deleteRenderbuffer(h.msaaBuffer),h.msaaBuffer=null,h.blitFramebuffer&&(h.blitFramebuffer.dispose(),h.blitFramebuffer=null));const y=[];for(let E=0;E<m;E++){const D=u[E],Z=D.parentTextureArray||D;this.renderer.texture.bind(Z,0),E===0&&h.msaaBuffer?(a.bindRenderbuffer(a.RENDERBUFFER,h.msaaBuffer),a.renderbufferStorageMultisample(a.RENDERBUFFER,h.multisample,Z._glTextures[this.CONTEXT_UID].internalFormat,e.width,e.height),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.RENDERBUFFER,h.msaaBuffer)):(a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0+E,D.target,Z._glTextures[this.CONTEXT_UID].texture,i),y.push(a.COLOR_ATTACHMENT0+E))}if(y.length>1&&a.drawBuffers(y),e.depthTexture&&this.writeDepthTexture){const E=e.depthTexture;this.renderer.texture.bind(E,0),a.framebufferTexture2D(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.TEXTURE_2D,E._glTextures[this.CONTEXT_UID].texture,i)}if((e.stencil||e.depth)&&!(e.depthTexture&&this.writeDepthTexture)){h.stencil=h.stencil||a.createRenderbuffer();let E,D;this.renderer.context.webGLVersion===1?(E=a.DEPTH_STENCIL_ATTACHMENT,D=a.DEPTH_STENCIL):e.depth&&e.stencil?(E=a.DEPTH_STENCIL_ATTACHMENT,D=a.DEPTH24_STENCIL8):e.depth?(E=a.DEPTH_ATTACHMENT,D=a.DEPTH_COMPONENT24):(E=a.STENCIL_ATTACHMENT,D=a.STENCIL_INDEX8),a.bindRenderbuffer(a.RENDERBUFFER,h.stencil),h.msaaBuffer?a.renderbufferStorageMultisample(a.RENDERBUFFER,h.multisample,D,e.width,e.height):a.renderbufferStorage(a.RENDERBUFFER,D,e.width,e.height),a.framebufferRenderbuffer(a.FRAMEBUFFER,E,a.RENDERBUFFER,h.stencil)}else h.stencil&&(a.deleteRenderbuffer(h.stencil),h.stencil=null)}canMultisampleFramebuffer(e){return this.renderer.context.webGLVersion!==1&&e.colorTextures.length<=1&&!e.depthTexture}detectSamples(e){const{msaaSamples:i}=this;let a=rt.NONE;if(e<=1||i===null)return a;for(let h=0;h<i.length;h++)if(i[h]<=e){a=i[h];break}return a===1&&(a=rt.NONE),a}blit(e,i,a){const{current:h,renderer:u,gl:m,CONTEXT_UID:y}=this;if(u.context.webGLVersion!==2||!h)return;const E=h.glFramebuffers[y];if(!E)return;if(!e){if(!E.msaaBuffer)return;const Z=h.colorTextures[0];if(!Z)return;E.blitFramebuffer||(E.blitFramebuffer=new ys(h.width,h.height),E.blitFramebuffer.addColorTexture(0,Z)),e=E.blitFramebuffer,e.colorTextures[0]!==Z&&(e.colorTextures[0]=Z,e.dirtyId++,e.dirtyFormat++),(e.width!==h.width||e.height!==h.height)&&(e.width=h.width,e.height=h.height,e.dirtyId++,e.dirtySize++)}i||(i=qn,i.width=h.width,i.height=h.height),a||(a=i);const D=i.width===a.width&&i.height===a.height;this.bind(e),m.bindFramebuffer(m.READ_FRAMEBUFFER,E.framebuffer),m.blitFramebuffer(i.left,i.top,i.right,i.bottom,a.left,a.top,a.right,a.bottom,m.COLOR_BUFFER_BIT,D?m.NEAREST:m.LINEAR),m.bindFramebuffer(m.READ_FRAMEBUFFER,e.glFramebuffers[this.CONTEXT_UID].framebuffer)}disposeFramebuffer(e,i){const a=e.glFramebuffers[this.CONTEXT_UID],h=this.gl;if(!a)return;delete e.glFramebuffers[this.CONTEXT_UID];const u=this.managedFramebuffers.indexOf(e);u>=0&&this.managedFramebuffers.splice(u,1),e.disposeRunner.remove(this),i||(h.deleteFramebuffer(a.framebuffer),a.msaaBuffer&&h.deleteRenderbuffer(a.msaaBuffer),a.stencil&&h.deleteRenderbuffer(a.stencil)),a.blitFramebuffer&&this.disposeFramebuffer(a.blitFramebuffer,i)}disposeAll(e){const i=this.managedFramebuffers;this.managedFramebuffers=[];for(let a=0;a<i.length;a++)this.disposeFramebuffer(i[a],e)}forceStencil(){const e=this.current;if(!e)return;const i=e.glFramebuffers[this.CONTEXT_UID];if(!i||i.stencil&&e.stencil)return;e.stencil=!0;const a=e.width,h=e.height,u=this.gl,m=i.stencil=u.createRenderbuffer();u.bindRenderbuffer(u.RENDERBUFFER,m);let y,E;this.renderer.context.webGLVersion===1?(y=u.DEPTH_STENCIL_ATTACHMENT,E=u.DEPTH_STENCIL):e.depth?(y=u.DEPTH_STENCIL_ATTACHMENT,E=u.DEPTH24_STENCIL8):(y=u.STENCIL_ATTACHMENT,E=u.STENCIL_INDEX8),i.msaaBuffer?u.renderbufferStorageMultisample(u.RENDERBUFFER,i.multisample,E,a,h):u.renderbufferStorage(u.RENDERBUFFER,E,a,h),u.framebufferRenderbuffer(u.FRAMEBUFFER,y,u.RENDERBUFFER,m)}reset(){this.current=this.unknownFramebuffer,this.viewport=new ie}destroy(){this.renderer=null}}sn.extension={type:Zt.RendererSystem,name:"framebuffer"},re.add(sn);const Di={5126:4,5123:2,5121:1};class nn{constructor(e){this.renderer=e,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.managedGeometries={}}contextChange(){this.disposeAll(!0);const e=this.gl=this.renderer.gl,i=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,i.webGLVersion!==2){let a=this.renderer.context.extensions.vertexArrayObject;P.PREFER_ENV===ut.WEBGL_LEGACY&&(a=null),a?(e.createVertexArray=()=>a.createVertexArrayOES(),e.bindVertexArray=h=>a.bindVertexArrayOES(h),e.deleteVertexArray=h=>a.deleteVertexArrayOES(h)):(this.hasVao=!1,e.createVertexArray=()=>null,e.bindVertexArray=()=>null,e.deleteVertexArray=()=>null)}if(i.webGLVersion!==2){const a=e.getExtension("ANGLE_instanced_arrays");a?(e.vertexAttribDivisor=(h,u)=>a.vertexAttribDivisorANGLE(h,u),e.drawElementsInstanced=(h,u,m,y,E)=>a.drawElementsInstancedANGLE(h,u,m,y,E),e.drawArraysInstanced=(h,u,m,y)=>a.drawArraysInstancedANGLE(h,u,m,y)):this.hasInstance=!1}this.canUseUInt32ElementIndex=i.webGLVersion===2||!!i.extensions.uint32ElementIndex}bind(e,i){i=i||this.renderer.shader.shader;const{gl:a}=this;let h=e.glVertexArrayObjects[this.CONTEXT_UID],u=!1;h||(this.managedGeometries[e.id]=e,e.disposeRunner.add(this),e.glVertexArrayObjects[this.CONTEXT_UID]=h={},u=!0);const m=h[i.program.id]||this.initGeometryVao(e,i,u);this._activeGeometry=e,this._activeVao!==m&&(this._activeVao=m,this.hasVao?a.bindVertexArray(m):this.activateVao(e,i.program)),this.updateBuffers()}reset(){this.unbind()}updateBuffers(){const e=this._activeGeometry,i=this.renderer.buffer;for(let a=0;a<e.buffers.length;a++){const h=e.buffers[a];i.update(h)}}checkCompatibility(e,i){const a=e.attributes,h=i.attributeData;for(const u in h)if(!a[u])throw new Error(`shader and geometry incompatible, geometry missing the "${u}" attribute`)}getSignature(e,i){const a=e.attributes,h=i.attributeData,u=["g",e.id];for(const m in a)h[m]&&u.push(m,h[m].location);return u.join("-")}initGeometryVao(e,i,a=!0){const h=this.gl,u=this.CONTEXT_UID,m=this.renderer.buffer,y=i.program;y.glPrograms[u]||this.renderer.shader.generateProgram(i),this.checkCompatibility(e,y);const E=this.getSignature(e,y),D=e.glVertexArrayObjects[this.CONTEXT_UID];let Z=D[E];if(Z)return D[y.id]=Z,Z;const st=e.buffers,yt=e.attributes,jt={},le={};for(const Kt in st)jt[Kt]=0,le[Kt]=0;for(const Kt in yt)!yt[Kt].size&&y.attributeData[Kt]?yt[Kt].size=y.attributeData[Kt].size:yt[Kt].size||console.warn(`PIXI Geometry attribute '${Kt}' size cannot be determined (likely the bound shader does not have the attribute)`),jt[yt[Kt].buffer]+=yt[Kt].size*Di[yt[Kt].type];for(const Kt in yt){const _e=yt[Kt],Yr=_e.size;_e.stride===void 0&&(jt[_e.buffer]===Yr*Di[_e.type]?_e.stride=0:_e.stride=jt[_e.buffer]),_e.start===void 0&&(_e.start=le[_e.buffer],le[_e.buffer]+=Yr*Di[_e.type])}Z=h.createVertexArray(),h.bindVertexArray(Z);for(let Kt=0;Kt<st.length;Kt++){const _e=st[Kt];m.bind(_e),a&&_e._glBuffers[u].refCount++}return this.activateVao(e,y),D[y.id]=Z,D[E]=Z,h.bindVertexArray(null),m.unbind(ct.ARRAY_BUFFER),Z}disposeGeometry(e,i){var y;if(!this.managedGeometries[e.id])return;delete this.managedGeometries[e.id];const a=e.glVertexArrayObjects[this.CONTEXT_UID],h=this.gl,u=e.buffers,m=(y=this.renderer)==null?void 0:y.buffer;if(e.disposeRunner.remove(this),!!a){if(m)for(let E=0;E<u.length;E++){const D=u[E]._glBuffers[this.CONTEXT_UID];D&&(D.refCount--,D.refCount===0&&!i&&m.dispose(u[E],i))}if(!i){for(const E in a)if(E[0]==="g"){const D=a[E];this._activeVao===D&&this.unbind(),h.deleteVertexArray(D)}}delete e.glVertexArrayObjects[this.CONTEXT_UID]}}disposeAll(e){const i=Object.keys(this.managedGeometries);for(let a=0;a<i.length;a++)this.disposeGeometry(this.managedGeometries[i[a]],e)}activateVao(e,i){const a=this.gl,h=this.CONTEXT_UID,u=this.renderer.buffer,m=e.buffers,y=e.attributes;e.indexBuffer&&u.bind(e.indexBuffer);let E=null;for(const D in y){const Z=y[D],st=m[Z.buffer],yt=st._glBuffers[h];if(i.attributeData[D]){E!==yt&&(u.bind(st),E=yt);const jt=i.attributeData[D].location;if(a.enableVertexAttribArray(jt),a.vertexAttribPointer(jt,Z.size,Z.type||a.FLOAT,Z.normalized,Z.stride,Z.start),Z.instance)if(this.hasInstance)a.vertexAttribDivisor(jt,Z.divisor);else throw new Error("geometry error, GPU Instancing is not supported on this device")}}}draw(e,i,a,h){const{gl:u}=this,m=this._activeGeometry;if(m.indexBuffer){const y=m.indexBuffer.data.BYTES_PER_ELEMENT,E=y===2?u.UNSIGNED_SHORT:u.UNSIGNED_INT;y===2||y===4&&this.canUseUInt32ElementIndex?m.instanced?u.drawElementsInstanced(e,i||m.indexBuffer.data.length,E,(a||0)*y,h||1):u.drawElements(e,i||m.indexBuffer.data.length,E,(a||0)*y):console.warn("unsupported index buffer type: uint32")}else m.instanced?u.drawArraysInstanced(e,a,i||m.getSize(),h||1):u.drawArrays(e,a,i||m.getSize());return this}unbind(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null}destroy(){this.renderer=null}}nn.extension={type:Zt.RendererSystem,name:"geometry"},re.add(nn);const hi=new de;class Ts{constructor(e,i){this._texture=e,this.mapCoord=new de,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=typeof i>"u"?.5:i,this.isSimple=!1}get texture(){return this._texture}set texture(e){this._texture=e,this._textureID=-1}multiplyUvs(e,i){i===void 0&&(i=e);const a=this.mapCoord;for(let h=0;h<e.length;h+=2){const u=e[h],m=e[h+1];i[h]=u*a.a+m*a.c+a.tx,i[h+1]=u*a.b+m*a.d+a.ty}return i}update(e){const i=this._texture;if(!i||!i.valid||!e&&this._textureID===i._updateID)return!1;this._textureID=i._updateID,this._updateID++;const a=i._uvs;this.mapCoord.set(a.x1-a.x0,a.y1-a.y0,a.x3-a.x0,a.y3-a.y0,a.x0,a.y0);const h=i.orig,u=i.trim;u&&(hi.set(h.width/u.width,0,0,h.height/u.height,-u.x/u.width,-u.y/u.height),this.mapCoord.append(hi));const m=i.baseTexture,y=this.uClampFrame,E=this.clampMargin/m.resolution,D=this.clampOffset;return y[0]=(i._frame.x+E+D)/m.width,y[1]=(i._frame.y+E+D)/m.height,y[2]=(i._frame.x+i._frame.width-E+D)/m.width,y[3]=(i._frame.y+i._frame.height-E+D)/m.height,this.uClampOffset[0]=D/m.realWidth,this.uClampOffset[1]=D/m.realHeight,this.isSimple=i._frame.width===m.width&&i._frame.height===m.height&&i.rotate===0,!0}}var an=`varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform sampler2D mask;
uniform float alpha;
uniform float npmAlpha;
uniform vec4 maskClamp;

void main(void)
{
    float clip = step(3.5,
        step(maskClamp.x, vMaskCoord.x) +
        step(maskClamp.y, vMaskCoord.y) +
        step(vMaskCoord.x, maskClamp.z) +
        step(vMaskCoord.y, maskClamp.w));

    vec4 original = texture2D(uSampler, vTextureCoord);
    vec4 masky = texture2D(mask, vMaskCoord);
    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);

    original *= (alphaMul * masky.r * alpha * clip);

    gl_FragColor = original;
}
`,on=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 otherMatrix;

varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;
}
`;class Zn extends rr{constructor(e,i,a){let h=null;typeof e!="string"&&i===void 0&&a===void 0&&(h=e,e=void 0,i=void 0,a=void 0),super(e||on,i||an,a),this.maskSprite=h,this.maskMatrix=new de}get maskSprite(){return this._maskSprite}set maskSprite(e){this._maskSprite=e,this._maskSprite&&(this._maskSprite.renderable=!1)}apply(e,i,a,h){const u=this._maskSprite,m=u._texture;m.valid&&(m.uvMatrix||(m.uvMatrix=new Ts(m,0)),m.uvMatrix.update(),this.uniforms.npmAlpha=m.baseTexture.alphaMode?0:1,this.uniforms.mask=m,this.uniforms.otherMatrix=e.calculateSpriteMatrix(this.maskMatrix,u).prepend(m.uvMatrix.mapCoord),this.uniforms.alpha=u.worldAlpha,this.uniforms.maskClamp=m.uvMatrix.uClampFrame,e.applyFilter(this,i,a,h))}}class hn{constructor(e=null){this.type=G.NONE,this.autoDetect=!0,this.maskObject=e||null,this.pooled=!1,this.isMaskData=!0,this.resolution=null,this.multisample=rr.defaultMultisample,this.enabled=!0,this.colorMask=15,this._filters=null,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._scissorRectLocal=null,this._colorMask=15,this._target=null}get filter(){return this._filters?this._filters[0]:null}set filter(e){e?this._filters?this._filters[0]=e:this._filters=[e]:this._filters=null}reset(){this.pooled&&(this.maskObject=null,this.type=G.NONE,this.autoDetect=!0),this._target=null,this._scissorRectLocal=null}copyCountersOrReset(e){e?(this._stencilCounter=e._stencilCounter,this._scissorCounter=e._scissorCounter,this._scissorRect=e._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)}}class ln{constructor(e){this.renderer=e,this.enableScissor=!0,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0}setMaskStack(e){this.maskStack=e,this.renderer.scissor.setMaskStack(e),this.renderer.stencil.setMaskStack(e)}push(e,i){let a=i;if(!a.isMaskData){const u=this.maskDataPool.pop()||new hn;u.pooled=!0,u.maskObject=i,a=u}const h=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null;if(a.copyCountersOrReset(h),a._colorMask=h?h._colorMask:15,a.autoDetect&&this.detect(a),a._target=e,a.type!==G.SPRITE&&this.maskStack.push(a),a.enabled)switch(a.type){case G.SCISSOR:this.renderer.scissor.push(a);break;case G.STENCIL:this.renderer.stencil.push(a);break;case G.SPRITE:a.copyCountersOrReset(null),this.pushSpriteMask(a);break;case G.COLOR:this.pushColorMask(a);break;default:break}a.type===G.SPRITE&&this.maskStack.push(a)}pop(e){const i=this.maskStack.pop();if(!(!i||i._target!==e)){if(i.enabled)switch(i.type){case G.SCISSOR:this.renderer.scissor.pop(i);break;case G.STENCIL:this.renderer.stencil.pop(i.maskObject);break;case G.SPRITE:this.popSpriteMask(i);break;case G.COLOR:this.popColorMask(i);break;default:break}if(i.reset(),i.pooled&&this.maskDataPool.push(i),this.maskStack.length!==0){const a=this.maskStack[this.maskStack.length-1];a.type===G.SPRITE&&a._filters&&(a._filters[0].maskSprite=a.maskObject)}}}detect(e){const i=e.maskObject;i?i.isSprite?e.type=G.SPRITE:this.enableScissor&&this.renderer.scissor.testScissor(e)?e.type=G.SCISSOR:e.type=G.STENCIL:e.type=G.COLOR}pushSpriteMask(e){const{maskObject:i}=e,a=e._target;let h=e._filters;h||(h=this.alphaMaskPool[this.alphaMaskIndex],h||(h=this.alphaMaskPool[this.alphaMaskIndex]=[new Zn])),h[0].resolution=e.resolution,h[0].multisample=e.multisample,h[0].maskSprite=i;const u=a.filterArea;a.filterArea=i.getBounds(!0),this.renderer.filter.push(a,h),a.filterArea=u,e._filters||this.alphaMaskIndex++}popSpriteMask(e){this.renderer.filter.pop(),e._filters?e._filters[0].maskSprite=null:(this.alphaMaskIndex--,this.alphaMaskPool[this.alphaMaskIndex][0].maskSprite=null)}pushColorMask(e){const i=e._colorMask,a=e._colorMask=i&e.colorMask;a!==i&&this.renderer.gl.colorMask((a&1)!==0,(a&2)!==0,(a&4)!==0,(a&8)!==0)}popColorMask(e){const i=e._colorMask,a=this.maskStack.length>0?this.maskStack[this.maskStack.length-1]._colorMask:15;a!==i&&this.renderer.gl.colorMask((a&1)!==0,(a&2)!==0,(a&4)!==0,(a&8)!==0)}destroy(){this.renderer=null}}ln.extension={type:Zt.RendererSystem,name:"mask"},re.add(ln);class li{constructor(e){this.renderer=e,this.maskStack=[],this.glConst=0}getStackLength(){return this.maskStack.length}setMaskStack(e){const{gl:i}=this.renderer,a=this.getStackLength();this.maskStack=e;const h=this.getStackLength();h!==a&&(h===0?i.disable(this.glConst):(i.enable(this.glConst),this._useCurrent()))}_useCurrent(){}destroy(){this.renderer=null,this.maskStack=null}}const ui=new de,Oi=[],Li=class En extends li{constructor(e){super(e),this.glConst=P.ADAPTER.getWebGLRenderingContext().SCISSOR_TEST}getStackLength(){const e=this.maskStack[this.maskStack.length-1];return e?e._scissorCounter:0}calcScissorRect(e){var y;if(e._scissorRectLocal)return;const i=e._scissorRect,{maskObject:a}=e,{renderer:h}=this,u=h.renderTexture,m=a.getBounds(!0,(y=Oi.pop())!=null?y:new ie);this.roundFrameToPixels(m,u.current?u.current.resolution:h.resolution,u.sourceFrame,u.destinationFrame,h.projection.transform),i&&m.fit(i),e._scissorRectLocal=m}static isMatrixRotated(e){if(!e)return!1;const{a:i,b:a,c:h,d:u}=e;return(Math.abs(a)>1e-4||Math.abs(h)>1e-4)&&(Math.abs(i)>1e-4||Math.abs(u)>1e-4)}testScissor(e){const{maskObject:i}=e;if(!i.isFastRect||!i.isFastRect()||En.isMatrixRotated(i.worldTransform)||En.isMatrixRotated(this.renderer.projection.transform))return!1;this.calcScissorRect(e);const a=e._scissorRectLocal;return a.width>0&&a.height>0}roundFrameToPixels(e,i,a,h,u){En.isMatrixRotated(u)||(u=u?ui.copyFrom(u):ui.identity(),u.translate(-a.x,-a.y).scale(h.width/a.width,h.height/a.height).translate(h.x,h.y),this.renderer.filter.transformAABB(u,e),e.fit(h),e.x=Math.round(e.x*i),e.y=Math.round(e.y*i),e.width=Math.round(e.width*i),e.height=Math.round(e.height*i))}push(e){e._scissorRectLocal||this.calcScissorRect(e);const{gl:i}=this.renderer;e._scissorRect||i.enable(i.SCISSOR_TEST),e._scissorCounter++,e._scissorRect=e._scissorRectLocal,this._useCurrent()}pop(e){const{gl:i}=this.renderer;e&&Oi.push(e._scissorRectLocal),this.getStackLength()>0?this._useCurrent():i.disable(i.SCISSOR_TEST)}_useCurrent(){const e=this.maskStack[this.maskStack.length-1]._scissorRect;let i;this.renderer.renderTexture.current?i=e.y:i=this.renderer.height-e.height-e.y,this.renderer.gl.scissor(e.x,i,e.width,e.height)}};Li.extension={type:Zt.RendererSystem,name:"scissor"};let Es=Li;re.add(Es);class un extends li{constructor(e){super(e),this.glConst=P.ADAPTER.getWebGLRenderingContext().STENCIL_TEST}getStackLength(){const e=this.maskStack[this.maskStack.length-1];return e?e._stencilCounter:0}push(e){const i=e.maskObject,{gl:a}=this.renderer,h=e._stencilCounter;h===0&&(this.renderer.framebuffer.forceStencil(),a.clearStencil(0),a.clear(a.STENCIL_BUFFER_BIT),a.enable(a.STENCIL_TEST)),e._stencilCounter++;const u=e._colorMask;u!==0&&(e._colorMask=0,a.colorMask(!1,!1,!1,!1)),a.stencilFunc(a.EQUAL,h,4294967295),a.stencilOp(a.KEEP,a.KEEP,a.INCR),i.renderable=!0,i.render(this.renderer),this.renderer.batch.flush(),i.renderable=!1,u!==0&&(e._colorMask=u,a.colorMask((u&1)!==0,(u&2)!==0,(u&4)!==0,(u&8)!==0)),this._useCurrent()}pop(e){const i=this.renderer.gl;if(this.getStackLength()===0)i.disable(i.STENCIL_TEST);else{const a=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null,h=a?a._colorMask:15;h!==0&&(a._colorMask=0,i.colorMask(!1,!1,!1,!1)),i.stencilOp(i.KEEP,i.KEEP,i.DECR),e.renderable=!0,e.render(this.renderer),this.renderer.batch.flush(),e.renderable=!1,h!==0&&(a._colorMask=h,i.colorMask((h&1)!==0,(h&2)!==0,(h&4)!==0,(h&8)!==0)),this._useCurrent()}}_useCurrent(){const e=this.renderer.gl;e.stencilFunc(e.EQUAL,this.getStackLength(),4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP)}}un.extension={type:Zt.RendererSystem,name:"stencil"},re.add(un);class cn{constructor(e){this.renderer=e,this.plugins={},Object.defineProperties(this.plugins,{extract:{enumerable:!1,get(){return Et("7.0.0","renderer.plugins.extract has moved to renderer.extract"),e.extract}},prepare:{enumerable:!1,get(){return Et("7.0.0","renderer.plugins.prepare has moved to renderer.prepare"),e.prepare}},interaction:{enumerable:!1,get(){return Et("7.0.0","renderer.plugins.interaction has been deprecated, use renderer.events"),e.events}}})}init(){const e=this.rendererPlugins;for(const i in e)this.plugins[i]=new e[i](this.renderer)}destroy(){for(const e in this.plugins)this.plugins[e].destroy(),this.plugins[e]=null}}cn.extension={type:[Zt.RendererSystem,Zt.CanvasRendererSystem],name:"_plugin"},re.add(cn);class dn{constructor(e){this.renderer=e,this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new de,this.transform=null}update(e,i,a,h){this.destinationFrame=e||this.destinationFrame||this.defaultFrame,this.sourceFrame=i||this.sourceFrame||e,this.calculateProjection(this.destinationFrame,this.sourceFrame,a,h),this.transform&&this.projectionMatrix.append(this.transform);const u=this.renderer;u.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,u.globalUniforms.update(),u.shader.shader&&u.shader.syncUniformGroup(u.shader.shader.uniforms.globals)}calculateProjection(e,i,a,h){const u=this.projectionMatrix,m=h?-1:1;u.identity(),u.a=1/i.width*2,u.d=m*(1/i.height*2),u.tx=-1-i.x*u.a,u.ty=-m-i.y*u.d}setTransform(e){}destroy(){this.renderer=null}}dn.extension={type:Zt.RendererSystem,name:"projection"},re.add(dn);const fn=new ls,pn=new ie;class ci{constructor(e){this.renderer=e,this._tempMatrix=new de}generateTexture(e,i){var Z;const D=i||{},{region:a}=D,h=ta(D,["region"]),u=(a==null?void 0:a.copyTo(pn))||e.getLocalBounds(pn,!0),m=h.resolution||this.renderer.resolution;u.width=Math.max(u.width,1/m),u.height=Math.max(u.height,1/m),h.width=u.width,h.height=u.height,h.resolution=m,(Z=h.multisample)!=null||(h.multisample=this.renderer.multisample);const y=Rr.create(h);this._tempMatrix.tx=-u.x,this._tempMatrix.ty=-u.y;const E=e.transform;return e.transform=fn,this.renderer.render(e,{renderTexture:y,transform:this._tempMatrix,skipUpdateTransform:!!e.parent,blit:!0}),e.transform=E,y}destroy(){}}ci.extension={type:[Zt.RendererSystem,Zt.CanvasRendererSystem],name:"textureGenerator"},re.add(ci);const Fe=new ie,Oe=new ie;class mn{constructor(e){this.renderer=e,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new ie,this.destinationFrame=new ie,this.viewportFrame=new ie}contextChange(){var i;const e=(i=this.renderer)==null?void 0:i.gl.getContextAttributes();this._rendererPremultipliedAlpha=!!(e&&e.alpha&&e.premultipliedAlpha)}bind(e=null,i,a){const h=this.renderer;this.current=e;let u,m,y;e?(u=e.baseTexture,y=u.resolution,i||(Fe.width=e.frame.width,Fe.height=e.frame.height,i=Fe),a||(Oe.x=e.frame.x,Oe.y=e.frame.y,Oe.width=i.width,Oe.height=i.height,a=Oe),m=u.framebuffer):(y=h.resolution,i||(Fe.width=h._view.screen.width,Fe.height=h._view.screen.height,i=Fe),a||(a=Fe,a.width=i.width,a.height=i.height));const E=this.viewportFrame;E.x=a.x*y,E.y=a.y*y,E.width=a.width*y,E.height=a.height*y,e||(E.y=h.view.height-(E.y+E.height)),E.ceil(),this.renderer.framebuffer.bind(m,E),this.renderer.projection.update(a,i,y,!m),e?this.renderer.mask.setMaskStack(u.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(i),this.destinationFrame.copyFrom(a)}clear(e,i){const a=this.current?this.current.baseTexture.clear:this.renderer.background.backgroundColor,h=Se.shared.setValue(e||a);(this.current&&this.current.baseTexture.alphaMode>0||!this.current&&this._rendererPremultipliedAlpha)&&h.premultiply(h.alpha);const u=this.destinationFrame,m=this.current?this.current.baseTexture:this.renderer._view.screen,y=u.width!==m.width||u.height!==m.height;if(y){let{x:E,y:D,width:Z,height:st}=this.viewportFrame;E=Math.round(E),D=Math.round(D),Z=Math.round(Z),st=Math.round(st),this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(E,D,Z,st)}this.renderer.framebuffer.clear(h.red,h.green,h.blue,h.alpha,i),y&&this.renderer.scissor.pop()}resize(){this.bind(null)}reset(){this.bind(null)}destroy(){this.renderer=null}}mn.extension={type:Zt.RendererSystem,name:"renderTexture"},re.add(mn);class ca{}class gn{constructor(e,i){this.program=e,this.uniformData=i,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBufferBindings={}}destroy(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBufferBindings=null,this.program=null}}function As(s,e,i){const a=s.createShader(e);return s.shaderSource(a,i),s.compileShader(a),a}function Ni(s){const e=new Array(s);for(let i=0;i<e.length;i++)e[i]=!1;return e}function _n(s,e){switch(s){case"float":return 0;case"vec2":return new Float32Array(2*e);case"vec3":return new Float32Array(3*e);case"vec4":return new Float32Array(4*e);case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"ivec2":return new Int32Array(2*e);case"ivec3":return new Int32Array(3*e);case"ivec4":return new Int32Array(4*e);case"uvec2":return new Uint32Array(2*e);case"uvec3":return new Uint32Array(3*e);case"uvec4":return new Uint32Array(4*e);case"bool":return!1;case"bvec2":return Ni(2*e);case"bvec3":return Ni(3*e);case"bvec4":return Ni(4*e);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}function da(s,e){const i={},a=e.getProgramParameter(s,e.ACTIVE_ATTRIBUTES);for(let h=0;h<a;h++){const u=e.getActiveAttrib(s,h);if(u.name.startsWith("gl_"))continue;const m=zn(e,u.type),y={type:m,name:u.name,size:Ys(m),location:e.getAttribLocation(s,u.name)};i[u.name]=y}return i}function Qn(s,e){const i={},a=e.getProgramParameter(s,e.ACTIVE_UNIFORMS);for(let h=0;h<a;h++){const u=e.getActiveUniform(s,h),m=u.name.replace(/\[.*?\]$/,""),y=!!u.name.match(/\[.*?\]$/),E=zn(e,u.type);i[m]={name:m,index:h,type:E,size:u.size,isArray:y,value:_n(E,u.size)}}return i}function yn(s,e){const i=s.getShaderSource(e).split(`
`).map((D,Z)=>`${Z}: ${D}`),a=s.getShaderInfoLog(e),h=a.split(`
`),u={},m=h.map(D=>parseFloat(D.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1"))).filter(D=>D&&!u[D]?(u[D]=!0,!0):!1),y=[""];m.forEach(D=>{i[D-1]=`%c${i[D-1]}%c`,y.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")});const E=i.join(`
`);y[0]=E,console.error(a),console.groupCollapsed("click to view full shader code"),console.warn(...y),console.groupEnd()}function ws(s,e,i,a){s.getProgramParameter(e,s.LINK_STATUS)||(s.getShaderParameter(i,s.COMPILE_STATUS)||yn(s,i),s.getShaderParameter(a,s.COMPILE_STATUS)||yn(s,a),console.error("PixiJS Error: Could not initialize shader."),s.getProgramInfoLog(e)!==""&&console.warn("PixiJS Warning: gl.getProgramInfoLog()",s.getProgramInfoLog(e)))}function Ss(s,e){var y;const i=As(s,s.VERTEX_SHADER,e.vertexSrc),a=As(s,s.FRAGMENT_SHADER,e.fragmentSrc),h=s.createProgram();s.attachShader(h,i),s.attachShader(h,a);const u=(y=e.extra)==null?void 0:y.transformFeedbackVaryings;if(u&&(typeof s.transformFeedbackVaryings!="function"?console.warn("TransformFeedback is not supported but TransformFeedbackVaryings are given."):s.transformFeedbackVaryings(h,u.names,u.bufferMode==="separate"?s.SEPARATE_ATTRIBS:s.INTERLEAVED_ATTRIBS)),s.linkProgram(h),s.getProgramParameter(h,s.LINK_STATUS)||ws(s,h,i,a),e.attributeData=da(h,s),e.uniformData=Qn(h,s),!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(e.vertexSrc)){const E=Object.keys(e.attributeData);E.sort((D,Z)=>D>Z?1:-1);for(let D=0;D<E.length;D++)e.attributeData[E[D]].location=D,s.bindAttribLocation(h,D,E[D]);s.linkProgram(h)}s.deleteShader(i),s.deleteShader(a);const m={};for(const E in e.uniformData){const D=e.uniformData[E];m[E]={location:s.getUniformLocation(h,E),value:_n(D.type,D.size)}}return new gn(h,m)}function Ui(s,e,i,a,h){i.buffer.update(h)}const fa={float:`
        data[offset] = v;
    `,vec2:`
        data[offset] = v[0];
        data[offset+1] = v[1];
    `,vec3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

    `,vec4:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];
        data[offset+3] = v[3];
    `,mat2:`
        data[offset] = v[0];
        data[offset+1] = v[1];

        data[offset+4] = v[2];
        data[offset+5] = v[3];
    `,mat3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

        data[offset + 4] = v[3];
        data[offset + 5] = v[4];
        data[offset + 6] = v[5];

        data[offset + 8] = v[6];
        data[offset + 9] = v[7];
        data[offset + 10] = v[8];
    `,mat4:`
        for(var i = 0; i < 16; i++)
        {
            data[offset + i] = v[i];
        }
    `},pa={float:4,vec2:8,vec3:12,vec4:16,int:4,ivec2:8,ivec3:12,ivec4:16,uint:4,uvec2:8,uvec3:12,uvec4:16,bool:4,bvec2:8,bvec3:12,bvec4:16,mat2:16*2,mat3:16*3,mat4:16*4};function wa(s){const e=s.map(u=>({data:u,offset:0,dataLen:0,dirty:0}));let i=0,a=0,h=0;for(let u=0;u<e.length;u++){const m=e[u];if(i=pa[m.data.type],m.data.size>1&&(i=Math.max(i,16)*m.data.size),m.dataLen=i,a%i!==0&&a<16){const y=a%i%16;a+=y,h+=y}a+i>16?(h=Math.ceil(h/16)*16,m.offset=h,h+=i,a=i):(m.offset=h,a+=i,h+=i)}return h=Math.ceil(h/16)*16,{uboElements:e,size:h}}function Sa(s,e){const i=[];for(const a in s)e[a]&&i.push(e[a]);return i.sort((a,h)=>a.index-h.index),i}function Ia(s,e){if(!s.autoManage)return{size:0,syncFunc:Ui};const i=Sa(s.uniforms,e),{uboElements:a,size:h}=wa(i),u=[`
    var v = null;
    var v2 = null;
    var cv = null;
    var t = 0;
    var gl = renderer.gl
    var index = 0;
    var data = buffer.data;
    `];for(let m=0;m<a.length;m++){const y=a[m],E=s.uniforms[y.data.name],D=y.data.name;let Z=!1;for(let st=0;st<ur.length;st++){const yt=ur[st];if(yt.codeUbo&&yt.test(y.data,E)){u.push(`offset = ${y.offset/4};`,ur[st].codeUbo(y.data.name,E)),Z=!0;break}}if(!Z)if(y.data.size>1){const st=Ys(y.data.type),yt=Math.max(pa[y.data.type]/16,1),jt=st/yt,le=(4-jt%4)%4;u.push(`
                cv = ud.${D}.value;
                v = uv.${D};
                offset = ${y.offset/4};

                t = 0;

                for(var i=0; i < ${y.data.size*yt}; i++)
                {
                    for(var j = 0; j < ${jt}; j++)
                    {
                        data[offset++] = v[t++];
                    }
                    offset += ${le};
                }

                `)}else{const st=fa[y.data.type];u.push(`
                cv = ud.${D}.value;
                v = uv.${D};
                offset = ${y.offset/4};
                ${st};
                `)}}return u.push(`
       renderer.buffer.update(buffer);
    `),{size:h,syncFunc:new Function("ud","uv","renderer","syncData","buffer",u.join(`
`))}}let Is;function Ca(){if(typeof Is=="boolean")return Is;try{Is=new Function("param1","param2","param3","return param1[param2] === param3;")({a:"b"},"a","b")===!0}catch(s){Is=!1}return Is}let Ra=0;const xn={textureCount:0,uboCount:0};class ma{constructor(e){this.destroyed=!1,this.renderer=e,this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this._uboCache={},this.id=Ra++}systemCheck(){if(!Ca())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")}contextChange(e){this.gl=e,this.reset()}bind(e,i){e.disposeRunner.add(this),e.uniforms.globals=this.renderer.globalUniforms;const a=e.program,h=a.glPrograms[this.renderer.CONTEXT_UID]||this.generateProgram(e);return this.shader=e,this.program!==a&&(this.program=a,this.gl.useProgram(h.program)),i||(xn.textureCount=0,xn.uboCount=0,this.syncUniformGroup(e.uniformGroup,xn)),h}setUniforms(e){const i=this.shader.program,a=i.glPrograms[this.renderer.CONTEXT_UID];i.syncUniforms(a.uniformData,e,this.renderer)}syncUniformGroup(e,i){const a=this.getGlProgram();(!e.static||e.dirtyId!==a.uniformDirtyGroups[e.id])&&(a.uniformDirtyGroups[e.id]=e.dirtyId,this.syncUniforms(e,a,i))}syncUniforms(e,i,a){(e.syncUniforms[this.shader.program.id]||this.createSyncGroups(e))(i.uniformData,e.uniforms,this.renderer,a)}createSyncGroups(e){const i=this.getSignature(e,this.shader.program.uniformData,"u");return this.cache[i]||(this.cache[i]=ha(e,this.shader.program.uniformData)),e.syncUniforms[this.shader.program.id]=this.cache[i],e.syncUniforms[this.shader.program.id]}syncUniformBufferGroup(e,i){const a=this.getGlProgram();if(!e.static||e.dirtyId!==0||!a.uniformGroups[e.id]){e.dirtyId=0;const h=a.uniformGroups[e.id]||this.createSyncBufferGroup(e,a,i);e.buffer.update(),h(a.uniformData,e.uniforms,this.renderer,xn,e.buffer)}this.renderer.buffer.bindBufferBase(e.buffer,a.uniformBufferBindings[i])}createSyncBufferGroup(e,i,a){const{gl:h}=this.renderer;this.renderer.buffer.bind(e.buffer);const u=this.gl.getUniformBlockIndex(i.program,a);i.uniformBufferBindings[a]=this.shader.uniformBindCount,h.uniformBlockBinding(i.program,u,this.shader.uniformBindCount),this.shader.uniformBindCount++;const m=this.getSignature(e,this.shader.program.uniformData,"ubo");let y=this._uboCache[m];if(y||(y=this._uboCache[m]=Ia(e,this.shader.program.uniformData)),e.autoManage){const E=new Float32Array(y.size/4);e.buffer.update(E)}return i.uniformGroups[e.id]=y.syncFunc,i.uniformGroups[e.id]}getSignature(e,i,a){const h=e.uniforms,u=[`${a}-`];for(const m in h)u.push(m),i[m]&&u.push(i[m].type);return u.join("-")}getGlProgram(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null}generateProgram(e){const i=this.gl,a=e.program,h=Ss(i,a);return a.glPrograms[this.renderer.CONTEXT_UID]=h,h}reset(){this.program=null,this.shader=null}disposeShader(e){this.shader===e&&(this.shader=null)}destroy(){this.renderer=null,this.destroyed=!0}}ma.extension={type:Zt.RendererSystem,name:"shader"},re.add(ma);class vn{constructor(e){this.renderer=e}run(e){const{renderer:i}=this;i.runners.init.emit(i.options),e.hello&&console.log(`PixiJS 7.3.2 - ${i.rendererLogId} - https://pixijs.com`),i.resize(i.screen.width,i.screen.height)}destroy(){}}vn.defaultOptions={hello:!1},vn.extension={type:[Zt.RendererSystem,Zt.CanvasRendererSystem],name:"startup"},re.add(vn);function d(s,e=[]){return e[Y.NORMAL]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],e[Y.ADD]=[s.ONE,s.ONE],e[Y.MULTIPLY]=[s.DST_COLOR,s.ONE_MINUS_SRC_ALPHA,s.ONE,s.ONE_MINUS_SRC_ALPHA],e[Y.SCREEN]=[s.ONE,s.ONE_MINUS_SRC_COLOR,s.ONE,s.ONE_MINUS_SRC_ALPHA],e[Y.OVERLAY]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],e[Y.DARKEN]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],e[Y.LIGHTEN]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],e[Y.COLOR_DODGE]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],e[Y.COLOR_BURN]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],e[Y.HARD_LIGHT]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],e[Y.SOFT_LIGHT]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],e[Y.DIFFERENCE]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],e[Y.EXCLUSION]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],e[Y.HUE]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],e[Y.SATURATION]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],e[Y.COLOR]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],e[Y.LUMINOSITY]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],e[Y.NONE]=[0,0],e[Y.NORMAL_NPM]=[s.SRC_ALPHA,s.ONE_MINUS_SRC_ALPHA,s.ONE,s.ONE_MINUS_SRC_ALPHA],e[Y.ADD_NPM]=[s.SRC_ALPHA,s.ONE,s.ONE,s.ONE],e[Y.SCREEN_NPM]=[s.SRC_ALPHA,s.ONE_MINUS_SRC_COLOR,s.ONE,s.ONE_MINUS_SRC_ALPHA],e[Y.SRC_IN]=[s.DST_ALPHA,s.ZERO],e[Y.SRC_OUT]=[s.ONE_MINUS_DST_ALPHA,s.ZERO],e[Y.SRC_ATOP]=[s.DST_ALPHA,s.ONE_MINUS_SRC_ALPHA],e[Y.DST_OVER]=[s.ONE_MINUS_DST_ALPHA,s.ONE],e[Y.DST_IN]=[s.ZERO,s.SRC_ALPHA],e[Y.DST_OUT]=[s.ZERO,s.ONE_MINUS_SRC_ALPHA],e[Y.DST_ATOP]=[s.ONE_MINUS_DST_ALPHA,s.SRC_ALPHA],e[Y.XOR]=[s.ONE_MINUS_DST_ALPHA,s.ONE_MINUS_SRC_ALPHA],e[Y.SUBTRACT]=[s.ONE,s.ONE,s.ONE,s.ONE,s.FUNC_REVERSE_SUBTRACT,s.FUNC_ADD],e}const t=0,r=1,n=2,o=3,l=4,c=5,p=class ea{constructor(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=Y.NONE,this._blendEq=!1,this.map=[],this.map[t]=this.setBlend,this.map[r]=this.setOffset,this.map[n]=this.setCullFace,this.map[o]=this.setDepthTest,this.map[l]=this.setFrontFace,this.map[c]=this.setDepthMask,this.checks=[],this.defaultState=new br,this.defaultState.blend=!0}contextChange(e){this.gl=e,this.blendModes=d(e),this.set(this.defaultState),this.reset()}set(e){if(e=e||this.defaultState,this.stateId!==e.data){let i=this.stateId^e.data,a=0;for(;i;)i&1&&this.map[a].call(this,!!(e.data&1<<a)),i=i>>1,a++;this.stateId=e.data}for(let i=0;i<this.checks.length;i++)this.checks[i](this,e)}forceState(e){e=e||this.defaultState;for(let i=0;i<this.map.length;i++)this.map[i].call(this,!!(e.data&1<<i));for(let i=0;i<this.checks.length;i++)this.checks[i](this,e);this.stateId=e.data}setBlend(e){this.updateCheck(ea.checkBlendMode,e),this.gl[e?"enable":"disable"](this.gl.BLEND)}setOffset(e){this.updateCheck(ea.checkPolygonOffset,e),this.gl[e?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)}setDepthTest(e){this.gl[e?"enable":"disable"](this.gl.DEPTH_TEST)}setDepthMask(e){this.gl.depthMask(e)}setCullFace(e){this.gl[e?"enable":"disable"](this.gl.CULL_FACE)}setFrontFace(e){this.gl.frontFace(this.gl[e?"CW":"CCW"])}setBlendMode(e){if(e===this.blendMode)return;this.blendMode=e;const i=this.blendModes[e],a=this.gl;i.length===2?a.blendFunc(i[0],i[1]):a.blendFuncSeparate(i[0],i[1],i[2],i[3]),i.length===6?(this._blendEq=!0,a.blendEquationSeparate(i[4],i[5])):this._blendEq&&(this._blendEq=!1,a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD))}setPolygonOffset(e,i){this.gl.polygonOffset(e,i)}reset(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)}updateCheck(e,i){const a=this.checks.indexOf(e);i&&a===-1?this.checks.push(e):!i&&a!==-1&&this.checks.splice(a,1)}static checkBlendMode(e,i){e.setBlendMode(i.blendMode)}static checkPolygonOffset(e,i){e.setPolygonOffset(1,i.polygonOffset)}destroy(){this.gl=null}};p.extension={type:Zt.RendererSystem,name:"state"};let g=p;re.add(g);class _ extends Mt{constructor(){super(...arguments),this.runners={},this._systemsHash={}}setup(e){var h;this.addRunners(...e.runners);const i=((h=e.priority)!=null?h:[]).filter(u=>e.systems[u]),a=[...i,...Object.keys(e.systems).filter(u=>!i.includes(u))];for(const u of a)this.addSystem(e.systems[u],u)}addRunners(...e){e.forEach(i=>{this.runners[i]=new ye(i)})}addSystem(e,i){const a=new e(this);if(this[i])throw new Error(`Whoops! The name "${i}" is already in use`);this[i]=a,this._systemsHash[i]=a;for(const h in this.runners)this.runners[h].add(a);return this}emitWithCustomOptions(e,i){const a=Object.keys(this._systemsHash);e.items.forEach(h=>{const u=a.find(m=>this._systemsHash[m]===h);h[e.name](i[u])})}destroy(){Object.values(this.runners).forEach(e=>{e.destroy()}),this._systemsHash={}}}const x=class An{constructor(e){this.renderer=e,this.count=0,this.checkCount=0,this.maxIdle=An.defaultMaxIdle,this.checkCountMax=An.defaultCheckCountMax,this.mode=An.defaultMode}postrender(){this.renderer.objectRenderer.renderingToScreen&&(this.count++,this.mode!==it.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))}run(){const e=this.renderer.texture,i=e.managedTextures;let a=!1;for(let h=0;h<i.length;h++){const u=i[h];u.resource&&this.count-u.touched>this.maxIdle&&(e.destroyTexture(u,!0),i[h]=null,a=!0)}if(a){let h=0;for(let u=0;u<i.length;u++)i[u]!==null&&(i[h++]=i[u]);i.length=h}}unload(e){const i=this.renderer.texture,a=e._texture;a&&!a.framebuffer&&i.destroyTexture(a);for(let h=e.children.length-1;h>=0;h--)this.unload(e.children[h])}destroy(){this.renderer=null}};x.defaultMode=it.AUTO,x.defaultMaxIdle=60*60,x.defaultCheckCountMax=60*10,x.extension={type:Zt.RendererSystem,name:"textureGC"};let v=x;re.add(v);class T{constructor(e){this.texture=e,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=V.UNSIGNED_BYTE,this.internalFormat=O.RGBA,this.samplerType=0}}function b(s){let e;return"WebGL2RenderingContext"in globalThis&&s instanceof globalThis.WebGL2RenderingContext?e={[s.RGB]:F.FLOAT,[s.RGBA]:F.FLOAT,[s.ALPHA]:F.FLOAT,[s.LUMINANCE]:F.FLOAT,[s.LUMINANCE_ALPHA]:F.FLOAT,[s.R8]:F.FLOAT,[s.R8_SNORM]:F.FLOAT,[s.RG8]:F.FLOAT,[s.RG8_SNORM]:F.FLOAT,[s.RGB8]:F.FLOAT,[s.RGB8_SNORM]:F.FLOAT,[s.RGB565]:F.FLOAT,[s.RGBA4]:F.FLOAT,[s.RGB5_A1]:F.FLOAT,[s.RGBA8]:F.FLOAT,[s.RGBA8_SNORM]:F.FLOAT,[s.RGB10_A2]:F.FLOAT,[s.RGB10_A2UI]:F.FLOAT,[s.SRGB8]:F.FLOAT,[s.SRGB8_ALPHA8]:F.FLOAT,[s.R16F]:F.FLOAT,[s.RG16F]:F.FLOAT,[s.RGB16F]:F.FLOAT,[s.RGBA16F]:F.FLOAT,[s.R32F]:F.FLOAT,[s.RG32F]:F.FLOAT,[s.RGB32F]:F.FLOAT,[s.RGBA32F]:F.FLOAT,[s.R11F_G11F_B10F]:F.FLOAT,[s.RGB9_E5]:F.FLOAT,[s.R8I]:F.INT,[s.R8UI]:F.UINT,[s.R16I]:F.INT,[s.R16UI]:F.UINT,[s.R32I]:F.INT,[s.R32UI]:F.UINT,[s.RG8I]:F.INT,[s.RG8UI]:F.UINT,[s.RG16I]:F.INT,[s.RG16UI]:F.UINT,[s.RG32I]:F.INT,[s.RG32UI]:F.UINT,[s.RGB8I]:F.INT,[s.RGB8UI]:F.UINT,[s.RGB16I]:F.INT,[s.RGB16UI]:F.UINT,[s.RGB32I]:F.INT,[s.RGB32UI]:F.UINT,[s.RGBA8I]:F.INT,[s.RGBA8UI]:F.UINT,[s.RGBA16I]:F.INT,[s.RGBA16UI]:F.UINT,[s.RGBA32I]:F.INT,[s.RGBA32UI]:F.UINT,[s.DEPTH_COMPONENT16]:F.FLOAT,[s.DEPTH_COMPONENT24]:F.FLOAT,[s.DEPTH_COMPONENT32F]:F.FLOAT,[s.DEPTH_STENCIL]:F.FLOAT,[s.DEPTH24_STENCIL8]:F.FLOAT,[s.DEPTH32F_STENCIL8]:F.FLOAT}:e={[s.RGB]:F.FLOAT,[s.RGBA]:F.FLOAT,[s.ALPHA]:F.FLOAT,[s.LUMINANCE]:F.FLOAT,[s.LUMINANCE_ALPHA]:F.FLOAT,[s.DEPTH_STENCIL]:F.FLOAT},e}function w(s){let e;return"WebGL2RenderingContext"in globalThis&&s instanceof globalThis.WebGL2RenderingContext?e={[V.UNSIGNED_BYTE]:{[O.RGBA]:s.RGBA8,[O.RGB]:s.RGB8,[O.RG]:s.RG8,[O.RED]:s.R8,[O.RGBA_INTEGER]:s.RGBA8UI,[O.RGB_INTEGER]:s.RGB8UI,[O.RG_INTEGER]:s.RG8UI,[O.RED_INTEGER]:s.R8UI,[O.ALPHA]:s.ALPHA,[O.LUMINANCE]:s.LUMINANCE,[O.LUMINANCE_ALPHA]:s.LUMINANCE_ALPHA},[V.BYTE]:{[O.RGBA]:s.RGBA8_SNORM,[O.RGB]:s.RGB8_SNORM,[O.RG]:s.RG8_SNORM,[O.RED]:s.R8_SNORM,[O.RGBA_INTEGER]:s.RGBA8I,[O.RGB_INTEGER]:s.RGB8I,[O.RG_INTEGER]:s.RG8I,[O.RED_INTEGER]:s.R8I},[V.UNSIGNED_SHORT]:{[O.RGBA_INTEGER]:s.RGBA16UI,[O.RGB_INTEGER]:s.RGB16UI,[O.RG_INTEGER]:s.RG16UI,[O.RED_INTEGER]:s.R16UI,[O.DEPTH_COMPONENT]:s.DEPTH_COMPONENT16},[V.SHORT]:{[O.RGBA_INTEGER]:s.RGBA16I,[O.RGB_INTEGER]:s.RGB16I,[O.RG_INTEGER]:s.RG16I,[O.RED_INTEGER]:s.R16I},[V.UNSIGNED_INT]:{[O.RGBA_INTEGER]:s.RGBA32UI,[O.RGB_INTEGER]:s.RGB32UI,[O.RG_INTEGER]:s.RG32UI,[O.RED_INTEGER]:s.R32UI,[O.DEPTH_COMPONENT]:s.DEPTH_COMPONENT24},[V.INT]:{[O.RGBA_INTEGER]:s.RGBA32I,[O.RGB_INTEGER]:s.RGB32I,[O.RG_INTEGER]:s.RG32I,[O.RED_INTEGER]:s.R32I},[V.FLOAT]:{[O.RGBA]:s.RGBA32F,[O.RGB]:s.RGB32F,[O.RG]:s.RG32F,[O.RED]:s.R32F,[O.DEPTH_COMPONENT]:s.DEPTH_COMPONENT32F},[V.HALF_FLOAT]:{[O.RGBA]:s.RGBA16F,[O.RGB]:s.RGB16F,[O.RG]:s.RG16F,[O.RED]:s.R16F},[V.UNSIGNED_SHORT_5_6_5]:{[O.RGB]:s.RGB565},[V.UNSIGNED_SHORT_4_4_4_4]:{[O.RGBA]:s.RGBA4},[V.UNSIGNED_SHORT_5_5_5_1]:{[O.RGBA]:s.RGB5_A1},[V.UNSIGNED_INT_2_10_10_10_REV]:{[O.RGBA]:s.RGB10_A2,[O.RGBA_INTEGER]:s.RGB10_A2UI},[V.UNSIGNED_INT_10F_11F_11F_REV]:{[O.RGB]:s.R11F_G11F_B10F},[V.UNSIGNED_INT_5_9_9_9_REV]:{[O.RGB]:s.RGB9_E5},[V.UNSIGNED_INT_24_8]:{[O.DEPTH_STENCIL]:s.DEPTH24_STENCIL8},[V.FLOAT_32_UNSIGNED_INT_24_8_REV]:{[O.DEPTH_STENCIL]:s.DEPTH32F_STENCIL8}}:e={[V.UNSIGNED_BYTE]:{[O.RGBA]:s.RGBA,[O.RGB]:s.RGB,[O.ALPHA]:s.ALPHA,[O.LUMINANCE]:s.LUMINANCE,[O.LUMINANCE_ALPHA]:s.LUMINANCE_ALPHA},[V.UNSIGNED_SHORT_5_6_5]:{[O.RGB]:s.RGB},[V.UNSIGNED_SHORT_4_4_4_4]:{[O.RGBA]:s.RGBA},[V.UNSIGNED_SHORT_5_5_5_1]:{[O.RGBA]:s.RGBA}},e}class R{constructor(e){this.renderer=e,this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new se,this.hasIntegerTextures=!1}contextChange(){const e=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion,this.internalFormats=w(e),this.samplerTypes=b(e);const i=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=i;for(let h=0;h<i;h++)this.boundTextures[h]=null;this.emptyTextures={};const a=new T(e.createTexture());e.bindTexture(e.TEXTURE_2D,a.texture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[e.TEXTURE_2D]=a,this.emptyTextures[e.TEXTURE_CUBE_MAP]=new T(e.createTexture()),e.bindTexture(e.TEXTURE_CUBE_MAP,this.emptyTextures[e.TEXTURE_CUBE_MAP].texture);for(let h=0;h<6;h++)e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+h,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,null);e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MIN_FILTER,e.LINEAR);for(let h=0;h<this.boundTextures.length;h++)this.bind(null,h)}bind(e,i=0){const{gl:a}=this;if(e=e==null?void 0:e.castToBaseTexture(),(e==null?void 0:e.valid)&&!e.parentTextureArray){e.touched=this.renderer.textureGC.count;const h=e._glTextures[this.CONTEXT_UID]||this.initTexture(e);this.boundTextures[i]!==e&&(this.currentLocation!==i&&(this.currentLocation=i,a.activeTexture(a.TEXTURE0+i)),a.bindTexture(e.target,h.texture)),h.dirtyId!==e.dirtyId?(this.currentLocation!==i&&(this.currentLocation=i,a.activeTexture(a.TEXTURE0+i)),this.updateTexture(e)):h.dirtyStyleId!==e.dirtyStyleId&&this.updateTextureStyle(e),this.boundTextures[i]=e}else this.currentLocation!==i&&(this.currentLocation=i,a.activeTexture(a.TEXTURE0+i)),a.bindTexture(a.TEXTURE_2D,this.emptyTextures[a.TEXTURE_2D].texture),this.boundTextures[i]=null}reset(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(let e=0;e<this.boundTextures.length;e++)this.boundTextures[e]=this.unknownTexture}unbind(e){const{gl:i,boundTextures:a}=this;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(let h=0;h<a.length;h++)a[h]===this.unknownTexture&&this.bind(null,h)}for(let h=0;h<a.length;h++)a[h]===e&&(this.currentLocation!==h&&(i.activeTexture(i.TEXTURE0+h),this.currentLocation=h),i.bindTexture(e.target,this.emptyTextures[e.target].texture),a[h]=null)}ensureSamplerType(e){const{boundTextures:i,hasIntegerTextures:a,CONTEXT_UID:h}=this;if(a)for(let u=e-1;u>=0;--u){const m=i[u];m&&m._glTextures[h].samplerType!==F.FLOAT&&this.renderer.texture.unbind(m)}}initTexture(e){const i=new T(this.gl.createTexture());return i.dirtyId=-1,e._glTextures[this.CONTEXT_UID]=i,this.managedTextures.push(e),e.on("dispose",this.destroyTexture,this),i}initTextureType(e,i){var a,h,u;i.internalFormat=(h=(a=this.internalFormats[e.type])==null?void 0:a[e.format])!=null?h:e.format,i.samplerType=(u=this.samplerTypes[i.internalFormat])!=null?u:F.FLOAT,this.webGLVersion===2&&e.type===V.HALF_FLOAT?i.type=this.gl.HALF_FLOAT:i.type=e.type}updateTexture(e){var h;const i=e._glTextures[this.CONTEXT_UID];if(!i)return;const a=this.renderer;if(this.initTextureType(e,i),(h=e.resource)==null?void 0:h.upload(a,e,i))i.samplerType!==F.FLOAT&&(this.hasIntegerTextures=!0);else{const u=e.realWidth,m=e.realHeight,y=a.gl;(i.width!==u||i.height!==m||i.dirtyId<0)&&(i.width=u,i.height=m,y.texImage2D(e.target,0,i.internalFormat,u,m,0,e.format,i.type,null))}e.dirtyStyleId!==i.dirtyStyleId&&this.updateTextureStyle(e),i.dirtyId=e.dirtyId}destroyTexture(e,i){const{gl:a}=this;if(e=e.castToBaseTexture(),e._glTextures[this.CONTEXT_UID]&&(this.unbind(e),a.deleteTexture(e._glTextures[this.CONTEXT_UID].texture),e.off("dispose",this.destroyTexture,this),delete e._glTextures[this.CONTEXT_UID],!i)){const h=this.managedTextures.indexOf(e);h!==-1&&Ls(this.managedTextures,h,1)}}updateTextureStyle(e){var a;const i=e._glTextures[this.CONTEXT_UID];i&&((e.mipmap===pt.POW2||this.webGLVersion!==2)&&!e.isPowerOfTwo?i.mipmap=!1:i.mipmap=e.mipmap>=1,this.webGLVersion!==2&&!e.isPowerOfTwo?i.wrapMode=ft.CLAMP:i.wrapMode=e.wrapMode,(a=e.resource)!=null&&a.style(this.renderer,e,i)||this.setStyle(e,i),i.dirtyStyleId=e.dirtyStyleId)}setStyle(e,i){const a=this.gl;if(i.mipmap&&e.mipmap!==pt.ON_MANUAL&&a.generateMipmap(e.target),a.texParameteri(e.target,a.TEXTURE_WRAP_S,i.wrapMode),a.texParameteri(e.target,a.TEXTURE_WRAP_T,i.wrapMode),i.mipmap){a.texParameteri(e.target,a.TEXTURE_MIN_FILTER,e.scaleMode===q.LINEAR?a.LINEAR_MIPMAP_LINEAR:a.NEAREST_MIPMAP_NEAREST);const h=this.renderer.context.extensions.anisotropicFiltering;if(h&&e.anisotropicLevel>0&&e.scaleMode===q.LINEAR){const u=Math.min(e.anisotropicLevel,a.getParameter(h.MAX_TEXTURE_MAX_ANISOTROPY_EXT));a.texParameterf(e.target,h.TEXTURE_MAX_ANISOTROPY_EXT,u)}}else a.texParameteri(e.target,a.TEXTURE_MIN_FILTER,e.scaleMode===q.LINEAR?a.LINEAR:a.NEAREST);a.texParameteri(e.target,a.TEXTURE_MAG_FILTER,e.scaleMode===q.LINEAR?a.LINEAR:a.NEAREST)}destroy(){this.renderer=null}}R.extension={type:Zt.RendererSystem,name:"texture"},re.add(R);class k{constructor(e){this.renderer=e}contextChange(){this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(e){const{gl:i,CONTEXT_UID:a}=this,h=e._glTransformFeedbacks[a]||this.createGLTransformFeedback(e);i.bindTransformFeedback(i.TRANSFORM_FEEDBACK,h)}unbind(){const{gl:e}=this;e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,null)}beginTransformFeedback(e,i){const{gl:a,renderer:h}=this;i&&h.shader.bind(i),a.beginTransformFeedback(e)}endTransformFeedback(){const{gl:e}=this;e.endTransformFeedback()}createGLTransformFeedback(e){const{gl:i,renderer:a,CONTEXT_UID:h}=this,u=i.createTransformFeedback();e._glTransformFeedbacks[h]=u,i.bindTransformFeedback(i.TRANSFORM_FEEDBACK,u);for(let m=0;m<e.buffers.length;m++){const y=e.buffers[m];y&&(a.buffer.update(y),y._glBuffers[h].refCount++,i.bindBufferBase(i.TRANSFORM_FEEDBACK_BUFFER,m,y._glBuffers[h].buffer||null))}return i.bindTransformFeedback(i.TRANSFORM_FEEDBACK,null),e.disposeRunner.add(this),u}disposeTransformFeedback(e,i){const a=e._glTransformFeedbacks[this.CONTEXT_UID],h=this.gl;e.disposeRunner.remove(this);const u=this.renderer.buffer;if(u)for(let m=0;m<e.buffers.length;m++){const y=e.buffers[m];if(!y)continue;const E=y._glBuffers[this.CONTEXT_UID];E&&(E.refCount--,E.refCount===0&&!i&&u.dispose(y,i))}a&&(i||h.deleteTransformFeedback(a),delete e._glTransformFeedbacks[this.CONTEXT_UID])}destroy(){this.renderer=null}}k.extension={type:Zt.RendererSystem,name:"transformFeedback"},re.add(k);class L{constructor(e){this.renderer=e}init(e){this.screen=new ie(0,0,e.width,e.height),this.element=e.view||P.ADAPTER.createCanvas(),this.resolution=e.resolution||P.RESOLUTION,this.autoDensity=!!e.autoDensity}resizeView(e,i){this.element.width=Math.round(e*this.resolution),this.element.height=Math.round(i*this.resolution);const a=this.element.width/this.resolution,h=this.element.height/this.resolution;this.screen.width=a,this.screen.height=h,this.autoDensity&&(this.element.style.width=`${a}px`,this.element.style.height=`${h}px`),this.renderer.emit("resize",a,h),this.renderer.runners.resize.emit(this.screen.width,this.screen.height)}destroy(e){var i;e&&((i=this.element.parentNode)==null||i.removeChild(this.element)),this.renderer=null,this.element=null,this.screen=null}}L.defaultOptions={width:800,height:600,resolution:void 0,autoDensity:!1},L.extension={type:[Zt.RendererSystem,Zt.CanvasRendererSystem],name:"_view"},re.add(L),P.PREFER_ENV=ut.WEBGL2,P.STRICT_TEXTURE_CACHE=!1,P.RENDER_OPTIONS=fe(fe(fe(fe({},Bi.defaultOptions),Mi.defaultOptions),L.defaultOptions),vn.defaultOptions),Object.defineProperties(P,{WRAP_MODE:{get(){return se.defaultOptions.wrapMode},set(s){Et("7.1.0","settings.WRAP_MODE is deprecated, use BaseTexture.defaultOptions.wrapMode"),se.defaultOptions.wrapMode=s}},SCALE_MODE:{get(){return se.defaultOptions.scaleMode},set(s){Et("7.1.0","settings.SCALE_MODE is deprecated, use BaseTexture.defaultOptions.scaleMode"),se.defaultOptions.scaleMode=s}},MIPMAP_TEXTURES:{get(){return se.defaultOptions.mipmap},set(s){Et("7.1.0","settings.MIPMAP_TEXTURES is deprecated, use BaseTexture.defaultOptions.mipmap"),se.defaultOptions.mipmap=s}},ANISOTROPIC_LEVEL:{get(){return se.defaultOptions.anisotropicLevel},set(s){Et("7.1.0","settings.ANISOTROPIC_LEVEL is deprecated, use BaseTexture.defaultOptions.anisotropicLevel"),se.defaultOptions.anisotropicLevel=s}},FILTER_RESOLUTION:{get(){return Et("7.1.0","settings.FILTER_RESOLUTION is deprecated, use Filter.defaultResolution"),rr.defaultResolution},set(s){rr.defaultResolution=s}},FILTER_MULTISAMPLE:{get(){return Et("7.1.0","settings.FILTER_MULTISAMPLE is deprecated, use Filter.defaultMultisample"),rr.defaultMultisample},set(s){rr.defaultMultisample=s}},SPRITE_MAX_TEXTURES:{get(){return fr.defaultMaxTextures},set(s){Et("7.1.0","settings.SPRITE_MAX_TEXTURES is deprecated, use BatchRenderer.defaultMaxTextures"),fr.defaultMaxTextures=s}},SPRITE_BATCH_SIZE:{get(){return fr.defaultBatchSize},set(s){Et("7.1.0","settings.SPRITE_BATCH_SIZE is deprecated, use BatchRenderer.defaultBatchSize"),fr.defaultBatchSize=s}},CAN_UPLOAD_SAME_BUFFER:{get(){return fr.canUploadSameBuffer},set(s){Et("7.1.0","settings.CAN_UPLOAD_SAME_BUFFER is deprecated, use BatchRenderer.canUploadSameBuffer"),fr.canUploadSameBuffer=s}},GC_MODE:{get(){return v.defaultMode},set(s){Et("7.1.0","settings.GC_MODE is deprecated, use TextureGCSystem.defaultMode"),v.defaultMode=s}},GC_MAX_IDLE:{get(){return v.defaultMaxIdle},set(s){Et("7.1.0","settings.GC_MAX_IDLE is deprecated, use TextureGCSystem.defaultMaxIdle"),v.defaultMaxIdle=s}},GC_MAX_CHECK_COUNT:{get(){return v.defaultCheckCountMax},set(s){Et("7.1.0","settings.GC_MAX_CHECK_COUNT is deprecated, use TextureGCSystem.defaultCheckCountMax"),v.defaultCheckCountMax=s}},PRECISION_VERTEX:{get(){return Cr.defaultVertexPrecision},set(s){Et("7.1.0","settings.PRECISION_VERTEX is deprecated, use Program.defaultVertexPrecision"),Cr.defaultVertexPrecision=s}},PRECISION_FRAGMENT:{get(){return Cr.defaultFragmentPrecision},set(s){Et("7.1.0","settings.PRECISION_FRAGMENT is deprecated, use Program.defaultFragmentPrecision"),Cr.defaultFragmentPrecision=s}}});var nt=(s=>(s[s.INTERACTION=50]="INTERACTION",s[s.HIGH=25]="HIGH",s[s.NORMAL=0]="NORMAL",s[s.LOW=-25]="LOW",s[s.UTILITY=-50]="UTILITY",s))(nt||{});class ${constructor(e,i=null,a=0,h=!1){this.next=null,this.previous=null,this._destroyed=!1,this.fn=e,this.context=i,this.priority=a,this.once=h}match(e,i=null){return this.fn===e&&this.context===i}emit(e){this.fn&&(this.context?this.fn.call(this.context,e):this.fn(e));const i=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),i}connect(e){this.previous=e,e.next&&(e.next.previous=this),this.next=e.next,e.next=this}destroy(e=!1){this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);const i=this.next;return this.next=e?null:i,this.previous=null,i}}const tt=class Ge{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new $(null,null,1/0),this.deltaMS=1/Ge.targetFPMS,this.elapsedMS=1/Ge.targetFPMS,this._tick=e=>{this._requestId=null,this.started&&(this.update(e),this.started&&this._requestId===null&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){this._requestId===null&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){this._requestId!==null&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(e,i,a=nt.NORMAL){return this._addListener(new $(e,i,a))}addOnce(e,i,a=nt.NORMAL){return this._addListener(new $(e,i,a,!0))}_addListener(e){let i=this._head.next,a=this._head;if(!i)e.connect(a);else{for(;i;){if(e.priority>i.priority){e.connect(a);break}a=i,i=i.next}e.previous||e.connect(a)}return this._startIfPossible(),this}remove(e,i){let a=this._head.next;for(;a;)a.match(e,i)?a=a.destroy():a=a.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let e=0,i=this._head;for(;i=i.next;)e++;return e}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let e=this._head.next;for(;e;)e=e.destroy(!0);this._head.destroy(),this._head=null}}update(e=performance.now()){let i;if(e>this.lastTime){if(i=this.elapsedMS=e-this.lastTime,i>this._maxElapsedMS&&(i=this._maxElapsedMS),i*=this.speed,this._minElapsedMS){const u=e-this._lastFrame|0;if(u<this._minElapsedMS)return;this._lastFrame=e-u%this._minElapsedMS}this.deltaMS=i,this.deltaTime=this.deltaMS*Ge.targetFPMS;const a=this._head;let h=a.next;for(;h;)h=h.emit(this.deltaTime);a.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=e}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(e){const i=Math.min(this.maxFPS,e),a=Math.min(Math.max(0,i)/1e3,Ge.targetFPMS);this._maxElapsedMS=1/a}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(e){if(e===0)this._minElapsedMS=0;else{const i=Math.max(this.minFPS,e);this._minElapsedMS=1/(i/1e3)}}static get shared(){if(!Ge._shared){const e=Ge._shared=new Ge;e.autoStart=!0,e._protected=!0}return Ge._shared}static get system(){if(!Ge._system){const e=Ge._system=new Ge;e.autoStart=!0,e._protected=!0}return Ge._system}};tt.targetFPMS=.06;let St=tt;Object.defineProperties(P,{TARGET_FPMS:{get(){return St.targetFPMS},set(s){Et("7.1.0","settings.TARGET_FPMS is deprecated, use Ticker.targetFPMS"),St.targetFPMS=s}}});class Wt{static init(e){e=Object.assign({autoStart:!0,sharedTicker:!1},e),Object.defineProperty(this,"ticker",{set(i){this._ticker&&this._ticker.remove(this.render,this),this._ticker=i,i&&i.add(this.render,this,nt.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=e.sharedTicker?St.shared:new St,e.autoStart&&this.start()}static destroy(){if(this._ticker){const e=this._ticker;this.ticker=null,e.destroy()}}}Wt.extension=Zt.Application,re.add(Wt);const Ct=[];re.handleByList(Zt.Renderer,Ct);function It(s){for(const e of Ct)if(e.test(s))return new e(s);throw new Error("Unable to auto-detect a suitable renderer.")}var Xt=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,zt=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;const he=Xt,Bt=zt;class et{constructor(e){this.renderer=e}contextChange(e){let i;if(this.renderer.context.webGLVersion===1){const a=e.getParameter(e.FRAMEBUFFER_BINDING);e.bindFramebuffer(e.FRAMEBUFFER,null),i=e.getParameter(e.SAMPLES),e.bindFramebuffer(e.FRAMEBUFFER,a)}else{const a=e.getParameter(e.DRAW_FRAMEBUFFER_BINDING);e.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),i=e.getParameter(e.SAMPLES),e.bindFramebuffer(e.DRAW_FRAMEBUFFER,a)}i>=rt.HIGH?this.multisample=rt.HIGH:i>=rt.MEDIUM?this.multisample=rt.MEDIUM:i>=rt.LOW?this.multisample=rt.LOW:this.multisample=rt.NONE}destroy(){}}et.extension={type:Zt.RendererSystem,name:"_multisample"},re.add(et);class At{constructor(e){this.buffer=e||null,this.updateID=-1,this.byteLength=-1,this.refCount=0}}class Vt{constructor(e){this.renderer=e,this.managedBuffers={},this.boundBufferBases={}}destroy(){this.renderer=null}contextChange(){this.disposeAll(!0),this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(e){const{gl:i,CONTEXT_UID:a}=this,h=e._glBuffers[a]||this.createGLBuffer(e);i.bindBuffer(e.type,h.buffer)}unbind(e){const{gl:i}=this;i.bindBuffer(e,null)}bindBufferBase(e,i){const{gl:a,CONTEXT_UID:h}=this;if(this.boundBufferBases[i]!==e){const u=e._glBuffers[h]||this.createGLBuffer(e);this.boundBufferBases[i]=e,a.bindBufferBase(a.UNIFORM_BUFFER,i,u.buffer)}}bindBufferRange(e,i,a){const{gl:h,CONTEXT_UID:u}=this;a=a||0;const m=e._glBuffers[u]||this.createGLBuffer(e);h.bindBufferRange(h.UNIFORM_BUFFER,i||0,m.buffer,a*256,256)}update(e){const{gl:i,CONTEXT_UID:a}=this,h=e._glBuffers[a]||this.createGLBuffer(e);if(e._updateID!==h.updateID)if(h.updateID=e._updateID,i.bindBuffer(e.type,h.buffer),h.byteLength>=e.data.byteLength)i.bufferSubData(e.type,0,e.data);else{const u=e.static?i.STATIC_DRAW:i.DYNAMIC_DRAW;h.byteLength=e.data.byteLength,i.bufferData(e.type,e.data,u)}}dispose(e,i){if(!this.managedBuffers[e.id])return;delete this.managedBuffers[e.id];const a=e._glBuffers[this.CONTEXT_UID],h=this.gl;e.disposeRunner.remove(this),a&&(i||h.deleteBuffer(a.buffer),delete e._glBuffers[this.CONTEXT_UID])}disposeAll(e){const i=Object.keys(this.managedBuffers);for(let a=0;a<i.length;a++)this.dispose(this.managedBuffers[i[a]],e)}createGLBuffer(e){const{CONTEXT_UID:i,gl:a}=this;return e._glBuffers[i]=new At(a.createBuffer()),this.managedBuffers[e.id]=e,e.disposeRunner.add(this),e._glBuffers[i]}}Vt.extension={type:Zt.RendererSystem,name:"buffer"},re.add(Vt);class te{constructor(e){this.renderer=e}render(e,i){const a=this.renderer;let h,u,m,y;if(i&&(h=i.renderTexture,u=i.clear,m=i.transform,y=i.skipUpdateTransform),this.renderingToScreen=!h,a.runners.prerender.emit(),a.emit("prerender"),a.projection.transform=m,!a.context.isLost){if(h||(this.lastObjectRendered=e),!y){const E=e.enableTempParent();e.updateTransform(),e.disableTempParent(E)}a.renderTexture.bind(h),a.batch.currentRenderer.start(),(u!=null?u:a.background.clearBeforeRender)&&a.renderTexture.clear(),e.render(a),a.batch.currentRenderer.flush(),h&&(i.blit&&a.framebuffer.blit(),h.baseTexture.update()),a.runners.postrender.emit(),a.projection.transform=null,a.emit("postrender")}}destroy(){this.renderer=null,this.lastObjectRendered=null}}te.extension={type:Zt.RendererSystem,name:"objectRenderer"},re.add(te);const kt=class ra extends _{constructor(e){super(),this.type=at.WEBGL,e=Object.assign({},P.RENDER_OPTIONS,e),this.gl=null,this.CONTEXT_UID=0,this.globalUniforms=new je({projectionMatrix:new de},!0);const i={runners:["init","destroy","contextChange","resolutionChange","reset","update","postrender","prerender","resize"],systems:ra.__systems,priority:["_view","textureGenerator","background","_plugin","startup","context","state","texture","buffer","geometry","framebuffer","transformFeedback","mask","scissor","stencil","projection","textureGC","filter","renderTexture","batch","objectRenderer","_multisample"]};this.setup(i),"useContextAlpha"in e&&(Et("7.0.0","options.useContextAlpha is deprecated, use options.premultipliedAlpha and options.backgroundAlpha instead"),e.premultipliedAlpha=e.useContextAlpha&&e.useContextAlpha!=="notMultiplied",e.backgroundAlpha=e.useContextAlpha===!1?1:e.backgroundAlpha),this._plugin.rendererPlugins=ra.__plugins,this.options=e,this.startup.run(this.options)}static test(e){return e!=null&&e.forceCanvas?!1:Kr()}render(e,i){this.objectRenderer.render(e,i)}resize(e,i){this._view.resizeView(e,i)}reset(){return this.runners.reset.emit(),this}clear(){this.renderTexture.bind(),this.renderTexture.clear()}destroy(e=!1){this.runners.destroy.items.reverse(),this.emitWithCustomOptions(this.runners.destroy,{_view:e}),super.destroy()}get plugins(){return this._plugin.plugins}get multisample(){return this._multisample.multisample}get width(){return this._view.element.width}get height(){return this._view.element.height}get resolution(){return this._view.resolution}set resolution(e){this._view.resolution=e,this.runners.resolutionChange.emit(e)}get autoDensity(){return this._view.autoDensity}get view(){return this._view.element}get screen(){return this._view.screen}get lastObjectRendered(){return this.objectRenderer.lastObjectRendered}get renderingToScreen(){return this.objectRenderer.renderingToScreen}get rendererLogId(){return`WebGL ${this.context.webGLVersion}`}get clearBeforeRender(){return Et("7.0.0","renderer.clearBeforeRender has been deprecated, please use renderer.background.clearBeforeRender instead."),this.background.clearBeforeRender}get useContextAlpha(){return Et("7.0.0","renderer.useContextAlpha has been deprecated, please use renderer.context.premultipliedAlpha instead."),this.context.useContextAlpha}get preserveDrawingBuffer(){return Et("7.0.0","renderer.preserveDrawingBuffer has been deprecated, we cannot truly know this unless pixi created the context"),this.context.preserveDrawingBuffer}get backgroundColor(){return Et("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color}set backgroundColor(e){Et("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color=e}get backgroundAlpha(){return Et("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha}set backgroundAlpha(e){Et("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha=e}get powerPreference(){return Et("7.0.0","renderer.powerPreference has been deprecated, we can only know this if pixi creates the context"),this.context.powerPreference}generateTexture(e,i){return this.textureGenerator.generateTexture(e,i)}};kt.extension={type:Zt.Renderer,priority:1},kt.__plugins={},kt.__systems={};let $t=kt;re.handleByMap(Zt.RendererPlugin,$t.__plugins),re.handleByMap(Zt.RendererSystem,$t.__systems),re.add($t);class be extends Tr{constructor(e,i){const{width:a,height:h}=i||{};super(a,h),this.items=[],this.itemDirtyIds=[];for(let u=0;u<e;u++){const m=new se;this.items.push(m),this.itemDirtyIds.push(-2)}this.length=e,this._load=null,this.baseTexture=null}initFromArray(e,i){for(let a=0;a<this.length;a++)e[a]&&(e[a].castToBaseTexture?this.addBaseTextureAt(e[a].castToBaseTexture(),a):e[a]instanceof Tr?this.addResourceAt(e[a],a):this.addResourceAt(Hs(e[a],i),a))}dispose(){for(let e=0,i=this.length;e<i;e++)this.items[e].destroy();this.items=null,this.itemDirtyIds=null,this._load=null}addResourceAt(e,i){if(!this.items[i])throw new Error(`Index ${i} is out of bounds`);return e.valid&&!this.valid&&this.resize(e.width,e.height),this.items[i].setResource(e),this}bind(e){if(this.baseTexture!==null)throw new Error("Only one base texture per TextureArray is allowed");super.bind(e);for(let i=0;i<this.length;i++)this.items[i].parentTextureArray=e,this.items[i].on("update",e.update,e)}unbind(e){super.unbind(e);for(let i=0;i<this.length;i++)this.items[i].parentTextureArray=null,this.items[i].off("update",e.update,e)}load(){if(this._load)return this._load;const e=this.items.map(i=>i.resource).filter(i=>i).map(i=>i.load());return this._load=Promise.all(e).then(()=>{const{realWidth:i,realHeight:a}=this.items[0];return this.resize(i,a),this.update(),Promise.resolve(this)}),this._load}}class Te extends be{constructor(e,i){const{width:a,height:h}=i||{};let u,m;Array.isArray(e)?(u=e,m=e.length):m=e,super(m,{width:a,height:h}),u&&this.initFromArray(u,i)}addBaseTextureAt(e,i){if(e.resource)this.addResourceAt(e.resource,i);else throw new Error("ArrayResource does not support RenderTexture");return this}bind(e){super.bind(e),e.target=J.TEXTURE_2D_ARRAY}upload(e,i,a){const{length:h,itemDirtyIds:u,items:m}=this,{gl:y}=e;a.dirtyId<0&&y.texImage3D(y.TEXTURE_2D_ARRAY,0,a.internalFormat,this._width,this._height,h,0,i.format,a.type,null);for(let E=0;E<h;E++){const D=m[E];u[E]<D.dirtyId&&(u[E]=D.dirtyId,D.valid&&y.texSubImage3D(y.TEXTURE_2D_ARRAY,0,0,0,E,D.resource.width,D.resource.height,1,i.format,a.type,D.resource.source))}return!0}}class Jt extends mr{constructor(e){super(e)}static test(e){const{OffscreenCanvas:i}=globalThis;return i&&e instanceof i?!0:globalThis.HTMLCanvasElement&&e instanceof HTMLCanvasElement}}const Cs=class Ms extends be{constructor(e,i){const{width:a,height:h,autoLoad:u,linkBaseTexture:m}=i||{};if(e&&e.length!==Ms.SIDES)throw new Error(`Invalid length. Got ${e.length}, expected 6`);super(6,{width:a,height:h});for(let y=0;y<Ms.SIDES;y++)this.items[y].target=J.TEXTURE_CUBE_MAP_POSITIVE_X+y;this.linkBaseTexture=m!==!1,e&&this.initFromArray(e,i),u!==!1&&this.load()}bind(e){super.bind(e),e.target=J.TEXTURE_CUBE_MAP}addBaseTextureAt(e,i,a){if(a===void 0&&(a=this.linkBaseTexture),!this.items[i])throw new Error(`Index ${i} is out of bounds`);if(!this.linkBaseTexture||e.parentTextureArray||Object.keys(e._glTextures).length>0)if(e.resource)this.addResourceAt(e.resource,i);else throw new Error("CubeResource does not support copying of renderTexture.");else e.target=J.TEXTURE_CUBE_MAP_POSITIVE_X+i,e.parentTextureArray=this.baseTexture,this.items[i]=e;return e.valid&&!this.valid&&this.resize(e.realWidth,e.realHeight),this.items[i]=e,this}upload(e,i,a){const h=this.itemDirtyIds;for(let u=0;u<Ms.SIDES;u++){const m=this.items[u];(h[u]<m.dirtyId||a.dirtyId<i.dirtyId)&&(m.valid&&m.resource?(m.resource.upload(e,m,a),h[u]=m.dirtyId):h[u]<-1&&(e.gl.texImage2D(m.target,0,a.internalFormat,i.realWidth,i.realHeight,0,i.format,a.type,null),h[u]=-1))}return!0}static test(e){return Array.isArray(e)&&e.length===Ms.SIDES}};Cs.SIDES=6;let ki=Cs;class Ke extends mr{constructor(e,i){var m,y;i=i||{};let a,h,u;typeof e=="string"?(a=Ke.EMPTY,h=e,u=!0):(a=e,h=null,u=!1),super(a),this.url=h,this.crossOrigin=(m=i.crossOrigin)!=null?m:!0,this.alphaMode=typeof i.alphaMode=="number"?i.alphaMode:null,this.ownsImageBitmap=(y=i.ownsImageBitmap)!=null?y:u,this._load=null,i.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise((e,i)=>Pt(this,null,function*(){if(this.url===null){e(this);return}try{const a=yield P.ADAPTER.fetch(this.url,{mode:this.crossOrigin?"cors":"no-cors"});if(this.destroyed)return;const h=yield a.blob();if(this.destroyed)return;const u=yield createImageBitmap(h,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===H.UNPACK?"premultiply":"none"});if(this.destroyed){u.close();return}this.source=u,this.update(),e(this)}catch(a){if(this.destroyed)return;i(a),this.onError.emit(a)}})),this._load)}upload(e,i,a){return this.source instanceof ImageBitmap?(typeof this.alphaMode=="number"&&(i.alphaMode=this.alphaMode),super.upload(e,i,a)):(this.load(),!1)}dispose(){this.ownsImageBitmap&&this.source instanceof ImageBitmap&&this.source.close(),super.dispose(),this._load=null}static test(e){return!!globalThis.createImageBitmap&&typeof ImageBitmap<"u"&&(typeof e=="string"||e instanceof ImageBitmap)}static get EMPTY(){var e;return Ke._EMPTY=(e=Ke._EMPTY)!=null?e:P.ADAPTER.createCanvas(0,0),Ke._EMPTY}}const Gi=class wn extends mr{constructor(e,i){i=i||{},super(P.ADAPTER.createCanvas()),this._width=0,this._height=0,this.svg=e,this.scale=i.scale||1,this._overrideWidth=i.width,this._overrideHeight=i.height,this._resolve=null,this._crossorigin=i.crossorigin,this._load=null,i.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(e=>{if(this._resolve=()=>{this.update(),e(this)},wn.SVG_XML.test(this.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");this.svg=`data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent(this.svg)))}`}this._loadSvg()}),this._load)}_loadSvg(){const e=new Image;mr.crossOrigin(e,this.svg,this._crossorigin),e.src=this.svg,e.onerror=i=>{this._resolve&&(e.onerror=null,this.onError.emit(i))},e.onload=()=>{if(!this._resolve)return;const i=e.width,a=e.height;if(!i||!a)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");let h=i*this.scale,u=a*this.scale;(this._overrideWidth||this._overrideHeight)&&(h=this._overrideWidth||this._overrideHeight/a*i,u=this._overrideHeight||this._overrideWidth/i*a),h=Math.round(h),u=Math.round(u);const m=this.source;m.width=h,m.height=u,m._pixiId=`canvas_${or()}`,m.getContext("2d").drawImage(e,0,0,i,a,0,0,h,u),this._resolve(),this._resolve=null}}static getSize(e){const i=wn.SVG_SIZE.exec(e),a={};return i&&(a[i[1]]=Math.round(parseFloat(i[3])),a[i[5]]=Math.round(parseFloat(i[7]))),a}dispose(){super.dispose(),this._resolve=null,this._crossorigin=null}static test(e,i){return i==="svg"||typeof e=="string"&&e.startsWith("data:image/svg+xml")||typeof e=="string"&&wn.SVG_XML.test(e)}};Gi.SVG_XML=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m,Gi.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i;let Rs=Gi;const $r=class ia extends mr{constructor(e,i){if(i=i||{},!(e instanceof HTMLVideoElement)){const a=document.createElement("video");i.autoLoad!==!1&&a.setAttribute("preload","auto"),i.playsinline!==!1&&(a.setAttribute("webkit-playsinline",""),a.setAttribute("playsinline","")),i.muted===!0&&(a.setAttribute("muted",""),a.muted=!0),i.loop===!0&&a.setAttribute("loop",""),i.autoPlay!==!1&&a.setAttribute("autoplay",""),typeof e=="string"&&(e=[e]);const h=e[0].src||e[0];mr.crossOrigin(a,h,i.crossorigin);for(let u=0;u<e.length;++u){const m=document.createElement("source");let{src:y,mime:E}=e[u];if(y=y||e[u],y.startsWith("data:"))E=y.slice(5,y.indexOf(";"));else if(!y.startsWith("blob:")){const D=y.split("?").shift().toLowerCase(),Z=D.slice(D.lastIndexOf(".")+1);E=E||ia.MIME_TYPES[Z]||`video/${Z}`}m.src=y,E&&(m.type=E),a.appendChild(m)}e=a}super(e),this.noSubImage=!0,this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=i.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=i.autoPlay!==!1,this._videoFrameRequestCallback=this._videoFrameRequestCallback.bind(this),this._videoFrameRequestCallbackHandle=null,this._load=null,this._resolve=null,this._reject=null,this._onCanPlay=this._onCanPlay.bind(this),this._onError=this._onError.bind(this),this._onPlayStart=this._onPlayStart.bind(this),this._onPlayStop=this._onPlayStop.bind(this),this._onSeeked=this._onSeeked.bind(this),i.autoLoad!==!1&&this.load()}update(e=0){if(!this.destroyed){if(this._updateFPS){const i=St.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-i)}(!this._updateFPS||this._msToNextUpdate<=0)&&(super.update(),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}}_videoFrameRequestCallback(){this.update(),this.destroyed?this._videoFrameRequestCallbackHandle=null:this._videoFrameRequestCallbackHandle=this.source.requestVideoFrameCallback(this._videoFrameRequestCallback)}load(){if(this._load)return this._load;const e=this.source;return(e.readyState===e.HAVE_ENOUGH_DATA||e.readyState===e.HAVE_FUTURE_DATA)&&e.width&&e.height&&(e.complete=!0),e.addEventListener("play",this._onPlayStart),e.addEventListener("pause",this._onPlayStop),e.addEventListener("seeked",this._onSeeked),this._isSourceReady()?this._onCanPlay():(e.addEventListener("canplay",this._onCanPlay),e.addEventListener("canplaythrough",this._onCanPlay),e.addEventListener("error",this._onError,!0)),this._load=new Promise((i,a)=>{this.valid?i(this):(this._resolve=i,this._reject=a,e.load())}),this._load}_onError(e){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(e),this._reject&&(this._reject(e),this._reject=null,this._resolve=null)}_isSourcePlaying(){const e=this.source;return!e.paused&&!e.ended}_isSourceReady(){return this.source.readyState>2}_onPlayStart(){this.valid||this._onCanPlay(),this._configureAutoUpdate()}_onPlayStop(){this._configureAutoUpdate()}_onSeeked(){this._autoUpdate&&!this._isSourcePlaying()&&(this._msToNextUpdate=0,this.update(),this._msToNextUpdate=0)}_onCanPlay(){const e=this.source;e.removeEventListener("canplay",this._onCanPlay),e.removeEventListener("canplaythrough",this._onCanPlay);const i=this.valid;this._msToNextUpdate=0,this.update(),this._msToNextUpdate=0,!i&&this._resolve&&(this._resolve(this),this._resolve=null,this._reject=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&e.play()}dispose(){this._configureAutoUpdate();const e=this.source;e&&(e.removeEventListener("play",this._onPlayStart),e.removeEventListener("pause",this._onPlayStop),e.removeEventListener("seeked",this._onSeeked),e.removeEventListener("canplay",this._onCanPlay),e.removeEventListener("canplaythrough",this._onCanPlay),e.removeEventListener("error",this._onError,!0),e.pause(),e.src="",e.load()),super.dispose()}get autoUpdate(){return this._autoUpdate}set autoUpdate(e){e!==this._autoUpdate&&(this._autoUpdate=e,this._configureAutoUpdate())}get updateFPS(){return this._updateFPS}set updateFPS(e){e!==this._updateFPS&&(this._updateFPS=e,this._configureAutoUpdate())}_configureAutoUpdate(){this._autoUpdate&&this._isSourcePlaying()?!this._updateFPS&&this.source.requestVideoFrameCallback?(this._isConnectedToTicker&&(St.shared.remove(this.update,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0),this._videoFrameRequestCallbackHandle===null&&(this._videoFrameRequestCallbackHandle=this.source.requestVideoFrameCallback(this._videoFrameRequestCallback))):(this._videoFrameRequestCallbackHandle!==null&&(this.source.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker||(St.shared.add(this.update,this),this._isConnectedToTicker=!0,this._msToNextUpdate=0)):(this._videoFrameRequestCallbackHandle!==null&&(this.source.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker&&(St.shared.remove(this.update,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0))}static test(e,i){return globalThis.HTMLVideoElement&&e instanceof HTMLVideoElement||ia.TYPES.includes(i)}};$r.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"],$r.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"};let di=$r;Ti.push(Ke,Js,Jt,di,Rs,Ei,ki,Te);class Jn{constructor(){this._glTransformFeedbacks={},this.buffers=[],this.disposeRunner=new Runner("disposeTransformFeedback")}bindBuffer(e,i){this.buffers[e]=i}destroy(){this.disposeRunner.emit(this,!1)}}const jr="7.3.2"},121:function(xt,Rt,K){"use strict";K.d(Rt,{U:function(){return at}});var f=K(774),ut=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform float uAlpha;

void main(void)
{
   gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha;
}
`;class at extends f.wn{constructor(Y=1){super(f.kP,ut,{uAlpha:1}),this.alpha=Y}get alpha(){return this.uniforms.uAlpha}set alpha(Y){this.uniforms.uAlpha=Y}}},844:function(xt,Rt,K){"use strict";K.d(Rt,{T:function(){return J},Y:function(){return O}});var f=K(774);const ut={5:[.153388,.221461,.250301],7:[.071303,.131514,.189879,.214607],9:[.028532,.067234,.124009,.179044,.20236],11:[.0093,.028002,.065984,.121703,.175713,.198596],13:[.002406,.009255,.027867,.065666,.121117,.174868,.197641],15:[489e-6,.002403,.009246,.02784,.065602,.120999,.174697,.197448]},at=["varying vec2 vBlurTexCoords[%size%];","uniform sampler2D uSampler;","void main(void)","{","    gl_FragColor = vec4(0.0);","    %blur%","}"].join(`
`);function vt(V){const F=ut[V],q=F.length;let ft=at,pt="";const H="gl_FragColor += texture2D(uSampler, vBlurTexCoords[%index%]) * %value%;";let mt;for(let it=0;it<V;it++){let C=H.replace("%index%",it.toString());mt=it,it>=q&&(mt=V-it-1),C=C.replace("%value%",F[mt].toString()),pt+=C,pt+=`
`}return ft=ft.replace("%blur%",pt),ft=ft.replace("%size%",V.toString()),ft}const Y=`
    attribute vec2 aVertexPosition;

    uniform mat3 projectionMatrix;

    uniform float strength;

    varying vec2 vBlurTexCoords[%size%];

    uniform vec4 inputSize;
    uniform vec4 outputFrame;

    vec4 filterVertexPosition( void )
    {
        vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

        return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
    }

    vec2 filterTextureCoord( void )
    {
        return aVertexPosition * (outputFrame.zw * inputSize.zw);
    }

    void main(void)
    {
        gl_Position = filterVertexPosition();

        vec2 textureCoord = filterTextureCoord();
        %blur%
    }`;function dt(V,F){const q=Math.ceil(V/2);let ft=Y,pt="",H;F?H="vBlurTexCoords[%index%] =  textureCoord + vec2(%sampleIndex% * strength, 0.0);":H="vBlurTexCoords[%index%] =  textureCoord + vec2(0.0, %sampleIndex% * strength);";for(let mt=0;mt<V;mt++){let it=H.replace("%index%",mt.toString());it=it.replace("%sampleIndex%",`${mt-(q-1)}.0`),pt+=it,pt+=`
`}return ft=ft.replace("%blur%",pt),ft=ft.replace("%size%",V.toString()),ft}class O extends f.wn{constructor(F,q=8,ft=4,pt=f.wn.defaultResolution,H=5){const mt=dt(H,F),it=vt(H);super(mt,it),this.horizontal=F,this.resolution=pt,this._quality=0,this.quality=ft,this.blur=q}apply(F,q,ft,pt){if(ft?this.horizontal?this.uniforms.strength=1/ft.width*(ft.width/q.width):this.uniforms.strength=1/ft.height*(ft.height/q.height):this.horizontal?this.uniforms.strength=1/F.renderer.width*(F.renderer.width/q.width):this.uniforms.strength=1/F.renderer.height*(F.renderer.height/q.height),this.uniforms.strength*=this.strength,this.uniforms.strength/=this.passes,this.passes===1)F.applyFilter(this,q,ft,pt);else{const H=F.getFilterTexture(),mt=F.renderer;let it=q,C=H;this.state.blend=!1,F.applyFilter(this,it,C,f.yl.CLEAR);for(let G=1;G<this.passes-1;G++){F.bindAndClear(it,f.yl.BLIT),this.uniforms.uSampler=C;const j=C;C=it,it=j,mt.shader.bind(this),mt.geometry.draw(5)}this.state.blend=!0,F.applyFilter(this,C,ft,pt),F.returnFilterTexture(H)}}get blur(){return this.strength}set blur(F){this.padding=1+Math.abs(F)*2,this.strength=F}get quality(){return this._quality}set quality(F){this._quality=F,this.passes=F}}class J extends f.wn{constructor(F=8,q=4,ft=f.wn.defaultResolution,pt=5){super(),this._repeatEdgePixels=!1,this.blurXFilter=new O(!0,F,q,ft,pt),this.blurYFilter=new O(!1,F,q,ft,pt),this.resolution=ft,this.quality=q,this.blur=F,this.repeatEdgePixels=!1}apply(F,q,ft,pt){const H=Math.abs(this.blurXFilter.strength),mt=Math.abs(this.blurYFilter.strength);if(H&&mt){const it=F.getFilterTexture();this.blurXFilter.apply(F,q,it,f.yl.CLEAR),this.blurYFilter.apply(F,it,ft,pt),F.returnFilterTexture(it)}else mt?this.blurYFilter.apply(F,q,ft,pt):this.blurXFilter.apply(F,q,ft,pt)}updatePadding(){this._repeatEdgePixels?this.padding=0:this.padding=Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))*2}get blur(){return this.blurXFilter.blur}set blur(F){this.blurXFilter.blur=this.blurYFilter.blur=F,this.updatePadding()}get quality(){return this.blurXFilter.quality}set quality(F){this.blurXFilter.quality=this.blurYFilter.quality=F}get blurX(){return this.blurXFilter.blur}set blurX(F){this.blurXFilter.blur=F,this.updatePadding()}get blurY(){return this.blurYFilter.blur}set blurY(F){this.blurYFilter.blur=F,this.updatePadding()}get blendMode(){return this.blurYFilter.blendMode}set blendMode(F){this.blurYFilter.blendMode=F}get repeatEdgePixels(){return this._repeatEdgePixels}set repeatEdgePixels(F){this._repeatEdgePixels=F,this.updatePadding()}}},465:function(xt,Rt,K){"use strict";K.d(Rt,{MxU:function(){return He},Graphics:function(){return ds}});var f=K(774);class ut{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null,this.updateID=-1}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}clear(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}getRectangle(t){return this.minX>this.maxX||this.minY>this.maxY?f.Ae.EMPTY:(t=t||new f.Ae(0,0,1,1),t.x=this.minX,t.y=this.minY,t.width=this.maxX-this.minX,t.height=this.maxY-this.minY,t)}addPoint(t){this.minX=Math.min(this.minX,t.x),this.maxX=Math.max(this.maxX,t.x),this.minY=Math.min(this.minY,t.y),this.maxY=Math.max(this.maxY,t.y)}addPointMatrix(t,r){const{a:n,b:o,c:l,d:c,tx:p,ty:g}=t,_=n*r.x+l*r.y+p,x=o*r.x+c*r.y+g;this.minX=Math.min(this.minX,_),this.maxX=Math.max(this.maxX,_),this.minY=Math.min(this.minY,x),this.maxY=Math.max(this.maxY,x)}addQuad(t){let r=this.minX,n=this.minY,o=this.maxX,l=this.maxY,c=t[0],p=t[1];r=c<r?c:r,n=p<n?p:n,o=c>o?c:o,l=p>l?p:l,c=t[2],p=t[3],r=c<r?c:r,n=p<n?p:n,o=c>o?c:o,l=p>l?p:l,c=t[4],p=t[5],r=c<r?c:r,n=p<n?p:n,o=c>o?c:o,l=p>l?p:l,c=t[6],p=t[7],r=c<r?c:r,n=p<n?p:n,o=c>o?c:o,l=p>l?p:l,this.minX=r,this.minY=n,this.maxX=o,this.maxY=l}addFrame(t,r,n,o,l){this.addFrameMatrix(t.worldTransform,r,n,o,l)}addFrameMatrix(t,r,n,o,l){const c=t.a,p=t.b,g=t.c,_=t.d,x=t.tx,v=t.ty;let T=this.minX,b=this.minY,w=this.maxX,R=this.maxY,k=c*r+g*n+x,L=p*r+_*n+v;T=k<T?k:T,b=L<b?L:b,w=k>w?k:w,R=L>R?L:R,k=c*o+g*n+x,L=p*o+_*n+v,T=k<T?k:T,b=L<b?L:b,w=k>w?k:w,R=L>R?L:R,k=c*r+g*l+x,L=p*r+_*l+v,T=k<T?k:T,b=L<b?L:b,w=k>w?k:w,R=L>R?L:R,k=c*o+g*l+x,L=p*o+_*l+v,T=k<T?k:T,b=L<b?L:b,w=k>w?k:w,R=L>R?L:R,this.minX=T,this.minY=b,this.maxX=w,this.maxY=R}addVertexData(t,r,n){let o=this.minX,l=this.minY,c=this.maxX,p=this.maxY;for(let g=r;g<n;g+=2){const _=t[g],x=t[g+1];o=_<o?_:o,l=x<l?x:l,c=_>c?_:c,p=x>p?x:p}this.minX=o,this.minY=l,this.maxX=c,this.maxY=p}addVertices(t,r,n,o){this.addVerticesMatrix(t.worldTransform,r,n,o)}addVerticesMatrix(t,r,n,o,l=0,c=l){const p=t.a,g=t.b,_=t.c,x=t.d,v=t.tx,T=t.ty;let b=this.minX,w=this.minY,R=this.maxX,k=this.maxY;for(let L=n;L<o;L+=2){const nt=r[L],$=r[L+1],tt=p*nt+_*$+v,St=x*$+g*nt+T;b=Math.min(b,tt-l),R=Math.max(R,tt+l),w=Math.min(w,St-c),k=Math.max(k,St+c)}this.minX=b,this.minY=w,this.maxX=R,this.maxY=k}addBounds(t){const r=this.minX,n=this.minY,o=this.maxX,l=this.maxY;this.minX=t.minX<r?t.minX:r,this.minY=t.minY<n?t.minY:n,this.maxX=t.maxX>o?t.maxX:o,this.maxY=t.maxY>l?t.maxY:l}addBoundsMask(t,r){const n=t.minX>r.minX?t.minX:r.minX,o=t.minY>r.minY?t.minY:r.minY,l=t.maxX<r.maxX?t.maxX:r.maxX,c=t.maxY<r.maxY?t.maxY:r.maxY;if(n<=l&&o<=c){const p=this.minX,g=this.minY,_=this.maxX,x=this.maxY;this.minX=n<p?n:p,this.minY=o<g?o:g,this.maxX=l>_?l:_,this.maxY=c>x?c:x}}addBoundsMatrix(t,r){this.addFrameMatrix(r,t.minX,t.minY,t.maxX,t.maxY)}addBoundsArea(t,r){const n=t.minX>r.x?t.minX:r.x,o=t.minY>r.y?t.minY:r.y,l=t.maxX<r.x+r.width?t.maxX:r.x+r.width,c=t.maxY<r.y+r.height?t.maxY:r.y+r.height;if(n<=l&&o<=c){const p=this.minX,g=this.minY,_=this.maxX,x=this.maxY;this.minX=n<p?n:p,this.minY=o<g?o:g,this.maxX=l>_?l:_,this.maxY=c>x?c:x}}pad(t=0,r=t){this.isEmpty()||(this.minX-=t,this.maxX+=t,this.minY-=r,this.maxY+=r)}addFramePad(t,r,n,o,l,c){t-=l,r-=c,n+=l,o+=c,this.minX=this.minX<t?this.minX:t,this.maxX=this.maxX>n?this.maxX:n,this.minY=this.minY<r?this.minY:r,this.maxY=this.maxY>o?this.maxY:o}}class at extends f.P6.EventEmitter{constructor(){super(),this.tempDisplayObjectParent=null,this.transform=new f.wx,this.alpha=1,this.visible=!0,this.renderable=!0,this.cullable=!1,this.cullArea=null,this.parent=null,this.worldAlpha=1,this._lastSortedIndex=0,this._zIndex=0,this.filterArea=null,this.filters=null,this._enabledFilters=null,this._bounds=new ut,this._localBounds=null,this._boundsID=0,this._boundsRect=null,this._localBoundsRect=null,this._mask=null,this._maskRefCount=0,this._destroyed=!1,this.isSprite=!1,this.isMask=!1}static mixin(t){const r=Object.keys(t);for(let n=0;n<r.length;++n){const o=r[n];Object.defineProperty(at.prototype,o,Object.getOwnPropertyDescriptor(t,o))}}get destroyed(){return this._destroyed}_recursivePostUpdateTransform(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)}updateTransform(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha}getBounds(t,r){return t||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._bounds.updateID!==this._boundsID&&(this.calculateBounds(),this._bounds.updateID=this._boundsID),r||(this._boundsRect||(this._boundsRect=new f.Ae),r=this._boundsRect),this._bounds.getRectangle(r)}getLocalBounds(t){var p;t||(this._localBoundsRect||(this._localBoundsRect=new f.Ae),t=this._localBoundsRect),this._localBounds||(this._localBounds=new ut);const r=this.transform,n=this.parent;this.parent=null,this._tempDisplayObjectParent.worldAlpha=(p=n==null?void 0:n.worldAlpha)!=null?p:1,this.transform=this._tempDisplayObjectParent.transform;const o=this._bounds,l=this._boundsID;this._bounds=this._localBounds;const c=this.getBounds(!1,t);return this.parent=n,this.transform=r,this._bounds=o,this._bounds.updateID+=this._boundsID-l,c}toGlobal(t,r,n=!1){return n||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(t,r)}toLocal(t,r,n,o){return r&&(t=r.toGlobal(t,n,o)),o||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(t,n)}setParent(t){if(!t||!t.addChild)throw new Error("setParent: Argument must be a Container");return t.addChild(this),t}removeFromParent(){var t;(t=this.parent)==null||t.removeChild(this)}setTransform(t=0,r=0,n=1,o=1,l=0,c=0,p=0,g=0,_=0){return this.position.x=t,this.position.y=r,this.scale.x=n||1,this.scale.y=o||1,this.rotation=l,this.skew.x=c,this.skew.y=p,this.pivot.x=g,this.pivot.y=_,this}destroy(t){this.removeFromParent(),this._destroyed=!0,this.transform=null,this.parent=null,this._bounds=null,this.mask=null,this.cullArea=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.eventMode="auto",this.interactiveChildren=!1,this.emit("destroyed"),this.removeAllListeners()}get _tempDisplayObjectParent(){return this.tempDisplayObjectParent===null&&(this.tempDisplayObjectParent=new vt),this.tempDisplayObjectParent}enableTempParent(){const t=this.parent;return this.parent=this._tempDisplayObjectParent,t}disableTempParent(t){this.parent=t}get x(){return this.position.x}set x(t){this.transform.position.x=t}get y(){return this.position.y}set y(t){this.transform.position.y=t}get worldTransform(){return this.transform.worldTransform}get localTransform(){return this.transform.localTransform}get position(){return this.transform.position}set position(t){this.transform.position.copyFrom(t)}get scale(){return this.transform.scale}set scale(t){this.transform.scale.copyFrom(t)}get pivot(){return this.transform.pivot}set pivot(t){this.transform.pivot.copyFrom(t)}get skew(){return this.transform.skew}set skew(t){this.transform.skew.copyFrom(t)}get rotation(){return this.transform.rotation}set rotation(t){this.transform.rotation=t}get angle(){return this.transform.rotation*f.jl}set angle(t){this.transform.rotation=t*f.ZX}get zIndex(){return this._zIndex}set zIndex(t){this._zIndex=t,this.parent&&(this.parent.sortDirty=!0)}get worldVisible(){let t=this;do{if(!t.visible)return!1;t=t.parent}while(t);return!0}get mask(){return this._mask}set mask(t){if(this._mask!==t){if(this._mask){const r=this._mask.isMaskData?this._mask.maskObject:this._mask;r&&(r._maskRefCount--,r._maskRefCount===0&&(r.renderable=!0,r.isMask=!1))}if(this._mask=t,this._mask){const r=this._mask.isMaskData?this._mask.maskObject:this._mask;r&&(r._maskRefCount===0&&(r.renderable=!1,r.isMask=!0),r._maskRefCount++)}}}}class vt extends at{constructor(){super(...arguments),this.sortDirty=null}}at.prototype.displayObjectUpdateTransform=at.prototype.updateTransform;const Y=new f.y3;function dt(d,t){return d.zIndex===t.zIndex?d._lastSortedIndex-t._lastSortedIndex:d.zIndex-t.zIndex}const O=class sa extends at{constructor(){super(),this.children=[],this.sortableChildren=sa.defaultSortableChildren,this.sortDirty=!1}onChildrenChange(t){}addChild(...t){if(t.length>1)for(let r=0;r<t.length;r++)this.addChild(t[r]);else{const r=t[0];r.parent&&r.parent.removeChild(r),r.parent=this,this.sortDirty=!0,r.transform._parentID=-1,this.children.push(r),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",r,this,this.children.length-1),r.emit("added",this)}return t[0]}addChildAt(t,r){if(r<0||r>this.children.length)throw new Error(`${t}addChildAt: The index ${r} supplied is out of bounds ${this.children.length}`);return t.parent&&t.parent.removeChild(t),t.parent=this,this.sortDirty=!0,t.transform._parentID=-1,this.children.splice(r,0,t),this._boundsID++,this.onChildrenChange(r),t.emit("added",this),this.emit("childAdded",t,this,r),t}swapChildren(t,r){if(t===r)return;const n=this.getChildIndex(t),o=this.getChildIndex(r);this.children[n]=r,this.children[o]=t,this.onChildrenChange(n<o?n:o)}getChildIndex(t){const r=this.children.indexOf(t);if(r===-1)throw new Error("The supplied DisplayObject must be a child of the caller");return r}setChildIndex(t,r){if(r<0||r>=this.children.length)throw new Error(`The index ${r} supplied is out of bounds ${this.children.length}`);const n=this.getChildIndex(t);f.P6.removeItems(this.children,n,1),this.children.splice(r,0,t),this.onChildrenChange(r)}getChildAt(t){if(t<0||t>=this.children.length)throw new Error(`getChildAt: Index (${t}) does not exist.`);return this.children[t]}removeChild(...t){if(t.length>1)for(let r=0;r<t.length;r++)this.removeChild(t[r]);else{const r=t[0],n=this.children.indexOf(r);if(n===-1)return null;r.parent=null,r.transform._parentID=-1,f.P6.removeItems(this.children,n,1),this._boundsID++,this.onChildrenChange(n),r.emit("removed",this),this.emit("childRemoved",r,this,n)}return t[0]}removeChildAt(t){const r=this.getChildAt(t);return r.parent=null,r.transform._parentID=-1,f.P6.removeItems(this.children,t,1),this._boundsID++,this.onChildrenChange(t),r.emit("removed",this),this.emit("childRemoved",r,this,t),r}removeChildren(t=0,r=this.children.length){const n=t,o=r,l=o-n;let c;if(l>0&&l<=o){c=this.children.splice(n,l);for(let p=0;p<c.length;++p)c[p].parent=null,c[p].transform&&(c[p].transform._parentID=-1);this._boundsID++,this.onChildrenChange(t);for(let p=0;p<c.length;++p)c[p].emit("removed",this),this.emit("childRemoved",c[p],this,p);return c}else if(l===0&&this.children.length===0)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")}sortChildren(){let t=!1;for(let r=0,n=this.children.length;r<n;++r){const o=this.children[r];o._lastSortedIndex=r,!t&&o.zIndex!==0&&(t=!0)}t&&this.children.length>1&&this.children.sort(dt),this.sortDirty=!1}updateTransform(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(let t=0,r=this.children.length;t<r;++t){const n=this.children[t];n.visible&&n.updateTransform()}}calculateBounds(){this._bounds.clear(),this._calculateBounds();for(let t=0;t<this.children.length;t++){const r=this.children[t];if(!(!r.visible||!r.renderable))if(r.calculateBounds(),r._mask){const n=r._mask.isMaskData?r._mask.maskObject:r._mask;n?(n.calculateBounds(),this._bounds.addBoundsMask(r._bounds,n._bounds)):this._bounds.addBounds(r._bounds)}else r.filterArea?this._bounds.addBoundsArea(r._bounds,r.filterArea):this._bounds.addBounds(r._bounds)}this._bounds.updateID=this._boundsID}getLocalBounds(t,r=!1){const n=super.getLocalBounds(t);if(!r)for(let o=0,l=this.children.length;o<l;++o){const c=this.children[o];c.visible&&c.updateTransform()}return n}_calculateBounds(){}_renderWithCulling(t){const r=t.renderTexture.sourceFrame;if(!(r.width>0&&r.height>0))return;let n,o;this.cullArea?(n=this.cullArea,o=this.worldTransform):this._render!==sa.prototype._render&&(n=this.getBounds(!0));const l=t.projection.transform;if(l&&(o?(o=Y.copyFrom(o),o.prepend(l)):o=l),n&&r.intersects(n,o))this._render(t);else if(this.cullArea)return;for(let c=0,p=this.children.length;c<p;++c){const g=this.children[c],_=g.cullable;g.cullable=_||!this.cullArea,g.render(t),g.cullable=_}}render(t){var r;if(!(!this.visible||this.worldAlpha<=0||!this.renderable))if(this._mask||(r=this.filters)!=null&&r.length)this.renderAdvanced(t);else if(this.cullable)this._renderWithCulling(t);else{this._render(t);for(let n=0,o=this.children.length;n<o;++n)this.children[n].render(t)}}renderAdvanced(t){var l,c,p;const r=this.filters,n=this._mask;if(r){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(let g=0;g<r.length;g++)r[g].enabled&&this._enabledFilters.push(r[g])}const o=r&&((l=this._enabledFilters)==null?void 0:l.length)||n&&(!n.isMaskData||n.enabled&&(n.autoDetect||n.type!==f.A7.NONE));if(o&&t.batch.flush(),r&&((c=this._enabledFilters)!=null&&c.length)&&t.filter.push(this,this._enabledFilters),n&&t.mask.push(this,this._mask),this.cullable)this._renderWithCulling(t);else{this._render(t);for(let g=0,_=this.children.length;g<_;++g)this.children[g].render(t)}o&&t.batch.flush(),n&&t.mask.pop(this),r&&((p=this._enabledFilters)!=null&&p.length)&&t.filter.pop()}_render(t){}destroy(t){super.destroy(),this.sortDirty=!1;const r=typeof t=="boolean"?t:t==null?void 0:t.children,n=this.removeChildren(0,this.children.length);if(r)for(let o=0;o<n.length;++o)n[o].destroy(t)}get width(){return this.scale.x*this.getLocalBounds().width}set width(t){const r=this.getLocalBounds().width;r!==0?this.scale.x=t/r:this.scale.x=1,this._width=t}get height(){return this.scale.y*this.getLocalBounds().height}set height(t){const r=this.getLocalBounds().height;r!==0?this.scale.y=t/r:this.scale.y=1,this._height=t}};O.defaultSortableChildren=!1;let J=O;J.prototype.containerUpdateTransform=J.prototype.updateTransform,Object.defineProperties(f.Xd,{SORTABLE_CHILDREN:{get(){return J.defaultSortableChildren},set(d){f.P6.deprecation("7.1.0","settings.SORTABLE_CHILDREN is deprecated, use Container.defaultSortableChildren"),J.defaultSortableChildren=d}}});const V=new f.E9,F=new Uint16Array([0,1,2,0,2,3]);class q extends J{constructor(t){super(),this._anchor=new f.AB(this._onAnchorUpdate,this,t?t.defaultAnchor.x:0,t?t.defaultAnchor.y:0),this._texture=null,this._width=0,this._height=0,this._tintColor=new f.Il(16777215),this._tintRGB=null,this.tint=16777215,this.blendMode=f.T$.NORMAL,this._cachedTint=16777215,this.uvs=null,this.texture=t||f.xE.EMPTY,this.vertexData=new Float32Array(8),this.vertexTrimmedData=null,this._transformID=-1,this._textureID=-1,this._transformTrimmedID=-1,this._textureTrimmedID=-1,this.indices=F,this.pluginName="batch",this.isSprite=!0,this._roundPixels=f.Xd.ROUND_PIXELS}_onTextureUpdate(){this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this._width&&(this.scale.x=f.P6.sign(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=f.P6.sign(this.scale.y)*this._height/this._texture.orig.height)}_onAnchorUpdate(){this._transformID=-1,this._transformTrimmedID=-1}calculateVertices(){const t=this._texture;if(this._transformID===this.transform._worldID&&this._textureID===t._updateID)return;this._textureID!==t._updateID&&(this.uvs=this._texture._uvs.uvsFloat32),this._transformID=this.transform._worldID,this._textureID=t._updateID;const r=this.transform.worldTransform,n=r.a,o=r.b,l=r.c,c=r.d,p=r.tx,g=r.ty,_=this.vertexData,x=t.trim,v=t.orig,T=this._anchor;let b=0,w=0,R=0,k=0;if(x?(w=x.x-T._x*v.width,b=w+x.width,k=x.y-T._y*v.height,R=k+x.height):(w=-T._x*v.width,b=w+v.width,k=-T._y*v.height,R=k+v.height),_[0]=n*w+l*k+p,_[1]=c*k+o*w+g,_[2]=n*b+l*k+p,_[3]=c*k+o*b+g,_[4]=n*b+l*R+p,_[5]=c*R+o*b+g,_[6]=n*w+l*R+p,_[7]=c*R+o*w+g,this._roundPixels){const L=f.Xd.RESOLUTION;for(let nt=0;nt<_.length;++nt)_[nt]=Math.round(_[nt]*L)/L}}calculateTrimmedVertices(){if(!this.vertexTrimmedData)this.vertexTrimmedData=new Float32Array(8);else if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return;this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;const t=this._texture,r=this.vertexTrimmedData,n=t.orig,o=this._anchor,l=this.transform.worldTransform,c=l.a,p=l.b,g=l.c,_=l.d,x=l.tx,v=l.ty,T=-o._x*n.width,b=T+n.width,w=-o._y*n.height,R=w+n.height;if(r[0]=c*T+g*w+x,r[1]=_*w+p*T+v,r[2]=c*b+g*w+x,r[3]=_*w+p*b+v,r[4]=c*b+g*R+x,r[5]=_*R+p*b+v,r[6]=c*T+g*R+x,r[7]=_*R+p*T+v,this._roundPixels){const k=f.Xd.RESOLUTION;for(let L=0;L<r.length;++L)r[L]=Math.round(r[L]*k)/k}}_render(t){this.calculateVertices(),t.batch.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this)}_calculateBounds(){const t=this._texture.trim,r=this._texture.orig;!t||t.width===r.width&&t.height===r.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))}getLocalBounds(t){return this.children.length===0?(this._localBounds||(this._localBounds=new ut),this._localBounds.minX=this._texture.orig.width*-this._anchor._x,this._localBounds.minY=this._texture.orig.height*-this._anchor._y,this._localBounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._localBounds.maxY=this._texture.orig.height*(1-this._anchor._y),t||(this._localBoundsRect||(this._localBoundsRect=new f.Ae),t=this._localBoundsRect),this._localBounds.getRectangle(t)):super.getLocalBounds.call(this,t)}containsPoint(t){this.worldTransform.applyInverse(t,V);const r=this._texture.orig.width,n=this._texture.orig.height,o=-r*this.anchor.x;let l=0;return V.x>=o&&V.x<o+r&&(l=-n*this.anchor.y,V.y>=l&&V.y<l+n)}destroy(t){if(super.destroy(t),this._texture.off("update",this._onTextureUpdate,this),this._anchor=null,typeof t=="boolean"?t:t==null?void 0:t.texture){const r=typeof t=="boolean"?t:t==null?void 0:t.baseTexture;this._texture.destroy(!!r)}this._texture=null}static from(t,r){const n=t instanceof f.xE?t:f.xE.from(t,r);return new q(n)}set roundPixels(t){this._roundPixels!==t&&(this._transformID=-1,this._transformTrimmedID=-1),this._roundPixels=t}get roundPixels(){return this._roundPixels}get width(){return Math.abs(this.scale.x)*this._texture.orig.width}set width(t){const r=f.P6.sign(this.scale.x)||1;this.scale.x=r*t/this._texture.orig.width,this._width=t}get height(){return Math.abs(this.scale.y)*this._texture.orig.height}set height(t){const r=f.P6.sign(this.scale.y)||1;this.scale.y=r*t/this._texture.orig.height,this._height=t}get anchor(){return this._anchor}set anchor(t){this._anchor.copyFrom(t)}get tint(){return this._tintColor.value}set tint(t){this._tintColor.setValue(t),this._tintRGB=this._tintColor.toLittleEndianNumber()}get tintValue(){return this._tintColor.toNumber()}get texture(){return this._texture}set texture(t){this._texture!==t&&(this._texture&&this._texture.off("update",this._onTextureUpdate,this),this._texture=t||f.xE.EMPTY,this._cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,t&&(t.baseTexture.valid?this._onTextureUpdate():t.once("update",this._onTextureUpdate,this)))}}const ft=new f.y3;at.prototype._cacheAsBitmap=!1,at.prototype._cacheData=null,at.prototype._cacheAsBitmapResolution=null,at.prototype._cacheAsBitmapMultisample=null;class pt{constructor(){this.textureCacheId=null,this.originalRender=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.originalContainsPoint=null,this.sprite=null}}Object.defineProperties(at.prototype,{cacheAsBitmapResolution:{get(){return this._cacheAsBitmapResolution},set(d){d!==this._cacheAsBitmapResolution&&(this._cacheAsBitmapResolution=d,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmapMultisample:{get(){return this._cacheAsBitmapMultisample},set(d){d!==this._cacheAsBitmapMultisample&&(this._cacheAsBitmapMultisample=d,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmap:{get(){return this._cacheAsBitmap},set(d){if(this._cacheAsBitmap===d)return;this._cacheAsBitmap=d;let t;d?(this._cacheData||(this._cacheData=new pt),t=this._cacheData,t.originalRender=this.render,t.originalRenderCanvas=this.renderCanvas,t.originalUpdateTransform=this.updateTransform,t.originalCalculateBounds=this.calculateBounds,t.originalGetLocalBounds=this.getLocalBounds,t.originalDestroy=this.destroy,t.originalContainsPoint=this.containsPoint,t.originalMask=this._mask,t.originalFilterArea=this.filterArea,this.render=this._renderCached,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):(t=this._cacheData,t.sprite&&this._destroyCachedDisplayObject(),this.render=t.originalRender,this.renderCanvas=t.originalRenderCanvas,this.calculateBounds=t.originalCalculateBounds,this.getLocalBounds=t.originalGetLocalBounds,this.destroy=t.originalDestroy,this.updateTransform=t.originalUpdateTransform,this.containsPoint=t.originalContainsPoint,this._mask=t.originalMask,this.filterArea=t.originalFilterArea)}}}),at.prototype._renderCached=function(d){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(d),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._render(d))},at.prototype._initCachedDisplayObject=function(d){var T,b,w;if((T=this._cacheData)!=null&&T.sprite)return;const t=this.alpha;this.alpha=1,d.batch.flush();const r=this.getLocalBounds(new f.Ae,!0);if((b=this.filters)!=null&&b.length){const R=this.filters[0].padding;r.pad(R)}const n=this.cacheAsBitmapResolution||d.resolution;r.ceil(n),r.width=Math.max(r.width,1/n),r.height=Math.max(r.height,1/n);const o=d.renderTexture.current,l=d.renderTexture.sourceFrame.clone(),c=d.renderTexture.destinationFrame.clone(),p=d.projection.transform,g=f.TI.create({width:r.width,height:r.height,resolution:n,multisample:(w=this.cacheAsBitmapMultisample)!=null?w:d.multisample}),_=`cacheAsBitmap_${f.P6.uid()}`;this._cacheData.textureCacheId=_,f.VL.addToCache(g.baseTexture,_),f.xE.addToCache(g,_);const x=this.transform.localTransform.copyTo(ft).invert().translate(-r.x,-r.y);this.render=this._cacheData.originalRender,d.render(this,{renderTexture:g,clear:!0,transform:x,skipUpdateTransform:!1}),d.framebuffer.blit(),d.projection.transform=p,d.renderTexture.bind(o,l,c),this.render=this._renderCached,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=t;const v=new q(g);v.transform.worldTransform=this.transform.worldTransform,v.anchor.x=-(r.x/r.width),v.anchor.y=-(r.y/r.height),v.alpha=t,v._bounds=this._bounds,this._cacheData.sprite=v,this.transform._parentID=-1,this.parent?this.updateTransform():(this.enableTempParent(),this.updateTransform(),this.disableTempParent(null)),this.containsPoint=v.containsPoint.bind(v)},at.prototype._renderCachedCanvas=function(d){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(d),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderCanvas(d))},at.prototype._initCachedDisplayObjectCanvas=function(d){var x;if((x=this._cacheData)!=null&&x.sprite)return;const t=this.getLocalBounds(new f.Ae,!0),r=this.alpha;this.alpha=1;const n=d.canvasContext.activeContext,o=d._projTransform,l=this.cacheAsBitmapResolution||d.resolution;t.ceil(l),t.width=Math.max(t.width,1/l),t.height=Math.max(t.height,1/l);const c=f.TI.create({width:t.width,height:t.height,resolution:l}),p=`cacheAsBitmap_${f.P6.uid()}`;this._cacheData.textureCacheId=p,f.VL.addToCache(c.baseTexture,p),f.xE.addToCache(c,p);const g=ft;this.transform.localTransform.copyTo(g),g.invert(),g.tx-=t.x,g.ty-=t.y,this.renderCanvas=this._cacheData.originalRenderCanvas,d.render(this,{renderTexture:c,clear:!0,transform:g,skipUpdateTransform:!1}),d.canvasContext.activeContext=n,d._projTransform=o,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=r;const _=new q(c);_.transform.worldTransform=this.transform.worldTransform,_.anchor.x=-(t.x/t.width),_.anchor.y=-(t.y/t.height),_.alpha=r,_._bounds=this._bounds,this._cacheData.sprite=_,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=d._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=_.containsPoint.bind(_)},at.prototype._calculateCachedBounds=function(){this._bounds.clear(),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite._calculateBounds(),this._bounds.updateID=this._boundsID},at.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds(null)},at.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,f.VL.removeFromCache(this._cacheData.textureCacheId),f.xE.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null},at.prototype._cacheAsBitmapDestroy=function(d){this.cacheAsBitmap=!1,this.destroy(d)},at.prototype.name=null,J.prototype.getChildByName=function(d,t){for(let r=0,n=this.children.length;r<n;r++)if(this.children[r].name===d)return this.children[r];if(t)for(let r=0,n=this.children.length;r<n;r++){const o=this.children[r];if(!o.getChildByName)continue;const l=o.getChildByName(d,!0);if(l)return l}return null},at.prototype.getGlobalPosition=function(d=new f.E9,t=!1){return this.parent?this.parent.toGlobal(this.position,d,t):(d.x=this.position.x,d.y=this.position.y),d};var H=K(121),mt=K(844),it=`varying vec2 vTextureCoord;
uniform sampler2D uSampler;
uniform float m[20];
uniform float uAlpha;

void main(void)
{
    vec4 c = texture2D(uSampler, vTextureCoord);

    if (uAlpha == 0.0) {
        gl_FragColor = c;
        return;
    }

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (c.a > 0.0) {
      c.rgb /= c.a;
    }

    vec4 result;

    result.r = (m[0] * c.r);
        result.r += (m[1] * c.g);
        result.r += (m[2] * c.b);
        result.r += (m[3] * c.a);
        result.r += m[4];

    result.g = (m[5] * c.r);
        result.g += (m[6] * c.g);
        result.g += (m[7] * c.b);
        result.g += (m[8] * c.a);
        result.g += m[9];

    result.b = (m[10] * c.r);
       result.b += (m[11] * c.g);
       result.b += (m[12] * c.b);
       result.b += (m[13] * c.a);
       result.b += m[14];

    result.a = (m[15] * c.r);
       result.a += (m[16] * c.g);
       result.a += (m[17] * c.b);
       result.a += (m[18] * c.a);
       result.a += m[19];

    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);

    // Premultiply alpha again.
    rgb *= result.a;

    gl_FragColor = vec4(rgb, result.a);
}
`;class C extends f.wn{constructor(){const t={m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1};super(f.Y9,it,t),this.alpha=1}_loadMatrix(t,r=!1){let n=t;r&&(this._multiply(n,this.uniforms.m,t),n=this._colorMatrix(n)),this.uniforms.m=n}_multiply(t,r,n){return t[0]=r[0]*n[0]+r[1]*n[5]+r[2]*n[10]+r[3]*n[15],t[1]=r[0]*n[1]+r[1]*n[6]+r[2]*n[11]+r[3]*n[16],t[2]=r[0]*n[2]+r[1]*n[7]+r[2]*n[12]+r[3]*n[17],t[3]=r[0]*n[3]+r[1]*n[8]+r[2]*n[13]+r[3]*n[18],t[4]=r[0]*n[4]+r[1]*n[9]+r[2]*n[14]+r[3]*n[19]+r[4],t[5]=r[5]*n[0]+r[6]*n[5]+r[7]*n[10]+r[8]*n[15],t[6]=r[5]*n[1]+r[6]*n[6]+r[7]*n[11]+r[8]*n[16],t[7]=r[5]*n[2]+r[6]*n[7]+r[7]*n[12]+r[8]*n[17],t[8]=r[5]*n[3]+r[6]*n[8]+r[7]*n[13]+r[8]*n[18],t[9]=r[5]*n[4]+r[6]*n[9]+r[7]*n[14]+r[8]*n[19]+r[9],t[10]=r[10]*n[0]+r[11]*n[5]+r[12]*n[10]+r[13]*n[15],t[11]=r[10]*n[1]+r[11]*n[6]+r[12]*n[11]+r[13]*n[16],t[12]=r[10]*n[2]+r[11]*n[7]+r[12]*n[12]+r[13]*n[17],t[13]=r[10]*n[3]+r[11]*n[8]+r[12]*n[13]+r[13]*n[18],t[14]=r[10]*n[4]+r[11]*n[9]+r[12]*n[14]+r[13]*n[19]+r[14],t[15]=r[15]*n[0]+r[16]*n[5]+r[17]*n[10]+r[18]*n[15],t[16]=r[15]*n[1]+r[16]*n[6]+r[17]*n[11]+r[18]*n[16],t[17]=r[15]*n[2]+r[16]*n[7]+r[17]*n[12]+r[18]*n[17],t[18]=r[15]*n[3]+r[16]*n[8]+r[17]*n[13]+r[18]*n[18],t[19]=r[15]*n[4]+r[16]*n[9]+r[17]*n[14]+r[18]*n[19]+r[19],t}_colorMatrix(t){const r=new Float32Array(t);return r[4]/=255,r[9]/=255,r[14]/=255,r[19]/=255,r}brightness(t,r){const n=[t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0];this._loadMatrix(n,r)}tint(t,r){const[n,o,l]=f.Il.shared.setValue(t).toArray(),c=[n,0,0,0,0,0,o,0,0,0,0,0,l,0,0,0,0,0,1,0];this._loadMatrix(c,r)}greyscale(t,r){const n=[t,t,t,0,0,t,t,t,0,0,t,t,t,0,0,0,0,0,1,0];this._loadMatrix(n,r)}blackAndWhite(t){const r=[.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0];this._loadMatrix(r,t)}hue(t,r){t=(t||0)/180*Math.PI;const n=Math.cos(t),o=Math.sin(t),l=Math.sqrt,c=1/3,p=l(c),g=n+(1-n)*c,_=c*(1-n)-p*o,x=c*(1-n)+p*o,v=c*(1-n)+p*o,T=n+c*(1-n),b=c*(1-n)-p*o,w=c*(1-n)-p*o,R=c*(1-n)+p*o,k=n+c*(1-n),L=[g,_,x,0,0,v,T,b,0,0,w,R,k,0,0,0,0,0,1,0];this._loadMatrix(L,r)}contrast(t,r){const n=(t||0)+1,o=-.5*(n-1),l=[n,0,0,0,o,0,n,0,0,o,0,0,n,0,o,0,0,0,1,0];this._loadMatrix(l,r)}saturate(t=0,r){const n=t*2/3+1,o=(n-1)*-.5,l=[n,o,o,0,0,o,n,o,0,0,o,o,n,0,0,0,0,0,1,0];this._loadMatrix(l,r)}desaturate(){this.saturate(-1)}negative(t){const r=[-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0];this._loadMatrix(r,t)}sepia(t){const r=[.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0];this._loadMatrix(r,t)}technicolor(t){const r=[1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0];this._loadMatrix(r,t)}polaroid(t){const r=[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0];this._loadMatrix(r,t)}toBGR(t){const r=[0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0];this._loadMatrix(r,t)}kodachrome(t){const r=[1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0];this._loadMatrix(r,t)}browni(t){const r=[.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0];this._loadMatrix(r,t)}vintage(t){const r=[.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0];this._loadMatrix(r,t)}colorTone(t,r,n,o,l){t=t||.2,r=r||.15,n=n||16770432,o=o||3375104;const c=f.Il.shared,[p,g,_]=c.setValue(n).toArray(),[x,v,T]=c.setValue(o).toArray(),b=[.3,.59,.11,0,0,p,g,_,t,0,x,v,T,r,0,p-x,g-v,_-T,0,0];this._loadMatrix(b,l)}night(t,r){t=t||.1;const n=[t*-2,-t,0,0,0,-t,0,t,0,0,0,t,t*2,0,0,0,0,0,1,0];this._loadMatrix(n,r)}predator(t,r){const n=[11.224130630493164*t,-4.794486999511719*t,-2.8746118545532227*t,0*t,.40342438220977783*t,-3.6330697536468506*t,9.193157196044922*t,-2.951810836791992*t,0*t,-1.316135048866272*t,-3.2184197902679443*t,-4.2375030517578125*t,7.476448059082031*t,0*t,.8044459223747253*t,0,0,0,1,0];this._loadMatrix(n,r)}lsd(t){const r=[2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0];this._loadMatrix(r,t)}reset(){const t=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];this._loadMatrix(t,!1)}get matrix(){return this.uniforms.m}set matrix(t){this.uniforms.m=t}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}}C.prototype.grayscale=C.prototype.greyscale;var G=`varying vec2 vFilterCoord;
varying vec2 vTextureCoord;

uniform vec2 scale;
uniform mat2 rotation;
uniform sampler2D uSampler;
uniform sampler2D mapSampler;

uniform highp vec4 inputSize;
uniform vec4 inputClamp;

void main(void)
{
  vec4 map =  texture2D(mapSampler, vFilterCoord);

  map -= 0.5;
  map.xy = scale * inputSize.zw * (rotation * map.xy);

  gl_FragColor = texture2D(uSampler, clamp(vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y), inputClamp.xy, inputClamp.zw));
}
`,j=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;
uniform mat3 filterMatrix;

varying vec2 vTextureCoord;
varying vec2 vFilterCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
	gl_Position = filterVertexPosition();
	vTextureCoord = filterTextureCoord();
	vFilterCoord = ( filterMatrix * vec3( vTextureCoord, 1.0)  ).xy;
}
`;class rt extends f.wn{constructor(t,r){const n=new f.y3;t.renderable=!1,super(j,G,{mapSampler:t._texture,filterMatrix:n,scale:{x:1,y:1},rotation:new Float32Array([1,0,0,1])}),this.maskSprite=t,this.maskMatrix=n,r==null&&(r=20),this.scale=new f.E9(r,r)}apply(t,r,n,o){this.uniforms.filterMatrix=t.calculateSpriteMatrix(this.maskMatrix,this.maskSprite),this.uniforms.scale.x=this.scale.x,this.uniforms.scale.y=this.scale.y;const l=this.maskSprite.worldTransform,c=Math.sqrt(l.a*l.a+l.b*l.b),p=Math.sqrt(l.c*l.c+l.d*l.d);c!==0&&p!==0&&(this.uniforms.rotation[0]=l.a/c,this.uniforms.rotation[1]=l.b/c,this.uniforms.rotation[2]=l.c/p,this.uniforms.rotation[3]=l.d/p),t.applyFilter(this,r,n,o)}get map(){return this.uniforms.mapSampler}set map(t){this.uniforms.mapSampler=t}}var ct=`varying vec2 v_rgbNW;
varying vec2 v_rgbNE;
varying vec2 v_rgbSW;
varying vec2 v_rgbSE;
varying vec2 v_rgbM;

varying vec2 vFragCoord;
uniform sampler2D uSampler;
uniform highp vec4 inputSize;


/**
 Basic FXAA implementation based on the code on geeks3d.com with the
 modification that the texture2DLod stuff was removed since it's
 unsupported by WebGL.

 --

 From:
 https://github.com/mitsuhiko/webgl-meincraft

 Copyright (c) 2011 by Armin Ronacher.

 Some rights reserved.

 Redistribution and use in source and binary forms, with or without
 modification, are permitted provided that the following conditions are
 met:

 * Redistributions of source code must retain the above copyright
 notice, this list of conditions and the following disclaimer.

 * Redistributions in binary form must reproduce the above
 copyright notice, this list of conditions and the following
 disclaimer in the documentation and/or other materials provided
 with the distribution.

 * The names of the contributors may not be used to endorse or
 promote products derived from this software without specific
 prior written permission.

 THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

#ifndef FXAA_REDUCE_MIN
#define FXAA_REDUCE_MIN   (1.0/ 128.0)
#endif
#ifndef FXAA_REDUCE_MUL
#define FXAA_REDUCE_MUL   (1.0 / 8.0)
#endif
#ifndef FXAA_SPAN_MAX
#define FXAA_SPAN_MAX     8.0
#endif

//optimized version for mobile, where dependent
//texture reads can be a bottleneck
vec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 inverseVP,
          vec2 v_rgbNW, vec2 v_rgbNE,
          vec2 v_rgbSW, vec2 v_rgbSE,
          vec2 v_rgbM) {
    vec4 color;
    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;
    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;
    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;
    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;
    vec4 texColor = texture2D(tex, v_rgbM);
    vec3 rgbM  = texColor.xyz;
    vec3 luma = vec3(0.299, 0.587, 0.114);
    float lumaNW = dot(rgbNW, luma);
    float lumaNE = dot(rgbNE, luma);
    float lumaSW = dot(rgbSW, luma);
    float lumaSE = dot(rgbSE, luma);
    float lumaM  = dot(rgbM,  luma);
    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));
    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));

    mediump vec2 dir;
    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));
    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));

    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *
                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);

    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);
    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),
              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),
                  dir * rcpDirMin)) * inverseVP;

    vec3 rgbA = 0.5 * (
                       texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +
                       texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);
    vec3 rgbB = rgbA * 0.5 + 0.25 * (
                                     texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +
                                     texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);

    float lumaB = dot(rgbB, luma);
    if ((lumaB < lumaMin) || (lumaB > lumaMax))
        color = vec4(rgbA, texColor.a);
    else
        color = vec4(rgbB, texColor.a);
    return color;
}

void main() {

      vec4 color;

      color = fxaa(uSampler, vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);

      gl_FragColor = color;
}
`,_t=`
attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 v_rgbNW;
varying vec2 v_rgbNE;
varying vec2 v_rgbSW;
varying vec2 v_rgbSE;
varying vec2 v_rgbM;

varying vec2 vFragCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

void texcoords(vec2 fragCoord, vec2 inverseVP,
               out vec2 v_rgbNW, out vec2 v_rgbNE,
               out vec2 v_rgbSW, out vec2 v_rgbSE,
               out vec2 v_rgbM) {
    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;
    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;
    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;
    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;
    v_rgbM = vec2(fragCoord * inverseVP);
}

void main(void) {

   gl_Position = filterVertexPosition();

   vFragCoord = aVertexPosition * outputFrame.zw;

   texcoords(vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);
}
`;class P extends f.wn{constructor(){super(_t,ct)}}var bt=`precision highp float;

varying vec2 vTextureCoord;
varying vec4 vColor;

uniform float uNoise;
uniform float uSeed;
uniform sampler2D uSampler;

float rand(vec2 co)
{
    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);
}

void main()
{
    vec4 color = texture2D(uSampler, vTextureCoord);
    float randomValue = rand(gl_FragCoord.xy * uSeed);
    float diff = (randomValue - 0.5) * uNoise;

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (color.a > 0.0) {
        color.rgb /= color.a;
    }

    color.r += diff;
    color.g += diff;
    color.b += diff;

    // Premultiply alpha again.
    color.rgb *= color.a;

    gl_FragColor = color;
}
`;class B extends f.wn{constructor(t=.5,r=Math.random()){super(f.Y9,bt,{uNoise:0,uSeed:0}),this.noise=t,this.seed=r}get noise(){return this.uniforms.uNoise}set noise(t){this.uniforms.uNoise=t}get seed(){return this.uniforms.uSeed}set seed(t){this.uniforms.uSeed=t}}const Gt={AlphaFilter:H.U,BlurFilter:mt.T,BlurFilterPass:mt.Y,ColorMatrixFilter:C,DisplacementFilter:rt,FXAAFilter:P,NoiseFilter:B};Object.entries(Gt).forEach(([d,t])=>{Object.defineProperty(Gt,d,{get(){return f.P6.deprecation("7.1.0",`filters.${d} has moved to ${d}`),t}})});class Ut{constructor(){this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}init(t){this.removeTickerListener(),this.events=t,this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}get pauseUpdate(){return this._pauseUpdate}set pauseUpdate(t){this._pauseUpdate=t}addTickerListener(){this.tickerAdded||!this.domElement||(f.vB.system.add(this.tickerUpdate,this,f.uF.INTERACTION),this.tickerAdded=!0)}removeTickerListener(){this.tickerAdded&&(f.vB.system.remove(this.tickerUpdate,this),this.tickerAdded=!1)}pointerMoved(){this._didMove=!0}update(){if(!this.domElement||this._pauseUpdate)return;if(this._didMove){this._didMove=!1;return}const t=this.events.rootPointerEvent;this.events.supportsTouchEvents&&t.pointerType==="touch"||globalThis.document.dispatchEvent(new PointerEvent("pointermove",{clientX:t.clientX,clientY:t.clientY}))}tickerUpdate(t){this._deltaTime+=t,!(this._deltaTime<this.interactionFrequency)&&(this._deltaTime=0,this.update())}}const Ht=new Ut;class Nt{constructor(t){this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.composed=!1,this.defaultPrevented=!1,this.eventPhase=Nt.prototype.NONE,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer=new f.E9,this.page=new f.E9,this.NONE=0,this.CAPTURING_PHASE=1,this.AT_TARGET=2,this.BUBBLING_PHASE=3,this.manager=t}get layerX(){return this.layer.x}get layerY(){return this.layer.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get data(){return this}composedPath(){return this.manager&&(!this.path||this.path[this.path.length-1]!==this.target)&&(this.path=this.target?this.manager.propagationPath(this.target):[]),this.path}initEvent(t,r,n){throw new Error("initEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}initUIEvent(t,r,n,o,l){throw new Error("initUIEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}preventDefault(){this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault(),this.defaultPrevented=!0}stopImmediatePropagation(){this.propagationImmediatelyStopped=!0}stopPropagation(){this.propagationStopped=!0}}class ot extends Nt{constructor(){super(...arguments),this.client=new f.E9,this.movement=new f.E9,this.offset=new f.E9,this.global=new f.E9,this.screen=new f.E9}get clientX(){return this.client.x}get clientY(){return this.client.y}get x(){return this.clientX}get y(){return this.clientY}get movementX(){return this.movement.x}get movementY(){return this.movement.y}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}getLocalPosition(t,r,n){return t.worldTransform.applyInverse(n||this.global,r)}getModifierState(t){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(t)}initMouseEvent(t,r,n,o,l,c,p,g,_,x,v,T,b,w,R){throw new Error("Method not implemented.")}}class A extends ot{constructor(){super(...arguments),this.width=0,this.height=0,this.isPrimary=!1}getCoalescedEvents(){return this.type==="pointermove"||this.type==="mousemove"||this.type==="touchmove"?[this]:[]}getPredictedEvents(){throw new Error("getPredictedEvents is not supported!")}}class I extends ot{constructor(){super(...arguments),this.DOM_DELTA_PIXEL=0,this.DOM_DELTA_LINE=1,this.DOM_DELTA_PAGE=2}}I.DOM_DELTA_PIXEL=0,I.DOM_DELTA_LINE=1,I.DOM_DELTA_PAGE=2;const S=2048,z=new f.E9,X=new f.E9;class M{constructor(t){this.dispatch=new f.P6.EventEmitter,this.moveOnAll=!1,this.enableGlobalMoveEvents=!0,this.mappingState={trackingData:{}},this.eventPool=new Map,this._allInteractiveElements=[],this._hitElements=[],this._isPointerMoveEvent=!1,this.rootTarget=t,this.hitPruneFn=this.hitPruneFn.bind(this),this.hitTestFn=this.hitTestFn.bind(this),this.mapPointerDown=this.mapPointerDown.bind(this),this.mapPointerMove=this.mapPointerMove.bind(this),this.mapPointerOut=this.mapPointerOut.bind(this),this.mapPointerOver=this.mapPointerOver.bind(this),this.mapPointerUp=this.mapPointerUp.bind(this),this.mapPointerUpOutside=this.mapPointerUpOutside.bind(this),this.mapWheel=this.mapWheel.bind(this),this.mappingTable={},this.addEventMapping("pointerdown",this.mapPointerDown),this.addEventMapping("pointermove",this.mapPointerMove),this.addEventMapping("pointerout",this.mapPointerOut),this.addEventMapping("pointerleave",this.mapPointerOut),this.addEventMapping("pointerover",this.mapPointerOver),this.addEventMapping("pointerup",this.mapPointerUp),this.addEventMapping("pointerupoutside",this.mapPointerUpOutside),this.addEventMapping("wheel",this.mapWheel)}addEventMapping(t,r){this.mappingTable[t]||(this.mappingTable[t]=[]),this.mappingTable[t].push({fn:r,priority:0}),this.mappingTable[t].sort((n,o)=>n.priority-o.priority)}dispatchEvent(t,r){t.propagationStopped=!1,t.propagationImmediatelyStopped=!1,this.propagate(t,r),this.dispatch.emit(r||t.type,t)}mapEvent(t){if(!this.rootTarget)return;const r=this.mappingTable[t.type];if(r)for(let n=0,o=r.length;n<o;n++)r[n].fn(t);else console.warn(`[EventBoundary]: Event mapping not defined for ${t.type}`)}hitTest(t,r){Ht.pauseUpdate=!0;const n=this._isPointerMoveEvent&&this.enableGlobalMoveEvents?"hitTestMoveRecursive":"hitTestRecursive",o=this[n](this.rootTarget,this.rootTarget.eventMode,z.set(t,r),this.hitTestFn,this.hitPruneFn);return o&&o[0]}propagate(t,r){if(!t.target)return;const n=t.composedPath();t.eventPhase=t.CAPTURING_PHASE;for(let o=0,l=n.length-1;o<l;o++)if(t.currentTarget=n[o],this.notifyTarget(t,r),t.propagationStopped||t.propagationImmediatelyStopped)return;if(t.eventPhase=t.AT_TARGET,t.currentTarget=t.target,this.notifyTarget(t,r),!(t.propagationStopped||t.propagationImmediatelyStopped)){t.eventPhase=t.BUBBLING_PHASE;for(let o=n.length-2;o>=0;o--)if(t.currentTarget=n[o],this.notifyTarget(t,r),t.propagationStopped||t.propagationImmediatelyStopped)return}}all(t,r,n=this._allInteractiveElements){if(n.length===0)return;t.eventPhase=t.BUBBLING_PHASE;const o=Array.isArray(r)?r:[r];for(let l=n.length-1;l>=0;l--)o.forEach(c=>{t.currentTarget=n[l],this.notifyTarget(t,c)})}propagationPath(t){const r=[t];for(let n=0;n<S&&t!==this.rootTarget;n++){if(!t.parent)throw new Error("Cannot find propagation path to disconnected target");r.push(t.parent),t=t.parent}return r.reverse(),r}hitTestMoveRecursive(t,r,n,o,l,c=!1){let p=!1;if(this._interactivePrune(t))return null;if((t.eventMode==="dynamic"||r==="dynamic")&&(Ht.pauseUpdate=!1),t.interactiveChildren&&t.children){const x=t.children;for(let v=x.length-1;v>=0;v--){const T=x[v],b=this.hitTestMoveRecursive(T,this._isInteractive(r)?r:T.eventMode,n,o,l,c||l(t,n));if(b){if(b.length>0&&!b[b.length-1].parent)continue;const w=t.isInteractive();(b.length>0||w)&&(w&&this._allInteractiveElements.push(t),b.push(t)),this._hitElements.length===0&&(this._hitElements=b),p=!0}}}const g=this._isInteractive(r),_=t.isInteractive();return g&&_&&this._allInteractiveElements.push(t),c||this._hitElements.length>0?null:p?this._hitElements:g&&!l(t,n)&&o(t,n)?_?[t]:[]:null}hitTestRecursive(t,r,n,o,l){if(this._interactivePrune(t)||l(t,n))return null;if((t.eventMode==="dynamic"||r==="dynamic")&&(Ht.pauseUpdate=!1),t.interactiveChildren&&t.children){const g=t.children;for(let _=g.length-1;_>=0;_--){const x=g[_],v=this.hitTestRecursive(x,this._isInteractive(r)?r:x.eventMode,n,o,l);if(v){if(v.length>0&&!v[v.length-1].parent)continue;const T=t.isInteractive();return(v.length>0||T)&&v.push(t),v}}}const c=this._isInteractive(r),p=t.isInteractive();return c&&o(t,n)?p?[t]:[]:null}_isInteractive(t){return t==="static"||t==="dynamic"}_interactivePrune(t){return!!(!t||t.isMask||!t.visible||!t.renderable||t.eventMode==="none"||t.eventMode==="passive"&&!t.interactiveChildren||t.isMask)}hitPruneFn(t,r){var n;if(t.hitArea&&(t.worldTransform.applyInverse(r,X),!t.hitArea.contains(X.x,X.y)))return!0;if(t._mask){const o=t._mask.isMaskData?t._mask.maskObject:t._mask;if(o&&!((n=o.containsPoint)!=null&&n.call(o,r)))return!0}return!1}hitTestFn(t,r){return t.eventMode==="passive"?!1:t.hitArea?!0:t.containsPoint?t.containsPoint(r):!1}notifyTarget(t,r){var l,c;r=r!=null?r:t.type;const n=`on${r}`;(c=(l=t.currentTarget)[n])==null||c.call(l,t);const o=t.eventPhase===t.CAPTURING_PHASE||t.eventPhase===t.AT_TARGET?`${r}capture`:r;this.notifyListeners(t,o),t.eventPhase===t.AT_TARGET&&this.notifyListeners(t,r)}mapPointerDown(t){if(!(t instanceof A)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const r=this.createPointerEvent(t);if(this.dispatchEvent(r,"pointerdown"),r.pointerType==="touch")this.dispatchEvent(r,"touchstart");else if(r.pointerType==="mouse"||r.pointerType==="pen"){const o=r.button===2;this.dispatchEvent(r,o?"rightdown":"mousedown")}const n=this.trackingData(t.pointerId);n.pressTargetsByButton[t.button]=r.composedPath(),this.freeEvent(r)}mapPointerMove(t){var g,_,x;if(!(t instanceof A)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}this._allInteractiveElements.length=0,this._hitElements.length=0,this._isPointerMoveEvent=!0;const r=this.createPointerEvent(t);this._isPointerMoveEvent=!1;const n=r.pointerType==="mouse"||r.pointerType==="pen",o=this.trackingData(t.pointerId),l=this.findMountedTarget(o.overTargets);if(((g=o.overTargets)==null?void 0:g.length)>0&&l!==r.target){const v=t.type==="mousemove"?"mouseout":"pointerout",T=this.createPointerEvent(t,v,l);if(this.dispatchEvent(T,"pointerout"),n&&this.dispatchEvent(T,"mouseout"),!r.composedPath().includes(l)){const b=this.createPointerEvent(t,"pointerleave",l);for(b.eventPhase=b.AT_TARGET;b.target&&!r.composedPath().includes(b.target);)b.currentTarget=b.target,this.notifyTarget(b),n&&this.notifyTarget(b,"mouseleave"),b.target=b.target.parent;this.freeEvent(b)}this.freeEvent(T)}if(l!==r.target){const v=t.type==="mousemove"?"mouseover":"pointerover",T=this.clonePointerEvent(r,v);this.dispatchEvent(T,"pointerover"),n&&this.dispatchEvent(T,"mouseover");let b=l==null?void 0:l.parent;for(;b&&b!==this.rootTarget.parent&&b!==r.target;)b=b.parent;if(!b||b===this.rootTarget.parent){const w=this.clonePointerEvent(r,"pointerenter");for(w.eventPhase=w.AT_TARGET;w.target&&w.target!==l&&w.target!==this.rootTarget.parent;)w.currentTarget=w.target,this.notifyTarget(w),n&&this.notifyTarget(w,"mouseenter"),w.target=w.target.parent;this.freeEvent(w)}this.freeEvent(T)}const c=[],p=(_=this.enableGlobalMoveEvents)!=null?_:!0;this.moveOnAll?c.push("pointermove"):this.dispatchEvent(r,"pointermove"),p&&c.push("globalpointermove"),r.pointerType==="touch"&&(this.moveOnAll?c.splice(1,0,"touchmove"):this.dispatchEvent(r,"touchmove"),p&&c.push("globaltouchmove")),n&&(this.moveOnAll?c.splice(1,0,"mousemove"):this.dispatchEvent(r,"mousemove"),p&&c.push("globalmousemove"),this.cursor=(x=r.target)==null?void 0:x.cursor),c.length>0&&this.all(r,c),this._allInteractiveElements.length=0,this._hitElements.length=0,o.overTargets=r.composedPath(),this.freeEvent(r)}mapPointerOver(t){var c;if(!(t instanceof A)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const r=this.trackingData(t.pointerId),n=this.createPointerEvent(t),o=n.pointerType==="mouse"||n.pointerType==="pen";this.dispatchEvent(n,"pointerover"),o&&this.dispatchEvent(n,"mouseover"),n.pointerType==="mouse"&&(this.cursor=(c=n.target)==null?void 0:c.cursor);const l=this.clonePointerEvent(n,"pointerenter");for(l.eventPhase=l.AT_TARGET;l.target&&l.target!==this.rootTarget.parent;)l.currentTarget=l.target,this.notifyTarget(l),o&&this.notifyTarget(l,"mouseenter"),l.target=l.target.parent;r.overTargets=n.composedPath(),this.freeEvent(n),this.freeEvent(l)}mapPointerOut(t){if(!(t instanceof A)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const r=this.trackingData(t.pointerId);if(r.overTargets){const n=t.pointerType==="mouse"||t.pointerType==="pen",o=this.findMountedTarget(r.overTargets),l=this.createPointerEvent(t,"pointerout",o);this.dispatchEvent(l),n&&this.dispatchEvent(l,"mouseout");const c=this.createPointerEvent(t,"pointerleave",o);for(c.eventPhase=c.AT_TARGET;c.target&&c.target!==this.rootTarget.parent;)c.currentTarget=c.target,this.notifyTarget(c),n&&this.notifyTarget(c,"mouseleave"),c.target=c.target.parent;r.overTargets=null,this.freeEvent(l),this.freeEvent(c)}this.cursor=null}mapPointerUp(t){if(!(t instanceof A)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const r=performance.now(),n=this.createPointerEvent(t);if(this.dispatchEvent(n,"pointerup"),n.pointerType==="touch")this.dispatchEvent(n,"touchend");else if(n.pointerType==="mouse"||n.pointerType==="pen"){const p=n.button===2;this.dispatchEvent(n,p?"rightup":"mouseup")}const o=this.trackingData(t.pointerId),l=this.findMountedTarget(o.pressTargetsByButton[t.button]);let c=l;if(l&&!n.composedPath().includes(l)){let p=l;for(;p&&!n.composedPath().includes(p);){if(n.currentTarget=p,this.notifyTarget(n,"pointerupoutside"),n.pointerType==="touch")this.notifyTarget(n,"touchendoutside");else if(n.pointerType==="mouse"||n.pointerType==="pen"){const g=n.button===2;this.notifyTarget(n,g?"rightupoutside":"mouseupoutside")}p=p.parent}delete o.pressTargetsByButton[t.button],c=p}if(c){const p=this.clonePointerEvent(n,"click");p.target=c,p.path=null,o.clicksByButton[t.button]||(o.clicksByButton[t.button]={clickCount:0,target:p.target,timeStamp:r});const g=o.clicksByButton[t.button];if(g.target===p.target&&r-g.timeStamp<200?++g.clickCount:g.clickCount=1,g.target=p.target,g.timeStamp=r,p.detail=g.clickCount,p.pointerType==="mouse"){const _=p.button===2;this.dispatchEvent(p,_?"rightclick":"click")}else p.pointerType==="touch"&&this.dispatchEvent(p,"tap");this.dispatchEvent(p,"pointertap"),this.freeEvent(p)}this.freeEvent(n)}mapPointerUpOutside(t){if(!(t instanceof A)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const r=this.trackingData(t.pointerId),n=this.findMountedTarget(r.pressTargetsByButton[t.button]),o=this.createPointerEvent(t);if(n){let l=n;for(;l;)o.currentTarget=l,this.notifyTarget(o,"pointerupoutside"),o.pointerType==="touch"?this.notifyTarget(o,"touchendoutside"):(o.pointerType==="mouse"||o.pointerType==="pen")&&this.notifyTarget(o,o.button===2?"rightupoutside":"mouseupoutside"),l=l.parent;delete r.pressTargetsByButton[t.button]}this.freeEvent(o)}mapWheel(t){if(!(t instanceof I)){console.warn("EventBoundary cannot map a non-wheel event as a wheel event");return}const r=this.createWheelEvent(t);this.dispatchEvent(r),this.freeEvent(r)}findMountedTarget(t){if(!t)return null;let r=t[0];for(let n=1;n<t.length&&t[n].parent===r;n++)r=t[n];return r}createPointerEvent(t,r,n){var l;const o=this.allocateEvent(A);return this.copyPointerData(t,o),this.copyMouseData(t,o),this.copyData(t,o),o.nativeEvent=t.nativeEvent,o.originalEvent=t,o.target=(l=n!=null?n:this.hitTest(o.global.x,o.global.y))!=null?l:this._hitElements[0],typeof r=="string"&&(o.type=r),o}createWheelEvent(t){const r=this.allocateEvent(I);return this.copyWheelData(t,r),this.copyMouseData(t,r),this.copyData(t,r),r.nativeEvent=t.nativeEvent,r.originalEvent=t,r.target=this.hitTest(r.global.x,r.global.y),r}clonePointerEvent(t,r){const n=this.allocateEvent(A);return n.nativeEvent=t.nativeEvent,n.originalEvent=t.originalEvent,this.copyPointerData(t,n),this.copyMouseData(t,n),this.copyData(t,n),n.target=t.target,n.path=t.composedPath().slice(),n.type=r!=null?r:n.type,n}copyWheelData(t,r){r.deltaMode=t.deltaMode,r.deltaX=t.deltaX,r.deltaY=t.deltaY,r.deltaZ=t.deltaZ}copyPointerData(t,r){t instanceof A&&r instanceof A&&(r.pointerId=t.pointerId,r.width=t.width,r.height=t.height,r.isPrimary=t.isPrimary,r.pointerType=t.pointerType,r.pressure=t.pressure,r.tangentialPressure=t.tangentialPressure,r.tiltX=t.tiltX,r.tiltY=t.tiltY,r.twist=t.twist)}copyMouseData(t,r){t instanceof ot&&r instanceof ot&&(r.altKey=t.altKey,r.button=t.button,r.buttons=t.buttons,r.client.copyFrom(t.client),r.ctrlKey=t.ctrlKey,r.metaKey=t.metaKey,r.movement.copyFrom(t.movement),r.screen.copyFrom(t.screen),r.shiftKey=t.shiftKey,r.global.copyFrom(t.global))}copyData(t,r){r.isTrusted=t.isTrusted,r.srcElement=t.srcElement,r.timeStamp=performance.now(),r.type=t.type,r.detail=t.detail,r.view=t.view,r.which=t.which,r.layer.copyFrom(t.layer),r.page.copyFrom(t.page)}trackingData(t){return this.mappingState.trackingData[t]||(this.mappingState.trackingData[t]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[t]}allocateEvent(t){this.eventPool.has(t)||this.eventPool.set(t,[]);const r=this.eventPool.get(t).pop()||new t(this);return r.eventPhase=r.NONE,r.currentTarget=null,r.path=null,r.target=null,r}freeEvent(t){if(t.manager!==this)throw new Error("It is illegal to free an event not managed by this EventBoundary!");const r=t.constructor;this.eventPool.has(r)||this.eventPool.set(r,[]),this.eventPool.get(r).push(t)}notifyListeners(t,r){const n=t.currentTarget._events[r];if(n&&t.currentTarget.isInteractive())if("fn"in n)n.once&&t.currentTarget.removeListener(r,n.fn,void 0,!0),n.fn.call(n.context,t);else for(let o=0,l=n.length;o<l&&!t.propagationImmediatelyStopped;o++)n[o].once&&t.currentTarget.removeListener(r,n[o].fn,void 0,!0),n[o].fn.call(n[o].context,t)}}const N=1,Q={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"},ht=class na{constructor(t){this.supportsTouchEvents="ontouchstart"in globalThis,this.supportsPointerEvents=!!globalThis.PointerEvent,this.domElement=null,this.resolution=1,this.renderer=t,this.rootBoundary=new M(null),Ht.init(this),this.autoPreventDefault=!0,this.eventsAdded=!1,this.rootPointerEvent=new A(null),this.rootWheelEvent=new I(null),this.cursorStyles={default:"inherit",pointer:"pointer"},this.features=new Proxy(fe({},na.defaultEventFeatures),{set:(r,n,o)=>(n==="globalMove"&&(this.rootBoundary.enableGlobalMoveEvents=o),r[n]=o,!0)}),this.onPointerDown=this.onPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.onPointerOverOut=this.onPointerOverOut.bind(this),this.onWheel=this.onWheel.bind(this)}static get defaultEventMode(){return this._defaultEventMode}init(t){var o,l;const{view:r,resolution:n}=this.renderer;this.setTargetElement(r),this.resolution=n,na._defaultEventMode=(o=t.eventMode)!=null?o:"auto",Object.assign(this.features,(l=t.eventFeatures)!=null?l:{}),this.rootBoundary.enableGlobalMoveEvents=this.features.globalMove}resolutionChange(t){this.resolution=t}destroy(){this.setTargetElement(null),this.renderer=null}setCursor(t){t=t||"default";let r=!0;if(globalThis.OffscreenCanvas&&this.domElement instanceof OffscreenCanvas&&(r=!1),this.currentCursor===t)return;this.currentCursor=t;const n=this.cursorStyles[t];if(n)switch(typeof n){case"string":r&&(this.domElement.style.cursor=n);break;case"function":n(t);break;case"object":r&&Object.assign(this.domElement.style,n);break}else r&&typeof t=="string"&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,t)&&(this.domElement.style.cursor=t)}get pointer(){return this.rootPointerEvent}onPointerDown(t){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;const r=this.normalizeToPointerData(t);this.autoPreventDefault&&r[0].isNormalized&&(t.cancelable||!("cancelable"in t))&&t.preventDefault();for(let n=0,o=r.length;n<o;n++){const l=r[n],c=this.bootstrapEvent(this.rootPointerEvent,l);this.rootBoundary.mapEvent(c)}this.setCursor(this.rootBoundary.cursor)}onPointerMove(t){if(!this.features.move)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,Ht.pointerMoved();const r=this.normalizeToPointerData(t);for(let n=0,o=r.length;n<o;n++){const l=this.bootstrapEvent(this.rootPointerEvent,r[n]);this.rootBoundary.mapEvent(l)}this.setCursor(this.rootBoundary.cursor)}onPointerUp(t){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;let r=t.target;t.composedPath&&t.composedPath().length>0&&(r=t.composedPath()[0]);const n=r!==this.domElement?"outside":"",o=this.normalizeToPointerData(t);for(let l=0,c=o.length;l<c;l++){const p=this.bootstrapEvent(this.rootPointerEvent,o[l]);p.type+=n,this.rootBoundary.mapEvent(p)}this.setCursor(this.rootBoundary.cursor)}onPointerOverOut(t){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;const r=this.normalizeToPointerData(t);for(let n=0,o=r.length;n<o;n++){const l=this.bootstrapEvent(this.rootPointerEvent,r[n]);this.rootBoundary.mapEvent(l)}this.setCursor(this.rootBoundary.cursor)}onWheel(t){if(!this.features.wheel)return;const r=this.normalizeWheelEvent(t);this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.rootBoundary.mapEvent(r)}setTargetElement(t){this.removeEvents(),this.domElement=t,Ht.domElement=t,this.addEvents()}addEvents(){if(this.eventsAdded||!this.domElement)return;Ht.addTickerListener();const t=this.domElement.style;t&&(globalThis.navigator.msPointerEnabled?(t.msContentZooming="none",t.msTouchAction="none"):this.supportsPointerEvents&&(t.touchAction="none")),this.supportsPointerEvents?(globalThis.document.addEventListener("pointermove",this.onPointerMove,!0),this.domElement.addEventListener("pointerdown",this.onPointerDown,!0),this.domElement.addEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.addEventListener("pointerover",this.onPointerOverOut,!0),globalThis.addEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.addEventListener("mousemove",this.onPointerMove,!0),this.domElement.addEventListener("mousedown",this.onPointerDown,!0),this.domElement.addEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.addEventListener("mouseover",this.onPointerOverOut,!0),globalThis.addEventListener("mouseup",this.onPointerUp,!0),this.supportsTouchEvents&&(this.domElement.addEventListener("touchstart",this.onPointerDown,!0),this.domElement.addEventListener("touchend",this.onPointerUp,!0),this.domElement.addEventListener("touchmove",this.onPointerMove,!0))),this.domElement.addEventListener("wheel",this.onWheel,{passive:!0,capture:!0}),this.eventsAdded=!0}removeEvents(){if(!this.eventsAdded||!this.domElement)return;Ht.removeTickerListener();const t=this.domElement.style;globalThis.navigator.msPointerEnabled?(t.msContentZooming="",t.msTouchAction=""):this.supportsPointerEvents&&(t.touchAction=""),this.supportsPointerEvents?(globalThis.document.removeEventListener("pointermove",this.onPointerMove,!0),this.domElement.removeEventListener("pointerdown",this.onPointerDown,!0),this.domElement.removeEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.removeEventListener("pointerover",this.onPointerOverOut,!0),globalThis.removeEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.removeEventListener("mousemove",this.onPointerMove,!0),this.domElement.removeEventListener("mousedown",this.onPointerDown,!0),this.domElement.removeEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.removeEventListener("mouseover",this.onPointerOverOut,!0),globalThis.removeEventListener("mouseup",this.onPointerUp,!0),this.supportsTouchEvents&&(this.domElement.removeEventListener("touchstart",this.onPointerDown,!0),this.domElement.removeEventListener("touchend",this.onPointerUp,!0),this.domElement.removeEventListener("touchmove",this.onPointerMove,!0))),this.domElement.removeEventListener("wheel",this.onWheel,!0),this.domElement=null,this.eventsAdded=!1}mapPositionToPoint(t,r,n){const o=this.domElement.isConnected?this.domElement.getBoundingClientRect():{x:0,y:0,width:this.domElement.width,height:this.domElement.height,left:0,top:0},l=1/this.resolution;t.x=(r-o.left)*(this.domElement.width/o.width)*l,t.y=(n-o.top)*(this.domElement.height/o.height)*l}normalizeToPointerData(t){const r=[];if(this.supportsTouchEvents&&t instanceof TouchEvent)for(let n=0,o=t.changedTouches.length;n<o;n++){const l=t.changedTouches[n];typeof l.button>"u"&&(l.button=0),typeof l.buttons>"u"&&(l.buttons=1),typeof l.isPrimary>"u"&&(l.isPrimary=t.touches.length===1&&t.type==="touchstart"),typeof l.width>"u"&&(l.width=l.radiusX||1),typeof l.height>"u"&&(l.height=l.radiusY||1),typeof l.tiltX>"u"&&(l.tiltX=0),typeof l.tiltY>"u"&&(l.tiltY=0),typeof l.pointerType>"u"&&(l.pointerType="touch"),typeof l.pointerId>"u"&&(l.pointerId=l.identifier||0),typeof l.pressure>"u"&&(l.pressure=l.force||.5),typeof l.twist>"u"&&(l.twist=0),typeof l.tangentialPressure>"u"&&(l.tangentialPressure=0),typeof l.layerX>"u"&&(l.layerX=l.offsetX=l.clientX),typeof l.layerY>"u"&&(l.layerY=l.offsetY=l.clientY),l.isNormalized=!0,l.type=t.type,r.push(l)}else if(!globalThis.MouseEvent||t instanceof MouseEvent&&(!this.supportsPointerEvents||!(t instanceof globalThis.PointerEvent))){const n=t;typeof n.isPrimary>"u"&&(n.isPrimary=!0),typeof n.width>"u"&&(n.width=1),typeof n.height>"u"&&(n.height=1),typeof n.tiltX>"u"&&(n.tiltX=0),typeof n.tiltY>"u"&&(n.tiltY=0),typeof n.pointerType>"u"&&(n.pointerType="mouse"),typeof n.pointerId>"u"&&(n.pointerId=N),typeof n.pressure>"u"&&(n.pressure=.5),typeof n.twist>"u"&&(n.twist=0),typeof n.tangentialPressure>"u"&&(n.tangentialPressure=0),n.isNormalized=!0,r.push(n)}else r.push(t);return r}normalizeWheelEvent(t){const r=this.rootWheelEvent;return this.transferMouseData(r,t),r.deltaX=t.deltaX,r.deltaY=t.deltaY,r.deltaZ=t.deltaZ,r.deltaMode=t.deltaMode,this.mapPositionToPoint(r.screen,t.clientX,t.clientY),r.global.copyFrom(r.screen),r.offset.copyFrom(r.screen),r.nativeEvent=t,r.type=t.type,r}bootstrapEvent(t,r){return t.originalEvent=null,t.nativeEvent=r,t.pointerId=r.pointerId,t.width=r.width,t.height=r.height,t.isPrimary=r.isPrimary,t.pointerType=r.pointerType,t.pressure=r.pressure,t.tangentialPressure=r.tangentialPressure,t.tiltX=r.tiltX,t.tiltY=r.tiltY,t.twist=r.twist,this.transferMouseData(t,r),this.mapPositionToPoint(t.screen,r.clientX,r.clientY),t.global.copyFrom(t.screen),t.offset.copyFrom(t.screen),t.isTrusted=r.isTrusted,t.type==="pointerleave"&&(t.type="pointerout"),t.type.startsWith("mouse")&&(t.type=t.type.replace("mouse","pointer")),t.type.startsWith("touch")&&(t.type=Q[t.type]||t.type),t}transferMouseData(t,r){t.isTrusted=r.isTrusted,t.srcElement=r.srcElement,t.timeStamp=performance.now(),t.type=r.type,t.altKey=r.altKey,t.button=r.button,t.buttons=r.buttons,t.client.x=r.clientX,t.client.y=r.clientY,t.ctrlKey=r.ctrlKey,t.metaKey=r.metaKey,t.movement.x=r.movementX,t.movement.y=r.movementY,t.page.x=r.pageX,t.page.y=r.pageY,t.relatedTarget=null,t.shiftKey=r.shiftKey}};ht.extension={name:"events",type:[f.nw.RendererSystem,f.nw.CanvasRendererSystem]},ht.defaultEventFeatures={move:!0,globalMove:!0,click:!0,wheel:!0};let gt=ht;f.Rw.add(gt);function lt(d){return d==="dynamic"||d==="static"}const Tt={onclick:null,onmousedown:null,onmouseenter:null,onmouseleave:null,onmousemove:null,onglobalmousemove:null,onmouseout:null,onmouseover:null,onmouseup:null,onmouseupoutside:null,onpointercancel:null,onpointerdown:null,onpointerenter:null,onpointerleave:null,onpointermove:null,onglobalpointermove:null,onpointerout:null,onpointerover:null,onpointertap:null,onpointerup:null,onpointerupoutside:null,onrightclick:null,onrightdown:null,onrightup:null,onrightupoutside:null,ontap:null,ontouchcancel:null,ontouchend:null,ontouchendoutside:null,ontouchmove:null,onglobaltouchmove:null,ontouchstart:null,onwheel:null,_internalInteractive:void 0,get interactive(){var d;return(d=this._internalInteractive)!=null?d:lt(gt.defaultEventMode)},set interactive(d){f.P6.deprecation("7.2.0","Setting interactive is deprecated, use eventMode = 'none'/'passive'/'auto'/'static'/'dynamic' instead."),this._internalInteractive=d,this.eventMode=d?"static":"auto"},_internalEventMode:void 0,get eventMode(){var d;return(d=this._internalEventMode)!=null?d:gt.defaultEventMode},set eventMode(d){this._internalInteractive=lt(d),this._internalEventMode=d},isInteractive(){return this.eventMode==="static"||this.eventMode==="dynamic"},interactiveChildren:!0,hitArea:null,addEventListener(d,t,r){const n=typeof r=="boolean"&&r||typeof r=="object"&&r.capture,o=typeof t=="function"?void 0:t;d=n?`${d}capture`:d,t=typeof t=="function"?t:t.handleEvent,this.on(d,t,o)},removeEventListener(d,t,r){const n=typeof r=="boolean"&&r||typeof r=="object"&&r.capture,o=typeof t=="function"?void 0:t;d=n?`${d}capture`:d,t=typeof t=="function"?t:t.handleEvent,this.off(d,t,o)},dispatchEvent(d){if(!(d instanceof Nt))throw new Error("DisplayObject cannot propagate events outside of the Federated Events API");return d.defaultPrevented=!1,d.path=null,d.target=this,d.manager.dispatchEvent(d),!d.defaultPrevented}};at.mixin(Tt);const wt={accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:null,accessibleType:"button",accessiblePointerEvents:"auto",accessibleChildren:!0,renderId:-1};at.mixin(wt);const Mt=9,Ft=100,ae=0,qt=0,Et=2,ue=1,Ot=-1e3,Lt=-1e3,xe=2;class sr{constructor(t){this.debug=!1,this._isActive=!1,this._isMobileAccessibility=!1,this.pool=[],this.renderId=0,this.children=[],this.androidUpdateCount=0,this.androidUpdateFrequency=500,this._hookDiv=null,(f.P6.isMobile.tablet||f.P6.isMobile.phone)&&this.createTouchHook();const r=document.createElement("div");r.style.width=`${Ft}px`,r.style.height=`${Ft}px`,r.style.position="absolute",r.style.top=`${ae}px`,r.style.left=`${qt}px`,r.style.zIndex=Et.toString(),this.div=r,this.renderer=t,this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),globalThis.addEventListener("keydown",this._onKeyDown,!1)}get isActive(){return this._isActive}get isMobileAccessibility(){return this._isMobileAccessibility}createTouchHook(){const t=document.createElement("button");t.style.width=`${ue}px`,t.style.height=`${ue}px`,t.style.position="absolute",t.style.top=`${Ot}px`,t.style.left=`${Lt}px`,t.style.zIndex=xe.toString(),t.style.backgroundColor="#FF0000",t.title="select to enable accessibility for this content",t.addEventListener("focus",()=>{this._isMobileAccessibility=!0,this.activate(),this.destroyTouchHook()}),document.body.appendChild(t),this._hookDiv=t}destroyTouchHook(){this._hookDiv&&(document.body.removeChild(this._hookDiv),this._hookDiv=null)}activate(){var t;this._isActive||(this._isActive=!0,globalThis.document.addEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),(t=this.renderer.view.parentNode)==null||t.appendChild(this.div))}deactivate(){var t;!this._isActive||this._isMobileAccessibility||(this._isActive=!1,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),(t=this.div.parentNode)==null||t.removeChild(this.div))}updateAccessibleObjects(t){if(!t.visible||!t.accessibleChildren)return;t.accessible&&t.isInteractive()&&(t._accessibleActive||this.addChild(t),t.renderId=this.renderId);const r=t.children;if(r)for(let n=0;n<r.length;n++)this.updateAccessibleObjects(r[n])}update(){const t=performance.now();if(f.P6.isMobile.android.device&&t<this.androidUpdateCount||(this.androidUpdateCount=t+this.androidUpdateFrequency,!this.renderer.renderingToScreen))return;this.renderer.lastObjectRendered&&this.updateAccessibleObjects(this.renderer.lastObjectRendered);const{x:r,y:n,width:o,height:l}=this.renderer.view.getBoundingClientRect(),{width:c,height:p,resolution:g}=this.renderer,_=o/c*g,x=l/p*g;let v=this.div;v.style.left=`${r}px`,v.style.top=`${n}px`,v.style.width=`${c}px`,v.style.height=`${p}px`;for(let T=0;T<this.children.length;T++){const b=this.children[T];if(b.renderId!==this.renderId)b._accessibleActive=!1,f.P6.removeItems(this.children,T,1),this.div.removeChild(b._accessibleDiv),this.pool.push(b._accessibleDiv),b._accessibleDiv=null,T--;else{v=b._accessibleDiv;let w=b.hitArea;const R=b.worldTransform;b.hitArea?(v.style.left=`${(R.tx+w.x*R.a)*_}px`,v.style.top=`${(R.ty+w.y*R.d)*x}px`,v.style.width=`${w.width*R.a*_}px`,v.style.height=`${w.height*R.d*x}px`):(w=b.getBounds(),this.capHitArea(w),v.style.left=`${w.x*_}px`,v.style.top=`${w.y*x}px`,v.style.width=`${w.width*_}px`,v.style.height=`${w.height*x}px`,v.title!==b.accessibleTitle&&b.accessibleTitle!==null&&(v.title=b.accessibleTitle),v.getAttribute("aria-label")!==b.accessibleHint&&b.accessibleHint!==null&&v.setAttribute("aria-label",b.accessibleHint)),(b.accessibleTitle!==v.title||b.tabIndex!==v.tabIndex)&&(v.title=b.accessibleTitle,v.tabIndex=b.tabIndex,this.debug&&this.updateDebugHTML(v))}}this.renderId++}updateDebugHTML(t){t.innerHTML=`type: ${t.type}</br> title : ${t.title}</br> tabIndex: ${t.tabIndex}`}capHitArea(t){t.x<0&&(t.width+=t.x,t.x=0),t.y<0&&(t.height+=t.y,t.y=0);const{width:r,height:n}=this.renderer;t.x+t.width>r&&(t.width=r-t.x),t.y+t.height>n&&(t.height=n-t.y)}addChild(t){let r=this.pool.pop();r||(r=document.createElement("button"),r.style.width=`${Ft}px`,r.style.height=`${Ft}px`,r.style.backgroundColor=this.debug?"rgba(255,255,255,0.5)":"transparent",r.style.position="absolute",r.style.zIndex=Et.toString(),r.style.borderStyle="none",navigator.userAgent.toLowerCase().includes("chrome")?r.setAttribute("aria-live","off"):r.setAttribute("aria-live","polite"),navigator.userAgent.match(/rv:.*Gecko\//)?r.setAttribute("aria-relevant","additions"):r.setAttribute("aria-relevant","text"),r.addEventListener("click",this._onClick.bind(this)),r.addEventListener("focus",this._onFocus.bind(this)),r.addEventListener("focusout",this._onFocusOut.bind(this))),r.style.pointerEvents=t.accessiblePointerEvents,r.type=t.accessibleType,t.accessibleTitle&&t.accessibleTitle!==null?r.title=t.accessibleTitle:(!t.accessibleHint||t.accessibleHint===null)&&(r.title=`displayObject ${t.tabIndex}`),t.accessibleHint&&t.accessibleHint!==null&&r.setAttribute("aria-label",t.accessibleHint),this.debug&&this.updateDebugHTML(r),t._accessibleActive=!0,t._accessibleDiv=r,r.displayObject=t,this.children.push(t),this.div.appendChild(t._accessibleDiv),t._accessibleDiv.tabIndex=t.tabIndex}_dispatchEvent(t,r){const{displayObject:n}=t.target,o=this.renderer.events.rootBoundary,l=Object.assign(new Nt(o),{target:n});o.rootTarget=this.renderer.lastObjectRendered,r.forEach(c=>o.dispatchEvent(l,c))}_onClick(t){this._dispatchEvent(t,["click","pointertap","tap"])}_onFocus(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","assertive"),this._dispatchEvent(t,["mouseover"])}_onFocusOut(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","polite"),this._dispatchEvent(t,["mouseout"])}_onKeyDown(t){t.keyCode===Mt&&this.activate()}_onMouseMove(t){t.movementX===0&&t.movementY===0||this.deactivate()}destroy(){this.destroyTouchHook(),this.div=null,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null}}sr.extension={name:"accessibility",type:[f.nw.RendererPlugin,f.nw.CanvasRendererPlugin]},f.Rw.add(sr);const qe=class aa{constructor(t){this.stage=new J,t=Object.assign({forceCanvas:!1},t),this.renderer=(0,f.e6)(t),aa._plugins.forEach(r=>{r.init.call(this,t)})}render(){this.renderer.render(this.stage)}get view(){var t;return(t=this.renderer)==null?void 0:t.view}get screen(){var t;return(t=this.renderer)==null?void 0:t.screen}destroy(t,r){const n=aa._plugins.slice(0);n.reverse(),n.forEach(o=>{o.destroy.call(this)}),this.stage.destroy(r),this.stage=null,this.renderer.destroy(t),this.renderer=null}};qe._plugins=[];let He=qe;f.Rw.handleByList(f.nw.Application,He._plugins);class Xe{static init(t){Object.defineProperty(this,"resizeTo",{set(r){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=r,r&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get(){return this._resizeTo}}),this.queueResize=()=>{this._resizeTo&&(this.cancelResize(),this._resizeId=requestAnimationFrame(()=>this.resize()))},this.cancelResize=()=>{this._resizeId&&(cancelAnimationFrame(this._resizeId),this._resizeId=null)},this.resize=()=>{if(!this._resizeTo)return;this.cancelResize();let r,n;if(this._resizeTo===globalThis.window)r=globalThis.innerWidth,n=globalThis.innerHeight;else{const{clientWidth:o,clientHeight:l}=this._resizeTo;r=o,n=l}this.renderer.resize(r,n),this.render()},this._resizeId=null,this._resizeTo=null,this.resizeTo=t.resizeTo||null}static destroy(){globalThis.removeEventListener("resize",this.queueResize),this.cancelResize(),this.cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null}}Xe.extension=f.nw.Application,f.Rw.add(Xe);const pi={loader:f.nw.LoadParser,resolver:f.nw.ResolveParser,cache:f.nw.CacheParser,detection:f.nw.DetectionParser};f.Rw.handle(f.nw.Asset,d=>{const t=d.ref;Object.entries(pi).filter(([r])=>!!t[r]).forEach(([r,n])=>{var o;return f.Rw.add(Object.assign(t[r],{extension:(o=t[r].extension)!=null?o:n}))})},d=>{const t=d.ref;Object.keys(pi).filter(r=>!!t[r]).forEach(r=>f.Rw.remove(t[r]))});class zi{constructor(t,r=!1){this._loader=t,this._assetList=[],this._isLoading=!1,this._maxConcurrent=1,this.verbose=r}add(t){t.forEach(r=>{this._assetList.push(r)}),this.verbose&&console.log("[BackgroundLoader] assets: ",this._assetList),this._isActive&&!this._isLoading&&this._next()}_next(){return Pt(this,null,function*(){if(this._assetList.length&&this._isActive){this._isLoading=!0;const t=[],r=Math.min(this._assetList.length,this._maxConcurrent);for(let n=0;n<r;n++)t.push(this._assetList.pop());yield this._loader.load(t),this._isLoading=!1,this._next()}})}get active(){return this._isActive}set active(t){this._isActive!==t&&(this._isActive=t,t&&!this._isLoading&&this._next())}}function Ve(d,t){const r=d.split("?")[0],n=f.P6.path.extname(r).toLowerCase();return Array.isArray(t)?t.includes(n):n===t}const Ce=(d,t,r=!1)=>(Array.isArray(d)||(d=[d]),t?d.map(n=>typeof n=="string"||r?t(n):n):d);class Kr{constructor(){this._parsers=[],this._cache=new Map,this._cacheMap=new Map}reset(){this._cacheMap.clear(),this._cache.clear()}has(t){return this._cache.has(t)}get(t){const r=this._cache.get(t);return r||console.warn(`[Assets] Asset id ${t} was not found in the Cache`),r}set(t,r){const n=Ce(t);let o;for(let p=0;p<this.parsers.length;p++){const g=this.parsers[p];if(g.test(r)){o=g.getCacheableAssets(n,r);break}}o||(o={},n.forEach(p=>{o[p]=r}));const l=Object.keys(o),c={cacheKeys:l,keys:n};if(n.forEach(p=>{this._cacheMap.set(p,c)}),l.forEach(p=>{this._cache.has(p)&&this._cache.get(p)!==r&&console.warn("[Cache] already has key:",p),this._cache.set(p,o[p])}),r instanceof f.xE){const p=r;n.forEach(g=>{p.baseTexture!==f.xE.EMPTY.baseTexture&&f.VL.addToCache(p.baseTexture,g),f.xE.addToCache(p,g)})}}remove(t){if(!this._cacheMap.has(t)){console.warn(`[Assets] Asset id ${t} was not found in the Cache`);return}const r=this._cacheMap.get(t);r.cacheKeys.forEach(n=>{this._cache.delete(n)}),r.keys.forEach(n=>{this._cacheMap.delete(n)})}get parsers(){return this._parsers}}const Ze=new Kr,Ee=d=>!Array.isArray(d);class ge{constructor(){this._parsers=[],this._parsersValidated=!1,this.parsers=new Proxy(this._parsers,{set:(t,r,n)=>(this._parsersValidated=!1,t[r]=n,!0)}),this.promiseCache={}}reset(){this._parsersValidated=!1,this.promiseCache={}}_getLoadPromiseAndParser(t,r){const n={promise:null,parser:null};return n.promise=(()=>Pt(this,null,function*(){var c,p;let o=null,l=null;if(r.loadParser&&(l=this._parserHash[r.loadParser],l||console.warn(`[Assets] specified load parser "${r.loadParser}" not found while loading ${t}`)),!l){for(let g=0;g<this.parsers.length;g++){const _=this.parsers[g];if(_.load&&((c=_.test)!=null&&c.call(_,t,r,this))){l=_;break}}if(!l)return console.warn(`[Assets] ${t} could not be loaded as we don't know how to parse it, ensure the correct parser has been added`),null}o=yield l.load(t,r,this),n.parser=l;for(let g=0;g<this.parsers.length;g++){const _=this.parsers[g];_.parse&&_.parse&&(yield(p=_.testParse)==null?void 0:p.call(_,o,r,this))&&(o=(yield _.parse(o,r,this))||o,n.parser=_)}return o}))(),n}load(t,r){return Pt(this,null,function*(){this._parsersValidated||this._validateParsers();let n=0;const o={},l=Ee(t),c=Ce(t,_=>({alias:[_],src:_})),p=c.length,g=c.map(_=>Pt(this,null,function*(){const x=f.P6.path.toAbsolute(_.src);if(!o[_.src])try{this.promiseCache[x]||(this.promiseCache[x]=this._getLoadPromiseAndParser(x,_)),o[_.src]=yield this.promiseCache[x].promise,r&&r(++n/p)}catch(v){throw delete this.promiseCache[x],delete o[_.src],new Error(`[Loader.load] Failed to load ${x}.
${v}`)}}));return yield Promise.all(g),l?o[c[0].src]:o})}unload(t){return Pt(this,null,function*(){const r=Ce(t,n=>({alias:[n],src:n})).map(n=>Pt(this,null,function*(){var c,p;const o=f.P6.path.toAbsolute(n.src),l=this.promiseCache[o];if(l){const g=yield l.promise;delete this.promiseCache[o],(p=(c=l.parser)==null?void 0:c.unload)==null||p.call(c,g,n,this)}}));yield Promise.all(r)})}_validateParsers(){this._parsersValidated=!0,this._parserHash=this._parsers.filter(t=>t.name).reduce((t,r)=>(t[r.name]&&console.warn(`[Assets] loadParser name conflict "${r.name}"`),fi(fe({},t),{[r.name]:r})),{})}}var ce=(d=>(d[d.Low=0]="Low",d[d.Normal=1]="Normal",d[d.High=2]="High",d))(ce||{});function Qe(d,t){if(Array.isArray(t)){for(const r of t)if(d.startsWith(`data:${r}`))return!0;return!1}return d.startsWith(`data:${t}`)}const mi=".json",yr="application/json",Or={extension:{type:f.nw.LoadParser,priority:ce.Low},name:"loadJson",test(d){return Qe(d,yr)||Ve(d,mi)},load(d){return Pt(this,null,function*(){return yield(yield f.Xd.ADAPTER.fetch(d)).json()})}};f.Rw.add(Or);const U=".txt",W="text/plain",Qt={name:"loadTxt",extension:{type:f.nw.LoadParser,priority:ce.Low},test(d){return Qe(d,W)||Ve(d,U)},load(d){return Pt(this,null,function*(){return yield(yield f.Xd.ADAPTER.fetch(d)).text()})}};f.Rw.add(Qt);const ee=["normal","bold","100","200","300","400","500","600","700","800","900"],pe=[".ttf",".otf",".woff",".woff2"],Yt=["font/ttf","font/otf","font/woff","font/woff2"],Me=/^(--|-?[A-Z_])[0-9A-Z_-]*$/i;function Je(d){const t=f.P6.path.extname(d),r=f.P6.path.basename(d,t).replace(/(-|_)/g," ").toLowerCase().split(" ").map(l=>l.charAt(0).toUpperCase()+l.slice(1));let n=r.length>0;for(const l of r)if(!l.match(Me)){n=!1;break}let o=r.join(" ");return n||(o=`"${o.replace(/[\\"]/g,"\\$&")}"`),o}const Re=/^[0-9A-Za-z%:/?#\[\]@!\$&'()\*\+,;=\-._~]*$/;function We(d){return Re.test(d)?d:encodeURI(d)}const qr={extension:{type:f.nw.LoadParser,priority:ce.Low},name:"loadWebFont",test(d){return Qe(d,Yt)||Ve(d,pe)},load(d,t){return Pt(this,null,function*(){var n,o,l,c,p,g;const r=f.Xd.ADAPTER.getFontFaceSet();if(r){const _=[],x=(o=(n=t.data)==null?void 0:n.family)!=null?o:Je(d),v=(p=(c=(l=t.data)==null?void 0:l.weights)==null?void 0:c.filter(b=>ee.includes(b)))!=null?p:["normal"],T=(g=t.data)!=null?g:{};for(let b=0;b<v.length;b++){const w=v[b],R=new FontFace(x,`url(${We(d)})`,fi(fe({},T),{weight:w}));yield R.load(),r.add(R),_.push(R)}return _.length===1?_[0]:_}return console.warn("[loadWebFont] FontFace API is not supported. Skipping loading font"),null})},unload(d){(Array.isArray(d)?d:[d]).forEach(t=>f.Xd.ADAPTER.getFontFaceSet().delete(t))}};f.Rw.add(qr);let Le=0,we;const Zr="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=",$i={id:"checkImageBitmap",code:`
    async function checkImageBitmap()
    {
        try
        {
            if (typeof createImageBitmap !== 'function') return false;

            const response = await fetch('${Zr}');
            const imageBlob =  await response.blob();
            const imageBitmap = await createImageBitmap(imageBlob);

            return imageBitmap.width === 1 && imageBitmap.height === 1;
        }
        catch (e)
        {
            return false;
        }
    }
    checkImageBitmap().then((result) => { self.postMessage(result); });
    `},Lr={id:"loadImageBitmap",code:`
    async function loadImageBitmap(url)
    {
        const response = await fetch(url);

        if (!response.ok)
        {
            throw new Error(\`[WorkerManager.loadImageBitmap] Failed to fetch \${url}: \`
                + \`\${response.status} \${response.statusText}\`);
        }

        const imageBlob =  await response.blob();
        const imageBitmap = await createImageBitmap(imageBlob);

        return imageBitmap;
    }
    self.onmessage = async (event) =>
    {
        try
        {
            const imageBitmap = await loadImageBitmap(event.data.data[0]);

            self.postMessage({
                data: imageBitmap,
                uuid: event.data.uuid,
                id: event.data.id,
            }, [imageBitmap]);
        }
        catch(e)
        {
            self.postMessage({
                error: e,
                uuid: event.data.uuid,
                id: event.data.id,
            });
        }
    };`};let Ne;class Nr{constructor(){this._initialized=!1,this._createdWorkers=0,this.workerPool=[],this.queue=[],this.resolveHash={}}isImageBitmapSupported(){return this._isImageBitmapSupported!==void 0?this._isImageBitmapSupported:(this._isImageBitmapSupported=new Promise(t=>{const r=URL.createObjectURL(new Blob([$i.code],{type:"application/javascript"})),n=new Worker(r);n.addEventListener("message",o=>{n.terminate(),URL.revokeObjectURL(r),t(o.data)})}),this._isImageBitmapSupported)}loadImageBitmap(t){return this._run("loadImageBitmap",[t])}_initWorkers(){return Pt(this,null,function*(){this._initialized||(this._initialized=!0)})}getWorker(){we===void 0&&(we=navigator.hardwareConcurrency||4);let t=this.workerPool.pop();return!t&&this._createdWorkers<we&&(Ne||(Ne=URL.createObjectURL(new Blob([Lr.code],{type:"application/javascript"}))),this._createdWorkers++,t=new Worker(Ne),t.addEventListener("message",r=>{this.complete(r.data),this.returnWorker(r.target),this.next()})),t}returnWorker(t){this.workerPool.push(t)}complete(t){t.error!==void 0?this.resolveHash[t.uuid].reject(t.error):this.resolveHash[t.uuid].resolve(t.data),this.resolveHash[t.uuid]=null}_run(t,r){return Pt(this,null,function*(){yield this._initWorkers();const n=new Promise((o,l)=>{this.queue.push({id:t,arguments:r,resolve:o,reject:l})});return this.next(),n})}next(){if(!this.queue.length)return;const t=this.getWorker();if(!t)return;const r=this.queue.pop(),n=r.id;this.resolveHash[Le]={resolve:r.resolve,reject:r.reject},t.postMessage({data:r.arguments,uuid:Le++,id:n})}}const ze=new Nr;function Ae(d,t,r){d.resource.internal=!0;const n=new f.xE(d),o=()=>{delete t.promiseCache[r],Ze.has(r)&&Ze.remove(r)};return n.baseTexture.once("destroyed",()=>{r in t.promiseCache&&(console.warn("[Assets] A BaseTexture managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the BaseTexture."),o())}),n.once("destroyed",()=>{d.destroyed||(console.warn("[Assets] A Texture managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the Texture."),o())}),n}const Ur=[".jpeg",".jpg",".png",".webp",".avif"],gi=["image/jpeg","image/png","image/webp","image/avif"];function ji(d){return Pt(this,null,function*(){const t=yield f.Xd.ADAPTER.fetch(d);if(!t.ok)throw new Error(`[loadImageBitmap] Failed to fetch ${d}: ${t.status} ${t.statusText}`);const r=yield t.blob();return yield createImageBitmap(r)})}const nr={name:"loadTextures",extension:{type:f.nw.LoadParser,priority:ce.High},config:{preferWorkers:!0,preferCreateImageBitmap:!0,crossOrigin:"anonymous"},test(d){return Qe(d,gi)||Ve(d,Ur)},load(d,t,r){return Pt(this,null,function*(){var p,g;const n=globalThis.createImageBitmap&&this.config.preferCreateImageBitmap;let o;n?this.config.preferWorkers&&(yield ze.isImageBitmapSupported())?o=yield ze.loadImageBitmap(d):o=yield ji(d):o=yield new Promise((_,x)=>{const v=new Image;v.crossOrigin=this.config.crossOrigin,v.src=d,v.complete?_(v):(v.onload=()=>_(v),v.onerror=T=>x(T))});const l=fe({},t.data);(p=l.resolution)!=null||(l.resolution=f.P6.getResolutionOfUrl(d)),n&&((g=l.resourceOptions)==null?void 0:g.ownsImageBitmap)===void 0&&(l.resourceOptions=fe({},l.resourceOptions),l.resourceOptions.ownsImageBitmap=!0);const c=new f.VL(o,l);return c.resource.src=d,Ae(c,r,d)})},unload(d){d.destroy(!0)}};f.Rw.add(nr);const tr=".svg",Se="image/svg+xml",_i={extension:{type:f.nw.LoadParser,priority:ce.High},name:"loadSVG",test(d){return Qe(d,Se)||Ve(d,tr)},testParse(d){return Pt(this,null,function*(){return f.pX.test(d)})},parse(d,t,r){return Pt(this,null,function*(){var l;const n=new f.pX(d,(l=t==null?void 0:t.data)==null?void 0:l.resourceOptions);yield n.load();const o=new f.VL(n,fe({resolution:f.P6.getResolutionOfUrl(d)},t==null?void 0:t.data));return o.resource.src=t.src,Ae(o,r,t.src)})},load(d,t){return Pt(this,null,function*(){return(yield f.Xd.ADAPTER.fetch(d)).text()})},unload:nr.unload};f.Rw.add(_i);const Yi=[".mp4",".m4v",".webm",".ogv"],Qr=["video/mp4","video/webm","video/ogg"],ar={name:"loadVideo",extension:{type:f.nw.LoadParser,priority:ce.High},config:{defaultAutoPlay:!0},test(d){return Qe(d,Qr)||Ve(d,Yi)},load(d,t,r){return Pt(this,null,function*(){var c;let n;const o=yield(yield f.Xd.ADAPTER.fetch(d)).blob(),l=URL.createObjectURL(o);try{const p=fe({autoPlay:this.config.defaultAutoPlay},(c=t==null?void 0:t.data)==null?void 0:c.resourceOptions),g=new f.eH(l,p);yield g.load();const _=new f.VL(g,fe({alphaMode:yield f.P6.detectVideoAlphaMode(),resolution:f.P6.getResolutionOfUrl(d)},t==null?void 0:t.data));_.resource.src=d,n=Ae(_,r,d),n.baseTexture.once("destroyed",()=>{URL.revokeObjectURL(l)})}catch(p){throw URL.revokeObjectURL(l),p}return n})},unload(d){d.destroy(!0)}};f.Rw.add(ar);function xr(d,t,r,n,o){const l=t[r];for(let c=0;c<l.length;c++){const p=l[c];r<t.length-1?xr(d.replace(n[r],p),t,r+1,n,o):o.push(d.replace(n[r],p))}}function Jr(d){const t=/\{(.*?)\}/g,r=d.match(t),n=[];if(r){const o=[];r.forEach(l=>{const c=l.substring(1,l.length-1).split(",");o.push(c)}),xr(d,o,0,r,n)}else n.push(d);return n}class yi{constructor(){this._defaultBundleIdentifierOptions={connector:"-",createBundleAssetId:(t,r)=>`${t}${this._bundleIdConnector}${r}`,extractAssetIdFromBundle:(t,r)=>r.replace(`${t}${this._bundleIdConnector}`,"")},this._bundleIdConnector=this._defaultBundleIdentifierOptions.connector,this._createBundleAssetId=this._defaultBundleIdentifierOptions.createBundleAssetId,this._extractAssetIdFromBundle=this._defaultBundleIdentifierOptions.extractAssetIdFromBundle,this._assetMap={},this._preferredOrder=[],this._parsers=[],this._resolverHash={},this._bundles={}}setBundleIdentifier(t){var r,n,o;if(this._bundleIdConnector=(r=t.connector)!=null?r:this._bundleIdConnector,this._createBundleAssetId=(n=t.createBundleAssetId)!=null?n:this._createBundleAssetId,this._extractAssetIdFromBundle=(o=t.extractAssetIdFromBundle)!=null?o:this._extractAssetIdFromBundle,this._extractAssetIdFromBundle("foo",this._createBundleAssetId("foo","bar"))!=="bar")throw new Error("[Resolver] GenerateBundleAssetId are not working correctly")}prefer(...t){t.forEach(r=>{this._preferredOrder.push(r),r.priority||(r.priority=Object.keys(r.params))}),this._resolverHash={}}set basePath(t){this._basePath=t}get basePath(){return this._basePath}set rootPath(t){this._rootPath=t}get rootPath(){return this._rootPath}get parsers(){return this._parsers}reset(){this.setBundleIdentifier(this._defaultBundleIdentifierOptions),this._assetMap={},this._preferredOrder=[],this._resolverHash={},this._rootPath=null,this._basePath=null,this._manifest=null,this._bundles={},this._defaultSearchParams=null}setDefaultSearchParams(t){if(typeof t=="string")this._defaultSearchParams=t;else{const r=t;this._defaultSearchParams=Object.keys(r).map(n=>`${encodeURIComponent(n)}=${encodeURIComponent(r[n])}`).join("&")}}getAlias(t){const{alias:r,name:n,src:o,srcs:l}=t;return Ce(r||n||o||l,c=>{var p;return typeof c=="string"?c:Array.isArray(c)?c.map(g=>{var _,x;return(x=(_=g==null?void 0:g.src)!=null?_:g==null?void 0:g.srcs)!=null?x:g}):c!=null&&c.src||c!=null&&c.srcs?(p=c.src)!=null?p:c.srcs:c},!0)}addManifest(t){this._manifest&&console.warn("[Resolver] Manifest already exists, this will be overwritten"),this._manifest=t,t.bundles.forEach(r=>{this.addBundle(r.name,r.assets)})}addBundle(t,r){const n=[];Array.isArray(r)?r.forEach(o=>{var g,_;const l=(g=o.src)!=null?g:o.srcs,c=(_=o.alias)!=null?_:o.name;let p;if(typeof c=="string"){const x=this._createBundleAssetId(t,c);n.push(x),p=[c,x]}else{const x=c.map(v=>this._createBundleAssetId(t,v));n.push(...x),p=[...c,...x]}this.add(fi(fe({},o),{alias:p,src:l}))}):Object.keys(r).forEach(o=>{var c;const l=[o,this._createBundleAssetId(t,o)];if(typeof r[o]=="string")this.add({alias:l,src:r[o]});else if(Array.isArray(r[o]))this.add({alias:l,src:r[o]});else{const p=r[o],g=(c=p.src)!=null?c:p.srcs;this.add(fi(fe({},p),{alias:l,src:Array.isArray(g)?g:[g]}))}n.push(...l)}),this._bundles[t]=n}add(t,r,n,o,l){const c=[];typeof t=="string"||Array.isArray(t)&&typeof t[0]=="string"?(f.P6.deprecation("7.2.0",`Assets.add now uses an object instead of individual parameters.
Please use Assets.add({ alias, src, data, format, loadParser }) instead.`),c.push({alias:t,src:r,data:n,format:o,loadParser:l})):Array.isArray(t)?c.push(...t):c.push(t);let p;p=g=>{this.hasKey(g)&&console.warn(`[Resolver] already has key: ${g} overwriting`)},Ce(c).forEach(g=>{const{src:_,srcs:x}=g;let{data:v,format:T,loadParser:b}=g;const w=Ce(_||x).map(L=>typeof L=="string"?Jr(L):Array.isArray(L)?L:[L]),R=this.getAlias(g);Array.isArray(R)?R.forEach(p):p(R);const k=[];w.forEach(L=>{L.forEach(nt=>{var tt,St,Wt;let $={};if(typeof nt!="object"){$.src=nt;for(let Ct=0;Ct<this._parsers.length;Ct++){const It=this._parsers[Ct];if(It.test(nt)){$=It.parse(nt);break}}}else v=(tt=nt.data)!=null?tt:v,T=(St=nt.format)!=null?St:T,b=(Wt=nt.loadParser)!=null?Wt:b,$=fe(fe({},$),nt);if(!R)throw new Error(`[Resolver] alias is undefined for this asset: ${$.src}`);$=this.buildResolvedAsset($,{aliases:R,data:v,format:T,loadParser:b}),k.push($)})}),R.forEach(L=>{this._assetMap[L]=k})})}resolveBundle(t){const r=Ee(t);t=Ce(t);const n={};return t.forEach(o=>{const l=this._bundles[o];if(l){const c=this.resolve(l),p={};for(const g in c){const _=c[g];p[this._extractAssetIdFromBundle(o,g)]=_}n[o]=p}}),r?n[t[0]]:n}resolveUrl(t){const r=this.resolve(t);if(typeof t!="string"){const n={};for(const o in r)n[o]=r[o].src;return n}return r.src}resolve(t){const r=Ee(t);t=Ce(t);const n={};return t.forEach(o=>{var l;if(!this._resolverHash[o])if(this._assetMap[o]){let c=this._assetMap[o];const p=c[0],g=this._getPreferredOrder(c);g==null||g.priority.forEach(_=>{g.params[_].forEach(x=>{const v=c.filter(T=>T[_]?T[_]===x:!1);v.length&&(c=v)})}),this._resolverHash[o]=(l=c[0])!=null?l:p}else this._resolverHash[o]=this.buildResolvedAsset({alias:[o],src:o},{});n[o]=this._resolverHash[o]}),r?n[t[0]]:n}hasKey(t){return!!this._assetMap[t]}hasBundle(t){return!!this._bundles[t]}_getPreferredOrder(t){for(let r=0;r<t.length;r++){const n=t[0],o=this._preferredOrder.find(l=>l.params.format.includes(n.format));if(o)return o}return this._preferredOrder[0]}_appendDefaultSearchParams(t){if(!this._defaultSearchParams)return t;const r=/\?/.test(t)?"&":"?";return`${t}${r}${this._defaultSearchParams}`}buildResolvedAsset(t,r){var p;const{aliases:n,data:o,loadParser:l,format:c}=r;return(this._basePath||this._rootPath)&&(t.src=f.P6.path.toAbsolute(t.src,this._basePath,this._rootPath)),t.alias=(p=n!=null?n:t.alias)!=null?p:[t.src],t.src=this._appendDefaultSearchParams(t.src),t.data=fe(fe({},o||{}),t.data),t.loadParser=l!=null?l:t.loadParser,t.format=c!=null?c:f.P6.path.extname(t.src).slice(1),t.srcs=t.src,t.name=t.alias,t}}class In{constructor(){this._detections=[],this._initialized=!1,this.resolver=new yi,this.loader=new ge,this.cache=Ze,this._backgroundLoader=new zi(this.loader),this._backgroundLoader.active=!0,this.reset()}init(){return Pt(this,arguments,function*(t={}){var l,c,p;if(this._initialized){console.warn("[Assets]AssetManager already initialized, did you load before calling this Asset.init()?");return}if(this._initialized=!0,t.defaultSearchParams&&this.resolver.setDefaultSearchParams(t.defaultSearchParams),t.basePath&&(this.resolver.basePath=t.basePath),t.bundleIdentifier&&this.resolver.setBundleIdentifier(t.bundleIdentifier),t.manifest){let g=t.manifest;typeof g=="string"&&(g=yield this.load(g)),this.resolver.addManifest(g)}const r=(c=(l=t.texturePreference)==null?void 0:l.resolution)!=null?c:1,n=typeof r=="number"?[r]:r,o=yield this._detectFormats({preferredFormats:(p=t.texturePreference)==null?void 0:p.format,skipDetections:t.skipDetections,detections:this._detections});this.resolver.prefer({params:{format:o,resolution:n}}),t.preferences&&this.setPreferences(t.preferences)})}add(t,r,n,o,l){this.resolver.add(t,r,n,o,l)}load(t,r){return Pt(this,null,function*(){this._initialized||(yield this.init());const n=Ee(t),o=Ce(t).map(p=>{if(typeof p!="string"){const g=this.resolver.getAlias(p);return g.some(_=>!this.resolver.hasKey(_))&&this.add(p),Array.isArray(g)?g[0]:g}return this.resolver.hasKey(p)||this.add({alias:p,src:p}),p}),l=this.resolver.resolve(o),c=yield this._mapLoadToResolve(l,r);return n?c[o[0]]:c})}addBundle(t,r){this.resolver.addBundle(t,r)}loadBundle(t,r){return Pt(this,null,function*(){this._initialized||(yield this.init());let n=!1;typeof t=="string"&&(n=!0,t=[t]);const o=this.resolver.resolveBundle(t),l={},c=Object.keys(o);let p=0,g=0;const _=()=>{r==null||r(++p/g)},x=c.map(v=>{const T=o[v];return g+=Object.keys(T).length,this._mapLoadToResolve(T,_).then(b=>{l[v]=b})});return yield Promise.all(x),n?l[t[0]]:l})}backgroundLoad(t){return Pt(this,null,function*(){this._initialized||(yield this.init()),typeof t=="string"&&(t=[t]);const r=this.resolver.resolve(t);this._backgroundLoader.add(Object.values(r))})}backgroundLoadBundle(t){return Pt(this,null,function*(){this._initialized||(yield this.init()),typeof t=="string"&&(t=[t]);const r=this.resolver.resolveBundle(t);Object.values(r).forEach(n=>{this._backgroundLoader.add(Object.values(n))})})}reset(){this.resolver.reset(),this.loader.reset(),this.cache.reset(),this._initialized=!1}get(t){if(typeof t=="string")return Ze.get(t);const r={};for(let n=0;n<t.length;n++)r[n]=Ze.get(t[n]);return r}_mapLoadToResolve(t,r){return Pt(this,null,function*(){const n=Object.values(t),o=Object.keys(t);this._backgroundLoader.active=!1;const l=yield this.loader.load(n,r);this._backgroundLoader.active=!0;const c={};return n.forEach((p,g)=>{const _=l[p.src],x=[p.src];p.alias&&x.push(...p.alias),c[o[g]]=_,Ze.set(x,_)}),c})}unload(t){return Pt(this,null,function*(){this._initialized||(yield this.init());const r=Ce(t).map(o=>typeof o!="string"?o.src:o),n=this.resolver.resolve(r);yield this._unloadFromResolved(n)})}unloadBundle(t){return Pt(this,null,function*(){this._initialized||(yield this.init()),t=Ce(t);const r=this.resolver.resolveBundle(t),n=Object.keys(r).map(o=>this._unloadFromResolved(r[o]));yield Promise.all(n)})}_unloadFromResolved(t){return Pt(this,null,function*(){const r=Object.values(t);r.forEach(n=>{Ze.remove(n.src)}),yield this.loader.unload(r)})}_detectFormats(t){return Pt(this,null,function*(){let r=[];t.preferredFormats&&(r=Array.isArray(t.preferredFormats)?t.preferredFormats:[t.preferredFormats]);for(const n of t.detections)t.skipDetections||(yield n.test())?r=yield n.add(r):t.skipDetections||(r=yield n.remove(r));return r=r.filter((n,o)=>r.indexOf(n)===o),r})}get detections(){return this._detections}get preferWorkers(){return nr.config.preferWorkers}set preferWorkers(t){f.P6.deprecation("7.2.0","Assets.prefersWorkers is deprecated, use Assets.setPreferences({ preferWorkers: true }) instead."),this.setPreferences({preferWorkers:t})}setPreferences(t){this.loader.parsers.forEach(r=>{r.config&&Object.keys(r.config).filter(n=>n in t).forEach(n=>{r.config[n]=t[n]})})}}const xi=new In;f.Rw.handleByList(f.nw.LoadParser,xi.loader.parsers).handleByList(f.nw.ResolveParser,xi.resolver.parsers).handleByList(f.nw.CacheParser,xi.cache.parsers).handleByList(f.nw.DetectionParser,xi.detections);const Cn={extension:f.nw.CacheParser,test:d=>Array.isArray(d)&&d.every(t=>t instanceof f.xE),getCacheableAssets:(d,t)=>{const r={};return d.forEach(n=>{t.forEach((o,l)=>{r[n+(l===0?"":l+1)]=o})}),r}};f.Rw.add(Cn);function Ki(d){return Pt(this,null,function*(){if("Image"in globalThis)return new Promise(t=>{const r=new Image;r.onload=()=>{t(!0)},r.onerror=()=>{t(!1)},r.src=d});if("createImageBitmap"in globalThis&&"fetch"in globalThis){try{const t=yield(yield fetch(d)).blob();yield createImageBitmap(t)}catch(t){return!1}return!0}return!1})}const Rn={extension:{type:f.nw.DetectionParser,priority:1},test:()=>Pt(this,null,function*(){return Ki("data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A=")}),add:d=>Pt(this,null,function*(){return[...d,"avif"]}),remove:d=>Pt(this,null,function*(){return d.filter(t=>t!=="avif")})};f.Rw.add(Rn);const vi={extension:{type:f.nw.DetectionParser,priority:0},test:()=>Pt(this,null,function*(){return Ki("data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA=")}),add:d=>Pt(this,null,function*(){return[...d,"webp"]}),remove:d=>Pt(this,null,function*(){return d.filter(t=>t!=="webp")})};f.Rw.add(vi);const Os=["png","jpg","jpeg"],Pn={extension:{type:f.nw.DetectionParser,priority:-1},test:()=>Promise.resolve(!0),add:d=>Pt(this,null,function*(){return[...d,...Os]}),remove:d=>Pt(this,null,function*(){return d.filter(t=>!Os.includes(t))})};f.Rw.add(Pn);const ti="WorkerGlobalScope"in globalThis&&globalThis instanceof globalThis.WorkerGlobalScope;function ei(d){return ti?!1:document.createElement("video").canPlayType(d)!==""}const qi={extension:{type:f.nw.DetectionParser,priority:0},test:()=>Pt(this,null,function*(){return ei("video/webm")}),add:d=>Pt(this,null,function*(){return[...d,"webm"]}),remove:d=>Pt(this,null,function*(){return d.filter(t=>t!=="webm")})};f.Rw.add(qi);const Ls={extension:{type:f.nw.DetectionParser,priority:0},test:()=>Pt(this,null,function*(){return ei("video/mp4")}),add:d=>Pt(this,null,function*(){return[...d,"mp4","m4v"]}),remove:d=>Pt(this,null,function*(){return d.filter(t=>t!=="mp4"&&t!=="m4v")})};f.Rw.add(Ls);const Mn={extension:{type:f.nw.DetectionParser,priority:0},test:()=>Pt(this,null,function*(){return ei("video/ogg")}),add:d=>Pt(this,null,function*(){return[...d,"ogv"]}),remove:d=>Pt(this,null,function*(){return d.filter(t=>t!=="ogv")})};f.Rw.add(Mn);const Bn={extension:f.nw.ResolveParser,test:nr.test,parse:d=>{var t,r;return{resolution:parseFloat((r=(t=f.Xd.RETINA_PREFIX.exec(d))==null?void 0:t[1])!=null?r:"1"),format:f.P6.path.extname(d).slice(1),src:d}}};f.Rw.add(Bn);const or=(d,t)=>{const r=t.split("?")[1];return r&&(d+=`?${r}`),d};var Pe=(d=>(d[d.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",d[d.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",d[d.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",d[d.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",d[d.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",d[d.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",d[d.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",d[d.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",d[d.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",d[d.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",d[d.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",d[d.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",d[d.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",d[d.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",d[d.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",d[d.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",d[d.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",d[d.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",d[d.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",d[d.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",d[d.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",d[d.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",d[d.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",d[d.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",d[d.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",d[d.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",d[d.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",d))(Pe||{});const kr={33776:.5,33777:.5,33778:1,33779:1,35916:.5,35917:.5,35918:1,35919:1,37488:.5,37489:.5,37490:1,37491:1,37492:.5,37496:1,37493:.5,37497:1,37494:.5,37495:.5,35840:.5,35842:.5,35841:.25,35843:.25,36196:.5,35986:.5,35986:1,34798:1,37808:1};let Ue,ve;function Be(){ve={s3tc:Ue.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:Ue.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:Ue.getExtension("WEBGL_compressed_texture_etc"),etc1:Ue.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:Ue.getExtension("WEBGL_compressed_texture_pvrtc")||Ue.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:Ue.getExtension("WEBGL_compressed_texture_atc"),astc:Ue.getExtension("WEBGL_compressed_texture_astc")}}const Fn={extension:{type:f.nw.DetectionParser,priority:2},test:()=>Pt(this,null,function*(){const d=f.Xd.ADAPTER.createCanvas().getContext("webgl");return d?(Ue=d,!0):(console.warn("WebGL not available for compressed textures."),!1)}),add:d=>Pt(this,null,function*(){ve||Be();const t=[];for(const r in ve)ve[r]&&t.push(r);return[...t,...d]}),remove:d=>Pt(this,null,function*(){return ve||Be(),d.filter(t=>!(t in ve))})};f.Rw.add(Fn);class Dn extends f.qm{constructor(t,r={width:1,height:1,autoLoad:!0}){let n,o;typeof t=="string"?(n=t,o=new Uint8Array):(n=null,o=t),super(o,r),this.origin=n,this.buffer=o?new f.Rv(o):null,this._load=null,this.loaded=!1,this.origin!==null&&r.autoLoad!==!1&&this.load(),this.origin===null&&this.buffer&&(this._load=Promise.resolve(this),this.loaded=!0,this.onBlobLoaded(this.buffer.rawBinaryData))}onBlobLoaded(t){}load(){return this._load?this._load:(this._load=fetch(this.origin).then(t=>t.blob()).then(t=>t.arrayBuffer()).then(t=>(this.data=new Uint32Array(t),this.buffer=new f.Rv(t),this.loaded=!0,this.onBlobLoaded(t),this.update(),this)),this._load)}}class vr extends Dn{constructor(t,r){super(t,r),this.format=r.format,this.levels=r.levels||1,this._width=r.width,this._height=r.height,this._extension=vr._formatToExtension(this.format),(r.levelBuffers||this.buffer)&&(this._levelBuffers=r.levelBuffers||vr._createLevelBuffers(t instanceof Uint8Array?t:this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height))}upload(t,r,n){const o=t.gl;if(!t.context.extensions[this._extension])throw new Error(`${this._extension} textures are not supported on the current machine`);if(!this._levelBuffers)return!1;o.pixelStorei(o.UNPACK_ALIGNMENT,4);for(let l=0,c=this.levels;l<c;l++){const{levelID:p,levelWidth:g,levelHeight:_,levelBuffer:x}=this._levelBuffers[l];o.compressedTexImage2D(o.TEXTURE_2D,p,this.format,g,_,0,x)}return!0}onBlobLoaded(){this._levelBuffers=vr._createLevelBuffers(this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height)}static _formatToExtension(t){if(t>=33776&&t<=33779)return"s3tc";if(t>=37488&&t<=37497)return"etc";if(t>=35840&&t<=35843)return"pvrtc";if(t>=36196)return"etc1";if(t>=35986&&t<=34798)return"atc";throw new Error("Invalid (compressed) texture format given!")}static _createLevelBuffers(t,r,n,o,l,c,p){const g=new Array(n);let _=t.byteOffset,x=c,v=p,T=x+o-1&~(o-1),b=v+l-1&~(l-1),w=T*b*kr[r];for(let R=0;R<n;R++)g[R]={levelID:R,levelWidth:n>1?x:T,levelHeight:n>1?v:b,levelBuffer:new Uint8Array(t.buffer,_,w)},_+=w,x=x>>1||1,v=v>>1||1,T=x+o-1&~(o-1),b=v+l-1&~(l-1),w=T*b*kr[r];return g}}const bi=4,ri=124,Ns=32,Us=20,On=542327876,ii={SIZE:1,FLAGS:2,HEIGHT:3,WIDTH:4,MIPMAP_COUNT:7,PIXEL_FORMAT:19},Zi={SIZE:0,FLAGS:1,FOURCC:2,RGB_BITCOUNT:3,R_BIT_MASK:4,G_BIT_MASK:5,B_BIT_MASK:6,A_BIT_MASK:7},Zt={DXGI_FORMAT:0,RESOURCE_DIMENSION:1,MISC_FLAG:2,ARRAY_SIZE:3,MISC_FLAGS2:4},Qi=1,ks=2,re=4,Gs=64,Ln=512,Nn=131072,Un=827611204,Ji=861165636,ts=894720068,es=808540228,rs=4,is={[Un]:Pe.COMPRESSED_RGBA_S3TC_DXT1_EXT,[Ji]:Pe.COMPRESSED_RGBA_S3TC_DXT3_EXT,[ts]:Pe.COMPRESSED_RGBA_S3TC_DXT5_EXT},ss={70:Pe.COMPRESSED_RGBA_S3TC_DXT1_EXT,71:Pe.COMPRESSED_RGBA_S3TC_DXT1_EXT,73:Pe.COMPRESSED_RGBA_S3TC_DXT3_EXT,74:Pe.COMPRESSED_RGBA_S3TC_DXT3_EXT,76:Pe.COMPRESSED_RGBA_S3TC_DXT5_EXT,77:Pe.COMPRESSED_RGBA_S3TC_DXT5_EXT,72:Pe.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,75:Pe.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,78:Pe.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT};function br(d){const t=new Uint32Array(d);if(t[0]!==On)throw new Error("Invalid DDS file magic word");const r=new Uint32Array(d,0,ri/Uint32Array.BYTES_PER_ELEMENT),n=r[ii.HEIGHT],o=r[ii.WIDTH],l=r[ii.MIPMAP_COUNT],c=new Uint32Array(d,ii.PIXEL_FORMAT*Uint32Array.BYTES_PER_ELEMENT,Ns/Uint32Array.BYTES_PER_ELEMENT),p=c[Qi];if(p&re){const g=c[Zi.FOURCC];if(g!==es){const nt=is[g],$=bi+ri,tt=new Uint8Array(d,$);return[new vr(tt,{format:nt,width:o,height:n,levels:l})]}const _=bi+ri,x=new Uint32Array(t.buffer,_,Us/Uint32Array.BYTES_PER_ELEMENT),v=x[Zt.DXGI_FORMAT],T=x[Zt.RESOURCE_DIMENSION],b=x[Zt.MISC_FLAG],w=x[Zt.ARRAY_SIZE],R=ss[v];if(R===void 0)throw new Error(`DDSParser cannot parse texture data with DXGI format ${v}`);if(b===rs)throw new Error("DDSParser does not support cubemap textures");if(T===6)throw new Error("DDSParser does not supported 3D texture data");const k=new Array,L=bi+ri+Us;if(w===1)k.push(new Uint8Array(d,L));else{const nt=kr[R];let $=0,tt=o,St=n;for(let Ct=0;Ct<l;Ct++){const It=Math.max(1,tt+3&-4),Xt=Math.max(1,St+3&-4),zt=It*Xt*nt;$+=zt,tt=tt>>>1,St=St>>>1}let Wt=L;for(let Ct=0;Ct<w;Ct++)k.push(new Uint8Array(d,Wt,$)),Wt+=$}return k.map(nt=>new vr(nt,{format:R,width:o,height:n,levels:l}))}throw p&Gs?new Error("DDSParser does not support uncompressed texture data."):p&Ln?new Error("DDSParser does not supported YUV uncompressed texture data."):p&Nn?new Error("DDSParser does not support single-channel (lumninance) texture data!"):p&ks?new Error("DDSParser does not support single-channel (alpha) texture data!"):new Error("DDSParser failed to load a texture file due to an unknown reason!")}const Ti=[171,75,84,88,32,49,49,187,13,10,26,10],Hs=67305985,ye={FILE_IDENTIFIER:0,ENDIANNESS:12,GL_TYPE:16,GL_TYPE_SIZE:20,GL_FORMAT:24,GL_INTERNAL_FORMAT:28,GL_BASE_INTERNAL_FORMAT:32,PIXEL_WIDTH:36,PIXEL_HEIGHT:40,PIXEL_DEPTH:44,NUMBER_OF_ARRAY_ELEMENTS:48,NUMBER_OF_FACES:52,NUMBER_OF_MIPMAP_LEVELS:56,BYTES_OF_KEY_VALUE_DATA:60},Tr=64,Ei={[f.vK.UNSIGNED_BYTE]:1,[f.vK.UNSIGNED_SHORT]:2,[f.vK.INT]:4,[f.vK.UNSIGNED_INT]:4,[f.vK.FLOAT]:4,[f.vK.HALF_FLOAT]:8},kn={[f.I2.RGBA]:4,[f.I2.RGB]:3,[f.I2.RG]:2,[f.I2.RED]:1,[f.I2.LUMINANCE]:1,[f.I2.LUMINANCE_ALPHA]:2,[f.I2.ALPHA]:1},ns={[f.vK.UNSIGNED_SHORT_4_4_4_4]:2,[f.vK.UNSIGNED_SHORT_5_5_5_1]:2,[f.vK.UNSIGNED_SHORT_5_6_5]:2};function se(d,t,r=!1){const n=new DataView(t);if(!Xs(d,n))return null;const o=n.getUint32(ye.ENDIANNESS,!0)===Hs,l=n.getUint32(ye.GL_TYPE,o),c=n.getUint32(ye.GL_FORMAT,o),p=n.getUint32(ye.GL_INTERNAL_FORMAT,o),g=n.getUint32(ye.PIXEL_WIDTH,o),_=n.getUint32(ye.PIXEL_HEIGHT,o)||1,x=n.getUint32(ye.PIXEL_DEPTH,o)||1,v=n.getUint32(ye.NUMBER_OF_ARRAY_ELEMENTS,o)||1,T=n.getUint32(ye.NUMBER_OF_FACES,o),b=n.getUint32(ye.NUMBER_OF_MIPMAP_LEVELS,o),w=n.getUint32(ye.BYTES_OF_KEY_VALUE_DATA,o);if(_===0||x!==1)throw new Error("Only 2D textures are supported");if(T!==1)throw new Error("CubeTextures are not supported by KTXLoader yet!");if(v!==1)throw new Error("WebGL does not support array textures");const R=4,k=4,L=g+3&-4,nt=_+3&-4,$=new Array(v);let tt=g*_;l===0&&(tt=L*nt);let St;if(l!==0?Ei[l]?St=Ei[l]*kn[c]:St=ns[l]:St=kr[p],St===void 0)throw new Error("Unable to resolve the pixel format stored in the *.ktx file!");const Wt=r?Ie(n,w,o):null;let Ct=tt*St,It=g,Xt=_,zt=L,he=nt,Bt=Tr+w;for(let et=0;et<b;et++){const At=n.getUint32(Bt,o);let Vt=Bt+4;for(let te=0;te<v;te++){let kt=$[te];kt||(kt=$[te]=new Array(b)),kt[et]={levelID:et,levelWidth:b>1||l!==0?It:zt,levelHeight:b>1||l!==0?Xt:he,levelBuffer:new Uint8Array(t,Vt,Ct)},Vt+=Ct}Bt+=At+4,Bt=Bt%4!==0?Bt+4-Bt%4:Bt,It=It>>1||1,Xt=Xt>>1||1,zt=It+R-1&~(R-1),he=Xt+k-1&~(k-1),Ct=zt*he*St}return l!==0?{uncompressed:$.map(et=>{let At=et[0].levelBuffer,Vt=!1;return l===f.vK.FLOAT?At=new Float32Array(et[0].levelBuffer.buffer,et[0].levelBuffer.byteOffset,et[0].levelBuffer.byteLength/4):l===f.vK.UNSIGNED_INT?(Vt=!0,At=new Uint32Array(et[0].levelBuffer.buffer,et[0].levelBuffer.byteOffset,et[0].levelBuffer.byteLength/4)):l===f.vK.INT&&(Vt=!0,At=new Int32Array(et[0].levelBuffer.buffer,et[0].levelBuffer.byteOffset,et[0].levelBuffer.byteLength/4)),{resource:new f.qm(At,{width:et[0].levelWidth,height:et[0].levelHeight}),type:l,format:Vt?Gn(c):c}}),kvData:Wt}:{compressed:$.map(et=>new vr(null,{format:p,width:g,height:_,levels:b,levelBuffers:et})),kvData:Wt}}function Xs(d,t){for(let r=0;r<Ti.length;r++)if(t.getUint8(r)!==Ti[r])return console.error(`${d} is not a valid *.ktx file!`),!1;return!0}function Gn(d){switch(d){case f.I2.RGBA:return f.I2.RGBA_INTEGER;case f.I2.RGB:return f.I2.RGB_INTEGER;case f.I2.RG:return f.I2.RG_INTEGER;case f.I2.RED:return f.I2.RED_INTEGER;default:return d}}function Ie(d,t,r){const n=new Map;let o=0;for(;o<t;){const l=d.getUint32(Tr+o,r),c=Tr+o+4,p=3-(l+3)%4;if(l===0||l>t-o){console.error("KTXLoader: keyAndValueByteSize out of bounds");break}let g=0;for(;g<l&&d.getUint8(c+g)!==0;g++);if(g===-1){console.error("KTXLoader: Failed to find null byte terminating kvData key");break}const _=new TextDecoder().decode(new Uint8Array(d.buffer,c,g)),x=new DataView(d.buffer,c+g+1,l-g-1);n.set(_,x),o+=4+l+p}return n}const Ai={extension:{type:f.nw.LoadParser,priority:ce.High},name:"loadDDS",test(d){return Ve(d,".dds")},load(d,t,r){return Pt(this,null,function*(){const n=yield(yield f.Xd.ADAPTER.fetch(d)).arrayBuffer(),o=br(n).map(l=>{const c=new f.VL(l,fe({mipmap:f.KI.OFF,alphaMode:f.iw.NO_PREMULTIPLIED_ALPHA,resolution:f.P6.getResolutionOfUrl(d)},t.data));return Ae(c,r,d)});return o.length===1?o[0]:o})},unload(d){Array.isArray(d)?d.forEach(t=>t.destroy(!0)):d.destroy(!0)}};f.Rw.add(Ai);const Hn={extension:{type:f.nw.LoadParser,priority:ce.High},name:"loadKTX",test(d){return Ve(d,".ktx")},load(d,t,r){return Pt(this,null,function*(){const n=yield(yield f.Xd.ADAPTER.fetch(d)).arrayBuffer(),{compressed:o,uncompressed:l,kvData:c}=se(d,n),p=o!=null?o:l,g=fe({mipmap:f.KI.OFF,alphaMode:f.iw.NO_PREMULTIPLIED_ALPHA,resolution:f.P6.getResolutionOfUrl(d)},t.data),_=p.map(x=>{var b;p===l&&Object.assign(g,{type:x.type,format:x.format});const v=(b=x.resource)!=null?b:x,T=new f.VL(v,g);return T.ktxKeyValueData=c,Ae(T,r,d)});return _.length===1?_[0]:_})},unload(d){Array.isArray(d)?d.forEach(t=>t.destroy(!0)):d.destroy(!0)}};f.Rw.add(Hn);const Xn={extension:f.nw.ResolveParser,test:d=>{const t=f.P6.path.extname(d).slice(1);return["basis","ktx","dds"].includes(t)},parse:d=>{var r,n,o,l;const t=f.P6.path.extname(d).slice(1);if(t==="ktx"){const c=[".s3tc.ktx",".s3tc_sRGB.ktx",".etc.ktx",".etc1.ktx",".pvrt.ktx",".atc.ktx",".astc.ktx"];if(c.some(p=>d.endsWith(p)))return{resolution:parseFloat((n=(r=f.Xd.RETINA_PREFIX.exec(d))==null?void 0:r[1])!=null?n:"1"),format:c.find(p=>d.endsWith(p)),src:d}}return{resolution:parseFloat((l=(o=f.Xd.RETINA_PREFIX.exec(d))==null?void 0:o[1])!=null?l:"1"),format:t,src:d}}};f.Rw.add(Xn);const si=new f.Ae,Vn=4,Vs=class Bs{constructor(t){this.renderer=t,this._rendererPremultipliedAlpha=!1}contextChange(){var r;const t=(r=this.renderer)==null?void 0:r.gl.getContextAttributes();this._rendererPremultipliedAlpha=!!(t&&t.alpha&&t.premultipliedAlpha)}image(t,r,n,o){return Pt(this,null,function*(){const l=new Image;return l.src=yield this.base64(t,r,n,o),l})}base64(t,r,n,o){return Pt(this,null,function*(){const l=this.canvas(t,o);if(l.toBlob!==void 0)return new Promise((c,p)=>{l.toBlob(g=>{if(!g){p(new Error("ICanvas.toBlob failed!"));return}const _=new FileReader;_.onload=()=>c(_.result),_.onerror=p,_.readAsDataURL(g)},r,n)});if(l.toDataURL!==void 0)return l.toDataURL(r,n);if(l.convertToBlob!==void 0){const c=yield l.convertToBlob({type:r,quality:n});return new Promise((p,g)=>{const _=new FileReader;_.onload=()=>p(_.result),_.onerror=g,_.readAsDataURL(c)})}throw new Error("Extract.base64() requires ICanvas.toDataURL, ICanvas.toBlob, or ICanvas.convertToBlob to be implemented")})}canvas(t,r){const{pixels:n,width:o,height:l,flipY:c,premultipliedAlpha:p}=this._rawPixels(t,r);c&&Bs._flipY(n,o,l),p&&Bs._unpremultiplyAlpha(n);const g=new f.P6.CanvasRenderTarget(o,l,1),_=new ImageData(new Uint8ClampedArray(n.buffer),o,l);return g.context.putImageData(_,0,0),g.canvas}pixels(t,r){const{pixels:n,width:o,height:l,flipY:c,premultipliedAlpha:p}=this._rawPixels(t,r);return c&&Bs._flipY(n,o,l),p&&Bs._unpremultiplyAlpha(n),n}_rawPixels(t,r){const n=this.renderer;if(!n)throw new Error("The Extract has already been destroyed");let o,l=!1,c=!1,p,g=!1;t&&(t instanceof f.TI?p=t:(p=n.generateTexture(t,{region:r,resolution:n.resolution,multisample:n.multisample}),g=!0,r&&(si.width=r.width,si.height=r.height,r=si)));const _=n.gl;if(p){if(o=p.baseTexture.resolution,r=r!=null?r:p.frame,l=!1,c=p.baseTexture.alphaMode>0&&p.baseTexture.format===f.I2.RGBA,!g){n.renderTexture.bind(p);const b=p.framebuffer.glFramebuffers[n.CONTEXT_UID];b.blitFramebuffer&&n.framebuffer.bind(b.blitFramebuffer)}}else o=n.resolution,r||(r=si,r.width=n.width/o,r.height=n.height/o),l=!0,c=this._rendererPremultipliedAlpha,n.renderTexture.bind();const x=Math.max(Math.round(r.width*o),1),v=Math.max(Math.round(r.height*o),1),T=new Uint8Array(Vn*x*v);return _.readPixels(Math.round(r.x*o),Math.round(r.y*o),x,v,_.RGBA,_.UNSIGNED_BYTE,T),g&&(p==null||p.destroy(!0)),{pixels:T,width:x,height:v,flipY:l,premultipliedAlpha:c}}destroy(){this.renderer=null}static _flipY(t,r,n){const o=r<<2,l=n>>1,c=new Uint8Array(o);for(let p=0;p<l;p++){const g=p*o,_=(n-p-1)*o;c.set(t.subarray(g,g+o)),t.copyWithin(g,_,_+o),t.set(c,_)}}static _unpremultiplyAlpha(t){t instanceof Uint8ClampedArray&&(t=new Uint8Array(t.buffer));const r=t.length;for(let n=0;n<r;n+=4){const o=t[n+3];if(o!==0){const l=255.001/o;t[n]=t[n]*l+.5,t[n+1]=t[n+1]*l+.5,t[n+2]=t[n+2]*l+.5}}}};Vs.extension={name:"extract",type:f.nw.RendererSystem};let Er=Vs;f.Rw.add(Er);const Gr={build(d){const t=d.points;let r,n,o,l,c,p;if(d.type===f.HS.CIRC){const w=d.shape;r=w.x,n=w.y,c=p=w.radius,o=l=0}else if(d.type===f.HS.ELIP){const w=d.shape;r=w.x,n=w.y,c=w.width,p=w.height,o=l=0}else{const w=d.shape,R=w.width/2,k=w.height/2;r=w.x+R,n=w.y+k,c=p=Math.max(0,Math.min(w.radius,Math.min(R,k))),o=R-c,l=k-p}if(!(c>=0&&p>=0&&o>=0&&l>=0)){t.length=0;return}const g=Math.ceil(2.3*Math.sqrt(c+p)),_=g*8+(o?4:0)+(l?4:0);if(t.length=_,_===0)return;if(g===0){t.length=8,t[0]=t[6]=r+o,t[1]=t[3]=n+l,t[2]=t[4]=r-o,t[5]=t[7]=n-l;return}let x=0,v=g*4+(o?2:0)+2,T=v,b=_;{const w=o+c,R=l,k=r+w,L=r-w,nt=n+R;if(t[x++]=k,t[x++]=nt,t[--v]=nt,t[--v]=L,l){const $=n-R;t[T++]=L,t[T++]=$,t[--b]=$,t[--b]=k}}for(let w=1;w<g;w++){const R=Math.PI/2*(w/g),k=o+Math.cos(R)*c,L=l+Math.sin(R)*p,nt=r+k,$=r-k,tt=n+L,St=n-L;t[x++]=nt,t[x++]=tt,t[--v]=tt,t[--v]=$,t[T++]=$,t[T++]=St,t[--b]=St,t[--b]=nt}{const w=o,R=l+p,k=r+w,L=r-w,nt=n+R,$=n-R;t[x++]=k,t[x++]=nt,t[--b]=$,t[--b]=k,o&&(t[x++]=L,t[x++]=nt,t[--b]=$,t[--b]=L)}},triangulate(d,t){const r=d.points,n=t.points,o=t.indices;if(r.length===0)return;let l=n.length/2;const c=l;let p,g;if(d.type!==f.HS.RREC){const x=d.shape;p=x.x,g=x.y}else{const x=d.shape;p=x.x+x.width/2,g=x.y+x.height/2}const _=d.matrix;n.push(d.matrix?_.a*p+_.c*g+_.tx:p,d.matrix?_.b*p+_.d*g+_.ty:g),l++,n.push(r[0],r[1]);for(let x=2;x<r.length;x+=2)n.push(r[x],r[x+1]),o.push(l++,c,l);o.push(c+1,c,l)}};function as(d,t=!1){const r=d.length;if(r<6)return;let n=0;for(let o=0,l=d[r-2],c=d[r-1];o<r;o+=2){const p=d[o],g=d[o+1];n+=(p-l)*(g+c),l=p,c=g}if(!t&&n>0||t&&n<=0){const o=r/2;for(let l=o+o%2;l<r;l+=2){const c=r-l-2,p=r-l-1,g=l,_=l+1;[d[c],d[g]]=[d[g],d[c]],[d[p],d[_]]=[d[_],d[p]]}}}const os={build(d){d.points=d.shape.points.slice()},triangulate(d,t){let r=d.points;const n=d.holes,o=t.points,l=t.indices;if(r.length>=6){as(r,!1);const c=[];for(let _=0;_<n.length;_++){const x=n[_];as(x.points,!0),c.push(r.length/2),r=r.concat(x.points)}const p=f.P6.earcut(r,c,2);if(!p)return;const g=o.length/2;for(let _=0;_<p.length;_+=3)l.push(p[_]+g),l.push(p[_+1]+g),l.push(p[_+2]+g);for(let _=0;_<r.length;_++)o.push(r[_])}}},Ws={build(d){const t=d.shape,r=t.x,n=t.y,o=t.width,l=t.height,c=d.points;c.length=0,o>=0&&l>=0&&c.push(r,n,r+o,n,r+o,n+l,r,n+l)},triangulate(d,t){const r=d.points,n=t.points;if(r.length===0)return;const o=n.length/2;n.push(r[0],r[1],r[2],r[3],r[6],r[7],r[4],r[5]),t.indices.push(o,o+1,o+2,o+1,o+2,o+3)}},hr={build(d){Gr.build(d)},triangulate(d,t){Gr.triangulate(d,t)}};var oe=(d=>(d.MITER="miter",d.BEVEL="bevel",d.ROUND="round",d))(oe||{}),ke=(d=>(d.BUTT="butt",d.ROUND="round",d.SQUARE="square",d))(ke||{});const ie={adaptive:!0,maxLength:10,minSegments:8,maxSegments:2048,epsilon:1e-4,_segmentsCount(d,t=20){if(!this.adaptive||!d||isNaN(d))return t;let r=Math.ceil(d/this.maxLength);return r<this.minSegments?r=this.minSegments:r>this.maxSegments&&(r=this.maxSegments),r}},hs=null;class Hr{static curveTo(t,r,n,o,l,c){const p=c[c.length-2],g=c[c.length-1]-r,_=p-t,x=o-r,v=n-t,T=Math.abs(g*v-_*x);if(T<1e-8||l===0)return(c[c.length-2]!==t||c[c.length-1]!==r)&&c.push(t,r),null;const b=g*g+_*_,w=x*x+v*v,R=g*x+_*v,k=l*Math.sqrt(b)/T,L=l*Math.sqrt(w)/T,nt=k*R/b,$=L*R/w,tt=k*v+L*_,St=k*x+L*g,Wt=_*(L+nt),Ct=g*(L+nt),It=v*(k+$),Xt=x*(k+$),zt=Math.atan2(Ct-St,Wt-tt),he=Math.atan2(Xt-St,It-tt);return{cx:tt+t,cy:St+r,radius:l,startAngle:zt,endAngle:he,anticlockwise:_*x>v*g}}static arc(t,r,n,o,l,c,p,g,_){const x=p-c,v=ie._segmentsCount(Math.abs(x)*l,Math.ceil(Math.abs(x)/f._b)*40),T=x/(v*2),b=T*2,w=Math.cos(T),R=Math.sin(T),k=v-1,L=k%1/k;for(let nt=0;nt<=k;++nt){const $=nt+L*nt,tt=T+c+b*$,St=Math.cos(tt),Wt=-Math.sin(tt);_.push((w*St+R*Wt)*l+n,(w*-Wt+R*St)*l+o)}}}class Ar{static curveLength(t,r,n,o,l,c,p,g){let _=0,x=0,v=0,T=0,b=0,w=0,R=0,k=0,L=0,nt=0,$=0,tt=t,St=r;for(let Wt=1;Wt<=10;++Wt)x=Wt/10,v=x*x,T=v*x,b=1-x,w=b*b,R=w*b,k=R*t+3*w*x*n+3*b*v*l+T*p,L=R*r+3*w*x*o+3*b*v*c+T*g,nt=tt-k,$=St-L,tt=k,St=L,_+=Math.sqrt(nt*nt+$*$);return _}static curveTo(t,r,n,o,l,c,p){const g=p[p.length-2],_=p[p.length-1];p.length-=2;const x=ie._segmentsCount(Ar.curveLength(g,_,t,r,n,o,l,c));let v=0,T=0,b=0,w=0,R=0;p.push(g,_);for(let k=1,L=0;k<=x;++k)L=k/x,v=1-L,T=v*v,b=T*v,w=L*L,R=w*L,p.push(b*g+3*T*L*t+3*v*w*n+R*l,b*_+3*T*L*r+3*v*w*o+R*c)}}function ni(d,t,r,n,o,l,c,p){const g=d-r*o,_=t-n*o,x=d+r*l,v=t+n*l;let T,b;c?(T=n,b=-r):(T=-n,b=r);const w=g+T,R=_+b,k=x+T,L=v+b;return p.push(w,R,k,L),2}function de(d,t,r,n,o,l,c,p){const g=r-d,_=n-t;let x=Math.atan2(g,_),v=Math.atan2(o-d,l-t);p&&x<v?x+=Math.PI*2:!p&&x>v&&(v+=Math.PI*2);let T=x;const b=v-x,w=Math.abs(b),R=Math.sqrt(g*g+_*_),k=(15*w*Math.sqrt(R)/Math.PI>>0)+1,L=b/k;if(T+=L,p){c.push(d,t,r,n);for(let nt=1,$=T;nt<k;nt++,$+=L)c.push(d,t,d+Math.sin($)*R,t+Math.cos($)*R);c.push(d,t,o,l)}else{c.push(r,n,d,t);for(let nt=1,$=T;nt<k;nt++,$+=L)c.push(d+Math.sin($)*R,t+Math.cos($)*R,d,t);c.push(o,l,d,t)}return k*2}function wr(d,t){const r=d.shape;let n=d.points||r.points.slice();const o=t.closePointEps;if(n.length===0)return;const l=d.lineStyle,c=new f.E9(n[0],n[1]),p=new f.E9(n[n.length-2],n[n.length-1]),g=r.type!==f.HS.POLY||r.closeStroke,_=Math.abs(c.x-p.x)<o&&Math.abs(c.y-p.y)<o;if(g){n=n.slice(),_&&(n.pop(),n.pop(),p.set(n[n.length-2],n[n.length-1]));const kt=(c.x+p.x)*.5,$t=(p.y+c.y)*.5;n.unshift(kt,$t),n.push(kt,$t)}const x=t.points,v=n.length/2;let T=n.length;const b=x.length/2,w=l.width/2,R=w*w,k=l.miterLimit*l.miterLimit;let L=n[0],nt=n[1],$=n[2],tt=n[3],St=0,Wt=0,Ct=-(nt-tt),It=L-$,Xt=0,zt=0,he=Math.sqrt(Ct*Ct+It*It);Ct/=he,It/=he,Ct*=w,It*=w;const Bt=l.alignment,et=(1-Bt)*2,At=Bt*2;g||(l.cap===ke.ROUND?T+=de(L-Ct*(et-At)*.5,nt-It*(et-At)*.5,L-Ct*et,nt-It*et,L+Ct*At,nt+It*At,x,!0)+2:l.cap===ke.SQUARE&&(T+=ni(L,nt,Ct,It,et,At,!0,x))),x.push(L-Ct*et,nt-It*et,L+Ct*At,nt+It*At);for(let kt=1;kt<v-1;++kt){L=n[(kt-1)*2],nt=n[(kt-1)*2+1],$=n[kt*2],tt=n[kt*2+1],St=n[(kt+1)*2],Wt=n[(kt+1)*2+1],Ct=-(nt-tt),It=L-$,he=Math.sqrt(Ct*Ct+It*It),Ct/=he,It/=he,Ct*=w,It*=w,Xt=-(tt-Wt),zt=$-St,he=Math.sqrt(Xt*Xt+zt*zt),Xt/=he,zt/=he,Xt*=w,zt*=w;const $t=$-L,be=nt-tt,Te=$-St,Jt=Wt-tt,Cs=$t*Te+be*Jt,ki=be*Te-Jt*$t,Ke=ki<0;if(Math.abs(ki)<.001*Math.abs(Cs)){x.push($-Ct*et,tt-It*et,$+Ct*At,tt+It*At),Cs>=0&&(l.join===oe.ROUND?T+=de($,tt,$-Ct*et,tt-It*et,$-Xt*et,tt-zt*et,x,!1)+4:T+=2,x.push($-Xt*At,tt-zt*At,$+Xt*et,tt+zt*et));continue}const Gi=(-Ct+L)*(-It+tt)-(-Ct+$)*(-It+nt),Rs=(-Xt+St)*(-zt+tt)-(-Xt+$)*(-zt+Wt),$r=($t*Rs-Te*Gi)/ki,di=(Jt*Gi-be*Rs)/ki,Jn=($r-$)*($r-$)+(di-tt)*(di-tt),jr=$+($r-$)*et,gr=tt+(di-tt)*et,s=$-($r-$)*At,e=tt-(di-tt)*At,i=Math.min($t*$t+be*be,Te*Te+Jt*Jt),a=Ke?et:At,h=i+a*a*R,u=Jn<=h;let m=l.join;if(m===oe.MITER&&Jn/R>k&&(m=oe.BEVEL),u)switch(m){case oe.MITER:{x.push(jr,gr,s,e);break}case oe.BEVEL:{Ke?x.push(jr,gr,$+Ct*At,tt+It*At,jr,gr,$+Xt*At,tt+zt*At):x.push($-Ct*et,tt-It*et,s,e,$-Xt*et,tt-zt*et,s,e),T+=2;break}case oe.ROUND:{Ke?(x.push(jr,gr,$+Ct*At,tt+It*At),T+=de($,tt,$+Ct*At,tt+It*At,$+Xt*At,tt+zt*At,x,!0)+4,x.push(jr,gr,$+Xt*At,tt+zt*At)):(x.push($-Ct*et,tt-It*et,s,e),T+=de($,tt,$-Ct*et,tt-It*et,$-Xt*et,tt-zt*et,x,!1)+4,x.push($-Xt*et,tt-zt*et,s,e));break}}else{switch(x.push($-Ct*et,tt-It*et,$+Ct*At,tt+It*At),m){case oe.MITER:{Ke?x.push(s,e,s,e):x.push(jr,gr,jr,gr),T+=2;break}case oe.ROUND:{Ke?T+=de($,tt,$+Ct*At,tt+It*At,$+Xt*At,tt+zt*At,x,!0)+2:T+=de($,tt,$-Ct*et,tt-It*et,$-Xt*et,tt-zt*et,x,!1)+2;break}}x.push($-Xt*et,tt-zt*et,$+Xt*At,tt+zt*At),T+=2}}L=n[(v-2)*2],nt=n[(v-2)*2+1],$=n[(v-1)*2],tt=n[(v-1)*2+1],Ct=-(nt-tt),It=L-$,he=Math.sqrt(Ct*Ct+It*It),Ct/=he,It/=he,Ct*=w,It*=w,x.push($-Ct*et,tt-It*et,$+Ct*At,tt+It*At),g||(l.cap===ke.ROUND?T+=de($-Ct*(et-At)*.5,tt-It*(et-At)*.5,$-Ct*et,tt-It*et,$+Ct*At,tt+It*At,x,!1)+2:l.cap===ke.SQUARE&&(T+=ni($,tt,Ct,It,et,At,!1,x)));const Vt=t.indices,te=ie.epsilon*ie.epsilon;for(let kt=b;kt<T+b-2;++kt)L=x[kt*2],nt=x[kt*2+1],$=x[(kt+1)*2],tt=x[(kt+1)*2+1],St=x[(kt+2)*2],Wt=x[(kt+2)*2+1],!(Math.abs(L*(tt-Wt)+$*(Wt-nt)+St*(nt-tt))<te)&&Vt.push(kt,kt+1,kt+2)}function Sr(d,t){let r=0;const n=d.shape,o=d.points||n.points,l=n.type!==f.HS.POLY||n.closeStroke;if(o.length===0)return;const c=t.points,p=t.indices,g=o.length/2,_=c.length/2;let x=_;for(c.push(o[0],o[1]),r=1;r<g;r++)c.push(o[r*2],o[r*2+1]),p.push(x,x+1),x++;l&&p.push(x,_)}function er(d,t){d.lineStyle.native?Sr(d,t):wr(d,t)}class $e{static curveLength(t,r,n,o,l,c){const p=t-2*n+l,g=r-2*o+c,_=2*n-2*t,x=2*o-2*r,v=4*(p*p+g*g),T=4*(p*_+g*x),b=_*_+x*x,w=2*Math.sqrt(v+T+b),R=Math.sqrt(v),k=2*v*R,L=2*Math.sqrt(b),nt=T/R;return(k*w+R*T*(w-L)+(4*b*v-T*T)*Math.log((2*R+nt+w)/(nt+L)))/(4*k)}static curveTo(t,r,n,o,l){const c=l[l.length-2],p=l[l.length-1],g=ie._segmentsCount($e.curveLength(c,p,t,r,n,o));let _=0,x=0;for(let v=1;v<=g;++v){const T=v/g;_=c+(t-c)*T,x=p+(r-p)*T,l.push(_+(t+(n-t)*T-_)*T,x+(r+(o-r)*T-x)*T)}}}const Xr={[f.HS.POLY]:os,[f.HS.CIRC]:Gr,[f.HS.ELIP]:Gr,[f.HS.RECT]:Ws,[f.HS.RREC]:hr},wi=[],lr=[];class Si{constructor(t,r=null,n=null,o=null){this.points=[],this.holes=[],this.shape=t,this.lineStyle=n,this.fillStyle=r,this.matrix=o,this.type=t.type}clone(){return new Si(this.shape,this.fillStyle,this.lineStyle,this.matrix)}destroy(){this.shape=null,this.holes.length=0,this.holes=null,this.points.length=0,this.points=null,this.lineStyle=null,this.fillStyle=null}}class me{constructor(){this.reset()}begin(t,r,n){this.reset(),this.style=t,this.start=r,this.attribStart=n}end(t,r){this.attribSize=r-this.attribStart,this.size=t-this.start}reset(){this.style=null,this.size=0,this.start=0,this.attribStart=0,this.attribSize=0}}const De=new f.E9,Ii=class ba extends f.JZ{constructor(){super(),this.closePointEps=1e-4,this.boundsPadding=0,this.uvsFloat32=null,this.indicesUint16=null,this.batchable=!1,this.points=[],this.colors=[],this.uvs=[],this.indices=[],this.textureIds=[],this.graphicsData=[],this.drawCalls=[],this.batchDirty=-1,this.batches=[],this.dirty=0,this.cacheDirty=-1,this.clearDirty=0,this.shapeIndex=0,this._bounds=new ut,this.boundsDirty=-1}get bounds(){return this.updateBatches(),this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.calculateBounds()),this._bounds}invalidate(){this.boundsDirty=-1,this.dirty++,this.batchDirty++,this.shapeIndex=0,this.points.length=0,this.colors.length=0,this.uvs.length=0,this.indices.length=0,this.textureIds.length=0;for(let t=0;t<this.drawCalls.length;t++)this.drawCalls[t].texArray.clear(),lr.push(this.drawCalls[t]);this.drawCalls.length=0;for(let t=0;t<this.batches.length;t++){const r=this.batches[t];r.reset(),wi.push(r)}this.batches.length=0}clear(){return this.graphicsData.length>0&&(this.invalidate(),this.clearDirty++,this.graphicsData.length=0),this}drawShape(t,r=null,n=null,o=null){const l=new Si(t,r,n,o);return this.graphicsData.push(l),this.dirty++,this}drawHole(t,r=null){if(!this.graphicsData.length)return null;const n=new Si(t,null,null,r),o=this.graphicsData[this.graphicsData.length-1];return n.lineStyle=o.lineStyle,o.holes.push(n),this.dirty++,this}destroy(){super.destroy();for(let t=0;t<this.graphicsData.length;++t)this.graphicsData[t].destroy();this.points.length=0,this.points=null,this.colors.length=0,this.colors=null,this.uvs.length=0,this.uvs=null,this.indices.length=0,this.indices=null,this.indexBuffer.destroy(),this.indexBuffer=null,this.graphicsData.length=0,this.graphicsData=null,this.drawCalls.length=0,this.drawCalls=null,this.batches.length=0,this.batches=null,this._bounds=null}containsPoint(t){const r=this.graphicsData;for(let n=0;n<r.length;++n){const o=r[n];if(o.fillStyle.visible&&o.shape&&(o.matrix?o.matrix.applyInverse(t,De):De.copyFrom(t),o.shape.contains(De.x,De.y))){let l=!1;if(o.holes){for(let c=0;c<o.holes.length;c++)if(o.holes[c].shape.contains(De.x,De.y)){l=!0;break}}if(!l)return!0}}return!1}updateBatches(){if(!this.graphicsData.length){this.batchable=!0;return}if(!this.validateBatching())return;this.cacheDirty=this.dirty;const t=this.uvs,r=this.graphicsData;let n=null,o=null;this.batches.length>0&&(n=this.batches[this.batches.length-1],o=n.style);for(let g=this.shapeIndex;g<r.length;g++){this.shapeIndex++;const _=r[g],x=_.fillStyle,v=_.lineStyle;Xr[_.type].build(_),_.matrix&&this.transformPoints(_.points,_.matrix),(x.visible||v.visible)&&this.processHoles(_.holes);for(let T=0;T<2;T++){const b=T===0?x:v;if(!b.visible)continue;const w=b.texture.baseTexture,R=this.indices.length,k=this.points.length/2;w.wrapMode=f.Nt.REPEAT,T===0?this.processFill(_):this.processLine(_);const L=this.points.length/2-k;L!==0&&(n&&!this._compareStyles(o,b)&&(n.end(R,k),n=null),n||(n=wi.pop()||new me,n.begin(b,R,k),this.batches.push(n),o=b),this.addUvs(this.points,t,b.texture,k,L,b.matrix))}}const l=this.indices.length,c=this.points.length/2;if(n&&n.end(l,c),this.batches.length===0){this.batchable=!0;return}const p=c>65535;this.indicesUint16&&this.indices.length===this.indicesUint16.length&&p===this.indicesUint16.BYTES_PER_ELEMENT>2?this.indicesUint16.set(this.indices):this.indicesUint16=p?new Uint32Array(this.indices):new Uint16Array(this.indices),this.batchable=this.isBatchable(),this.batchable?this.packBatches():this.buildDrawCalls()}_compareStyles(t,r){return!(!t||!r||t.texture.baseTexture!==r.texture.baseTexture||t.color+t.alpha!==r.color+r.alpha||!!t.native!=!!r.native)}validateBatching(){if(this.dirty===this.cacheDirty||!this.graphicsData.length)return!1;for(let t=0,r=this.graphicsData.length;t<r;t++){const n=this.graphicsData[t],o=n.fillStyle,l=n.lineStyle;if(o&&!o.texture.baseTexture.valid||l&&!l.texture.baseTexture.valid)return!1}return!0}packBatches(){this.batchDirty++,this.uvsFloat32=new Float32Array(this.uvs);const t=this.batches;for(let r=0,n=t.length;r<n;r++){const o=t[r];for(let l=0;l<o.size;l++){const c=o.start+l;this.indicesUint16[c]=this.indicesUint16[c]-o.attribStart}}}isBatchable(){if(this.points.length>65535*2)return!1;const t=this.batches;for(let r=0;r<t.length;r++)if(t[r].style.native)return!1;return this.points.length<ba.BATCHABLE_SIZE*2}buildDrawCalls(){let t=++f.VL._globalBatch;for(let v=0;v<this.drawCalls.length;v++)this.drawCalls[v].texArray.clear(),lr.push(this.drawCalls[v]);this.drawCalls.length=0;const r=this.colors,n=this.textureIds;let o=lr.pop();o||(o=new f.a$,o.texArray=new f.Ie),o.texArray.count=0,o.start=0,o.size=0,o.type=f.lg.TRIANGLES;let l=0,c=null,p=0,g=!1,_=f.lg.TRIANGLES,x=0;this.drawCalls.push(o);for(let v=0;v<this.batches.length;v++){const T=this.batches[v],b=8,w=T.style,R=w.texture.baseTexture;g!==!!w.native&&(g=!!w.native,_=g?f.lg.LINES:f.lg.TRIANGLES,c=null,l=b,t++),c!==R&&(c=R,R._batchEnabled!==t&&(l===b&&(t++,l=0,o.size>0&&(o=lr.pop(),o||(o=new f.a$,o.texArray=new f.Ie),this.drawCalls.push(o)),o.start=x,o.size=0,o.texArray.count=0,o.type=_),R.touched=1,R._batchEnabled=t,R._batchLocation=l,R.wrapMode=f.Nt.REPEAT,o.texArray.elements[o.texArray.count++]=R,l++)),o.size+=T.size,x+=T.size,p=R._batchLocation,this.addColors(r,w.color,w.alpha,T.attribSize,T.attribStart),this.addTextureIds(n,p,T.attribSize,T.attribStart)}f.VL._globalBatch=t,this.packAttributes()}packAttributes(){const t=this.points,r=this.uvs,n=this.colors,o=this.textureIds,l=new ArrayBuffer(t.length*3*4),c=new Float32Array(l),p=new Uint32Array(l);let g=0;for(let _=0;_<t.length/2;_++)c[g++]=t[_*2],c[g++]=t[_*2+1],c[g++]=r[_*2],c[g++]=r[_*2+1],p[g++]=n[_],c[g++]=o[_];this._buffer.update(l),this._indexBuffer.update(this.indicesUint16)}processFill(t){t.holes.length?os.triangulate(t,this):Xr[t.type].triangulate(t,this)}processLine(t){er(t,this);for(let r=0;r<t.holes.length;r++)er(t.holes[r],this)}processHoles(t){for(let r=0;r<t.length;r++){const n=t[r];Xr[n.type].build(n),n.matrix&&this.transformPoints(n.points,n.matrix)}}calculateBounds(){const t=this._bounds;t.clear(),t.addVertexData(this.points,0,this.points.length),t.pad(this.boundsPadding,this.boundsPadding)}transformPoints(t,r){for(let n=0;n<t.length/2;n++){const o=t[n*2],l=t[n*2+1];t[n*2]=r.a*o+r.c*l+r.tx,t[n*2+1]=r.b*o+r.d*l+r.ty}}addColors(t,r,n,o,l=0){const c=f.Il.shared.setValue(r).toLittleEndianNumber(),p=f.Il.shared.setValue(c).toPremultiplied(n);t.length=Math.max(t.length,l+o);for(let g=0;g<o;g++)t[l+g]=p}addTextureIds(t,r,n,o=0){t.length=Math.max(t.length,o+n);for(let l=0;l<n;l++)t[o+l]=r}addUvs(t,r,n,o,l,c=null){let p=0;const g=r.length,_=n.frame;for(;p<l;){let v=t[(o+p)*2],T=t[(o+p)*2+1];if(c){const b=c.a*v+c.c*T+c.tx;T=c.b*v+c.d*T+c.ty,v=b}p++,r.push(v/_.width,T/_.height)}const x=n.baseTexture;(_.width<x.width||_.height<x.height)&&this.adjustUvs(r,n,g,l)}adjustUvs(t,r,n,o){const l=r.baseTexture,c=1e-6,p=n+o*2,g=r.frame,_=g.width/l.width,x=g.height/l.height;let v=g.x/g.width,T=g.y/g.height,b=Math.floor(t[n]+c),w=Math.floor(t[n+1]+c);for(let R=n+2;R<p;R+=2)b=Math.min(b,Math.floor(t[R]+c)),w=Math.min(w,Math.floor(t[R+1]+c));v-=b,T-=w;for(let R=n;R<p;R+=2)t[R]=(t[R]+v)*_,t[R+1]=(t[R+1]+T)*x}};Ii.BATCHABLE_SIZE=100;let ls=Ii;class Ci{constructor(){this.color=16777215,this.alpha=1,this.texture=f.xE.WHITE,this.matrix=null,this.visible=!1,this.reset()}clone(){const t=new Ci;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t}reset(){this.color=16777215,this.alpha=1,this.texture=f.xE.WHITE,this.matrix=null,this.visible=!1}destroy(){this.texture=null,this.matrix=null}}class us extends Ci{constructor(){super(...arguments),this.width=0,this.alignment=.5,this.native=!1,this.cap=ke.BUTT,this.join=oe.MITER,this.miterLimit=10}clone(){const t=new us;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t.width=this.width,t.alignment=this.alignment,t.native=this.native,t.cap=this.cap,t.join=this.join,t.miterLimit=this.miterLimit,t}reset(){super.reset(),this.color=0,this.alignment=.5,this.width=0,this.native=!1,this.cap=ke.BUTT,this.join=oe.MITER,this.miterLimit=10}}const ur={},cs=class Sn extends J{constructor(t=null){super(),this.shader=null,this.pluginName="batch",this.currentPath=null,this.batches=[],this.batchTint=-1,this.batchDirty=-1,this.vertexData=null,this._fillStyle=new Ci,this._lineStyle=new us,this._matrix=null,this._holeMode=!1,this.state=f.ZM.for2d(),this._geometry=t||new ls,this._geometry.refCount++,this._transformID=-1,this._tintColor=new f.Il(16777215),this.blendMode=f.T$.NORMAL}get geometry(){return this._geometry}clone(){return this.finishPoly(),new Sn(this._geometry)}set blendMode(t){this.state.blendMode=t}get blendMode(){return this.state.blendMode}get tint(){return this._tintColor.value}set tint(t){this._tintColor.setValue(t)}get fill(){return this._fillStyle}get line(){return this._lineStyle}lineStyle(t=null,r=0,n,o=.5,l=!1){return typeof t=="number"&&(t={width:t,color:r,alpha:n,alignment:o,native:l}),this.lineTextureStyle(t)}lineTextureStyle(t){const r={width:0,texture:f.xE.WHITE,color:t!=null&&t.texture?16777215:0,matrix:null,alignment:.5,native:!1,cap:ke.BUTT,join:oe.MITER,miterLimit:10};t=Object.assign(r,t),this.normalizeColor(t),this.currentPath&&this.startPoly();const n=t.width>0&&t.alpha>0;return n?(t.matrix&&(t.matrix=t.matrix.clone(),t.matrix.invert()),Object.assign(this._lineStyle,{visible:n},t)):this._lineStyle.reset(),this}startPoly(){if(this.currentPath){const t=this.currentPath.points,r=this.currentPath.points.length;r>2&&(this.drawShape(this.currentPath),this.currentPath=new f.mg,this.currentPath.closeStroke=!1,this.currentPath.points.push(t[r-2],t[r-1]))}else this.currentPath=new f.mg,this.currentPath.closeStroke=!1}finishPoly(){this.currentPath&&(this.currentPath.points.length>2?(this.drawShape(this.currentPath),this.currentPath=null):this.currentPath.points.length=0)}moveTo(t,r){return this.startPoly(),this.currentPath.points[0]=t,this.currentPath.points[1]=r,this}lineTo(t,r){this.currentPath||this.moveTo(0,0);const n=this.currentPath.points,o=n[n.length-2],l=n[n.length-1];return(o!==t||l!==r)&&n.push(t,r),this}_initCurve(t=0,r=0){this.currentPath?this.currentPath.points.length===0&&(this.currentPath.points=[t,r]):this.moveTo(t,r)}quadraticCurveTo(t,r,n,o){this._initCurve();const l=this.currentPath.points;return l.length===0&&this.moveTo(0,0),$e.curveTo(t,r,n,o,l),this}bezierCurveTo(t,r,n,o,l,c){return this._initCurve(),Ar.curveTo(t,r,n,o,l,c,this.currentPath.points),this}arcTo(t,r,n,o,l){this._initCurve(t,r);const c=this.currentPath.points,p=Hr.curveTo(t,r,n,o,l,c);if(p){const{cx:g,cy:_,radius:x,startAngle:v,endAngle:T,anticlockwise:b}=p;this.arc(g,_,x,v,T,b)}return this}arc(t,r,n,o,l,c=!1){if(o===l)return this;if(!c&&l<=o?l+=f._b:c&&o<=l&&(o+=f._b),l-o===0)return this;const p=t+Math.cos(o)*n,g=r+Math.sin(o)*n,_=this._geometry.closePointEps;let x=this.currentPath?this.currentPath.points:null;if(x){const v=Math.abs(x[x.length-2]-p),T=Math.abs(x[x.length-1]-g);v<_&&T<_||x.push(p,g)}else this.moveTo(p,g),x=this.currentPath.points;return Hr.arc(p,g,t,r,n,o,l,c,x),this}beginFill(t=0,r){return this.beginTextureFill({texture:f.xE.WHITE,color:t,alpha:r})}normalizeColor(t){var n,o;const r=f.Il.shared.setValue((n=t.color)!=null?n:0);t.color=r.toNumber(),(o=t.alpha)!=null||(t.alpha=r.alpha)}beginTextureFill(t){const r={texture:f.xE.WHITE,color:16777215,matrix:null};t=Object.assign(r,t),this.normalizeColor(t),this.currentPath&&this.startPoly();const n=t.alpha>0;return n?(t.matrix&&(t.matrix=t.matrix.clone(),t.matrix.invert()),Object.assign(this._fillStyle,{visible:n},t)):this._fillStyle.reset(),this}endFill(){return this.finishPoly(),this._fillStyle.reset(),this}drawRect(t,r,n,o){return this.drawShape(new f.Ae(t,r,n,o))}drawRoundedRect(t,r,n,o,l){return this.drawShape(new f.c9(t,r,n,o,l))}drawCircle(t,r,n){return this.drawShape(new f.Cd(t,r,n))}drawEllipse(t,r,n,o){return this.drawShape(new f.Pj(t,r,n,o))}drawPolygon(...t){let r,n=!0;const o=t[0];o.points?(n=o.closeStroke,r=o.points):Array.isArray(t[0])?r=t[0]:r=t;const l=new f.mg(r);return l.closeStroke=n,this.drawShape(l),this}drawShape(t){return this._holeMode?this._geometry.drawHole(t,this._matrix):this._geometry.drawShape(t,this._fillStyle.clone(),this._lineStyle.clone(),this._matrix),this}clear(){return this._geometry.clear(),this._lineStyle.reset(),this._fillStyle.reset(),this._boundsID++,this._matrix=null,this._holeMode=!1,this.currentPath=null,this}isFastRect(){const t=this._geometry.graphicsData;return t.length===1&&t[0].shape.type===f.HS.RECT&&!t[0].matrix&&!t[0].holes.length&&!(t[0].lineStyle.visible&&t[0].lineStyle.width)}_render(t){this.finishPoly();const r=this._geometry;r.updateBatches(),r.batchable?(this.batchDirty!==r.batchDirty&&this._populateBatches(),this._renderBatched(t)):(t.batch.flush(),this._renderDirect(t))}_populateBatches(){const t=this._geometry,r=this.blendMode,n=t.batches.length;this.batchTint=-1,this._transformID=-1,this.batchDirty=t.batchDirty,this.batches.length=n,this.vertexData=new Float32Array(t.points);for(let o=0;o<n;o++){const l=t.batches[o],c=l.style.color,p=new Float32Array(this.vertexData.buffer,l.attribStart*4*2,l.attribSize*2),g=new Float32Array(t.uvsFloat32.buffer,l.attribStart*4*2,l.attribSize*2),_=new Uint16Array(t.indicesUint16.buffer,l.start*2,l.size),x={vertexData:p,blendMode:r,indices:_,uvs:g,_batchRGB:f.Il.shared.setValue(c).toRgbArray(),_tintRGB:c,_texture:l.style.texture,alpha:l.style.alpha,worldAlpha:1};this.batches[o]=x}}_renderBatched(t){if(this.batches.length){t.batch.setObjectRenderer(t.plugins[this.pluginName]),this.calculateVertices(),this.calculateTints();for(let r=0,n=this.batches.length;r<n;r++){const o=this.batches[r];o.worldAlpha=this.worldAlpha*o.alpha,t.plugins[this.pluginName].render(o)}}}_renderDirect(t){const r=this._resolveDirectShader(t),n=this._geometry,o=this.worldAlpha,l=r.uniforms,c=n.drawCalls;l.translationMatrix=this.transform.worldTransform,f.Il.shared.setValue(this._tintColor).premultiply(o).toArray(l.tint),t.shader.bind(r),t.geometry.bind(n,r),t.state.set(this.state);for(let p=0,g=c.length;p<g;p++)this._renderDrawCallDirect(t,n.drawCalls[p])}_renderDrawCallDirect(t,r){const{texArray:n,type:o,size:l,start:c}=r,p=n.count;for(let g=0;g<p;g++)t.texture.bind(n.elements[g],g);t.geometry.draw(o,l,c)}_resolveDirectShader(t){let r=this.shader;const n=this.pluginName;if(!r){if(!ur[n]){const{maxTextures:o}=t.plugins[n],l=new Int32Array(o);for(let g=0;g<o;g++)l[g]=g;const c={tint:new Float32Array([1,1,1,1]),translationMatrix:new f.y3,default:f.oo.from({uSamplers:l},!0)},p=t.plugins[n]._shader.program;ur[n]=new f.ex(p,c)}r=ur[n]}return r}_calculateBounds(){this.finishPoly();const t=this._geometry;if(!t.graphicsData.length)return;const{minX:r,minY:n,maxX:o,maxY:l}=t.bounds;this._bounds.addFrame(this.transform,r,n,o,l)}containsPoint(t){return this.worldTransform.applyInverse(t,Sn._TEMP_POINT),this._geometry.containsPoint(Sn._TEMP_POINT)}calculateTints(){if(this.batchTint!==this.tint){this.batchTint=this._tintColor.toNumber();for(let t=0;t<this.batches.length;t++){const r=this.batches[t];r._tintRGB=f.Il.shared.setValue(this._tintColor).multiply(r._batchRGB).toLittleEndianNumber()}}}calculateVertices(){const t=this.transform._worldID;if(this._transformID===t)return;this._transformID=t;const r=this.transform.worldTransform,n=r.a,o=r.b,l=r.c,c=r.d,p=r.tx,g=r.ty,_=this._geometry.points,x=this.vertexData;let v=0;for(let T=0;T<_.length;T+=2){const b=_[T],w=_[T+1];x[v++]=n*b+l*w+p,x[v++]=c*w+o*b+g}}closePath(){const t=this.currentPath;return t&&(t.closeStroke=!0,this.finishPoly()),this}setMatrix(t){return this._matrix=t,this}beginHole(){return this.finishPoly(),this._holeMode=!0,this}endHole(){return this.finishPoly(),this._holeMode=!1,this}destroy(t){this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose(),this._matrix=null,this.currentPath=null,this._lineStyle.destroy(),this._lineStyle=null,this._fillStyle.destroy(),this._fillStyle=null,this._geometry=null,this.shader=null,this.vertexData=null,this.batches.length=0,this.batches=null,super.destroy(t)}};cs.curves=ie,cs._TEMP_POINT=new f.E9;let ds=cs;const ha={buildPoly:os,buildCircle:Gr,buildRectangle:Ws,buildRoundedRectangle:hr,buildLine:er,ArcUtils:Hr,BezierUtils:Ar,QuadraticUtils:$e,BatchPart:me,FILL_COMMANDS:Xr,BATCH_POOL:wi,DRAW_CALL_POOL:lr};class zs{constructor(t,r){this.uvBuffer=t,this.uvMatrix=r,this.data=null,this._bufferUpdateId=-1,this._textureUpdateId=-1,this._updateID=0}update(t){if(!t&&this._bufferUpdateId===this.uvBuffer._updateID&&this._textureUpdateId===this.uvMatrix._updateID)return;this._bufferUpdateId=this.uvBuffer._updateID,this._textureUpdateId=this.uvMatrix._updateID;const r=this.uvBuffer.data;(!this.data||this.data.length!==r.length)&&(this.data=new Float32Array(r.length)),this.uvMatrix.multiplyUvs(r,this.data),this._updateID++}}const cr=new f.E9,$s=new f.mg,ai=class Ta extends J{constructor(t,r,n,o=f.lg.TRIANGLES){super(),this.geometry=t,this.shader=r,this.state=n||f.ZM.for2d(),this.drawMode=o,this.start=0,this.size=0,this.uvs=null,this.indices=null,this.vertexData=new Float32Array(1),this.vertexDirty=-1,this._transformID=-1,this._roundPixels=f.Xd.ROUND_PIXELS,this.batchUvs=null}get geometry(){return this._geometry}set geometry(t){this._geometry!==t&&(this._geometry&&(this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose()),this._geometry=t,this._geometry&&this._geometry.refCount++,this.vertexDirty=-1)}get uvBuffer(){return this.geometry.buffers[1]}get verticesBuffer(){return this.geometry.buffers[0]}set material(t){this.shader=t}get material(){return this.shader}set blendMode(t){this.state.blendMode=t}get blendMode(){return this.state.blendMode}set roundPixels(t){this._roundPixels!==t&&(this._transformID=-1),this._roundPixels=t}get roundPixels(){return this._roundPixels}get tint(){return"tint"in this.shader?this.shader.tint:null}set tint(t){this.shader.tint=t}get tintValue(){return this.shader.tintValue}get texture(){return"texture"in this.shader?this.shader.texture:null}set texture(t){this.shader.texture=t}_render(t){const r=this.geometry.buffers[0].data;this.shader.batchable&&this.drawMode===f.lg.TRIANGLES&&r.length<Ta.BATCHABLE_SIZE*2?this._renderToBatch(t):this._renderDefault(t)}_renderDefault(t){const r=this.shader;r.alpha=this.worldAlpha,r.update&&r.update(),t.batch.flush(),r.uniforms.translationMatrix=this.transform.worldTransform.toArray(!0),t.shader.bind(r),t.state.set(this.state),t.geometry.bind(this.geometry,r),t.geometry.draw(this.drawMode,this.size,this.start,this.geometry.instanceCount)}_renderToBatch(t){const r=this.geometry,n=this.shader;n.uvMatrix&&(n.uvMatrix.update(),this.calculateUvs()),this.calculateVertices(),this.indices=r.indexBuffer.data,this._tintRGB=n._tintRGB,this._texture=n.texture;const o=this.material.pluginName;t.batch.setObjectRenderer(t.plugins[o]),t.plugins[o].render(this)}calculateVertices(){const t=this.geometry.buffers[0],r=t.data,n=t._updateID;if(n===this.vertexDirty&&this._transformID===this.transform._worldID)return;this._transformID=this.transform._worldID,this.vertexData.length!==r.length&&(this.vertexData=new Float32Array(r.length));const o=this.transform.worldTransform,l=o.a,c=o.b,p=o.c,g=o.d,_=o.tx,x=o.ty,v=this.vertexData;for(let T=0;T<v.length/2;T++){const b=r[T*2],w=r[T*2+1];v[T*2]=l*b+p*w+_,v[T*2+1]=c*b+g*w+x}if(this._roundPixels){const T=f.Xd.RESOLUTION;for(let b=0;b<v.length;++b)v[b]=Math.round(v[b]*T)/T}this.vertexDirty=n}calculateUvs(){const t=this.geometry.buffers[1],r=this.shader;r.uvMatrix.isSimple?this.uvs=t.data:(this.batchUvs||(this.batchUvs=new zs(t,r.uvMatrix)),this.batchUvs.update(),this.uvs=this.batchUvs.data)}_calculateBounds(){this.calculateVertices(),this._bounds.addVertexData(this.vertexData,0,this.vertexData.length)}containsPoint(t){if(!this.getBounds().contains(t.x,t.y))return!1;this.worldTransform.applyInverse(t,cr);const r=this.geometry.getBuffer("aVertexPosition").data,n=$s.points,o=this.geometry.getIndex().data,l=o.length,c=this.drawMode===4?3:1;for(let p=0;p+2<l;p+=c){const g=o[p]*2,_=o[p+1]*2,x=o[p+2]*2;if(n[0]=r[g],n[1]=r[g+1],n[2]=r[_],n[3]=r[_+1],n[4]=r[x],n[5]=r[x+1],$s.contains(cr.x,cr.y))return!0}return!1}destroy(t){super.destroy(t),this._cachedTexture&&(this._cachedTexture.destroy(),this._cachedTexture=null),this.geometry=null,this.shader=null,this.state=null,this.uvs=null,this.indices=null,this.vertexData=null}};ai.BATCHABLE_SIZE=100;let js=ai;class Wn extends f.wG{constructor(t,r,n){super();const o=new f.lW(t),l=new f.lW(r,!0),c=new f.lW(n,!0,!0);this.addAttribute("aVertexPosition",o,2,!1,f.vK.FLOAT).addAttribute("aTextureCoord",l,2,!1,f.vK.FLOAT).addIndex(c),this._updateId=-1}get vertexDirtyId(){return this.buffers[0]._updateID}}var Ys=`varying vec2 vTextureCoord;
uniform vec4 uColor;

uniform sampler2D uSampler;

void main(void)
{
    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;
}
`,Ri=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTextureMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;
}
`;class fs extends f.ex{constructor(t,r){const n={uSampler:t,alpha:1,uTextureMatrix:f.y3.IDENTITY,uColor:new Float32Array([1,1,1,1])};r=Object.assign({tint:16777215,alpha:1,pluginName:"batch"},r),r.uniforms&&Object.assign(n,r.uniforms),super(r.program||f.$r.from(Ri,Ys),n),this._colorDirty=!1,this.uvMatrix=new f.UX(t),this.batchable=r.program===void 0,this.pluginName=r.pluginName,this._tintColor=new f.Il(r.tint),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0,this.alpha=r.alpha}get texture(){return this.uniforms.uSampler}set texture(t){this.uniforms.uSampler!==t&&(!this.uniforms.uSampler.baseTexture.alphaMode!=!t.baseTexture.alphaMode&&(this._colorDirty=!0),this.uniforms.uSampler=t,this.uvMatrix.texture=t)}set alpha(t){t!==this._alpha&&(this._alpha=t,this._colorDirty=!0)}get alpha(){return this._alpha}set tint(t){t!==this.tint&&(this._tintColor.setValue(t),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0)}get tint(){return this._tintColor.value}get tintValue(){return this._tintColor.toNumber()}update(){if(this._colorDirty){this._colorDirty=!1;const t=this.texture.baseTexture.alphaMode;f.Il.shared.setValue(this._tintColor).premultiply(this._alpha,t).toArray(this.uniforms.uColor)}this.uvMatrix.update()&&(this.uniforms.uTextureMatrix=this.uvMatrix.mapCoord)}}class zn extends null{constructor(t=100,r=100,n=10,o=10){super(),this.segWidth=n,this.segHeight=o,this.width=t,this.height=r,this.build()}build(){const t=this.segWidth*this.segHeight,r=[],n=[],o=[],l=this.segWidth-1,c=this.segHeight-1,p=this.width/l,g=this.height/c;for(let x=0;x<t;x++){const v=x%this.segWidth,T=x/this.segWidth|0;r.push(v*p,T*g),n.push(v/l,T/c)}const _=l*c;for(let x=0;x<_;x++){const v=x%l,T=x/l|0,b=T*this.segWidth+v,w=T*this.segWidth+v+1,R=(T+1)*this.segWidth+v,k=(T+1)*this.segWidth+v+1;o.push(b,w,R,w,k,R)}this.buffers[0].data=new Float32Array(r),this.buffers[1].data=new Float32Array(n),this.indexBuffer.data=new Uint16Array(o),this.buffers[0].update(),this.buffers[1].update(),this.indexBuffer.update()}}class $n extends null{constructor(t=200,r,n=0){super(new Float32Array(r.length*4),new Float32Array(r.length*4),new Uint16Array((r.length-1)*6)),this.points=r,this._width=t,this.textureScale=n,this.build()}get width(){return this._width}build(){const t=this.points;if(!t)return;const r=this.getBuffer("aVertexPosition"),n=this.getBuffer("aTextureCoord"),o=this.getIndex();if(t.length<1)return;r.data.length/4!==t.length&&(r.data=new Float32Array(t.length*4),n.data=new Float32Array(t.length*4),o.data=new Uint16Array((t.length-1)*6));const l=n.data,c=o.data;l[0]=0,l[1]=0,l[2]=0,l[3]=1;let p=0,g=t[0];const _=this._width*this.textureScale,x=t.length;for(let T=0;T<x;T++){const b=T*4;if(this.textureScale>0){const w=g.x-t[T].x,R=g.y-t[T].y,k=Math.sqrt(w*w+R*R);g=t[T],p+=k/_}else p=T/(x-1);l[b]=p,l[b+1]=0,l[b+2]=p,l[b+3]=1}let v=0;for(let T=0;T<x-1;T++){const b=T*2;c[v++]=b,c[v++]=b+1,c[v++]=b+2,c[v++]=b+2,c[v++]=b+1,c[v++]=b+3}n.update(),o.update(),this.updateVertices()}updateVertices(){const t=this.points;if(t.length<1)return;let r=t[0],n,o=0,l=0;const c=this.buffers[0].data,p=t.length,g=this.textureScale>0?this.textureScale*this._width/2:this._width/2;for(let _=0;_<p;_++){const x=t[_],v=_*4;_<t.length-1?n=t[_+1]:n=x,l=-(n.x-r.x),o=n.y-r.y;let T=(1-_/(p-1))*10;T>1&&(T=1);const b=Math.sqrt(o*o+l*l);b<1e-6?(o=0,l=0):(o/=b,l/=b,o*=g,l*=g),c[v]=x.x+o,c[v+1]=x.y+l,c[v+2]=x.x-o,c[v+3]=x.y-l,r=x}this.buffers[0].update()}update(){this.textureScale>0?this.build():this.updateVertices()}}class la extends null{constructor(t,r,n){const o=new PlaneGeometry(t.width,t.height,r,n),l=new MeshMaterial(Texture.WHITE);super(o,l),this.texture=t,this.autoResize=!0}textureUpdated(){this._textureID=this.shader.texture._updateID;const t=this.geometry,{width:r,height:n}=this.shader.texture;this.autoResize&&(t.width!==r||t.height!==n)&&(t.width=this.shader.texture.width,t.height=this.shader.texture.height,t.build())}set texture(t){this.shader.texture!==t&&(this.shader.texture=t,this._textureID=-1,t.baseTexture.valid?this.textureUpdated():t.once("update",this.textureUpdated,this))}get texture(){return this.shader.texture}_render(t){this._textureID!==this.shader.texture._updateID&&this.textureUpdated(),super._render(t)}destroy(t){this.shader.texture.off("update",this.textureUpdated,this),super.destroy(t)}}const Ir=10;class Ks extends null{constructor(t,r,n,o,l){var c,p,g,_,x,v,T,b;super(Texture.WHITE,4,4),this._origWidth=t.orig.width,this._origHeight=t.orig.height,this._width=this._origWidth,this._height=this._origHeight,this._leftWidth=(p=r!=null?r:(c=t.defaultBorders)==null?void 0:c.left)!=null?p:Ir,this._rightWidth=(_=o!=null?o:(g=t.defaultBorders)==null?void 0:g.right)!=null?_:Ir,this._topHeight=(v=n!=null?n:(x=t.defaultBorders)==null?void 0:x.top)!=null?v:Ir,this._bottomHeight=(b=l!=null?l:(T=t.defaultBorders)==null?void 0:T.bottom)!=null?b:Ir,this.texture=t}textureUpdated(){this._textureID=this.shader.texture._updateID,this._refresh()}get vertices(){return this.geometry.getBuffer("aVertexPosition").data}set vertices(t){this.geometry.getBuffer("aVertexPosition").data=t}updateHorizontalVertices(){const t=this.vertices,r=this._getMinScale();t[9]=t[11]=t[13]=t[15]=this._topHeight*r,t[17]=t[19]=t[21]=t[23]=this._height-this._bottomHeight*r,t[25]=t[27]=t[29]=t[31]=this._height}updateVerticalVertices(){const t=this.vertices,r=this._getMinScale();t[2]=t[10]=t[18]=t[26]=this._leftWidth*r,t[4]=t[12]=t[20]=t[28]=this._width-this._rightWidth*r,t[6]=t[14]=t[22]=t[30]=this._width}_getMinScale(){const t=this._leftWidth+this._rightWidth,r=this._width>t?1:this._width/t,n=this._topHeight+this._bottomHeight,o=this._height>n?1:this._height/n;return Math.min(r,o)}get width(){return this._width}set width(t){this._width=t,this._refresh()}get height(){return this._height}set height(t){this._height=t,this._refresh()}get leftWidth(){return this._leftWidth}set leftWidth(t){this._leftWidth=t,this._refresh()}get rightWidth(){return this._rightWidth}set rightWidth(t){this._rightWidth=t,this._refresh()}get topHeight(){return this._topHeight}set topHeight(t){this._topHeight=t,this._refresh()}get bottomHeight(){return this._bottomHeight}set bottomHeight(t){this._bottomHeight=t,this._refresh()}_refresh(){const t=this.texture,r=this.geometry.buffers[1].data;this._origWidth=t.orig.width,this._origHeight=t.orig.height;const n=1/this._origWidth,o=1/this._origHeight;r[0]=r[8]=r[16]=r[24]=0,r[1]=r[3]=r[5]=r[7]=0,r[6]=r[14]=r[22]=r[30]=1,r[25]=r[27]=r[29]=r[31]=1,r[2]=r[10]=r[18]=r[26]=n*this._leftWidth,r[4]=r[12]=r[20]=r[28]=1-n*this._rightWidth,r[9]=r[11]=r[13]=r[15]=o*this._topHeight,r[17]=r[19]=r[21]=r[23]=1-o*this._bottomHeight,this.updateHorizontalVertices(),this.updateVerticalVertices(),this.geometry.buffers[0].update(),this.geometry.buffers[1].update()}}class Cr extends null{constructor(t=Texture.EMPTY,r,n,o,l){const c=new MeshGeometry(r,n,o);c.getBuffer("aVertexPosition").static=!1;const p=new MeshMaterial(t);super(c,p,null,l),this.autoUpdate=!0}get vertices(){return this.geometry.getBuffer("aVertexPosition").data}set vertices(t){this.geometry.getBuffer("aVertexPosition").data=t}_render(t){this.autoUpdate&&this.geometry.getBuffer("aVertexPosition").update(),super._render(t)}}class ua extends null{constructor(t,r,n=0){const o=new RopeGeometry(t.height,r,n),l=new MeshMaterial(t);n>0&&(t.baseTexture.wrapMode=WRAP_MODES.REPEAT),super(o,l),this.autoUpdate=!0}_render(t){const r=this.geometry;(this.autoUpdate||r._width!==this.shader.texture.height)&&(r._width=this.shader.texture.height,r.update()),super._render(t)}}class je extends null{constructor(t=1500,r,n=16384,o=!1){super();const l=16384;n>l&&(n=l),this._properties=[!1,!0,!1,!1,!1],this._maxSize=t,this._batchSize=n,this._buffers=null,this._bufferUpdateIDs=[],this._updateID=0,this.interactiveChildren=!1,this.blendMode=BLEND_MODES.NORMAL,this.autoResize=o,this.roundPixels=!0,this.baseTexture=null,this.setProperties(r),this._tintColor=new Color(0),this.tintRgb=new Float32Array(3),this.tint=16777215}setProperties(t){t&&(this._properties[0]="vertices"in t||"scale"in t?!!t.vertices||!!t.scale:this._properties[0],this._properties[1]="position"in t?!!t.position:this._properties[1],this._properties[2]="rotation"in t?!!t.rotation:this._properties[2],this._properties[3]="uvs"in t?!!t.uvs:this._properties[3],this._properties[4]="tint"in t||"alpha"in t?!!t.tint||!!t.alpha:this._properties[4])}updateTransform(){this.displayObjectUpdateTransform()}get tint(){return this._tintColor.value}set tint(t){this._tintColor.setValue(t),this._tintColor.toRgbArray(this.tintRgb)}render(t){!this.visible||this.worldAlpha<=0||!this.children.length||!this.renderable||(this.baseTexture||(this.baseTexture=this.children[0]._texture.baseTexture,this.baseTexture.valid||this.baseTexture.once("update",()=>this.onChildrenChange(0))),t.batch.setObjectRenderer(t.plugins.particle),t.plugins.particle.render(this))}onChildrenChange(t){const r=Math.floor(t/this._batchSize);for(;this._bufferUpdateIDs.length<r;)this._bufferUpdateIDs.push(0);this._bufferUpdateIDs[r]=++this._updateID}dispose(){if(this._buffers){for(let t=0;t<this._buffers.length;++t)this._buffers[t].destroy();this._buffers=null}}destroy(t){super.destroy(t),this.dispose(),this._properties=null,this._buffers=null,this._bufferUpdateIDs=null}}class Vr{constructor(t,r,n){this.geometry=new f.wG,this.indexBuffer=null,this.size=n,this.dynamicProperties=[],this.staticProperties=[];for(let o=0;o<t.length;++o){let l=t[o];l={attributeName:l.attributeName,size:l.size,uploadFunction:l.uploadFunction,type:l.type||f.vK.FLOAT,offset:l.offset},r[o]?this.dynamicProperties.push(l):this.staticProperties.push(l)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this._updateID=0,this.initBuffers()}initBuffers(){const t=this.geometry;let r=0;this.indexBuffer=new f.lW(f.P6.createIndicesForQuads(this.size),!0,!0),t.addIndex(this.indexBuffer),this.dynamicStride=0;for(let c=0;c<this.dynamicProperties.length;++c){const p=this.dynamicProperties[c];p.offset=r,r+=p.size,this.dynamicStride+=p.size}const n=new ArrayBuffer(this.size*this.dynamicStride*4*4);this.dynamicData=new Float32Array(n),this.dynamicDataUint32=new Uint32Array(n),this.dynamicBuffer=new f.lW(this.dynamicData,!1,!1);let o=0;this.staticStride=0;for(let c=0;c<this.staticProperties.length;++c){const p=this.staticProperties[c];p.offset=o,o+=p.size,this.staticStride+=p.size}const l=new ArrayBuffer(this.size*this.staticStride*4*4);this.staticData=new Float32Array(l),this.staticDataUint32=new Uint32Array(l),this.staticBuffer=new f.lW(this.staticData,!0,!1);for(let c=0;c<this.dynamicProperties.length;++c){const p=this.dynamicProperties[c];t.addAttribute(p.attributeName,this.dynamicBuffer,0,p.type===f.vK.UNSIGNED_BYTE,p.type,this.dynamicStride*4,p.offset*4)}for(let c=0;c<this.staticProperties.length;++c){const p=this.staticProperties[c];t.addAttribute(p.attributeName,this.staticBuffer,0,p.type===f.vK.UNSIGNED_BYTE,p.type,this.staticStride*4,p.offset*4)}}uploadDynamic(t,r,n){for(let o=0;o<this.dynamicProperties.length;o++){const l=this.dynamicProperties[o];l.uploadFunction(t,r,n,l.type===f.vK.UNSIGNED_BYTE?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,l.offset)}this.dynamicBuffer._updateID++}uploadStatic(t,r,n){for(let o=0;o<this.staticProperties.length;o++){const l=this.staticProperties[o];l.uploadFunction(t,r,n,l.type===f.vK.UNSIGNED_BYTE?this.staticDataUint32:this.staticData,this.staticStride,l.offset)}this.staticBuffer._updateID++}destroy(){this.indexBuffer=null,this.dynamicProperties=null,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this.staticProperties=null,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.geometry.destroy()}}var jn=`varying vec2 vTextureCoord;
varying vec4 vColor;

uniform sampler2D uSampler;

void main(void){
    vec4 color = texture2D(uSampler, vTextureCoord) * vColor;
    gl_FragColor = color;
}`,qs=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;

attribute vec2 aPositionCoord;
attribute float aRotation;

uniform mat3 translationMatrix;
uniform vec4 uColor;

varying vec2 vTextureCoord;
varying vec4 vColor;

void main(void){
    float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);
    float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);

    vec2 v = vec2(x, y);
    v = v + aPositionCoord;

    gl_Position = vec4((translationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vColor = aColor * uColor;
}
`;class Zs extends f.bO{constructor(t){super(t),this.shader=null,this.properties=null,this.tempMatrix=new f.y3,this.properties=[{attributeName:"aVertexPosition",size:2,uploadFunction:this.uploadVertices,offset:0},{attributeName:"aPositionCoord",size:2,uploadFunction:this.uploadPosition,offset:0},{attributeName:"aRotation",size:1,uploadFunction:this.uploadRotation,offset:0},{attributeName:"aTextureCoord",size:2,uploadFunction:this.uploadUvs,offset:0},{attributeName:"aColor",size:1,type:f.vK.UNSIGNED_BYTE,uploadFunction:this.uploadTint,offset:0}],this.shader=f.ex.from(qs,jn,{}),this.state=f.ZM.for2d()}render(t){const r=t.children,n=t._maxSize,o=t._batchSize,l=this.renderer;let c=r.length;if(c===0)return;c>n&&!t.autoResize&&(c=n);let p=t._buffers;p||(p=t._buffers=this.generateBuffers(t));const g=r[0]._texture.baseTexture,_=g.alphaMode>0;this.state.blendMode=f.P6.correctBlendMode(t.blendMode,_),l.state.set(this.state);const x=l.gl,v=t.worldTransform.copyTo(this.tempMatrix);v.prepend(l.globalUniforms.uniforms.projectionMatrix),this.shader.uniforms.translationMatrix=v.toArray(!0),this.shader.uniforms.uColor=f.Il.shared.setValue(t.tintRgb).premultiply(t.worldAlpha,_).toArray(this.shader.uniforms.uColor),this.shader.uniforms.uSampler=g,this.renderer.shader.bind(this.shader);let T=!1;for(let b=0,w=0;b<c;b+=o,w+=1){let R=c-b;R>o&&(R=o),w>=p.length&&p.push(this._generateOneMoreBuffer(t));const k=p[w];k.uploadDynamic(r,b,R);const L=t._bufferUpdateIDs[w]||0;T=T||k._updateID<L,T&&(k._updateID=t._updateID,k.uploadStatic(r,b,R)),l.geometry.bind(k.geometry),x.drawElements(x.TRIANGLES,R*6,x.UNSIGNED_SHORT,0)}}generateBuffers(t){const r=[],n=t._maxSize,o=t._batchSize,l=t._properties;for(let c=0;c<n;c+=o)r.push(new Vr(this.properties,l,o));return r}_generateOneMoreBuffer(t){const r=t._batchSize,n=t._properties;return new Vr(this.properties,n,r)}uploadVertices(t,r,n,o,l,c){let p=0,g=0,_=0,x=0;for(let v=0;v<n;++v){const T=t[r+v],b=T._texture,w=T.scale.x,R=T.scale.y,k=b.trim,L=b.orig;k?(g=k.x-T.anchor.x*L.width,p=g+k.width,x=k.y-T.anchor.y*L.height,_=x+k.height):(p=L.width*(1-T.anchor.x),g=L.width*-T.anchor.x,_=L.height*(1-T.anchor.y),x=L.height*-T.anchor.y),o[c]=g*w,o[c+1]=x*R,o[c+l]=p*w,o[c+l+1]=x*R,o[c+l*2]=p*w,o[c+l*2+1]=_*R,o[c+l*3]=g*w,o[c+l*3+1]=_*R,c+=l*4}}uploadPosition(t,r,n,o,l,c){for(let p=0;p<n;p++){const g=t[r+p].position;o[c]=g.x,o[c+1]=g.y,o[c+l]=g.x,o[c+l+1]=g.y,o[c+l*2]=g.x,o[c+l*2+1]=g.y,o[c+l*3]=g.x,o[c+l*3+1]=g.y,c+=l*4}}uploadRotation(t,r,n,o,l,c){for(let p=0;p<n;p++){const g=t[r+p].rotation;o[c]=g,o[c+l]=g,o[c+l*2]=g,o[c+l*3]=g,c+=l*4}}uploadUvs(t,r,n,o,l,c){for(let p=0;p<n;++p){const g=t[r+p]._texture._uvs;g?(o[c]=g.x0,o[c+1]=g.y0,o[c+l]=g.x1,o[c+l+1]=g.y1,o[c+l*2]=g.x2,o[c+l*2+1]=g.y2,o[c+l*3]=g.x3,o[c+l*3+1]=g.y3,c+=l*4):(o[c]=0,o[c+1]=0,o[c+l]=0,o[c+l+1]=0,o[c+l*2]=0,o[c+l*2+1]=0,o[c+l*3]=0,o[c+l*3+1]=0,c+=l*4)}}uploadTint(t,r,n,o,l,c){for(let p=0;p<n;++p){const g=t[r+p],_=f.Il.shared.setValue(g._tintRGB).toPremultiplied(g.alpha,g.texture.baseTexture.alphaMode>0);o[c]=_,o[c+l]=_,o[c+l*2]=_,o[c+l*3]=_,c+=l*4}}destroy(){super.destroy(),this.shader&&(this.shader.destroy(),this.shader=null),this.tempMatrix=null}}Zs.extension={name:"particle",type:f.nw.RendererPlugin},f.Rw.add(Zs);var Pi=(d=>(d[d.LINEAR_VERTICAL=0]="LINEAR_VERTICAL",d[d.LINEAR_HORIZONTAL=1]="LINEAR_HORIZONTAL",d))(Pi||{});const Wr={willReadFrequently:!0},Ye=class Dt{static get experimentalLetterSpacingSupported(){let t=Dt._experimentalLetterSpacingSupported;if(t!==void 0){const r=f.Xd.ADAPTER.getCanvasRenderingContext2D().prototype;t=Dt._experimentalLetterSpacingSupported="letterSpacing"in r||"textLetterSpacing"in r}return t}constructor(t,r,n,o,l,c,p,g,_){this.text=t,this.style=r,this.width=n,this.height=o,this.lines=l,this.lineWidths=c,this.lineHeight=p,this.maxLineWidth=g,this.fontProperties=_}static measureText(t,r,n,o=Dt._canvas){n=n!=null?n:r.wordWrap;const l=r.toFontString(),c=Dt.measureFont(l);c.fontSize===0&&(c.fontSize=r.fontSize,c.ascent=r.fontSize);const p=o.getContext("2d",Wr);p.font=l;const g=(n?Dt.wordWrap(t,r,o):t).split(/(?:\r\n|\r|\n)/),_=new Array(g.length);let x=0;for(let w=0;w<g.length;w++){const R=Dt._measureText(g[w],r.letterSpacing,p);_[w]=R,x=Math.max(x,R)}let v=x+r.strokeThickness;r.dropShadow&&(v+=r.dropShadowDistance);const T=r.lineHeight||c.fontSize+r.strokeThickness;let b=Math.max(T,c.fontSize+r.strokeThickness*2)+r.leading+(g.length-1)*(T+r.leading);return r.dropShadow&&(b+=r.dropShadowDistance),new Dt(t,r,v,b,g,_,T+r.leading,x,c)}static _measureText(t,r,n){let o=!1;Dt.experimentalLetterSpacingSupported&&(Dt.experimentalLetterSpacing?(n.letterSpacing=`${r}px`,n.textLetterSpacing=`${r}px`,o=!0):(n.letterSpacing="0px",n.textLetterSpacing="0px"));let l=n.measureText(t).width;return l>0&&(o?l-=r:l+=(Dt.graphemeSegmenter(t).length-1)*r),l}static wordWrap(t,r,n=Dt._canvas){const o=n.getContext("2d",Wr);let l=0,c="",p="";const g=Object.create(null),{letterSpacing:_,whiteSpace:x}=r,v=Dt.collapseSpaces(x),T=Dt.collapseNewlines(x);let b=!v;const w=r.wordWrapWidth+_,R=Dt.tokenize(t);for(let k=0;k<R.length;k++){let L=R[k];if(Dt.isNewline(L)){if(!T){p+=Dt.addLine(c),b=!v,c="",l=0;continue}L=" "}if(v){const $=Dt.isBreakingSpace(L),tt=Dt.isBreakingSpace(c[c.length-1]);if($&&tt)continue}const nt=Dt.getFromCache(L,_,g,o);if(nt>w)if(c!==""&&(p+=Dt.addLine(c),c="",l=0),Dt.canBreakWords(L,r.breakWords)){const $=Dt.wordWrapSplit(L);for(let tt=0;tt<$.length;tt++){let St=$[tt],Wt=St,Ct=1;for(;$[tt+Ct];){const Xt=$[tt+Ct];if(!Dt.canBreakChars(Wt,Xt,L,tt,r.breakWords))St+=Xt;else break;Wt=Xt,Ct++}tt+=Ct-1;const It=Dt.getFromCache(St,_,g,o);It+l>w&&(p+=Dt.addLine(c),b=!1,c="",l=0),c+=St,l+=It}}else{c.length>0&&(p+=Dt.addLine(c),c="",l=0);const $=k===R.length-1;p+=Dt.addLine(L,!$),b=!1,c="",l=0}else nt+l>w&&(b=!1,p+=Dt.addLine(c),c="",l=0),(c.length>0||!Dt.isBreakingSpace(L)||b)&&(c+=L,l+=nt)}return p+=Dt.addLine(c,!1),p}static addLine(t,r=!0){return t=Dt.trimRight(t),t=r?`${t}
`:t,t}static getFromCache(t,r,n,o){let l=n[t];return typeof l!="number"&&(l=Dt._measureText(t,r,o)+r,n[t]=l),l}static collapseSpaces(t){return t==="normal"||t==="pre-line"}static collapseNewlines(t){return t==="normal"}static trimRight(t){if(typeof t!="string")return"";for(let r=t.length-1;r>=0;r--){const n=t[r];if(!Dt.isBreakingSpace(n))break;t=t.slice(0,-1)}return t}static isNewline(t){return typeof t!="string"?!1:Dt._newlines.includes(t.charCodeAt(0))}static isBreakingSpace(t,r){return typeof t!="string"?!1:Dt._breakingSpaces.includes(t.charCodeAt(0))}static tokenize(t){const r=[];let n="";if(typeof t!="string")return r;for(let o=0;o<t.length;o++){const l=t[o],c=t[o+1];if(Dt.isBreakingSpace(l,c)||Dt.isNewline(l)){n!==""&&(r.push(n),n=""),r.push(l);continue}n+=l}return n!==""&&r.push(n),r}static canBreakWords(t,r){return r}static canBreakChars(t,r,n,o,l){return!0}static wordWrapSplit(t){return Dt.graphemeSegmenter(t)}static measureFont(t){if(Dt._fonts[t])return Dt._fonts[t];const r={ascent:0,descent:0,fontSize:0},n=Dt._canvas,o=Dt._context;o.font=t;const l=Dt.METRICS_STRING+Dt.BASELINE_SYMBOL,c=Math.ceil(o.measureText(l).width);let p=Math.ceil(o.measureText(Dt.BASELINE_SYMBOL).width);const g=Math.ceil(Dt.HEIGHT_MULTIPLIER*p);if(p=p*Dt.BASELINE_MULTIPLIER|0,c===0||g===0)return Dt._fonts[t]=r,r;n.width=c,n.height=g,o.fillStyle="#f00",o.fillRect(0,0,c,g),o.font=t,o.textBaseline="alphabetic",o.fillStyle="#000",o.fillText(l,0,p);const _=o.getImageData(0,0,c,g).data,x=_.length,v=c*4;let T=0,b=0,w=!1;for(T=0;T<p;++T){for(let R=0;R<v;R+=4)if(_[b+R]!==255){w=!0;break}if(!w)b+=v;else break}for(r.ascent=p-T,b=x-v,w=!1,T=g;T>p;--T){for(let R=0;R<v;R+=4)if(_[b+R]!==255){w=!0;break}if(!w)b-=v;else break}return r.descent=T-p,r.fontSize=r.ascent+r.descent,Dt._fonts[t]=r,r}static clearMetrics(t=""){t?delete Dt._fonts[t]:Dt._fonts={}}static get _canvas(){var t;if(!Dt.__canvas){let r;try{const n=new OffscreenCanvas(0,0);if((t=n.getContext("2d",Wr))!=null&&t.measureText)return Dt.__canvas=n,n;r=f.Xd.ADAPTER.createCanvas()}catch(n){r=f.Xd.ADAPTER.createCanvas()}r.width=r.height=10,Dt.__canvas=r}return Dt.__canvas}static get _context(){return Dt.__context||(Dt.__context=Dt._canvas.getContext("2d",Wr)),Dt.__context}};Ye.METRICS_STRING="|\xC9q\xC5",Ye.BASELINE_SYMBOL="M",Ye.BASELINE_MULTIPLIER=1.4,Ye.HEIGHT_MULTIPLIER=2,Ye.graphemeSegmenter=(()=>{if(typeof(Intl==null?void 0:Intl.Segmenter)=="function"){const d=new Intl.Segmenter;return t=>[...d.segment(t)].map(r=>r.segment)}return d=>[...d]})(),Ye.experimentalLetterSpacing=!1,Ye._fonts={},Ye._newlines=[10,13],Ye._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];let dr=Ye;const oi=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],fr=class Fs{constructor(t){this.styleID=0,this.reset(),rr(this,t,t)}clone(){const t={};return rr(t,this,Fs.defaultStyle),new Fs(t)}reset(){rr(this,Fs.defaultStyle,Fs.defaultStyle)}get align(){return this._align}set align(t){this._align!==t&&(this._align=t,this.styleID++)}get breakWords(){return this._breakWords}set breakWords(t){this._breakWords!==t&&(this._breakWords=t,this.styleID++)}get dropShadow(){return this._dropShadow}set dropShadow(t){this._dropShadow!==t&&(this._dropShadow=t,this.styleID++)}get dropShadowAlpha(){return this._dropShadowAlpha}set dropShadowAlpha(t){this._dropShadowAlpha!==t&&(this._dropShadowAlpha=t,this.styleID++)}get dropShadowAngle(){return this._dropShadowAngle}set dropShadowAngle(t){this._dropShadowAngle!==t&&(this._dropShadowAngle=t,this.styleID++)}get dropShadowBlur(){return this._dropShadowBlur}set dropShadowBlur(t){this._dropShadowBlur!==t&&(this._dropShadowBlur=t,this.styleID++)}get dropShadowColor(){return this._dropShadowColor}set dropShadowColor(t){const r=ps(t);this._dropShadowColor!==r&&(this._dropShadowColor=r,this.styleID++)}get dropShadowDistance(){return this._dropShadowDistance}set dropShadowDistance(t){this._dropShadowDistance!==t&&(this._dropShadowDistance=t,this.styleID++)}get fill(){return this._fill}set fill(t){const r=ps(t);this._fill!==r&&(this._fill=r,this.styleID++)}get fillGradientType(){return this._fillGradientType}set fillGradientType(t){this._fillGradientType!==t&&(this._fillGradientType=t,this.styleID++)}get fillGradientStops(){return this._fillGradientStops}set fillGradientStops(t){ms(this._fillGradientStops,t)||(this._fillGradientStops=t,this.styleID++)}get fontFamily(){return this._fontFamily}set fontFamily(t){this.fontFamily!==t&&(this._fontFamily=t,this.styleID++)}get fontSize(){return this._fontSize}set fontSize(t){this._fontSize!==t&&(this._fontSize=t,this.styleID++)}get fontStyle(){return this._fontStyle}set fontStyle(t){this._fontStyle!==t&&(this._fontStyle=t,this.styleID++)}get fontVariant(){return this._fontVariant}set fontVariant(t){this._fontVariant!==t&&(this._fontVariant=t,this.styleID++)}get fontWeight(){return this._fontWeight}set fontWeight(t){this._fontWeight!==t&&(this._fontWeight=t,this.styleID++)}get letterSpacing(){return this._letterSpacing}set letterSpacing(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.styleID++)}get lineHeight(){return this._lineHeight}set lineHeight(t){this._lineHeight!==t&&(this._lineHeight=t,this.styleID++)}get leading(){return this._leading}set leading(t){this._leading!==t&&(this._leading=t,this.styleID++)}get lineJoin(){return this._lineJoin}set lineJoin(t){this._lineJoin!==t&&(this._lineJoin=t,this.styleID++)}get miterLimit(){return this._miterLimit}set miterLimit(t){this._miterLimit!==t&&(this._miterLimit=t,this.styleID++)}get padding(){return this._padding}set padding(t){this._padding!==t&&(this._padding=t,this.styleID++)}get stroke(){return this._stroke}set stroke(t){const r=ps(t);this._stroke!==r&&(this._stroke=r,this.styleID++)}get strokeThickness(){return this._strokeThickness}set strokeThickness(t){this._strokeThickness!==t&&(this._strokeThickness=t,this.styleID++)}get textBaseline(){return this._textBaseline}set textBaseline(t){this._textBaseline!==t&&(this._textBaseline=t,this.styleID++)}get trim(){return this._trim}set trim(t){this._trim!==t&&(this._trim=t,this.styleID++)}get whiteSpace(){return this._whiteSpace}set whiteSpace(t){this._whiteSpace!==t&&(this._whiteSpace=t,this.styleID++)}get wordWrap(){return this._wordWrap}set wordWrap(t){this._wordWrap!==t&&(this._wordWrap=t,this.styleID++)}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(t){this._wordWrapWidth!==t&&(this._wordWrapWidth=t,this.styleID++)}toFontString(){const t=typeof this.fontSize=="number"?`${this.fontSize}px`:this.fontSize;let r=this.fontFamily;Array.isArray(this.fontFamily)||(r=this.fontFamily.split(","));for(let n=r.length-1;n>=0;n--){let o=r[n].trim();!/([\"\'])[^\'\"]+\1/.test(o)&&!oi.includes(o)&&(o=`"${o}"`),r[n]=o}return`${this.fontStyle} ${this.fontVariant} ${this.fontWeight} ${t} ${r.join(",")}`}};fr.defaultStyle={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:Pi.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",leading:0,letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100};let pr=fr;function ps(d){const t=f.Il.shared,r=n=>{const o=t.setValue(n);return o.alpha===1?o.toHex():o.toRgbaString()};return Array.isArray(d)?d.map(r):r(d)}function ms(d,t){if(!Array.isArray(d)||!Array.isArray(t)||d.length!==t.length)return!1;for(let r=0;r<d.length;++r)if(d[r]!==t[r])return!1;return!0}function rr(d,t,r){for(const n in r)Array.isArray(t[n])?d[n]=t[n].slice():d[n]=t[n]}const Mi={texture:!0,children:!1,baseTexture:!0},gs=class oa extends q{constructor(t,r,n){var c;let o=!1;n||(n=f.Xd.ADAPTER.createCanvas(),o=!0),n.width=3,n.height=3;const l=f.xE.from(n);l.orig=new f.Ae,l.trim=new f.Ae,super(l),this._ownCanvas=o,this.canvas=n,this.context=n.getContext("2d",{willReadFrequently:!0}),this._resolution=(c=oa.defaultResolution)!=null?c:f.Xd.RESOLUTION,this._autoResolution=oa.defaultAutoResolution,this._text=null,this._style=null,this._styleListener=null,this._font="",this.text=t,this.style=r,this.localStyleID=-1}static get experimentalLetterSpacing(){return dr.experimentalLetterSpacing}static set experimentalLetterSpacing(t){f.P6.deprecation("7.1.0","Text.experimentalLetterSpacing is deprecated, use TextMetrics.experimentalLetterSpacing"),dr.experimentalLetterSpacing=t}updateText(t){const r=this._style;if(this.localStyleID!==r.styleID&&(this.dirty=!0,this.localStyleID=r.styleID),!this.dirty&&t)return;this._font=this._style.toFontString();const n=this.context,o=dr.measureText(this._text||" ",this._style,this._style.wordWrap,this.canvas),l=o.width,c=o.height,p=o.lines,g=o.lineHeight,_=o.lineWidths,x=o.maxLineWidth,v=o.fontProperties;this.canvas.width=Math.ceil(Math.ceil(Math.max(1,l)+r.padding*2)*this._resolution),this.canvas.height=Math.ceil(Math.ceil(Math.max(1,c)+r.padding*2)*this._resolution),n.scale(this._resolution,this._resolution),n.clearRect(0,0,this.canvas.width,this.canvas.height),n.font=this._font,n.lineWidth=r.strokeThickness,n.textBaseline=r.textBaseline,n.lineJoin=r.lineJoin,n.miterLimit=r.miterLimit;let T,b;const w=r.dropShadow?2:1;for(let R=0;R<w;++R){const k=r.dropShadow&&R===0,L=k?Math.ceil(Math.max(1,c)+r.padding*2):0,nt=L*this._resolution;if(k){n.fillStyle="black",n.strokeStyle="black";const tt=r.dropShadowColor,St=r.dropShadowBlur*this._resolution,Wt=r.dropShadowDistance*this._resolution;n.shadowColor=f.Il.shared.setValue(tt).setAlpha(r.dropShadowAlpha).toRgbaString(),n.shadowBlur=St,n.shadowOffsetX=Math.cos(r.dropShadowAngle)*Wt,n.shadowOffsetY=Math.sin(r.dropShadowAngle)*Wt+nt}else n.fillStyle=this._generateFillStyle(r,p,o),n.strokeStyle=r.stroke,n.shadowColor="black",n.shadowBlur=0,n.shadowOffsetX=0,n.shadowOffsetY=0;let $=(g-v.fontSize)/2;g-v.fontSize<0&&($=0);for(let tt=0;tt<p.length;tt++)T=r.strokeThickness/2,b=r.strokeThickness/2+tt*g+v.ascent+$,r.align==="right"?T+=x-_[tt]:r.align==="center"&&(T+=(x-_[tt])/2),r.stroke&&r.strokeThickness&&this.drawLetterSpacing(p[tt],T+r.padding,b+r.padding-L,!0),r.fill&&this.drawLetterSpacing(p[tt],T+r.padding,b+r.padding-L)}this.updateTexture()}drawLetterSpacing(t,r,n,o=!1){const l=this._style.letterSpacing;let c=!1;if(dr.experimentalLetterSpacingSupported&&(dr.experimentalLetterSpacing?(this.context.letterSpacing=`${l}px`,this.context.textLetterSpacing=`${l}px`,c=!0):(this.context.letterSpacing="0px",this.context.textLetterSpacing="0px")),l===0||c){o?this.context.strokeText(t,r,n):this.context.fillText(t,r,n);return}let p=r;const g=dr.graphemeSegmenter(t);let _=this.context.measureText(t).width,x=0;for(let v=0;v<g.length;++v){const T=g[v];o?this.context.strokeText(T,p,n):this.context.fillText(T,p,n);let b="";for(let w=v+1;w<g.length;++w)b+=g[w];x=this.context.measureText(b).width,p+=_-x+l,_=x}}updateTexture(){const t=this.canvas;if(this._style.trim){const c=f.P6.trimCanvas(t);c.data&&(t.width=c.width,t.height=c.height,this.context.putImageData(c.data,0,0))}const r=this._texture,n=this._style,o=n.trim?0:n.padding,l=r.baseTexture;r.trim.width=r._frame.width=t.width/this._resolution,r.trim.height=r._frame.height=t.height/this._resolution,r.trim.x=-o,r.trim.y=-o,r.orig.width=r._frame.width-o*2,r.orig.height=r._frame.height-o*2,this._onTextureUpdate(),l.setRealSize(t.width,t.height,this._resolution),r.updateUvs(),this.dirty=!1}_render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),super._render(t)}updateTransform(){this.updateText(!0),super.updateTransform()}getBounds(t,r){return this.updateText(!0),this._textureID===-1&&(t=!1),super.getBounds(t,r)}getLocalBounds(t){return this.updateText(!0),super.getLocalBounds.call(this,t)}_calculateBounds(){this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_generateFillStyle(t,r,n){const o=t.fill;if(Array.isArray(o)){if(o.length===1)return o[0]}else return o;let l;const c=t.dropShadow?t.dropShadowDistance:0,p=t.padding||0,g=this.canvas.width/this._resolution-c-p*2,_=this.canvas.height/this._resolution-c-p*2,x=o.slice(),v=t.fillGradientStops.slice();if(!v.length){const T=x.length+1;for(let b=1;b<T;++b)v.push(b/T)}if(x.unshift(o[0]),v.unshift(0),x.push(o[o.length-1]),v.push(1),t.fillGradientType===Pi.LINEAR_VERTICAL){l=this.context.createLinearGradient(g/2,p,g/2,_+p);const T=n.fontProperties.fontSize+t.strokeThickness;for(let b=0;b<r.length;b++){const w=n.lineHeight*(b-1)+T,R=n.lineHeight*b;let k=R;b>0&&w>R&&(k=(R+w)/2);const L=R+T,nt=n.lineHeight*(b+1);let $=L;b+1<r.length&&nt<L&&($=(L+nt)/2);const tt=($-k)/_;for(let St=0;St<x.length;St++){let Wt=0;typeof v[St]=="number"?Wt=v[St]:Wt=St/x.length;let Ct=Math.min(1,Math.max(0,k/_+Wt*tt));Ct=Number(Ct.toFixed(5)),l.addColorStop(Ct,x[St])}}}else{l=this.context.createLinearGradient(p,_/2,g+p,_/2);const T=x.length+1;let b=1;for(let w=0;w<x.length;w++){let R;typeof v[w]=="number"?R=v[w]:R=b/T,l.addColorStop(R,x[w]),b++}}return l}destroy(t){typeof t=="boolean"&&(t={children:t}),t=Object.assign({},Mi,t),super.destroy(t),this._ownCanvas&&(this.canvas.height=this.canvas.width=0),this.context=null,this.canvas=null,this._style=null}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width}set width(t){this.updateText(!0);const r=f.P6.sign(this.scale.x)||1;this.scale.x=r*t/this._texture.orig.width,this._width=t}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height}set height(t){this.updateText(!0);const r=f.P6.sign(this.scale.y)||1;this.scale.y=r*t/this._texture.orig.height,this._height=t}get style(){return this._style}set style(t){t=t||{},t instanceof pr?this._style=t:this._style=new pr(t),this.localStyleID=-1,this.dirty=!0}get text(){return this._text}set text(t){t=String(t!=null?t:""),this._text!==t&&(this._text=t,this.dirty=!0)}get resolution(){return this._resolution}set resolution(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)}};gs.defaultAutoResolution=!0;let _s=gs;class Bi{constructor(t){this.maxItemsPerFrame=t,this.itemsLeft=0}beginFrame(){this.itemsLeft=this.maxItemsPerFrame}allowedToUpload(){return this.itemsLeft-- >0}}function ys(d,t){var n;let r=!1;if((n=d==null?void 0:d._textures)!=null&&n.length){for(let o=0;o<d._textures.length;o++)if(d._textures[o]instanceof f.xE){const l=d._textures[o].baseTexture;t.includes(l)||(t.push(l),r=!0)}}return r}function Qs(d,t){if(d.baseTexture instanceof f.VL){const r=d.baseTexture;return t.includes(r)||t.push(r),!0}return!1}function mr(d,t){if(d._texture&&d._texture instanceof f.xE){const r=d._texture.baseTexture;return t.includes(r)||t.push(r),!0}return!1}function Js(d,t){return t instanceof _s?(t.updateText(!0),!0):!1}function xs(d,t){if(t instanceof pr){const r=t.toFontString();return dr.measureFont(r),!0}return!1}function tn(d,t){if(d instanceof _s){t.includes(d.style)||t.push(d.style),t.includes(d)||t.push(d);const r=d._texture.baseTexture;return t.includes(r)||t.push(r),!0}return!1}function Fi(d,t){return d instanceof pr?(t.includes(d)||t.push(d),!0):!1}const ne=class Ea{constructor(t){this.limiter=new Bi(Ea.uploadsPerFrame),this.renderer=t,this.uploadHookHelper=null,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.delayedTick=()=>{this.queue&&this.prepareItems()},this.registerFindHook(tn),this.registerFindHook(Fi),this.registerFindHook(ys),this.registerFindHook(Qs),this.registerFindHook(mr),this.registerUploadHook(Js),this.registerUploadHook(xs)}upload(t){return new Promise(r=>{t&&this.add(t),this.queue.length?(this.completes.push(r),this.ticking||(this.ticking=!0,f.vB.system.addOnce(this.tick,this,f.uF.UTILITY))):r()})}tick(){setTimeout(this.delayedTick,0)}prepareItems(){for(this.limiter.beginFrame();this.queue.length&&this.limiter.allowedToUpload();){const t=this.queue[0];let r=!1;if(t&&!t._destroyed){for(let n=0,o=this.uploadHooks.length;n<o;n++)if(this.uploadHooks[n](this.uploadHookHelper,t)){this.queue.shift(),r=!0;break}}r||this.queue.shift()}if(this.queue.length)f.vB.system.addOnce(this.tick,this,f.uF.UTILITY);else{this.ticking=!1;const t=this.completes.slice(0);this.completes.length=0;for(let r=0,n=t.length;r<n;r++)t[r]()}}registerFindHook(t){return t&&this.addHooks.push(t),this}registerUploadHook(t){return t&&this.uploadHooks.push(t),this}add(t){for(let r=0,n=this.addHooks.length;r<n&&!this.addHooks[r](t,this.queue);r++);if(t instanceof J)for(let r=t.children.length-1;r>=0;r--)this.add(t.children[r]);return this}destroy(){this.ticking&&f.vB.system.remove(this.tick,this),this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null,this.limiter=null,this.uploadHookHelper=null}};ne.uploadsPerFrame=4;let Rr=ne;Object.defineProperties(f.Xd,{UPLOADS_PER_FRAME:{get(){return Rr.uploadsPerFrame},set(d){f.P6.deprecation("7.1.0","settings.UPLOADS_PER_FRAME is deprecated, use prepare.BasePrepare.uploadsPerFrame"),Rr.uploadsPerFrame=d}}});function vs(d,t){return t instanceof f.VL?(t._glTextures[d.CONTEXT_UID]||d.texture.bind(t),!0):!1}function Yn(d,t){if(!(t instanceof ds))return!1;const{geometry:r}=t;t.finishPoly(),r.updateBatches();const{batches:n}=r;for(let o=0;o<n.length;o++){const{texture:l}=n[o].style;l&&vs(d,l.baseTexture)}return r.batchable||d.geometry.bind(r,t._resolveDirectShader(d)),!0}function en(d,t){return d instanceof ds?(t.push(d),!0):!1}class rn extends Rr{constructor(t){super(t),this.uploadHookHelper=this.renderer,this.registerFindHook(en),this.registerUploadHook(vs),this.registerUploadHook(Yn)}}rn.extension={name:"prepare",type:f.nw.RendererSystem},f.Rw.add(rn);class zr extends null{constructor(t,r=!0){super(t[0]instanceof Texture?t[0]:t[0].texture),this._textures=null,this._durations=null,this._autoUpdate=r,this._isConnectedToTicker=!1,this.animationSpeed=1,this.loop=!0,this.updateAnchor=!1,this.onComplete=null,this.onFrameChange=null,this.onLoop=null,this._currentTime=0,this._playing=!1,this._previousFrame=null,this.textures=t}stop(){this._playing&&(this._playing=!1,this._autoUpdate&&this._isConnectedToTicker&&(Ticker.shared.remove(this.update,this),this._isConnectedToTicker=!1))}play(){this._playing||(this._playing=!0,this._autoUpdate&&!this._isConnectedToTicker&&(Ticker.shared.add(this.update,this,UPDATE_PRIORITY.HIGH),this._isConnectedToTicker=!0))}gotoAndStop(t){this.stop(),this.currentFrame=t}gotoAndPlay(t){this.currentFrame=t,this.play()}update(t){if(!this._playing)return;const r=this.animationSpeed*t,n=this.currentFrame;if(this._durations!==null){let o=this._currentTime%1*this._durations[this.currentFrame];for(o+=r/60*1e3;o<0;)this._currentTime--,o+=this._durations[this.currentFrame];const l=Math.sign(this.animationSpeed*t);for(this._currentTime=Math.floor(this._currentTime);o>=this._durations[this.currentFrame];)o-=this._durations[this.currentFrame]*l,this._currentTime+=l;this._currentTime+=o/this._durations[this.currentFrame]}else this._currentTime+=r;this._currentTime<0&&!this.loop?(this.gotoAndStop(0),this.onComplete&&this.onComplete()):this._currentTime>=this._textures.length&&!this.loop?(this.gotoAndStop(this._textures.length-1),this.onComplete&&this.onComplete()):n!==this.currentFrame&&(this.loop&&this.onLoop&&(this.animationSpeed>0&&this.currentFrame<n||this.animationSpeed<0&&this.currentFrame>n)&&this.onLoop(),this.updateTexture())}updateTexture(){const t=this.currentFrame;this._previousFrame!==t&&(this._previousFrame=t,this._texture=this._textures[t],this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this.uvs=this._texture._uvs.uvsFloat32,this.updateAnchor&&this._anchor.copyFrom(this._texture.defaultAnchor),this.onFrameChange&&this.onFrameChange(this.currentFrame))}destroy(t){this.stop(),super.destroy(t),this.onComplete=null,this.onFrameChange=null,this.onLoop=null}static fromFrames(t){const r=[];for(let n=0;n<t.length;++n)r.push(Texture.from(t[n]));return new zr(r)}static fromImages(t){const r=[];for(let n=0;n<t.length;++n)r.push(Texture.from(t[n]));return new zr(r)}get totalFrames(){return this._textures.length}get textures(){return this._textures}set textures(t){if(t[0]instanceof Texture)this._textures=t,this._durations=null;else{this._textures=[],this._durations=[];for(let r=0;r<t.length;r++)this._textures.push(t[r].texture),this._durations.push(t[r].time)}this._previousFrame=null,this.gotoAndStop(0),this.updateTexture()}get currentFrame(){let t=Math.floor(this._currentTime)%this._textures.length;return t<0&&(t+=this._textures.length),t}set currentFrame(t){if(t<0||t>this.totalFrames-1)throw new Error(`[AnimatedSprite]: Invalid frame index value ${t}, expected to be between 0 and totalFrames ${this.totalFrames}.`);const r=this.currentFrame;this._currentTime=t,r!==this.currentFrame&&this.updateTexture()}get playing(){return this._playing}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){t!==this._autoUpdate&&(this._autoUpdate=t,!this._autoUpdate&&this._isConnectedToTicker?(Ticker.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._playing&&(Ticker.shared.add(this.update,this),this._isConnectedToTicker=!0))}}const Pr=new f.E9;class bs extends null{constructor(t,r=100,n=100){super(t),this.tileTransform=new Transform,this._width=r,this._height=n,this.uvMatrix=this.texture.uvMatrix||new TextureMatrix(t),this.pluginName="tilingSprite",this.uvRespectAnchor=!1}get clampMargin(){return this.uvMatrix.clampMargin}set clampMargin(t){this.uvMatrix.clampMargin=t,this.uvMatrix.update(!0)}get tileScale(){return this.tileTransform.scale}set tileScale(t){this.tileTransform.scale.copyFrom(t)}get tilePosition(){return this.tileTransform.position}set tilePosition(t){this.tileTransform.position.copyFrom(t)}_onTextureUpdate(){this.uvMatrix&&(this.uvMatrix.texture=this._texture),this._cachedTint=16777215}_render(t){const r=this._texture;!r||!r.valid||(this.tileTransform.updateLocalTransform(),this.uvMatrix.update(),t.batch.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this))}_calculateBounds(){const t=this._width*-this._anchor._x,r=this._height*-this._anchor._y,n=this._width*(1-this._anchor._x),o=this._height*(1-this._anchor._y);this._bounds.addFrame(this.transform,t,r,n,o)}getLocalBounds(t){return this.children.length===0?(this._bounds.minX=this._width*-this._anchor._x,this._bounds.minY=this._height*-this._anchor._y,this._bounds.maxX=this._width*(1-this._anchor._x),this._bounds.maxY=this._height*(1-this._anchor._y),t||(this._localBoundsRect||(this._localBoundsRect=new Rectangle),t=this._localBoundsRect),this._bounds.getRectangle(t)):super.getLocalBounds.call(this,t)}containsPoint(t){this.worldTransform.applyInverse(t,Pr);const r=this._width,n=this._height,o=-r*this.anchor._x;if(Pr.x>=o&&Pr.x<o+r){const l=-n*this.anchor._y;if(Pr.y>=l&&Pr.y<l+n)return!0}return!1}destroy(t){super.destroy(t),this.tileTransform=null,this.uvMatrix=null}static from(t,r){const n=t instanceof Texture?t:Texture.from(t,r);return new bs(n,r.width,r.height)}get width(){return this._width}set width(t){this._width=t}get height(){return this._height}set height(t){this._height=t}}var Kn=`#version 300 es
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

in vec2 vTextureCoord;

out vec4 fragmentColor;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    vec4 texSample = texture(uSampler, coord, unclamped == coord ? 0.0f : -32.0f);// lod-bias very negative to force lod 0

    fragmentColor = texSample * uColor;
}
`,qn=`#version 300 es
#define SHADER_NAME Tiling-Sprite-300

precision lowp float;

in vec2 aVertexPosition;
in vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

out vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`,sn=`#version 100
#ifdef GL_EXT_shader_texture_lod
    #extension GL_EXT_shader_texture_lod : enable
#endif
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    #ifdef GL_EXT_shader_texture_lod
        vec4 texSample = unclamped == coord
            ? texture2D(uSampler, coord) 
            : texture2DLodEXT(uSampler, coord, 0);
    #else
        vec4 texSample = texture2D(uSampler, coord);
    #endif

    gl_FragColor = texSample * uColor;
}
`,Di=`#version 100
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`,nn=`#version 100
#define SHADER_NAME Tiling-Sprite-Simple-100

precision lowp float;

varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;

void main(void)
{
    vec4 texSample = texture2D(uSampler, vTextureCoord);
    gl_FragColor = texSample * uColor;
}
`;const hi=new f.y3;class Ts extends f.bO{constructor(t){super(t),t.runners.contextChange.add(this),this.quad=new f.ud,this.state=f.ZM.for2d()}contextChange(){const t=this.renderer,r={globals:t.globalUniforms};this.simpleShader=f.ex.from(Di,nn,r),this.shader=t.context.webGLVersion>1?f.ex.from(qn,Kn,r):f.ex.from(Di,sn,r)}render(t){const r=this.renderer,n=this.quad;let o=n.vertices;o[0]=o[6]=t._width*-t.anchor.x,o[1]=o[3]=t._height*-t.anchor.y,o[2]=o[4]=t._width*(1-t.anchor.x),o[5]=o[7]=t._height*(1-t.anchor.y);const l=t.uvRespectAnchor?t.anchor.x:0,c=t.uvRespectAnchor?t.anchor.y:0;o=n.uvs,o[0]=o[6]=-l,o[1]=o[3]=-c,o[2]=o[4]=1-l,o[5]=o[7]=1-c,n.invalidate();const p=t._texture,g=p.baseTexture,_=g.alphaMode>0,x=t.tileTransform.localTransform,v=t.uvMatrix;let T=g.isPowerOfTwo&&p.frame.width===g.width&&p.frame.height===g.height;T&&(g._glTextures[r.CONTEXT_UID]?T=g.wrapMode!==f.Nt.CLAMP:g.wrapMode===f.Nt.CLAMP&&(g.wrapMode=f.Nt.REPEAT));const b=T?this.simpleShader:this.shader,w=p.width,R=p.height,k=t._width,L=t._height;hi.set(x.a*w/k,x.b*w/L,x.c*R/k,x.d*R/L,x.tx/k,x.ty/L),hi.invert(),T?hi.prepend(v.mapCoord):(b.uniforms.uMapCoord=v.mapCoord.toArray(!0),b.uniforms.uClampFrame=v.uClampFrame,b.uniforms.uClampOffset=v.uClampOffset),b.uniforms.uTransform=hi.toArray(!0),b.uniforms.uColor=f.Il.shared.setValue(t.tint).premultiply(t.worldAlpha,_).toArray(b.uniforms.uColor),b.uniforms.translationMatrix=t.transform.worldTransform.toArray(!0),b.uniforms.uSampler=p,r.shader.bind(b),r.geometry.bind(n),this.state.blendMode=f.P6.correctBlendMode(t.blendMode,_),r.state.set(this.state),r.geometry.draw(this.renderer.gl.TRIANGLES,6,0)}}Ts.extension={name:"tilingSprite",type:f.nw.RendererPlugin},f.Rw.add(Ts);const an=class Ds{constructor(t,r,n=null){this.linkedSheets=[],this._texture=t instanceof f.xE?t:null,this.baseTexture=t instanceof f.VL?t:this._texture.baseTexture,this.textures={},this.animations={},this.data=r;const o=this.baseTexture.resource;this.resolution=this._updateResolution(n||(o?o.url:null)),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}_updateResolution(t=null){const{scale:r}=this.data.meta;let n=f.P6.getResolutionOfUrl(t,null);return n===null&&(n=parseFloat(r!=null?r:"1")),n!==1&&this.baseTexture.setResolution(n),n}parse(){return new Promise(t=>{this._callback=t,this._batchIndex=0,this._frameKeys.length<=Ds.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()})}_processFrames(t){let r=t;const n=Ds.BATCH_SIZE;for(;r-t<n&&r<this._frameKeys.length;){const o=this._frameKeys[r],l=this._frames[o],c=l.frame;if(c){let p=null,g=null;const _=l.trimmed!==!1&&l.sourceSize?l.sourceSize:l.frame,x=new f.Ae(0,0,Math.floor(_.w)/this.resolution,Math.floor(_.h)/this.resolution);l.rotated?p=new f.Ae(Math.floor(c.x)/this.resolution,Math.floor(c.y)/this.resolution,Math.floor(c.h)/this.resolution,Math.floor(c.w)/this.resolution):p=new f.Ae(Math.floor(c.x)/this.resolution,Math.floor(c.y)/this.resolution,Math.floor(c.w)/this.resolution,Math.floor(c.h)/this.resolution),l.trimmed!==!1&&l.spriteSourceSize&&(g=new f.Ae(Math.floor(l.spriteSourceSize.x)/this.resolution,Math.floor(l.spriteSourceSize.y)/this.resolution,Math.floor(c.w)/this.resolution,Math.floor(c.h)/this.resolution)),this.textures[o]=new f.xE(this.baseTexture,p,x,g,l.rotated?2:0,l.anchor,l.borders),f.xE.addToCache(this.textures[o],o.toString())}r++}}_processAnimations(){const t=this.data.animations||{};for(const r in t){this.animations[r]=[];for(let n=0;n<t[r].length;n++){const o=t[r][n];this.animations[r].push(this.textures[o])}}}_parseComplete(){const t=this._callback;this._callback=null,this._batchIndex=0,t.call(this,this.textures)}_nextBatch(){this._processFrames(this._batchIndex*Ds.BATCH_SIZE),this._batchIndex++,setTimeout(()=>{this._batchIndex*Ds.BATCH_SIZE<this._frameKeys.length?this._nextBatch():(this._processAnimations(),this._parseComplete())},0)}destroy(t=!1){var r;for(const n in this.textures)this.textures[n].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,t&&((r=this._texture)==null||r.destroy(),this.baseTexture.destroy()),this._texture=null,this.baseTexture=null,this.linkedSheets=[]}};an.BATCH_SIZE=1e3;let on=an;const Zn=["jpg","png","jpeg","avif","webp"];function hn(d,t,r){const n={};if(d.forEach(o=>{n[o]=t}),Object.keys(t.textures).forEach(o=>{n[o]=t.textures[o]}),!r){const o=f.P6.path.dirname(d[0]);t.linkedSheets.forEach((l,c)=>{const p=hn([`${o}/${t.data.meta.related_multi_packs[c]}`],l,!0);Object.assign(n,p)})}return n}const ln={extension:f.nw.Asset,cache:{test:d=>d instanceof on,getCacheableAssets:(d,t)=>hn(d,t,!1)},resolver:{test:d=>{const t=d.split("?")[0].split("."),r=t.pop(),n=t.pop();return r==="json"&&Zn.includes(n)},parse:d=>{var r,n;const t=d.split(".");return{resolution:parseFloat((n=(r=f.Xd.RETINA_PREFIX.exec(d))==null?void 0:r[1])!=null?n:"1"),format:t[t.length-2],src:d}}},loader:{name:"spritesheetLoader",extension:{type:f.nw.LoadParser,priority:ce.Normal},testParse(d,t){return Pt(this,null,function*(){return f.P6.path.extname(t.src).toLowerCase()===".json"&&!!d.frames})},parse(d,t,r){return Pt(this,null,function*(){var g,_;let n=f.P6.path.dirname(t.src);n&&n.lastIndexOf("/")!==n.length-1&&(n+="/");let o=n+d.meta.image;o=or(o,t.src);const l=(yield r.load([o]))[o],c=new on(l.baseTexture,d,t.src);yield c.parse();const p=(g=d==null?void 0:d.meta)==null?void 0:g.related_multi_packs;if(Array.isArray(p)){const x=[];for(const T of p){if(typeof T!="string")continue;let b=n+T;(_=t.data)!=null&&_.ignoreMultiPack||(b=or(b,t.src),x.push(r.load({src:b,data:{ignoreMultiPack:!0}})))}const v=yield Promise.all(x);c.linkedSheets=v,v.forEach(T=>{T.linkedSheets=[c].concat(c.linkedSheets.filter(b=>b!==T))})}return c})},unload(d){d.destroy(!0)}}};f.Rw.add(ln);class li{constructor(){this.info=[],this.common=[],this.page=[],this.char=[],this.kerning=[],this.distanceField=[]}}class ui{static test(t){return typeof t=="string"&&t.startsWith("info face=")}static parse(t){const r=t.match(/^[a-z]+\s+.+$/gm),n={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(const l in r){const c=r[l].match(/^[a-z]+/gm)[0],p=r[l].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),g={};for(const _ in p){const x=p[_].split("="),v=x[0],T=x[1].replace(/"/gm,""),b=parseFloat(T),w=isNaN(b)?T:b;g[v]=w}n[c].push(g)}const o=new li;return n.info.forEach(l=>o.info.push({face:l.face,size:parseInt(l.size,10)})),n.common.forEach(l=>o.common.push({lineHeight:parseInt(l.lineHeight,10)})),n.page.forEach(l=>o.page.push({id:parseInt(l.id,10),file:l.file})),n.char.forEach(l=>o.char.push({id:parseInt(l.id,10),page:parseInt(l.page,10),x:parseInt(l.x,10),y:parseInt(l.y,10),width:parseInt(l.width,10),height:parseInt(l.height,10),xoffset:parseInt(l.xoffset,10),yoffset:parseInt(l.yoffset,10),xadvance:parseInt(l.xadvance,10)})),n.kerning.forEach(l=>o.kerning.push({first:parseInt(l.first,10),second:parseInt(l.second,10),amount:parseInt(l.amount,10)})),n.distanceField.forEach(l=>o.distanceField.push({distanceRange:parseInt(l.distanceRange,10),fieldType:l.fieldType})),o}}class Oi{static test(t){const r=t;return typeof t!="string"&&"getElementsByTagName"in t&&r.getElementsByTagName("page").length&&r.getElementsByTagName("info")[0].getAttribute("face")!==null}static parse(t){const r=new li,n=t.getElementsByTagName("info"),o=t.getElementsByTagName("common"),l=t.getElementsByTagName("page"),c=t.getElementsByTagName("char"),p=t.getElementsByTagName("kerning"),g=t.getElementsByTagName("distanceField");for(let _=0;_<n.length;_++)r.info.push({face:n[_].getAttribute("face"),size:parseInt(n[_].getAttribute("size"),10)});for(let _=0;_<o.length;_++)r.common.push({lineHeight:parseInt(o[_].getAttribute("lineHeight"),10)});for(let _=0;_<l.length;_++)r.page.push({id:parseInt(l[_].getAttribute("id"),10)||0,file:l[_].getAttribute("file")});for(let _=0;_<c.length;_++){const x=c[_];r.char.push({id:parseInt(x.getAttribute("id"),10),page:parseInt(x.getAttribute("page"),10)||0,x:parseInt(x.getAttribute("x"),10),y:parseInt(x.getAttribute("y"),10),width:parseInt(x.getAttribute("width"),10),height:parseInt(x.getAttribute("height"),10),xoffset:parseInt(x.getAttribute("xoffset"),10),yoffset:parseInt(x.getAttribute("yoffset"),10),xadvance:parseInt(x.getAttribute("xadvance"),10)})}for(let _=0;_<p.length;_++)r.kerning.push({first:parseInt(p[_].getAttribute("first"),10),second:parseInt(p[_].getAttribute("second"),10),amount:parseInt(p[_].getAttribute("amount"),10)});for(let _=0;_<g.length;_++)r.distanceField.push({fieldType:g[_].getAttribute("fieldType"),distanceRange:parseInt(g[_].getAttribute("distanceRange"),10)});return r}}class Li{static test(t){return typeof t=="string"&&t.includes("<font>")?Oi.test(f.Xd.ADAPTER.parseXML(t)):!1}static parse(t){return Oi.parse(f.Xd.ADAPTER.parseXML(t))}}const Es=[ui,Oi,Li];function un(d){for(let t=0;t<Es.length;t++)if(Es[t].test(d))return Es[t];return null}function cn(d,t,r,n,o,l){const c=r.fill;if(Array.isArray(c)){if(c.length===1)return c[0]}else return c;let p;const g=r.dropShadow?r.dropShadowDistance:0,_=r.padding||0,x=d.width/n-g-_*2,v=d.height/n-g-_*2,T=c.slice(),b=r.fillGradientStops.slice();if(!b.length){const w=T.length+1;for(let R=1;R<w;++R)b.push(R/w)}if(T.unshift(c[0]),b.unshift(0),T.push(c[c.length-1]),b.push(1),r.fillGradientType===Pi.LINEAR_VERTICAL){p=t.createLinearGradient(x/2,_,x/2,v+_);let w=0;const R=(l.fontProperties.fontSize+r.strokeThickness)/v;for(let k=0;k<o.length;k++){const L=l.lineHeight*k;for(let nt=0;nt<T.length;nt++){let $=0;typeof b[nt]=="number"?$=b[nt]:$=nt/T.length;const tt=L/v+$*R;let St=Math.max(w,tt);St=Math.min(St,1),p.addColorStop(St,T[nt]),w=St}}}else{p=t.createLinearGradient(_,v/2,x+_,v/2);const w=T.length+1;let R=1;for(let k=0;k<T.length;k++){let L;typeof b[k]=="number"?L=b[k]:L=R/w,p.addColorStop(L,T[k]),R++}}return p}function dn(d,t,r,n,o,l,c){const p=r.text,g=r.fontProperties;t.translate(n,o),t.scale(l,l);const _=c.strokeThickness/2,x=-(c.strokeThickness/2);if(t.font=c.toFontString(),t.lineWidth=c.strokeThickness,t.textBaseline=c.textBaseline,t.lineJoin=c.lineJoin,t.miterLimit=c.miterLimit,t.fillStyle=cn(d,t,c,l,[p],r),t.strokeStyle=c.stroke,c.dropShadow){const v=c.dropShadowColor,T=c.dropShadowBlur*l,b=c.dropShadowDistance*l;t.shadowColor=f.Il.shared.setValue(v).setAlpha(c.dropShadowAlpha).toRgbaString(),t.shadowBlur=T,t.shadowOffsetX=Math.cos(c.dropShadowAngle)*b,t.shadowOffsetY=Math.sin(c.dropShadowAngle)*b}else t.shadowColor="black",t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0;c.stroke&&c.strokeThickness&&t.strokeText(p,_,x+r.lineHeight-g.descent),c.fill&&t.fillText(p,_,x+r.lineHeight-g.descent),t.setTransform(1,0,0,1,0,0),t.fillStyle="rgba(0, 0, 0, 0)"}function fn(d){return Array.from?Array.from(d):d.split("")}function pn(d){typeof d=="string"&&(d=[d]);const t=[];for(let r=0,n=d.length;r<n;r++){const o=d[r];if(Array.isArray(o)){if(o.length!==2)throw new Error(`[BitmapFont]: Invalid character range length, expecting 2 got ${o.length}.`);const l=o[0].charCodeAt(0),c=o[1].charCodeAt(0);if(c<l)throw new Error("[BitmapFont]: Invalid character range.");for(let p=l,g=c;p<=g;p++)t.push(String.fromCharCode(p))}else t.push(...fn(o))}if(t.length===0)throw new Error("[BitmapFont]: Empty set when resolving characters.");return t}function ci(d){return d.codePointAt?d.codePointAt(0):d.charCodeAt(0)}const Fe=class _r{constructor(t,r,n){var x,v;const[o]=t.info,[l]=t.common,[c]=t.page,[p]=t.distanceField,g=f.P6.getResolutionOfUrl(c.file),_={};this._ownsTextures=n,this.font=o.face,this.size=o.size,this.lineHeight=l.lineHeight/g,this.chars={},this.pageTextures=_;for(let T=0;T<t.page.length;T++){const{id:b,file:w}=t.page[T];_[b]=r instanceof Array?r[T]:r[w],p!=null&&p.fieldType&&p.fieldType!=="none"&&(_[b].baseTexture.alphaMode=f.iw.NO_PREMULTIPLIED_ALPHA,_[b].baseTexture.mipmap=f.KI.OFF)}for(let T=0;T<t.char.length;T++){const{id:b,page:w}=t.char[T];let{x:R,y:k,width:L,height:nt,xoffset:$,yoffset:tt,xadvance:St}=t.char[T];R/=g,k/=g,L/=g,nt/=g,$/=g,tt/=g,St/=g;const Wt=new f.Ae(R+_[w].frame.x/g,k+_[w].frame.y/g,L,nt);this.chars[b]={xOffset:$,yOffset:tt,xAdvance:St,kerning:{},texture:new f.xE(_[w].baseTexture,Wt),page:w}}for(let T=0;T<t.kerning.length;T++){let{first:b,second:w,amount:R}=t.kerning[T];b/=g,w/=g,R/=g,this.chars[w]&&(this.chars[w].kerning[b]=R)}this.distanceFieldRange=p==null?void 0:p.distanceRange,this.distanceFieldType=(v=(x=p==null?void 0:p.fieldType)==null?void 0:x.toLowerCase())!=null?v:"none"}destroy(){for(const t in this.chars)this.chars[t].texture.destroy(),this.chars[t].texture=null;for(const t in this.pageTextures)this._ownsTextures&&this.pageTextures[t].destroy(!0),this.pageTextures[t]=null;this.chars=null,this.pageTextures=null}static install(t,r,n){let o;if(t instanceof li)o=t;else{const c=un(t);if(!c)throw new Error("Unrecognized data format for font.");o=c.parse(t)}r instanceof f.xE&&(r=[r]);const l=new _r(o,r,n);return _r.available[l.font]=l,l}static uninstall(t){const r=_r.available[t];if(!r)throw new Error(`No font found named '${t}'`);r.destroy(),delete _r.available[t]}static from(t,r,n){if(!t)throw new Error("[BitmapFont] Property `name` is required.");const Ct=Object.assign({},_r.defaultOptions,n),{chars:o,padding:l,resolution:c,textureWidth:p,textureHeight:g}=Ct,_=ta(Ct,["chars","padding","resolution","textureWidth","textureHeight"]),x=pn(o),v=r instanceof pr?r:new pr(r),T=p,b=new li;b.info[0]={face:v.fontFamily,size:v.fontSize},b.common[0]={lineHeight:v.fontSize};let w=0,R=0,k,L,nt,$=0;const tt=[],St=[];for(let It=0;It<x.length;It++){k||(k=f.Xd.ADAPTER.createCanvas(),k.width=p,k.height=g,L=k.getContext("2d"),nt=new f.VL(k,fe({resolution:c},_)),tt.push(nt),St.push(new f.xE(nt)),b.page.push({id:St.length-1,file:""}));const Xt=x[It],zt=dr.measureText(Xt,v,!1,k),he=zt.width,Bt=Math.ceil(zt.height),et=Math.ceil((v.fontStyle==="italic"?2:1)*he);if(R>=g-Bt*c){if(R===0)throw new Error(`[BitmapFont] textureHeight ${g}px is too small (fontFamily: '${v.fontFamily}', fontSize: ${v.fontSize}px, char: '${Xt}')`);--It,k=null,L=null,nt=null,R=0,w=0,$=0;continue}if($=Math.max(Bt+zt.fontProperties.descent,$),et*c+w>=T){if(w===0)throw new Error(`[BitmapFont] textureWidth ${p}px is too small (fontFamily: '${v.fontFamily}', fontSize: ${v.fontSize}px, char: '${Xt}')`);--It,R+=$*c,R=Math.ceil(R),w=0,$=0;continue}dn(k,L,zt,w,R,c,v);const At=ci(zt.text);b.char.push({id:At,page:St.length-1,x:w/c,y:R/c,width:et,height:Bt,xoffset:0,yoffset:0,xadvance:he-(v.dropShadow?v.dropShadowDistance:0)-(v.stroke?v.strokeThickness:0)}),w+=(et+2*l)*c,w=Math.ceil(w)}if(!(n!=null&&n.skipKerning))for(let It=0,Xt=x.length;It<Xt;It++){const zt=x[It];for(let he=0;he<Xt;he++){const Bt=x[he],et=L.measureText(zt).width,At=L.measureText(Bt).width,Vt=L.measureText(zt+Bt).width-(et+At);Vt&&b.kerning.push({first:ci(zt),second:ci(Bt),amount:Vt})}}const Wt=new _r(b,St,!0);return _r.available[t]!==void 0&&_r.uninstall(t),_r.available[t]=Wt,Wt}};Fe.ALPHA=[["a","z"],["A","Z"]," "],Fe.NUMERIC=[["0","9"]],Fe.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "],Fe.ASCII=[[" ","~"]],Fe.defaultOptions={resolution:1,textureWidth:512,textureHeight:512,padding:4,chars:Fe.ALPHANUMERIC},Fe.available={};let Oe=Fe;var mn=`// Pixi texture info\r
varying vec2 vTextureCoord;\r
uniform sampler2D uSampler;\r
\r
// Tint\r
uniform vec4 uColor;\r
\r
// on 2D applications fwidth is screenScale / glyphAtlasScale * distanceFieldRange\r
uniform float uFWidth;\r
\r
void main(void) {\r
\r
  // To stack MSDF and SDF we need a non-pre-multiplied-alpha texture.\r
  vec4 texColor = texture2D(uSampler, vTextureCoord);\r
\r
  // MSDF\r
  float median = texColor.r + texColor.g + texColor.b -\r
                  min(texColor.r, min(texColor.g, texColor.b)) -\r
                  max(texColor.r, max(texColor.g, texColor.b));\r
  // SDF\r
  median = min(median, texColor.a);\r
\r
  float screenPxDistance = uFWidth * (median - 0.5);\r
  float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);\r
  if (median < 0.01) {\r
    alpha = 0.0;\r
  } else if (median > 0.99) {\r
    alpha = 1.0;\r
  }\r
\r
  // Gamma correction for coverage-like alpha\r
  float luma = dot(uColor.rgb, vec3(0.299, 0.587, 0.114));\r
  float gamma = mix(1.0, 1.0 / 2.2, luma);\r
  float coverage = pow(uColor.a * alpha, gamma);  \r
\r
  // NPM Textures, NPM outputs\r
  gl_FragColor = vec4(uColor.rgb, coverage);\r
}\r
`,ca=`// Mesh material default fragment\r
attribute vec2 aVertexPosition;\r
attribute vec2 aTextureCoord;\r
\r
uniform mat3 projectionMatrix;\r
uniform mat3 translationMatrix;\r
uniform mat3 uTextureMatrix;\r
\r
varying vec2 vTextureCoord;\r
\r
void main(void)\r
{\r
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\r
\r
    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\r
}\r
`;const gn=[],As=[],Ni=[],_n=class Aa extends J{constructor(t,r={}){super();const{align:n,tint:o,maxWidth:l,letterSpacing:c,fontName:p,fontSize:g}=Object.assign({},Aa.styleDefaults,r);if(!Oe.available[p])throw new Error(`Missing BitmapFont "${p}"`);this._activePagesMeshData=[],this._textWidth=0,this._textHeight=0,this._align=n,this._tintColor=new f.Il(o),this._font=void 0,this._fontName=p,this._fontSize=g,this.text=t,this._maxWidth=l,this._maxLineHeight=0,this._letterSpacing=c,this._anchor=new f.AB(()=>{this.dirty=!0},this,0,0),this._roundPixels=f.Xd.ROUND_PIXELS,this.dirty=!0,this._resolution=f.Xd.RESOLUTION,this._autoResolution=!0,this._textureCache={}}updateText(){var he;const t=Oe.available[this._fontName],r=this.fontSize,n=r/t.size,o=new f.E9,l=[],c=[],p=[],g=this._text.replace(/(?:\r\n|\r)/g,`
`)||" ",_=fn(g),x=this._maxWidth*t.size/r,v=t.distanceFieldType==="none"?gn:As;let T=null,b=0,w=0,R=0,k=-1,L=0,nt=0,$=0,tt=0;for(let Bt=0;Bt<_.length;Bt++){const et=_[Bt],At=ci(et);if(/(?:\s)/.test(et)&&(k=Bt,L=b,tt++),et==="\r"||et===`
`){c.push(b),p.push(-1),w=Math.max(w,b),++R,++nt,o.x=0,o.y+=t.lineHeight,T=null,tt=0;continue}const Vt=t.chars[At];if(!Vt)continue;T&&Vt.kerning[T]&&(o.x+=Vt.kerning[T]);const te=Ni.pop()||{texture:f.xE.EMPTY,line:0,charCode:0,prevSpaces:0,position:new f.E9};te.texture=Vt.texture,te.line=R,te.charCode=At,te.position.x=Math.round(o.x+Vt.xOffset+this._letterSpacing/2),te.position.y=Math.round(o.y+Vt.yOffset),te.prevSpaces=tt,l.push(te),b=te.position.x+Math.max(Vt.xAdvance-Vt.xOffset,Vt.texture.orig.width),o.x+=Vt.xAdvance+this._letterSpacing,$=Math.max($,Vt.yOffset+Vt.texture.height),T=At,k!==-1&&x>0&&o.x>x&&(++nt,f.P6.removeItems(l,1+k-nt,1+Bt-k),Bt=k,k=-1,c.push(L),p.push(l.length>0?l[l.length-1].prevSpaces:0),w=Math.max(w,L),R++,o.x=0,o.y+=t.lineHeight,T=null,tt=0)}const St=_[_.length-1];St!=="\r"&&St!==`
`&&(/(?:\s)/.test(St)&&(b=L),c.push(b),w=Math.max(w,b),p.push(-1));const Wt=[];for(let Bt=0;Bt<=R;Bt++){let et=0;this._align==="right"?et=w-c[Bt]:this._align==="center"?et=(w-c[Bt])/2:this._align==="justify"&&(et=p[Bt]<0?0:(w-c[Bt])/p[Bt]),Wt.push(et)}const Ct=l.length,It={},Xt=[],zt=this._activePagesMeshData;v.push(...zt);for(let Bt=0;Bt<Ct;Bt++){const et=l[Bt].texture,At=et.baseTexture.uid;if(!It[At]){let Vt=v.pop();if(!Vt){const kt=new Wn;let $t,be;t.distanceFieldType==="none"?($t=new fs(f.xE.EMPTY),be=f.T$.NORMAL):($t=new fs(f.xE.EMPTY,{program:f.$r.from(ca,mn),uniforms:{uFWidth:0}}),be=f.T$.NORMAL_NPM);const Te=new js(kt,$t);Te.blendMode=be,Vt={index:0,indexCount:0,vertexCount:0,uvsCount:0,total:0,mesh:Te,vertices:null,uvs:null,indices:null}}Vt.index=0,Vt.indexCount=0,Vt.vertexCount=0,Vt.uvsCount=0,Vt.total=0;const{_textureCache:te}=this;te[At]=te[At]||new f.xE(et.baseTexture),Vt.mesh.texture=te[At],Vt.mesh.tint=this._tintColor.value,Xt.push(Vt),It[At]=Vt}It[At].total++}for(let Bt=0;Bt<zt.length;Bt++)Xt.includes(zt[Bt])||this.removeChild(zt[Bt].mesh);for(let Bt=0;Bt<Xt.length;Bt++)Xt[Bt].mesh.parent!==this&&this.addChild(Xt[Bt].mesh);this._activePagesMeshData=Xt;for(const Bt in It){const et=It[Bt],At=et.total;if(!(((he=et.indices)==null?void 0:he.length)>6*At)||et.vertices.length<js.BATCHABLE_SIZE*2)et.vertices=new Float32Array(4*2*At),et.uvs=new Float32Array(4*2*At),et.indices=new Uint16Array(6*At);else{const Vt=et.total,te=et.vertices;for(let kt=Vt*4*2;kt<te.length;kt++)te[kt]=0}et.mesh.size=6*At}for(let Bt=0;Bt<Ct;Bt++){const et=l[Bt];let At=et.position.x+Wt[et.line]*(this._align==="justify"?et.prevSpaces:1);this._roundPixels&&(At=Math.round(At));const Vt=At*n,te=et.position.y*n,kt=et.texture,$t=It[kt.baseTexture.uid],be=kt.frame,Te=kt._uvs,Jt=$t.index++;$t.indices[Jt*6+0]=0+Jt*4,$t.indices[Jt*6+1]=1+Jt*4,$t.indices[Jt*6+2]=2+Jt*4,$t.indices[Jt*6+3]=0+Jt*4,$t.indices[Jt*6+4]=2+Jt*4,$t.indices[Jt*6+5]=3+Jt*4,$t.vertices[Jt*8+0]=Vt,$t.vertices[Jt*8+1]=te,$t.vertices[Jt*8+2]=Vt+be.width*n,$t.vertices[Jt*8+3]=te,$t.vertices[Jt*8+4]=Vt+be.width*n,$t.vertices[Jt*8+5]=te+be.height*n,$t.vertices[Jt*8+6]=Vt,$t.vertices[Jt*8+7]=te+be.height*n,$t.uvs[Jt*8+0]=Te.x0,$t.uvs[Jt*8+1]=Te.y0,$t.uvs[Jt*8+2]=Te.x1,$t.uvs[Jt*8+3]=Te.y1,$t.uvs[Jt*8+4]=Te.x2,$t.uvs[Jt*8+5]=Te.y2,$t.uvs[Jt*8+6]=Te.x3,$t.uvs[Jt*8+7]=Te.y3}this._textWidth=w*n,this._textHeight=(o.y+t.lineHeight)*n;for(const Bt in It){const et=It[Bt];if(this.anchor.x!==0||this.anchor.y!==0){let kt=0;const $t=this._textWidth*this.anchor.x,be=this._textHeight*this.anchor.y;for(let Te=0;Te<et.total;Te++)et.vertices[kt++]-=$t,et.vertices[kt++]-=be,et.vertices[kt++]-=$t,et.vertices[kt++]-=be,et.vertices[kt++]-=$t,et.vertices[kt++]-=be,et.vertices[kt++]-=$t,et.vertices[kt++]-=be}this._maxLineHeight=$*n;const At=et.mesh.geometry.getBuffer("aVertexPosition"),Vt=et.mesh.geometry.getBuffer("aTextureCoord"),te=et.mesh.geometry.getIndex();At.data=et.vertices,Vt.data=et.uvs,te.data=et.indices,At.update(),Vt.update(),te.update()}for(let Bt=0;Bt<l.length;Bt++)Ni.push(l[Bt]);this._font=t,this.dirty=!1}updateTransform(){this.validate(),this.containerUpdateTransform()}_render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0);const{distanceFieldRange:r,distanceFieldType:n,size:o}=Oe.available[this._fontName];if(n!=="none"){const{a:l,b:c,c:p,d:g}=this.worldTransform,_=Math.sqrt(l*l+c*c),x=Math.sqrt(p*p+g*g),v=(Math.abs(_)+Math.abs(x))/2,T=this.fontSize/o,b=t._view.resolution;for(const w of this._activePagesMeshData)w.mesh.shader.uniforms.uFWidth=v*r*T*b}super._render(t)}getLocalBounds(){return this.validate(),super.getLocalBounds()}validate(){const t=Oe.available[this._fontName];if(!t)throw new Error(`Missing BitmapFont "${this._fontName}"`);this._font!==t&&(this.dirty=!0),this.dirty&&this.updateText()}get tint(){return this._tintColor.value}set tint(t){if(this.tint!==t){this._tintColor.setValue(t);for(let r=0;r<this._activePagesMeshData.length;r++)this._activePagesMeshData[r].mesh.tint=t}}get align(){return this._align}set align(t){this._align!==t&&(this._align=t,this.dirty=!0)}get fontName(){return this._fontName}set fontName(t){if(!Oe.available[t])throw new Error(`Missing BitmapFont "${t}"`);this._fontName!==t&&(this._fontName=t,this.dirty=!0)}get fontSize(){var t;return(t=this._fontSize)!=null?t:Oe.available[this._fontName].size}set fontSize(t){this._fontSize!==t&&(this._fontSize=t,this.dirty=!0)}get anchor(){return this._anchor}set anchor(t){typeof t=="number"?this._anchor.set(t):this._anchor.copyFrom(t)}get text(){return this._text}set text(t){t=String(t!=null?t:""),this._text!==t&&(this._text=t,this.dirty=!0)}get maxWidth(){return this._maxWidth}set maxWidth(t){this._maxWidth!==t&&(this._maxWidth=t,this.dirty=!0)}get maxLineHeight(){return this.validate(),this._maxLineHeight}get textWidth(){return this.validate(),this._textWidth}get letterSpacing(){return this._letterSpacing}set letterSpacing(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.dirty=!0)}get roundPixels(){return this._roundPixels}set roundPixels(t){t!==this._roundPixels&&(this._roundPixels=t,this.dirty=!0)}get textHeight(){return this.validate(),this._textHeight}get resolution(){return this._resolution}set resolution(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)}destroy(t){const{_textureCache:r}=this,n=Oe.available[this._fontName].distanceFieldType==="none"?gn:As;n.push(...this._activePagesMeshData);for(const o of this._activePagesMeshData)this.removeChild(o.mesh);this._activePagesMeshData=[],n.filter(o=>r[o.mesh.texture.baseTexture.uid]).forEach(o=>{o.mesh.texture=f.xE.EMPTY});for(const o in r)r[o].destroy(),delete r[o];this._font=null,this._tintColor=null,this._textureCache=null,super.destroy(t)}};_n.styleDefaults={align:"left",tint:16777215,maxWidth:0,letterSpacing:0};let da=null;const Qn=[".xml",".fnt"],yn={extension:{type:f.nw.LoadParser,priority:ce.Normal},name:"loadBitmapFont",test(d){return Qn.includes(f.P6.path.extname(d).toLowerCase())},testParse(d){return Pt(this,null,function*(){return ui.test(d)||Li.test(d)})},parse(d,t,r){return Pt(this,null,function*(){const n=ui.test(d)?ui.parse(d):Li.parse(d),{src:o}=t,{page:l}=n,c=[];for(let _=0;_<l.length;++_){const x=l[_].file;let v=f.P6.path.join(f.P6.path.dirname(o),x);v=or(v,o),c.push(v)}const p=yield r.load(c),g=c.map(_=>p[_]);return Oe.install(n,g,!0)})},load(d,t){return Pt(this,null,function*(){return(yield f.Xd.ADAPTER.fetch(d)).text()})},unload(d){d.destroy()}};f.Rw.add(yn);const ws=class Vi extends pr{constructor(){super(...arguments),this._fonts=[],this._overrides=[],this._stylesheet="",this.fontsDirty=!1}static from(t){return new Vi(Object.keys(Vi.defaultOptions).reduce((r,n)=>fi(fe({},r),{[n]:t[n]}),{}))}cleanFonts(){this._fonts.length>0&&(this._fonts.forEach(t=>{URL.revokeObjectURL(t.src),t.refs--,t.refs===0&&(t.fontFace&&document.fonts.delete(t.fontFace),delete Vi.availableFonts[t.originalUrl])}),this.fontFamily="Arial",this._fonts.length=0,this.styleID++,this.fontsDirty=!0)}loadFont(t,r={}){const{availableFonts:n}=Vi;if(n[t]){const o=n[t];return this._fonts.push(o),o.refs++,this.styleID++,this.fontsDirty=!0,Promise.resolve()}return f.Xd.ADAPTER.fetch(t).then(o=>o.blob()).then(o=>Pt(this,null,function*(){return new Promise((l,c)=>{const p=URL.createObjectURL(o),g=new FileReader;g.onload=()=>l([p,g.result]),g.onerror=c,g.readAsDataURL(o)})})).then(c=>Pt(this,[c],function*([o,l]){const p=Object.assign({family:f.P6.path.basename(t,f.P6.path.extname(t)),weight:"normal",style:"normal",display:"auto",src:o,dataSrc:l,refs:1,originalUrl:t,fontFace:null},r);n[t]=p,this._fonts.push(p),this.styleID++;const g=new FontFace(p.family,`url(${p.src})`,{weight:p.weight,style:p.style,display:p.display});p.fontFace=g,yield g.load(),document.fonts.add(g),yield document.fonts.ready,this.styleID++,this.fontsDirty=!0}))}addOverride(...t){const r=t.filter(n=>!this._overrides.includes(n));r.length>0&&(this._overrides.push(...r),this.styleID++)}removeOverride(...t){const r=t.filter(n=>this._overrides.includes(n));r.length>0&&(this._overrides=this._overrides.filter(n=>!r.includes(n)),this.styleID++)}toCSS(t){return[`transform: scale(${t})`,"transform-origin: top left","display: inline-block",`color: ${this.normalizeColor(this.fill)}`,`font-size: ${this.fontSize}px`,`font-family: ${this.fontFamily}`,`font-weight: ${this.fontWeight}`,`font-style: ${this.fontStyle}`,`font-variant: ${this.fontVariant}`,`letter-spacing: ${this.letterSpacing}px`,`text-align: ${this.align}`,`padding: ${this.padding}px`,`white-space: ${this.whiteSpace}`,...this.lineHeight?[`line-height: ${this.lineHeight}px`]:[],...this.wordWrap?[`word-wrap: ${this.breakWords?"break-all":"break-word"}`,`max-width: ${this.wordWrapWidth}px`]:[],...this.strokeThickness?[`-webkit-text-stroke-width: ${this.strokeThickness}px`,`-webkit-text-stroke-color: ${this.normalizeColor(this.stroke)}`,`text-stroke-width: ${this.strokeThickness}px`,`text-stroke-color: ${this.normalizeColor(this.stroke)}`,"paint-order: stroke"]:[],...this.dropShadow?[this.dropShadowToCSS()]:[],...this._overrides].join(";")}toGlobalCSS(){return this._fonts.reduce((t,r)=>`${t}
            @font-face {
                font-family: "${r.family}";
                src: url('${r.dataSrc}');
                font-weight: ${r.weight};
                font-style: ${r.style};
                font-display: ${r.display};
            }`,this._stylesheet)}get stylesheet(){return this._stylesheet}set stylesheet(t){this._stylesheet!==t&&(this._stylesheet=t,this.styleID++)}normalizeColor(t){return Array.isArray(t)&&(t=f.P6.rgb2hex(t)),typeof t=="number"?f.P6.hex2string(t):t}dropShadowToCSS(){let t=this.normalizeColor(this.dropShadowColor);const r=this.dropShadowAlpha,n=Math.round(Math.cos(this.dropShadowAngle)*this.dropShadowDistance),o=Math.round(Math.sin(this.dropShadowAngle)*this.dropShadowDistance);t.startsWith("#")&&r<1&&(t+=(r*255|0).toString(16).padStart(2,"0"));const l=`${n}px ${o}px`;return this.dropShadowBlur>0?`text-shadow: ${l} ${this.dropShadowBlur}px ${t}`:`text-shadow: ${l} ${t}`}reset(){Object.assign(this,Vi.defaultOptions)}onBeforeDraw(){const{fontsDirty:t}=this;return this.fontsDirty=!1,this.isSafari&&this._fonts.length>0&&t?new Promise(r=>setTimeout(r,100)):Promise.resolve()}get isSafari(){const{userAgent:t}=f.Xd.ADAPTER.getNavigator();return/^((?!chrome|android).)*safari/i.test(t)}set fillGradientStops(t){console.warn("[HTMLTextStyle] fillGradientStops is not supported by HTMLText")}get fillGradientStops(){return super.fillGradientStops}set fillGradientType(t){console.warn("[HTMLTextStyle] fillGradientType is not supported by HTMLText")}get fillGradientType(){return super.fillGradientType}set miterLimit(t){console.warn("[HTMLTextStyle] miterLimit is not supported by HTMLText")}get miterLimit(){return super.miterLimit}set trim(t){console.warn("[HTMLTextStyle] trim is not supported by HTMLText")}get trim(){return super.trim}set textBaseline(t){console.warn("[HTMLTextStyle] textBaseline is not supported by HTMLText")}get textBaseline(){return super.textBaseline}set leading(t){console.warn("[HTMLTextStyle] leading is not supported by HTMLText")}get leading(){return super.leading}set lineJoin(t){console.warn("[HTMLTextStyle] lineJoin is not supported by HTMLText")}get lineJoin(){return super.lineJoin}};ws.availableFonts={},ws.defaultOptions={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",letterSpacing:0,lineHeight:0,padding:0,stroke:"black",strokeThickness:0,whiteSpace:"normal",wordWrap:!1,wordWrapWidth:100};let Ss=ws;const Ui=class Wi extends q{constructor(t="",r={}){var v;super(f.xE.EMPTY),this._text=null,this._style=null,this._autoResolution=!0,this.localStyleID=-1,this.dirty=!1,this._updateID=0,this.ownsStyle=!1;const n=new Image,o=f.xE.from(n,{scaleMode:f.Xd.SCALE_MODE,resourceOptions:{autoLoad:!1}});o.orig=new f.Ae,o.trim=new f.Ae,this.texture=o;const l="http://www.w3.org/2000/svg",c="http://www.w3.org/1999/xhtml",p=document.createElementNS(l,"svg"),g=document.createElementNS(l,"foreignObject"),_=document.createElementNS(c,"div"),x=document.createElementNS(c,"style");g.setAttribute("width","10000"),g.setAttribute("height","10000"),g.style.overflow="hidden",p.appendChild(g),this.maxWidth=Wi.defaultMaxWidth,this.maxHeight=Wi.defaultMaxHeight,this._domElement=_,this._styleElement=x,this._svgRoot=p,this._foreignObject=g,this._foreignObject.appendChild(x),this._foreignObject.appendChild(_),this._image=n,this._loadImage=new Image,this._autoResolution=Wi.defaultAutoResolution,this._resolution=(v=Wi.defaultResolution)!=null?v:f.Xd.RESOLUTION,this.text=t,this.style=r}measureText(t){var x,v;const{text:r,style:n,resolution:o}=Object.assign({text:this._text,style:this._style,resolution:this._resolution},t);Object.assign(this._domElement,{innerHTML:r,style:n.toCSS(o)}),this._styleElement.textContent=n.toGlobalCSS(),document.body.appendChild(this._svgRoot);const l=this._domElement.getBoundingClientRect();this._svgRoot.remove();const{width:c,height:p}=l;(c>this.maxWidth||p>this.maxHeight)&&console.warn("[HTMLText] Large expanse of text, increase HTMLText.maxWidth or HTMLText.maxHeight property.");const g=Math.min(this.maxWidth,Math.ceil(c)),_=Math.min(this.maxHeight,Math.ceil(p));return this._svgRoot.setAttribute("width",g.toString()),this._svgRoot.setAttribute("height",_.toString()),r!==this._text&&(this._domElement.innerHTML=this._text),n!==this._style&&(Object.assign(this._domElement,{style:(x=this._style)==null?void 0:x.toCSS(o)}),this._styleElement.textContent=(v=this._style)==null?void 0:v.toGlobalCSS()),{width:g+n.padding*2,height:_+n.padding*2}}updateText(t=!0){return Pt(this,null,function*(){const{style:r,_image:n,_loadImage:o}=this;if(this.localStyleID!==r.styleID&&(this.dirty=!0,this.localStyleID=r.styleID),!this.dirty&&t)return;const{width:l,height:c}=this.measureText();n.width=o.width=Math.ceil(Math.max(1,l)),n.height=o.height=Math.ceil(Math.max(1,c)),this._updateID++;const p=this._updateID;yield new Promise(g=>{o.onload=()=>Pt(this,null,function*(){if(p<this._updateID){g();return}yield r.onBeforeDraw(),n.src=o.src,o.onload=null,o.src="",this.updateTexture(),g()});const _=new XMLSerializer().serializeToString(this._svgRoot);o.src=`data:image/svg+xml;charset=utf8,${encodeURIComponent(_)}`})})}get source(){return this._image}updateTexture(){const{style:t,texture:r,_image:n,resolution:o}=this,{padding:l}=t,{baseTexture:c}=r;r.trim.width=r._frame.width=n.width/o,r.trim.height=r._frame.height=n.height/o,r.trim.x=-l,r.trim.y=-l,r.orig.width=r._frame.width-l*2,r.orig.height=r._frame.height-l*2,this._onTextureUpdate(),c.setRealSize(n.width,n.height,o),this.dirty=!1}_render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),super._render(t)}_renderCanvas(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),super._renderCanvas(t)}getLocalBounds(t){return this.updateText(!0),super.getLocalBounds(t)}_calculateBounds(){this.updateText(!0),this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_onStyleChange(){this.dirty=!0}destroy(t){var n,o,l,c,p;typeof t=="boolean"&&(t={children:t}),t=Object.assign({},Wi.defaultDestroyOptions,t),super.destroy(t);const r=null;this.ownsStyle&&((n=this._style)==null||n.cleanFonts()),this._style=r,(o=this._svgRoot)==null||o.remove(),this._svgRoot=r,(l=this._domElement)==null||l.remove(),this._domElement=r,(c=this._foreignObject)==null||c.remove(),this._foreignObject=r,(p=this._styleElement)==null||p.remove(),this._styleElement=r,this._loadImage.src="",this._loadImage.onload=null,this._loadImage=r,this._image.src="",this._image=r}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._image.width/this.resolution}set width(t){this.updateText(!0);const r=f.P6.sign(this.scale.x)||1;this.scale.x=r*t/this._image.width/this.resolution,this._width=t}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._image.height/this.resolution}set height(t){this.updateText(!0);const r=f.P6.sign(this.scale.y)||1;this.scale.y=r*t/this._image.height/this.resolution,this._height=t}get style(){return this._style}set style(t){this._style!==t&&(t=t||{},t instanceof Ss?(this.ownsStyle=!1,this._style=t):t instanceof pr?(console.warn("[HTMLText] Cloning TextStyle, if this is not what you want, use HTMLTextStyle"),this.ownsStyle=!0,this._style=Ss.from(t)):(this.ownsStyle=!0,this._style=new Ss(t)),this.localStyleID=-1,this.dirty=!0)}get text(){return this._text}set text(t){t=String(t===""||t===null||t===void 0?" ":t),t=this.sanitiseText(t),this._text!==t&&(this._text=t,this.dirty=!0)}get resolution(){return this._resolution}set resolution(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)}sanitiseText(t){return t.replace(/<br>/gi,"<br/>").replace(/<hr>/gi,"<hr/>").replace(/&nbsp;/gi,"&#160;")}};Ui.defaultDestroyOptions={texture:!0,children:!1,baseTexture:!0},Ui.defaultMaxWidth=2024,Ui.defaultMaxHeight=2024,Ui.defaultAutoResolution=!0;let fa=null}}]);
